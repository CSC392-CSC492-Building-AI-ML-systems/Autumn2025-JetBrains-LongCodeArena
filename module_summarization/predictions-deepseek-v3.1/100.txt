==================
Request Managers
==================

The managers module provides classes for handling Ethereum JSON-RPC requests, including synchronous and asynchronous operations, transaction management, and signing.

.. contents::
   :local:

Classes
=======

RequestManager
--------------
.. autoclass:: RequestManager
   :members:
   :undoc-members:
   :show-inheritance:

ManagerWrapper
--------------
.. autoclass:: ManagerWrapper
   :members:
   :undoc-members:
   :show-inheritance:

BaseSendRawTransactionMixin
---------------------------
.. autoclass:: BaseSendRawTransactionMixin
   :members:
   :undoc-members:
   :show-inheritance:

Detailed Descriptions
=====================

RequestManager
--------------
The main manager class for handling JSON-RPC requests to Ethereum nodes.

**Constructor:**
    - ``__init__(self, provider)``: Initializes with a provider instance.

**Methods:**
    - ``setProvider(provider)``: Sets the provider for making requests.
    - ``request_blocking(method, params)``: Makes a synchronous request and returns the result.
    - ``request_async(method, params)``: Initiates an asynchronous request and returns a request ID.
    - ``receive_blocking(request_id, timeout=None)``: Blocks until the result for the given request ID is available.
    - ``receive_async(request_id, *args, **kwargs)``: Not implemented; raises NotImplementedError.

ManagerWrapper
--------------
A wrapper class that delegates all method calls to a wrapped RequestManager instance.

**Constructor:**
    - ``__init__(self, wrapped_manager)``: Initializes with a RequestManager to wrap.

**Properties:**
    - ``provider``: Returns the provider of the wrapped manager.
    - ``pending_requests``: Returns the pending requests of the wrapped manager.

**Methods:**
    All methods (``setProvider``, ``request_blocking``, ``request_async``, ``receive_blocking``, ``receive_async``) delegate to the wrapped manager.

BaseSendRawTransactionMixin
---------------------------
A mixin class that extends ManagerWrapper with functionality for constructing, signing, and sending raw transactions.

**Constructor:**
    - ``__init__(self, *args, **kwargs)``: Initializes internal data structures for tracking transactions and nonces.

**Methods:**
    - ``_get_nonces_and_cleanup(addr, chain_nonce)``: Internal method to clean up old transactions and return relevant nonces.
    - ``get_chain_nonce(addr)``: Retrieves the current transaction count (nonce) for an address from the blockchain.
    - ``get_nonce(addr)``: Computes the next usable nonce for an address, considering both on-chain and pending transactions.
    - ``get_transaction_signature(serialized_txn)``: Abstract method; must be implemented by subclasses to provide transaction signing.
    - ``sign_and_serialize_transaction(transaction)``: Signs and serializes a transaction object into a raw transaction.
    - ``construct_full_transaction(base_transaction)``: Expands a partial transaction object with default values (nonce, gasPrice, gas, value, to, data).
    - Overrides ``request_blocking`` to intercept ``eth_sendTransaction`` calls, construct full transactions, sign them, and send as raw transactions.

**Class Attributes:**
    - ``TXN_SENDING_METHODS``: A set of method names that are considered transaction-sending methods.

Notes
=====
- The module relies on several external libraries including ``uuid``, ``json``, ``collections``, ``gevent``, ``rlp``, and utilities from ``web3.utils``.
- Asynchronous operations use gevent for greenlet-based concurrency.
- Transaction serialization and signing use RLP (Recursive Length Prefix) encoding and Ethereum-specific cryptographic functions.