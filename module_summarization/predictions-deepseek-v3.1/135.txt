.. _camera_geometry:

===================
Camera Geometry
===================

.. currentmodule:: ctapipe.instrument

The `CameraGeometry` class provides a detailed description of the geometry
of a Cherenkov camera, including pixel positions, pixel shapes, and camera
layout. This is essential for working with images and data cubes from
Cherenkov telescopes.

Basic Usage
===========

Creating a CameraGeometry
-------------------------

You can create a `CameraGeometry` instance by specifying the camera name,
the number of pixels, and their positions:

.. code-block:: python

    from ctapipe.instrument import CameraGeometry
    import numpy as np

    # Example: Create a simple camera geometry with 4 pixels
    pix_x = np.array([-0.5, 0.5, -0.5, 0.5]) * u.m
    pix_y = np.array([-0.5, -0.5, 0.5, 0.5]) * u.m
    geom = CameraGeometry(
        camera_name="ExampleCam",
        pix_id=np.arange(4),
        pix_x=pix_x,
        pix_y=pix_y,
        pix_area=np.full(4, 1.0) * u.m**2,
    )

Working with Images
===================

The camera geometry is crucial for interpreting and manipulating images
recorded by Cherenkov cameras. Each pixel in the image corresponds to a
physical pixel in the camera.

Accessing Pixel Information
---------------------------

You can access various properties of the camera pixels:

.. code-block:: python

    # Get pixel positions
    pixel_positions = geom.pix_x, geom.pix_y

    # Get pixel areas
    areas = geom.pix_area

    # Get the number of pixels
    n_pixels = geom.n_pixels

Image Manipulation
------------------

The geometry can be used to manipulate images, for example, to rotate
or transform them:

.. code-block:: python

    # Rotate the image by 90 degrees
    rotated_geom = geom.rotate(90 * u.deg)

    # Transform to a different coordinate frame
    transformed_geom = geom.transform_to(camera_frame)

Data Cubes
==========

For analysis involving data cubes (time-series of images), the camera
geometry provides the spatial information for each time step.

Creating Image Masks
--------------------

You can create masks based on pixel properties:

.. code-block:: python

    # Create a mask for pixels within a certain radius
    mask = geom.get_border_pixel_mask(radius=0.4 * u.m)

    # Apply the mask to an image or data cube
    masked_image = image[mask]

Coordinate Systems
==================

The camera geometry uses the `CameraFrame` coordinate system by default,
which is a 2D coordinate system with the origin at the center of the camera.

.. code-block:: python

    # Get the coordinate frame
    frame = geom.frame

    # Convert to another coordinate system if needed
    ground_coords = geom.to_ground_frame()

Visualization
=============

The camera geometry can be visualized to understand the camera layout:

.. code-block:: python

    # Plot the camera geometry
    geom.plot()

    # Display with pixel indices
    geom.plot(show_pixel_index=True)

This is particularly useful for understanding the camera structure and
for debugging analysis procedures.

See Also
========

* :class:`CameraDescription`
* :class:`CameraReadout`
* :class:`SubarrayDescription`