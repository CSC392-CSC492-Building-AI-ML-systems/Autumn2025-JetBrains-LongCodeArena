Using review sessions
=====================

The ``Session`` class in the ftrack API provides an isolated session for interaction with an ftrack server. It handles authentication, caching, event handling, and entity management.

Initialization
--------------

A session is typically initialized with server connection details and authentication credentials:

.. code-block:: python

    session = Session(
        server_url='https://your-ftrack-server',
        api_key='your-api-key',
        api_user='your-username'
    )

Parameters
~~~~~~~~~~

* **server_url**: URL of the ftrack server (can also be set via FTRACK_SERVER environment variable)
* **api_key**: API key for authentication (can also be set via FTRACK_API_KEY environment variable)
* **api_user**: Username to record operations against (can also be set via FTRACK_API_USER environment variable or derived from system user)
* **auto_populate**: Whether to automatically fetch entity attributes from server when accessed (default: True)
* **plugin_paths**: List of paths to search for plugins (default: FTRACK_EVENT_PLUGIN_PATH environment variable)
* **cache**: Cache instance implementing ftrack_api.cache.Cache interface
* **cache_key_maker**: Key maker instance for cache key generation
* **auto_connect_event_hub**: Whether to automatically connect to event server (default: None)
* **schema_cache_path**: Path for schema caching (default: FTRACK_API_SCHEMA_CACHE_PATH environment variable or temporary directory)
* **plugin_arguments**: Additional arguments to pass to plugin register functions

Authentication
--------------

The session uses ``SessionAuthentication`` to attach authentication headers to all requests:

.. code-block:: python

    auth = SessionAuthentication(api_key, api_user)

This adds 'ftrack-api-key' and 'ftrack-user' headers to all outgoing requests.

Caching
-------

The session employs a layered caching system with a memory cache at the top level. Custom caches can be provided but should work with the built-in memory cache.

Event Handling
--------------

The session includes an event hub that can be automatically or manually connected to the event server for publishing and subscribing to events. Event hub connection happens in a background thread to improve startup performance.

Operations Tracking
-------------------

The session tracks pending operations through ``recorded_operations`` and can enable/disable operation recording via the ``record_operations`` attribute.

Best Practices
--------------

* Always close sessions when finished using ``session.close()``
* Check event hub connection status if plugins require connected event hub
* Use environment variables for consistent configuration across environments
* Be mindful of auto_populate setting's impact on performance

Example Usage
-------------

.. code-block:: python

    with Session(
        server_url='https://your-ftrack-server',
        api_key='your-api-key', 
        api_user='your-username'
    ) as session:
        # Perform operations
        project = session.query('Project').first()
        print(project['name'])