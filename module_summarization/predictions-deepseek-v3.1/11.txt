Working with entities
=====================

The ftrack API provides an object-oriented interface to interact with entities
stored on the ftrack server. Entities represent objects in the ftrack system
such as projects, tasks, assets, and users.

Entity Basics
-------------

Entities are Python objects that map to types defined in the ftrack schema.
Each entity has attributes that correspond to fields in the database and can
be accessed using standard Python attribute access::

    project = session.get('Project', 'project-id-123')
    print(project['name'])  # Dictionary-style access
    print(project.name)     # Attribute-style access

Entity attributes are automatically populated from the server when accessed
if they are not already available in the local session cache. This behavior
can be controlled using the ``auto_populate`` session property.

Entity Types
------------

The session provides several methods to work with different entity types:

- ``create(entity_type, data)`` - Create a new entity
- ``get(entity_type, entity_id)`` - Retrieve a specific entity by ID
- ``query(expression)`` - Query for entities using a custom expression
- ``delete(entity)`` - Mark an entity for deletion

Creating Entities
-----------------

To create a new entity, use the ``create`` method::

    task = session.create('Task', {
        'name': 'New Task',
        'parent_id': project['id']
    })

The entity is created locally first and will be persisted to the server when
``session.commit()`` is called.

Querying Entities
-----------------

The ``query`` method allows you to find entities using a query expression::

    # Find all tasks in a project
    tasks = session.query('Task where project_id is "{}"'.format(project['id']))
    
    for task in tasks:
        print(task['name'])

You can also use the more advanced query builder for complex queries.

Collections
-----------

Many entities contain collections of other entities. For example, a Project
has collections of tasks, assets, etc. These collections can be accessed
like regular attributes::

    for task in project['tasks']:
        print(task['name'])

Collections support various operations such as filtering, sorting, and
adding/removing entities.

Modifying Entities
------------------

Entity attributes can be modified using standard assignment::

    task['name'] = 'Updated Task Name'
    task.description = 'Updated description'

Changes are tracked locally and sent to the server when ``session.commit()``
is called.

Operations and Change Tracking
------------------------------

The session tracks all operations (create, update, delete) performed on
entities. These operations are stored in ``session.recorded_operations`` and
can be reviewed before committing::

    for operation in session.recorded_operations:
        print(operation)

To persist changes to the server, call ``session.commit()``. To discard
changes, use ``session.reset()``.

Entity Relationships
--------------------

Entities can have relationships to other entities. These can be accessed
through attributes that reference other entities::

    # Get the project for a task
    project = task['project']
    print(project['name'])

The API handles resolving these relationships automatically, fetching related
entities from the server as needed.

Custom Entities
---------------

The ftrack API supports custom entity types through the plugin system. Custom
entities behave exactly like built-in entities and can be created, queried,
and manipulated using the same methods.

Best Practices
--------------

- Always check if an entity exists using ``entity is not None`` before
  accessing its attributes
- Use the ``in`` operator to check if an entity has a particular attribute::
  
    if 'custom_attribute' in entity:
        value = entity['custom_attribute']

- Be mindful of automatic population - disable it with
  ``session.auto_populate = False`` for performance-critical code
- Use ``session.merge()`` to incorporate server-side changes into local
  entities