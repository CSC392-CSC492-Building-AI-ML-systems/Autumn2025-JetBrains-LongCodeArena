# Fleur Input/Output Parsers

This module provides functions to extract distinct parts of the FLEUR XML files for easy versioning and reuse.

## Functions

### `get_fleur_modes(xmltree, schema_dict, logger=None)`

Determine the calculation modes of FLEUR for the given XML file. Calculation modes are settings that change the produced files or output in the out.xml files.

**Parameters:**
- `xmltree`: etree representing the FLEUR XML file
- `schema_dict`: schema dictionary corresponding to the file version of the xmltree
- `logger`: logger object for logging warnings and errors (optional)

**Returns:**
Dictionary with all the extracted calculation modes containing the following keys:

- `jspin`: How many spins are considered in the calculation
- `noco`: Is the calculation non-collinear?
- `soc`: Is spin-orbit coupling included?
- `relax`: Is the calculation a structure relaxation?
- `spex`: Special mode for GW/Spex calculations
- `force_theorem`: Is a Force theorem calculation performed?
- `cf_coeff`: Crystal field coefficient settings
- `plot`: Plotting mode
- `film`: Is the structure a film system?
- `ldau`: Is LDA+U included?
- `dos`: Is it a density of states calculation?
- `band`: Is it a bandstructure calculation?
- `bz_integration`: How is the integration over the Brillouin-Zone performed?
- `greensf`: Green's function calculation mode
- `ldahia`: LDA+HIA calculation mode

### `get_nkpts(xmltree, schema_dict, logger=None)`

Get the number of k-points that will be used in the calculation specified in the given FLEUR XML file.

**Warning:** For file versions before Max5, only kPointList or kPointCount tags will work. However, for kPointCount there is no real guarantee that it will always correspond to the actual number of k-points, so a warning is generated.

**Parameters:**
- `xmltree`: etree representing the FLEUR XML file
- `schema_dict`: schema dictionary corresponding to the file version of the xmltree
- `logger`: logger object for logging warnings and errors (optional)

**Returns:**
Integer with the number of k-points

## Dependencies

- `lxml.etree`: For XML parsing
- `numpy`: For numerical operations
- `masci_tools.io.parsers.fleur_schema`: For schema version handling
- `masci_tools.io.common_functions`: For common functionality
- `masci_tools.util.typing`: For type annotations
- `masci_tools.io.fleur_xml`: For XML context handling
- `xpathbuilder`: For XPath query building

## Version Compatibility

The functions include version-specific handling for different FLEUR input file versions, with special considerations for:
- Version 0.27 and earlier: Force theorem handling
- Version 0.29 and later: Plotting mode interpretation
- Version 0.32 and later: Green's function and LDA+HIA calculations
- Version 0.33 and later: Crystal field coefficients
- Version 0.34 and later: GW/Spex mode attribute naming
- Version 0.35 and later: Torque calculation handling