.. _execute_api:

Executing Notebooks
===================

The ``nbconvert`` library provides preprocessors for executing Jupyter notebooks and handling language-specific cell magics. This document describes the API for these components.

ExecutePreprocessor
-------------------

.. autoclass:: nbconvert.preprocessors.execute.ExecutePreprocessor
   :members:
   :inherited-members:
   :show-inheritance:

The ``ExecutePreprocessor`` class is responsible for executing all code cells in a notebook. It inherits from both ``Preprocessor`` and ``NotebookClient`` (from ``nbclient``) to maintain backward compatibility with earlier versions of nbconvert.

Key Methods:

- ``preprocess(nb, resources=None, km=None)``: Executes each code cell in the notebook, modifying it in-place. Returns the executed notebook and resources dictionary.
- ``preprocess_cell(cell, resources, index)``: Processes an individual cell by executing it and returning the modified cell and resources.

The preprocessor handles kernel management, execution tracking, and widget metadata automatically during processing.

HighlightMagicsPreprocessor
---------------------------

.. autoclass:: nbconvert.preprocessors.execute.HighlightMagicsPreprocessor
   :members:
   :inherited-members:
   :show-inheritance:

The ``HighlightMagicsPreprocessor`` detects and tags code cells that use language magics (e.g., ``%%R``, ``%%bash``) to enable proper syntax highlighting during conversion.

Key Features:

- Detects magic extensions in cell sources using regular expressions
- Tags cells with ``magics_language`` metadata indicating the appropriate language
- Supports both built-in magic languages (R, bash, JavaScript, etc.) and user-configured extensions

Configuration:

The ``languages`` trait can be configured to add support for additional magic extensions:

.. code-block:: python

   c.HighlightMagicsPreprocessor.languages = {
       '%%custom': 'custom-language'
   }

Deprecated Function
-------------------

.. autofunction:: nbconvert.preprocessors.execute.executenb

Note: This function is deprecated and will be removed in a future version. Use ``nbclient.execute`` directly instead.

Exceptions
----------

.. autoexception:: nbconvert.preprocessors.execute.CellExecutionError

This exception is raised when cell execution fails and is imported from ``nbclient.exceptions`` for backward compatibility.