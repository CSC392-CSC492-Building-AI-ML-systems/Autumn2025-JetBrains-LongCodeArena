`filenode.rst`
=========

.. currentmodule:: tables.filenode

The :mod:`filenode` module provides a file interface for nodes inside PyTables database files, allowing users to read and write data as if working with ordinary Python files while storing content in an HDF5-based structure.

Overview
--------

File nodes simulate a filesystem within PyTables databases, supporting binary I/O operations. They are useful for embedding file-like data (e.g., serialized objects, binary logs, or custom data streams) directly into HDF5 files, leveraging PyTables' efficient storage and retrieval mechanisms.

Key Features
------------

- **File-like Interface**: Read and write using standard Python file operations.
- **Append-Only Writing**: Write operations (when enabled) only allow appending data; existing data cannot be overwritten.
- **Seekable**: Supports random access via ``seek()`` and ``tell()``.
- **Binary Mode**: Currently, only binary I/O is supported.
- **HDF5 Integration**: Seamlessly stores data as PyTables nodes, inheriting benefits like compression and chunking.

Usage
-----

Creating and using file nodes involves two primary functions:

- :func:`new_node`: Create a new file node.
- :func:`open_node`: Open an existing file node.

Example:

.. code-block:: python

   import tables as tb
   from tables.filenode import new_node, open_node

   with tb.open_file('example.h5', 'w') as f:
       # Create a new file node
       with new_node(f, '/file_data') as fnode:
           fnode.write(b'Hello, world!')

   with tb.open_file('example.h5', 'r') as f:
       # Open an existing file node
       with open_node(f.root.file_data) as fnode:
           data = fnode.read()
           print(data)  # Output: b'Hello, world!'

API Reference
-------------

Classes
~~~~~~~

.. autoclass:: RawPyTablesIO
   :members:
   :inherited-members:

The :class:`RawPyTablesIO` class is the base implementation for raw binary I/O on HDF5 files using PyTables. It inherits from :class:`io.RawIOBase` and implements methods like ``readinto``, ``seek``, ``truncate``, and others, providing the core functionality for file node operations.

Functions
~~~~~~~~~

.. autofunction:: new_node
.. autofunction:: open_node

Attributes
~~~~~~~~~~

.. data:: NodeType
   :annotation: = 'file'

   Value for the ``NODE_TYPE`` node system attribute.

.. data:: NodeTypeVersions
   :annotation: = [1, 2]

   Supported values for the ``NODE_TYPE_VERSION`` node system attribute.

Notes
-----

- File nodes are append-only for writes; truncation is only allowed for growing the file.
- The module is fully compliant with the Python :mod:`io` module interfaces (since version 3.0).
- Read access is always available; write access depends on the file mode (e.g., ``'a+'`` allows appending).

See Also
--------

- :ref:`filenode_usersguide` for a detailed user guide.
- The :mod:`io` module for base I/O interfaces in Python.

Version History
---------------

- **Version 3.0**: The module was completely rewritten for full compliance with the :mod:`io` module.