# Storage Driver Documentation

## Overview

The Storage driver system provides a flexible interface for storing and retrieving data using a NetCDF backend (or other storage systems). The core component is the `StorageInterfaceDirVar` class, which enables dynamic creation and management of variables and directories through an intuitive attribute-based interface.

## Core Components

### StorageInterfaceDirVar

The Storage Interface Directory/Variable (SIDV) class is a versatile, dynamic class that structures variables stored on disk by representing them as methods of the StorageInterface and other SIDV instances.

**Key Characteristics:**
- New variables and folders are created by simply accessing them as properties
- Data is not kept in memory - operations read/write directly to disk on demand
- Never meant to be instantiated directly (should be used through StorageInterface)
- Provides both directory and variable functionality through a unified interface

#### Initialization

```python
def __init__(self, name, storage_interface, predecessor=None)
```

**Parameters:**
- `name` (string): Name of the storage variable on disk
- `storage_interface`: Main interface handling top-level I/O operations
- `predecessor`: Directory-like SIDV above this instance (for path construction)

#### Core Methods

##### write(data, at_index=None)
Writes data to a variable. Can overwrite specific indices in appendable variables.

**Parameters:**
- `data`: Data to be written to disk (processed by storage system)
- `at_index` (int, optional): Index to overwrite in appendable variables

**Raises error if:** Instance is a directory

**Examples:**
```python
# Store numpy array
x = np.eye(3)
my_store.my_arr.write(x)

# Update specific index in appendable variable
my_store.the_list.write([1,1,1], at_index=0)
```

##### append(data)
Appends data to a variable, expanding the first dimension dynamically.

**Parameters:**
- `data`: Data to append to the variable

**Raises error if:** Instance is a directory

**Example:**
```python
# Append multiple values
my_store.IAmADir.AnInt.append(756)
my_store.IAmADir.AnInt.append(757)
```

##### read()
Reads variable data from disk.

**Returns:** Data stored on variable (converted to Python types, possibly with unit handling)

**Raises error if:** Instance is unbound or a directory

## Usage Pattern

The SIDV class enables intuitive storage operations through attribute chaining:

```python
# Create storage interface
my_driver = NetCDFIODriver('my_store.nc')
my_store = StorageInterface(my_driver)

# Store data using natural attribute syntax
my_store.simulation_results.temperature_data.append(298.15)
my_store.configuration.parameters.write({'cutoff': 12.0})

# Read data back
results = my_store.simulation_results.temperature_data.read()
```

## Implementation Notes

- The class automatically binds to storage variables on first access
- Metadata is managed through an internal buffer system
- Directory vs variable status is determined dynamically
- Error handling distinguishes between missing variables (KeyError) and system problems (AttributeError)

## Dependencies

- Requires `iodrivers.NetCDFIODriver` for NetCDF backend operations
- Uses Python's `abc` module for abstract base class support
- Compatible with Python 2 and 3