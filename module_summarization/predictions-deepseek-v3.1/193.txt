The Metadata Routing API
=======================

The Metadata Routing API in scikit-learn enables flexible and controlled passing of metadata such as sample weights or other supplementary data to different components of meta-estimators. This API is particularly useful for multi-output estimators and other meta-estimators that require routing metadata to their underlying base estimators.

Key Components
--------------

The API utilizes several key components from `sklearn.utils.metadata_routing`:

- `MetadataRouter`: A class that manages the routing of metadata to different methods of an estimator.
- `MethodMapping`: A structure that defines how methods of the meta-estimator map to methods of the underlying estimator(s).
- `process_routing`: A function that processes the routing information and prepares the metadata for the appropriate methods.
- `_routing_enabled`: A utility to check if metadata routing is enabled for a given context.
- `_raise_for_params`: A helper function to validate parameters used in metadata routing.

Usage in Multi-Output Estimators
--------------------------------

Multi-output estimators such as `MultiOutputRegressor`, `MultiOutputClassifier`, `ClassifierChain`, and `RegressorChain` leverage the Metadata Routing API to pass metadata like `sample_weight` to their base estimators. For example:

- In `_fit_estimator`, the `sample_weight` and other `fit_params` are passed directly to the `fit` method of the base estimator.
- In `_partial_fit_estimator`, similar parameters are routed to the `partial_fit` method.

These functions ensure that metadata is correctly handled whether the underlying estimator supports metadata routing or not.

Implementation Details
----------------------

The API is designed to be extensible and integrates with scikit-learn's validation and cloning mechanisms. It checks for the availability of methods in sub-estimators (using `_available_if_estimator_has`) and ensures that metadata is only passed when appropriate.

The routing process involves:

1. Defining how methods map between the meta-estimator and base estimators.
2. Validating that the required parameters are present and correctly formatted.
3. Cloning the base estimator to avoid in-place modifications.
4. Passing the metadata to the respective methods during fit or partial_fit.

This approach maintains the consistency and robustness of scikit-learn's estimator interface while enabling advanced metadata handling capabilities.

Note: The Metadata Routing API is part of scikit-learn's utilities and is primarily intended for internal use within meta-estimators. Users typically interact with it indirectly through the parameters of meta-estimators.