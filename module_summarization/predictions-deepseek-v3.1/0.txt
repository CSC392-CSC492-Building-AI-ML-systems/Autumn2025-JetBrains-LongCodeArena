Working with assignments and allocations
=========================================

The ftrack API provides functionality to manage assignments and allocations of tasks and resources. This section covers common operations and patterns when working with these entities.

Creating assignments
-------------------

Assignments represent the relationship between a task and a user (resource). To create a new assignment:

.. code-block:: python

    # Create a new assignment
    assignment = session.create('Assignment', {
        'task_id': task['id'],
        'resource_id': user['id']
    })
    session.commit()

Querying assignments
-------------------

You can query assignments using the standard query syntax:

.. code-block:: python

    # Find all assignments for a specific task
    assignments = session.query('Assignment where task_id is "{0}"'.format(task_id))
    
    # Find all assignments for a specific user
    assignments = session.query('Assignment where resource_id is "{0}"'.format(user_id))

Managing allocations
-------------------

Allocations represent the scheduled time or resource allocation for assignments:

.. code-block:: python

    # Create time allocation for an assignment
    allocation = session.create('Allocation', {
        'assignment_id': assignment['id'],
        'start_date': datetime.datetime.now(),
        'end_date': datetime.datetime.now() + datetime.timedelta(hours=8),
        'hours': 8
    })
    session.commit()

Updating assignments and allocations
------------------------------------

Entities can be modified and the changes persisted to the server:

.. code-block:: python

    # Update assignment role
    assignment['role'] = new_role
    session.commit()
    
    # Update allocation hours
    allocation['hours'] = 10
    session.commit()

Deleting assignments and allocations
------------------------------------

To remove assignments or allocations:

.. code-block:: python

    # Delete an allocation
    session.delete(allocation)
    session.commit()
    
    # Delete an assignment (will typically cascade to related allocations)
    session.delete(assignment)
    session.commit()

Working with nested collections
-------------------------------

Assignments and allocations can be accessed through their parent entities:

.. code-block:: python

    # Access assignments through a task
    task = session.get('Task', task_id)
    for assignment in task['assignments']:
        print(assignment['resource']['username'])
        
        # Access allocations through an assignment
        for allocation in assignment['allocations']:
            print(allocation['hours'])

Best practices
--------------

- Always check for existing assignments before creating new ones to avoid duplicates
- Use the session cache to avoid unnecessary server requests when working with related entities
- Commit changes in batches when making multiple updates to improve performance
- Handle exceptions appropriately when working with allocations to ensure data consistency