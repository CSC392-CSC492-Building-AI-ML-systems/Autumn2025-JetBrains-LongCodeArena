.. _config:

Configuration
=============

The ASAB framework provides an enhanced configuration system built on top of Python's standard ``configparser`` module, offering additional features such as default configuration values, URL validation, automatic reading from ZooKeeper, and configuration file includes.

ConfigParser Class
------------------

The main configuration class is ``ConfigParser``, which extends ``configparser.ConfigParser`` with enhanced functionality.

Default Configuration Values
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The framework provides comprehensive default values for various configuration sections:

**General Section**
- ``config_file``: Path to configuration file (from ASAB_CONFIG environment variable)
- ``tick_period``: Default tick period in seconds (default: 1)
- ``var_dir``: Variable directory location (default: ``~/.{appname}``)
- ``pidfile``: PID file location (platform-specific when set to '!')
- ``working_dir``: Working directory for the application
- ``uid``/``gid``: User and group IDs for daemonization

**Metrics Section (asab:metrics)**
- ``native_metrics``: Enable native metrics collection (default: true)
- ``web_requests_metrics``: Enable web request metrics (default: false)
- ``expiration``: Metrics expiration time in seconds (default: 60)

**Documentation Section (asab:doc)**
- ``default_route_tag``: Default route tag for documentation (default: module_name)

**Logging Sections**
- Console, syslog, and file logging with configurable formats, levels, and rotation settings
- Environment variable support through ``ASAB_VERBOSE``
- Platform-specific syslog socket paths

**Additional Sections**
- Library configuration (Azure cache)
- Passwords section for secure credential storage
- Housekeeping scheduling configuration
- Automatic ZooKeeper configuration when ``ASAB_ZOOKEEPER_SERVERS`` environment variable is set

Configuration File Includes
~~~~~~~~~~~~~~~~~~~~~~~~~~~

The configuration system supports including additional configuration files:

.. code-block:: ini

   [general]
   include = /path/to/other/config.conf
   include = /path/to/*.conf

Includes can be specified with glob patterns and support nested includes. The system prevents infinite inclusion loops by tracking already included files.

Password Management
~~~~~~~~~~~~~~~~~~~

Secure password storage is supported through a dedicated passwords section:

.. code-block:: ini

   [connection:KafkaConnection]
   password=${passwords:kafka_password}
   
   [passwords]
   kafka_password=<MY_SECRET_PASSWORD>

Passwords are not exposed through the default API and remain secure within the configuration.

Methods
~~~~~~~

``add_defaults(dictionary: dict) -> None``
   Add default values to the current configuration. Existing values are preserved.

``_traverse_includes(includes: str, this_dir: str) -> None``
   Process included configuration files with support for nested includes and ZooKeeper configuration sources.

Environment Variables
~~~~~~~~~~~~~~~~~~~~~

- ``ASAB_CONFIG``: Specifies the main configuration file path
- ``ASAB_VERBOSE``: Controls verbose logging output
- ``ASAB_ZOOKEEPER_SERVERS``: Enables and configures ZooKeeper integration when set

Usage Example
-------------

.. code-block:: python

   from asab import config
   
   cfg = config.ConfigParser()
   cfg.add_defaults(config.ConfigParser._default_values)
   cfg.read('myapp.conf')

The configuration system automatically handles environment variables, file includes, and provides sensible defaults for various application components.