.. _running:

Running Migrations
==================

This module provides functionality for managing database migrations, including running them backwards and checking their status.

Backwards Migration
-------------------

The ``BackwardsMigrationManager`` class handles reversing migrations for a specific app.

Parameters:
    - ``app_name``: The name of the app to reverse migrations for
    - ``migration_id``: The target migration to reverse to (supports "all" or "1" for most recent)
    - ``auto_agree``: Automatically confirm prompts without user input
    - ``clean``: Delete migration files after successfully reversing them
    - ``preview``: Show SQL queries without executing them

The manager will:
1. Check which migrations have already run
2. Determine the migration range to reverse
3. Prompt for confirmation (unless auto_agree is True)
4. Execute the reverse migrations in order
5. Clean up migration files if requested

Command Line Interface
----------------------

The ``backwards`` function provides a CLI interface for reversing migrations:

.. code-block:: python

    await backwards(
        app_name="my_app",
        migration_id="all",
        auto_agree=False,
        clean=False,
        preview=False
    )

Special values for ``migration_id``:
    - ``"all"``: Reverse all migrations for the app
    - ``"1"``: Reverse only the most recent migration

Migration Status Checking
-------------------------

The ``CheckMigrationManager`` class provides functionality to check the status of migrations:

.. code-block:: python

    manager = CheckMigrationManager(app_name="my_app")
    statuses = await manager.get_migration_statuses()

Returns a list of ``MigrationStatus`` objects containing:
    - ``app_name``: The application name
    - ``migration_id``: The migration identifier
    - ``description``: Migration description
    - ``has_ran``: Boolean indicating if migration has been executed

Error Handling
--------------

All operations return ``MigrationResult`` objects indicating success/failure:
    - ``success``: Boolean result status
    - ``message``: Descriptive message about the operation outcome

The CLI interface will exit with code 1 if migrations fail to run successfully.