================
Piccolo Apps Module
================

This module provides the core classes and utilities for defining and managing Piccolo applications, including configuration, table discovery, and migration dependencies.

Classes
=======

AppConfig
---------

Each Piccolo app requires an ``AppConfig``, which is defined in the app's ``piccolo_app.py`` file. It configures the app's name, migration folder path, table classes, migration dependencies, and custom commands.

**Parameters**:

- ``app_name`` (str): The name of the app (e.g., 'article').
- ``migrations_folder_path`` (str): The path to the folder containing the app's migration files.
- ``table_classes`` (List[Type[Table]], optional): A list of table classes to register with the app for auto-migration detection. Defaults to an empty list.
- ``migration_dependencies`` (List[str], optional): A list of Piccolo app module paths that this app's migrations depend on (e.g., ``['piccolo.apps.user.piccolo_conf']``). Migrations for these apps run before this app's migrations.
- ``commands`` (List[Union[Callable, Command]], optional): A list of functions or coroutines to register as custom CLI commands for the app.

**Methods**:

- ``register_table(table_class: Type[Table])``: Registers a table class with the app and returns it.
- ``migration_dependency_app_configs`` (property): Returns a list of ``AppConfig`` instances from the app's migration dependencies.
- ``get_table_with_name(table_class_name: str)``: Returns a table class by name from the app; raises ``ValueError`` if not found.

AppRegistry
-----------

Records all Piccolo apps in a project, typically stored in ``piccolo_conf.py``.

**Parameters**:

- ``apps`` (List[str], optional): A list of paths to Piccolo app modules (e.g., ``['blog.piccolo_app']``).

Command
-------

A dataclass representing a CLI command, including its callable and any aliases.

**Parameters**:

- ``callable`` (Callable): The function or coroutine to execute.
- ``aliases`` (List[str], optional): Alternative names for the command.

MigrationModule
---------------

A module type for migration files, containing:

- ``ID`` (str): The migration identifier.
- ``VERSION`` (str): The migration version.
- ``DESCRIPTION`` (str): A description of the migration.
- ``forwards()`` (static method): The migration logic to apply changes.

PiccoloAppModule
----------------

A module type for Piccolo apps, containing:

- ``APP_CONFIG`` (AppConfig): The app's configuration instance.

Functions
=========

table_finder
------------

Discovers and imports ``Table`` subclasses from specified modules, with optional filtering by tags and exclusion of imported tables.

**Parameters**:

- ``modules`` (Sequence[str]): Module paths to search for tables (e.g., ``['blog.tables']``), from the project root.
- ``include_tags`` (Sequence[str], optional): Tags to include; ``'__all__'`` imports all tables. Defaults to ``['__all__']``.
- ``exclude_tags`` (Sequence[str], optional): Tags to exclude; overrides ``include_tags``. Defaults to an empty list.
- ``exclude_imported`` (bool, optional): If ``True``, excludes tables imported from other modules. Defaults to ``False``.

**Returns**:

- List[Type[Table]]: A list of discovered table classes.

Usage Example
=============

.. code-block:: python

    from piccolo.apps.apps import AppConfig, table_finder

    APP_CONFIG = AppConfig(
        app_name="my_app",
        migrations_folder_path="my_app/migrations",
        table_classes=table_finder(modules=["my_app.tables"]),
        migration_dependencies=[],
        commands=[],
    )

Notes
=====

- Use ``table_finder`` to automate table registration instead of manually importing and listing table classes.
- Migration dependencies ensure proper ordering when running migrations across multiple apps.
- Custom commands are accessible via the Piccolo CLI (e.g., ``piccolo my_app custom_command``).