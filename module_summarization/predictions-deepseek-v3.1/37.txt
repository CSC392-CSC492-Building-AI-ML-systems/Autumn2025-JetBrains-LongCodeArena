w_trace
=======

The ``w_trace`` command reconstructs and analyzes trajectory traces within WESTPA simulations by tracing segments back to their origins. It provides functionality to extract and process data along these trajectories, including auxiliary datasets and progress coordinate information.

Overview
--------

The ``w_trace`` tool is built around the ``Trace`` class, which represents a complete trace of a trajectory segment back to its initial state. This includes information about each segment in the trace, such as iteration number, segment ID, weight, timing information, and final progress coordinate values.

Key Features
------------

- **Trace Reconstruction**: Build complete trajectory traces from any segment in the simulation
- **Data Extraction**: Retrieve auxiliary data along trajectories from HDF5 files
- **Timepoint Analysis**: Process datasets organized by segment and timepoint
- **Backward Compatibility**: Supports both current and older HDF5 file formats

Trace Class
-----------

The core ``Trace`` class provides the main functionality:

.. code-block:: python

    class Trace:
        '''A class representing a trace of a certain trajectory segment back to its origin.'''
        
        def __init__(self, summary, endpoint_type, basis_state, initial_state, data_manager=None):
            # Initialization with trace summary and related information

Class Methods
~~~~~~~~~~~~~

``from_data_manager(n_iter, seg_id, data_manager=None)``
    Construct a trajectory trace whose last segment is identified by ``seg_id`` in iteration ``n_iter``. Returns a ``Trace`` instance containing the complete history back to the initial state.

Instance Methods
~~~~~~~~~~~~~~~~

``get_segment_data_slice(datafile, dsname, n_iter, seg_id, slice_=None, index_data=None, iter_prec=None)``
    Retrieve data from a specific dataset for a given iteration and segment. Supports both indexed and iteration-group-based data access patterns.

``trace_timepoint_dataset(dsname, slice_=None, auxfile=None, index_ds=None)``
    Extract time series data along the trajectory for datasets organized by segment and timepoint. Returns both the data trace and corresponding weight values.

Data Structure
--------------

The trace summary is stored as a structured numpy array with the following fields:

- ``n_iter``: Iteration number (n_iter_dtype)
- ``seg_id``: Segment identifier (seg_id_dtype)
- ``weight``: Segment weight (weight_dtype)
- ``walltime``: Wall clock time (utime_dtype)
- ``cputime``: CPU time (utime_dtype)
- ``final_pcoord``: Final progress coordinate value (pcoord_dtype)

Usage Example
-------------

.. code-block:: python

    # Create a trace from segment 5 in iteration 100
    trace = Trace.from_data_manager(100, 5)
    
    # Access trace information
    print(f"Trace length: {len(trace)} segments")
    print(f"Initial state: {trace.initial_state}")
    print(f"Basis state: {trace.basis_state}")
    
    # Get data from auxiliary files
    with h5py.File('auxdata.h5', 'r') as auxfile:
        data = trace.get_segment_data_slice(auxfile, 'my_dataset', 50, 25)

Dependencies
------------

- ``h5py``: HDF5 file handling
- ``numpy``: Numerical operations and array management
- ``westpa`` core modules: Segment, InitialState, and data management utilities

The ``w_trace`` tool is essential for analyzing trajectory pathways and extracting time-dependent data along specific trajectories in WESTPA simulations.