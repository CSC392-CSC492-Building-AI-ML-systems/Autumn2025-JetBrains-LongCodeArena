.. _config:

Configuration
=============

The ``asdf`` library provides a configuration system that allows users to
customize various aspects of ASDF file handling. Configuration options
are managed through the :class:`AsdfConfig` class and associated module
functions.

Module Functions
----------------

.. function:: get_config()

   Returns the current global configuration instance.

.. function:: config_context()

   Context manager for temporarily modifying configuration options.

Configuration Options
---------------------

The :class:`AsdfConfig` class provides the following configuration properties:

.. class:: AsdfConfig()

   Container for ASDF configuration options. Users should not construct
   this object directly; instead use the module-level functions.

   .. attribute:: resource_mappings

      :type: list of :class:`asdf.resource.ResourceMappingProxy`
      :access: read-only

      Get the list of registered resource mapping instances. Unless overridden
      by user configuration, this list contains every mapping registered with
      an entry point.

   .. method:: add_resource_mapping(mapping)

      Register a new resource mapping. The new mapping will take precedence
      over all previously registered mappings.

      :param mapping: Map of ``str`` resource URI to ``bytes`` content
      :type mapping: collections.abc.Mapping

   .. method:: remove_resource_mapping(mapping=None, *, package=None)

      Remove a registered resource mapping.

      :param mapping: Mapping to remove (optional)
      :type mapping: collections.abc.Mapping
      :param package: Remove only extensions provided by this package (optional)
      :type package: str

   .. method:: reset_resources()

      Reset registered resource mappings to the default list provided as
      entry points.

   .. attribute:: resource_manager

      :type: :class:`asdf.resource.ResourceManager`
      :access: read-only

      Get the ResourceManager instance. Includes resources from registered
      resource mappings and any mappings added at runtime.

   .. attribute:: extensions

      :type: list of :class:`asdf.extension.ExtensionProxy`
      :access: read-only

      Get the list of registered extensions.

   .. method:: add_extension(extension)

      Register a new extension. The new extension will take precedence over
      all previously registered extensions.

      :param extension: Extension to register
      :type extension: :class:`asdf.extension.AsdfExtension` or :class:`asdf.extension.Extension`

   .. method:: remove_extension(extension=None, *, package=None)

      Remove a registered extension.

      :param extension: Extension instance or URI pattern to remove (optional)
      :type extension: :class:`asdf.extension.AsdfExtension`, :class:`asdf.extension.Extension`, or str
      :param package: Remove only extensions provided by this package (optional)
      :type package: str

   .. method:: reset_extensions()

      Reset extensions to the default list registered via entry points.

   .. attribute:: default_version

      :type: str
      :access: read/write

      Get or set the default ASDF Standard version used for new files.

   .. attribute:: io_block_size

      :type: int
      :access: read/write

      Get or set the block size used when reading and writing files. A value
      of -1 uses the filesystem's preferred block size.

   .. attribute:: validate_on_read

      :type: bool
      :access: read/write

      Get or set whether to validate ASDF files during read operations.

   .. attribute:: legacy_fill_schema_defaults

      :type: bool
      :access: read/write

      Get or set whether to fill schema defaults for legacy ASDF files.

   .. attribute:: array_inline_threshold

      :type: int or None
      :access: read/write

      Get or set the threshold for inlining arrays in ASDF files.

Default Values
--------------

The following default values are used for configuration options:

- ``validate_on_read``: ``True``
- ``default_version``: Current default ASDF version
- ``legacy_fill_schema_defaults``: ``True``
- ``io_block_size``: ``-1`` (use filesystem preferred block size)
- ``array_inline_threshold``: ``None``

Thread Safety
-------------

All configuration operations are thread-safe and protected by reentrant locks.