=========================
Image Extraction
=========================

The `ctapipe.image.extractor` module provides algorithms for charge extraction, reducing the camera image to one value per pixel. These algorithms process waveforms to extract both charge and timing information.

Available Extractors
====================

The module includes the following extractor classes and functions:

**Main Classes:**
- `ImageExtractor` - Base class for all extractors
- `FlashCamExtractor` - Specialized extractor for FlashCam cameras
- `FullWaveformSum` - Sums the entire waveform
- `FixedWindowSum` - Extracts charge from a fixed window
- `GlobalPeakWindowSum` - Uses global peak position for window extraction
- `LocalPeakWindowSum` - Uses local peak position for window extraction
- `SlidingWindowMaxSum` - Finds window with maximum sum
- `NeighborPeakWindowSum` - Incorporates neighbor information for peak finding
- `BaselineSubtractedNeighborPeakWindowSum` - Baseline-subtracted version with neighbor info
- `TwoPassWindowSum` - Performs two-pass extraction

**Utility Functions:**
- `extract_around_peak` - Extracts around a specified peak position
- `extract_sliding_window` - Finds optimal window by sliding through waveform
- `neighbor_average_maximum` - Finds maximum using neighbor averaging
- `subtract_baseline` - Removes baseline from waveforms
- `integration_correction` - Applies integration correction factors

Core Functions
==============

extract_around_peak
-------------------
Numba-accelerated function that sums samples around a peak position and calculates pulse time using weighted average.

**Parameters:**
- `waveforms` (ndarray): Waveform data with shape (n_pix, n_samples)
- `peak_index` (int/ndarray): Peak index for each pixel
- `width` (int/ndarray): Integration window size
- `shift` (int/ndarray): Window shift from peak position
- `sampling_rate_ghz` (float): Camera sampling rate in GHz

**Returns:**
- `charge` (ndarray): Extracted charge with shape (n_pix)
- `peak_time` (ndarray): Peak time in nanoseconds

extract_sliding_window
----------------------
Finds the largest sum of consecutive slices and calculates timing information.

**Parameters:**
- `waveforms` (ndarray): Waveform data with shape (n_pix, n_samples)
- `width` (int/ndarray): Integration window size
- `sampling_rate_ghz` (float): Camera sampling rate in GHz

**Returns:**
- `charge` (ndarray): Extracted charge with shape (n_pix)
- `peak_time` (ndarray): Peak time in nanoseconds

Key Features
============

- **Universal Functions**: Many extractors use Numba's `@guvectorize` for efficient pixel-wise operations
- **Unit Handling**: Proper time unit conversion using sampling rate
- **Memory Efficiency**: Optimized implementations with caching support
- **Flexible Window Sizes**: Support for variable window sizes per pixel
- **Timing Extraction**: Simultaneous charge and timing information extraction

Usage
=====

All extractors follow a consistent interface, typically taking waveform data and camera-specific parameters, returning both charge and timing information. The module supports both fixed and dynamic window approaches, with various peak-finding strategies for optimal charge extraction.

Dependencies
============

- `numba` for JIT compilation and optimization
- `numpy` for array operations
- `astropy.units` for unit handling
- `scipy` for statistical operations
- `traitlets` for configuration management

The extractors are designed to work with ctapipe's container system (`DL1CameraContainer`) and integrate with other image processing components like cleaning, hillas parameterization, and invalid pixel handling.