=======================
Generating Pydantic Models
=======================

The ``tortoise.contrib.pydantic`` module provides utilities to automatically generate Pydantic models from Tortoise ORM models.

Basic Usage
-----------

To generate a Pydantic model from a Tortoise model, use the ``pydantic_model_creator()`` function:

.. code-block:: python

    from tortoise.contrib.pydantic import pydantic_model_creator
    from .models import User
    
    User_Pydantic = pydantic_model_creator(User)

PydanticMeta Configuration
--------------------------

You can configure the Pydantic model generation using a ``PydanticMeta`` inner class:

.. code-block:: python

    class User(Model):
        name = fields.CharField(max_length=255)
        email = fields.CharField(max_length=255)
        
        class PydanticMeta:
            exclude = ("password",)
            computed = ("email_domain",)
            max_recursion = 2

Available PydanticMeta options:

- ``include``: Tuple of field names to include (if not empty, only these fields will be included)
- ``exclude``: Tuple of field names to exclude from the generated model
- ``computed``: Tuple of computed field names to include
- ``backward_relations``: Include backward relations (default: True)
- ``max_recursion``: Maximum recursion level for related models (default: 3)
- ``allow_cycles``: Allow cycles in recursion (use with caution, default: False)
- ``exclude_raw_fields``: Exclude raw relation fields (those with _id suffixes, default: True)
- ``sort_alphabetically``: Sort fields alphabetically instead of declaration order (default: False)

Function Parameters
-------------------

The ``pydantic_model_creator()`` function accepts these parameters:

- ``cls``: The Tortoise Model class to convert
- ``name``: Custom name for the generated Pydantic model
- ``exclude``: Extra fields to exclude
- ``include``: Extra fields to include
- ``computed``: Extra computed fields to include
- ``allow_cycles``: Allow cycles in recursive models
- ``sort_alphabetically``: Sort fields alphabetically
- ``exclude_readonly``: Exclude readonly fields

Recursion Protection
-------------------

The system includes built-in recursion protection to prevent infinite loops when handling self-referential or circular relationships. Use ``max_recursion`` and ``allow_cycles`` parameters carefully to control this behavior.

Model Caching
-------------

Generated models are cached based on their configuration parameters. Models with identical configuration will return the same Pydantic model class instance.

Example
-------

.. code-block:: python

    # Generate basic model
    User_Pydantic = pydantic_model_creator(User)
    
    # Generate model with custom configuration
    UserSummary_Pydantic = pydantic_model_creator(
        User,
        exclude=("password", "email"),
        computed=("name_length",),
        sort_alphabetically=True
    )

This functionality allows for easy integration between Tortoise ORM models and Pydantic's powerful data validation and serialization capabilities.