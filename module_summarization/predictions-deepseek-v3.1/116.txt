.. _features:

Features
========

The ASDF Search Utilities provide a powerful and flexible mechanism for querying and manipulating nodes within an ASDF tree structure. The primary interface for this functionality is the ``AsdfSearchResult`` class.

AsdfSearchResult Class
----------------------

The ``AsdfSearchResult`` class represents the result of a search operation performed on an ASDF tree. It provides methods for further refining search results, formatting output, and performing replacement operations.

Initialization
~~~~~~~~~~~~~~

The class is initialized with search identifiers, a node reference, and optional formatting parameters:

- ``identifiers``: Path identifiers to the node
- ``node``: The target ASDF node
- ``filters``: List of filter functions (default: empty list)
- ``parent_node``: Parent node reference (optional)
- ``max_rows``: Maximum display rows (default: from configuration)
- ``max_cols``: Maximum display columns (default: from configuration)
- ``show_values``: Boolean flag to display primitive values (default: from configuration)

Key Methods
~~~~~~~~~~~

format()
^^^^^^^^
Modifies the display formatting parameters for the rendered tree output:

- ``max_rows``: Controls maximum lines to display (int, tuple, None, or NotSet)
- ``max_cols``: Controls maximum line length (int, None, or NotSet)
- ``show_values``: Toggles display of primitive values (bool or NotSet)

Returns a new ``AsdfSearchResult`` instance with updated formatting.

search()
^^^^^^^^
Further narrows search results using multiple query criteria:

- ``key``: Searches by dict key or list index using string patterns, exact matches, or regular expressions
- ``type``: Filters by node type using type objects, string patterns, or regular expressions
- ``value``: Searches by node value using string patterns, exact matches, or regular expressions
- ``filter``: Custom callable function for arbitrary filtering logic

The method supports complex pattern matching and type checking, including fully qualified type name matching for non-builtin types.

replace()
^^^^^^^^
Replaces all leaf nodes in the search results with a specified value:

- ``value``: The replacement value to assign to matching nodes

Performs in-place modification of the underlying ASDF tree structure.

Properties
~~~~~~~~~~

node
^^^^
Retrieves the leaf node when the search result contains exactly one matching node. Raises appropriate exceptions for multiple or no results.

Additional Features
-------------------

- **Pattern Compilation**: Automatic compilation of string patterns to regular expressions
- **Safe Equality Comparison**: Exception-safe equality checking for various object types
- **Type Qualification**: Automatic generation of fully qualified type names for pattern matching
- **Filter Chaining**: Support for combining multiple filters through successive search operations
- **Tree Walking**: Internal breadth-first tree traversal for replacement operations

The search functionality supports complex queries combining key, type, and value constraints with custom filter functions, making it suitable for sophisticated ASDF tree manipulation and analysis tasks.