Querying
========

The ``ftrack_api`` provides a powerful and flexible querying system to retrieve entities from the ftrack server. This document covers the main concepts and usage patterns for querying.

Basic Query
-----------

The primary method for querying is the :meth:`Session.query` method. It returns a :class:`Query` object that can be used to build and execute queries.

.. code-block:: python

    # Query all tasks
    tasks = session.query('Task')

    # Query specific fields
    tasks = session.query('Task', 'name, status')

Query Conditions
----------------

You can filter results by adding conditions using the :meth:`Query.filter` method or by passing conditions directly to the query.

.. code-block:: python

    # Using filter method
    tasks = session.query('Task').filter('status is "in_progress"')

    # Passing condition directly
    tasks = session.query('Task where status is "in_progress"')

Multiple conditions can be combined using logical operators:

.. code-block:: python

    tasks = session.query('Task').filter(
        'status is "in_progress" and project.name is "my_project"'
    )

Joins and Relationships
-----------------------

The query system supports navigating relationships between entities:

.. code-block:: python

    # Query tasks and include related project information
    tasks = session.query('Task select name, project.name')

    # Query projects and include all tasks
    projects = session.query('Project select name, tasks.name')

Sorting and Ordering
--------------------

Results can be ordered using the :meth:`Query.sort` method:

.. code-block:: python

    # Sort by name ascending
    tasks = session.query('Task').sort('name')

    # Sort by multiple fields
    tasks = session.query('Task').sort('project.name, name')

Pagination
----------

For large result sets, you can use pagination with :meth:`Query.offset` and :meth:`Query.limit`:

.. code-block:: python

    # Get first 10 tasks
    tasks = session.query('Task').limit(10)

    # Get next 10 tasks
    tasks = session.query('Task').offset(10).limit(10)

Query Options
-------------

Additional query options can be specified using :meth:`Query.options`:

.. code-block:: python

    # Disable auto-population of related entities
    tasks = session.query('Task').options(ftrack_api.query.AutoPopulate(False))

Caching
-------

Query results are cached by default. You can control caching behavior:

.. code-block:: python

    # Bypass cache
    tasks = session.query('Task').options(ftrack_api.query.Cache(False))

Query Results
-------------

Query results are returned as collections that can be iterated over:

.. code-block:: python

    for task in session.query('Task'):
        print(task['name'])

You can also get the first result:

.. code-block:: python

    task = session.query('Task').first()

Or count the number of results:

.. code-block:: python

    count = session.query('Task').count()

Advanced Queries
----------------

The query system supports more advanced features like:

- Subqueries
- Aggregate functions
- Custom expressions
- Union queries

Refer to the API documentation for :class:`ftrack_api.query.Query` for complete details on available methods and options.