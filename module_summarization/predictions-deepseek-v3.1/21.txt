w_eddist
========

Calculate time-resolved transition-event duration distribution from kinetics results.

Synopsis
--------

.. code-block:: bash

   w_eddist [-h] [--version] [-r RCFILE] [--max-queue-length MAX_QUEUE_LENGTH]
            [--work-manager WORK_MANAGER] [--n-workers N_WORKERS] [--serial]
            [-W WEST_H5FILE] [-o OUTPUT] [-b BINS] [--ignore-out-of-range]
            [--initpoint INITPOINT] KINETICS_FILE ISTATE FSTATE

Description
-----------

This tool calculates time-resolved transition-event duration distributions using the results from ``w_kinetics trace``. It generates normalized histograms of event durations across iterations, which can be used for further analysis and visualization.

Source Data
-----------

Source data is collected from the results of ``w_kinetics trace`` (see ``w_kinetics trace --help`` for more information on generating this dataset).

Histogram Binning
-----------------

By default, histograms are constructed with 100 bins in each dimension. This can be overridden by specifying ``-b/--bins``, which accepts several argument formats:

- A single integer N: N uniformly spaced bins will be used in each dimension.
- A sequence of integers N1,N2,... (comma-separated): N1 uniformly spaced bins for the first dimension, N2 for the second, etc.
- A list of lists [[B11, B12, B13,...], [B21, B22, B23,...],...]: Custom bin boundaries for each dimension (evaluated using Python's ``eval`` with ``np`` available).

The first two formats trigger a scan of all data to determine min/max values, which may be expensive for large datasets. The list-of-lists format avoids this by allowing explicit bin boundary specification.

Note: These bins are unrelated to the bins used in WE sampling.

Output Format
-------------

The output file (specified by ``-o/--output``, default: "pdist.h5") contains the following datasets:

- ``histograms``: Normalized histograms. The first axis corresponds to iteration; remaining axes correspond to input dataset dimensions.
- ``/binbounds_0``, ``/binbounds_1``, ...: Vectors of bin boundaries for each dimension.
- ``/midpoints_0``, ``/midpoints_1``, ...: Vectors of bin midpoints for each dimension.
- ``n_iter``: Vector of iteration numbers corresponding to the histograms.

Subsequent Processing
---------------------

The output file can be plotted using the ``plothist`` program (see ``plothist --help`` for details).

Parallelization
---------------

The tool supports parallelized binning and input data reading by default. For simpler cases (pre-computed input, few segments), serial processing (``--serial``) may be more efficient.

Arguments
---------

KINETICS_FILE
  Input HDF5 file containing kinetics trace data (default: "kintrace.h5").

ISTATE
  Initial state index for transition events.

FSTATE
  Final state index for transition events.

Options
-------

-h, --help
  Show help message and exit.

--version
  Show version and exit.

-r RCFILE, --rcfile RCFILE
  Specify WESTPA configuration file.

--max-queue-length MAX_QUEUE_LENGTH
  Maximum queue length for work manager.

--work-manager WORK_MANAGER
  Type of work manager to use.

--n-workers N_WORKERS
  Number of worker processes.

--serial
  Disable parallel processing; run in serial.

-W WEST_H5FILE, --west-h5file WEST_H5FILE
  Path to WESTPA data file.

-o OUTPUT, --output OUTPUT
  Output HDF5 file for histograms (default: "pdist.h5").

-b BINS, --bins BINS
  Bin specification (see "Histogram Binning" section).

--ignore-out-of-range
  Ignore data points outside specified bin boundaries.

--initpoint INITPOINT
  Starting point index for data processing.

Examples
--------

Calculate duration distribution using default settings:

.. code-block:: bash

   w_eddist kintrace.h5 0 1

Use custom bins and specify output file:

.. code-block:: bash

   w_eddist -o duration_dist.h5 -b "[[0,1,2,3,4,5], [0.0,0.5,1.0]]" kintrace.h5 0 1

Run in serial mode with 50 uniform bins:

.. code-block:: bash

   w_eddist --serial -b 50 kintrace.h5 0 1

See Also
--------

- ``w_kinetics trace``: Generate kinetics trace data.
- ``plothist``: Plot histograms from output files.