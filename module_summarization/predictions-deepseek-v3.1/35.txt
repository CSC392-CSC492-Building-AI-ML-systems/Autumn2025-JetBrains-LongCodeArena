`w_states` - WESTPA State Management Utility
============================================

The `w_states` command is used to display or manipulate basis (initial) and target (recycling) states for a WESTPA simulation. By default, states are displayed or dumped to files. The tool supports three primary modes of operation: displaying current states, appending new states, or replacing existing states.

Usage Modes
-----------

The command supports three mutually exclusive modes:

- ``--show``: Display current basis/target states (or dump to files)
- ``--append``: Append given basis/target states to those currently in use
- ``--replace``: Replace current basis/target states with those specified

Command Line Arguments
----------------------

Primary Options:
^^^^^^^^^^^^^^^^

- ``--bstate-file BSTATE_FILE``: Read (with --append/--replace) or write (with --show) basis state names, probabilities, and data references from/to the specified file
- ``--bstate``: Add a basis state specified as a string 'label,probability[,auxref]'. This argument may be specified multiple times to append states in the order given
- ``--tstate-file TSTATE_FILE``: Read (with --append/--replace) or write (with --show) target state names and representative progress coordinates from/to the specified file
- ``--tstate``: Add a target state specified as a string 'label,pcoord0[,pcoord1[,...]]'. This argument may be specified multiple times to append states in the order given

Basis State Management
----------------------

Basis states represent the initial states for trajectories. Each basis state requires:
- A label (string identifier)
- A probability value (float)
- An optional auxiliary reference

When using ``--replace`` mode with basis states, the tool automatically:
- Checks that the total probability of all basis states adds to unity (within numerical precision)
- Rescales probabilities if they don't sum to 1.0 and issues a warning
- Assigns progress coordinates to basis states
- Creates the initial basis state group in the HDF5 file

Note: Appending basis states is not permitted as this would require renormalizing basis state probabilities in ways that may be error-prone. Instead, use the workflow:
1. ``w_states --show --bstate-file=bstates.txt``
2. Edit the resulting bstates.txt file to include new desired basis states
3. ``w_states --replace --bstate-file=bstates.txt``

Target State Management
-----------------------

Target states represent recycling states for the simulation. Each target state requires:
- A label (string identifier)
- One or more progress coordinate values

The tool handles iteration management automatically. If an iteration has completed segments when using ``--replace``, the new states are applied to the next iteration.

Examples
--------

Display current states::
    
    w_states --show

Dump basis states to file::
    
    w_states --show --bstate-file=current_bstates.txt

Replace all states using files::
    
    w_states --replace --bstate-file=new_bstates.txt --tstate-file=new_tstates.txt

Add a target state via command line::
    
    w_states --append --tstate="TS1,1.5,2.0"

Implementation Notes
--------------------

The tool operates on the current iteration by default and automatically handles:
- Opening the HDF5 data file in append mode
- Retrieving the current iteration number from the data manager
- Proper state serialization/deserialization to/from text files
- Work manager coordination for parallel environments

The state file formats are human-readable text files with appropriate headers indicating the iteration number.