Publishing versions
==================

The ftrack API provides a robust mechanism for publishing versions of assets to an ftrack server. This process involves creating a new version of an asset, setting its metadata, and uploading associated files.

Authentication
--------------

Before publishing, ensure you have a valid session with the server. The session requires:

- **server_url**: The URL of the ftrack server (can be set via ``FTRACK_SERVER`` environment variable).
- **api_key**: Your API key for authentication (can be set via ``FTRACK_API_KEY`` environment variable).
- **api_user**: The username to record operations against (can be set via ``FTRACK_API_USER`` environment variable or derived from the system).

Example session creation:

.. code-block:: python

    import ftrack_api
    session = ftrack_api.Session()

Session Configuration
---------------------

The session supports several configuration options to customize behavior:

- **auto_populate**: Automatically fetch entity attributes from the server when accessed (default: True).
- **plugin_paths**: Paths to search for event plugins (default: from ``FTRACK_EVENT_PLUGIN_PATH``).
- **cache**: Custom cache implementation adhering to ``ftrack_api.cache.Cache`` interface.
- **cache_key_maker**: Key maker for cache entries (default: ``StringKeyMaker``).
- **auto_connect_event_hub**: Automatically connect to the event server for non-local events (default: None).
- **schema_cache_path**: Path for schema caching (default: from ``FTRACK_API_SCHEMA_CACHE_PATH`` or temporary directory).
- **plugin_arguments**: Additional arguments to pass to plugin register functions.

Publishing Process
------------------

1. **Create a new version**: Use the session to create a new version entity for your asset.
2. **Set metadata**: Populate version attributes such as version number, description, and status.
3. **Upload files**: Associate components (files) with the version and upload them to the server.
4. **Commit changes**: Persist all changes to the server by committing the session.

Example:

.. code-block:: python

    # Create a new version
    version = session.create('AssetVersion', {
        'asset': asset,
        'version': next_version_number,
        'comment': 'Published via API'
    })

    # Add a component (file)
    component = version.create_component(
        path='/path/to/file.ext',
        data={'name': 'main'}
    )

    # Commit the session
    session.commit()

Event System
------------

The session includes an event hub that allows publishing and subscribing to events. This can be used to extend the publishing process with custom logic. Plugins can be discovered from specified paths and are integrated automatically.

Notes
-----

- The session uses a layered cache with a memory cache at the top level for performance.
- Schema caching can significantly improve performance by reducing server round-trips.
- Always ensure the session is properly closed after use to release resources.

For advanced usage, refer to the specific classes and methods in the ftrack API documentation.