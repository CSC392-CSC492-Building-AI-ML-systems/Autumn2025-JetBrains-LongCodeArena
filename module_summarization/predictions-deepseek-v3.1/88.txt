using_sqlite_and_asyncio_effectively.rst
==========================================

SQLite with AsyncIO Integration
-------------------------------

This module provides asynchronous SQLite database support with type conversion adapters to ensure consistency with PostgreSQL behavior. It includes custom type handlers, batch processing capabilities, and transaction management for async applications.

Type Conversion
~~~~~~~~~~~~~~~

The module registers custom adapters and converters to handle various Python types when interacting with SQLite:

Input Adapters (Python → SQLite):
- Decimal → float
- UUID → string
- datetime.time → ISO format string
- datetime.date → ISO format string
- datetime.datetime → UTC ISO string (timezone aware converted to UTC)
- datetime.timedelta → total seconds
- list → JSON string (only str/int/float elements supported)

Output Converters (SQLite → Python):
- Numeric → Decimal
- Integer → int
- UUID → uuid.UUID
- Date → datetime.date
- Time → datetime.time
- Seconds → datetime.timedelta
- Boolean → bool (1=True, 0=False)
- Timestamp → datetime.datetime
- Timestamptz → datetime.datetime (UTC timezone)
- Array → list (from JSON)
- M2M → list (comma-separated string)

Async Batch Processing
~~~~~~~~~~~~~~~~~~~~~~

The ``AsyncBatch`` class provides asynchronous batch processing capabilities:

.. code-block:: python

    async with AsyncBatch(connection, query, batch_size=100) as batch:
        async for results in batch:
            # Process batch of results

Features:
- Automatic cursor management using async context manager
- Configurable batch size
- Automatic result processing using the query's processing method
- Proper resource cleanup on exit

Transaction Support
~~~~~~~~~~~~~~~~~~~

The module includes transaction type enumeration (incomplete in provided code) for managing database transactions in async contexts.

Dependencies
~~~~~~~~~~~~

- Requires ``aiosqlite`` for asynchronous SQLite support (loaded lazily)
- Uses Piccolo ORM components for query building and engine abstraction
- Built-in Python modules: contextvars, datetime, enum, os, sqlite3, uuid

Usage Example
~~~~~~~~~~~~~

.. code-block:: python

    from piccolo.engine.sqlite import AsyncBatch, Engine
    
    # Typically used through Piccolo's ORM interface
    async with engine.transaction():
        batch = AsyncBatch(connection, query, 100)
        async for results in batch:
            process_results(results)

Note: This module is designed to work within the Piccolo ORM ecosystem and provides PostgreSQL-compatible type handling for SQLite databases in asynchronous applications.