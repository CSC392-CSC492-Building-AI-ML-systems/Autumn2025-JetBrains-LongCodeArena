imputation.rst
============

Overview
--------

The imputation module implements the Multiple Imputation through Chained Equations (MICE) approach for handling missing data in statistical analyses. This procedure follows a structured iterative process to generate multiple complete datasets, allowing for robust statistical inference when dealing with incomplete data.

The MICE procedure consists of these key steps:

1. Initial mean imputation of missing values
2. Iterative cycling through variables with missing data:
   - Fitting appropriate regression models (imputation models)
   - Imputing missing values using predictive mean matching
3. Optional fitting of analysis models on completed datasets
4. Combining results across multiple imputations using Rubin's rules

The module provides two primary usage patterns:

- **MICEData**: For generating and exporting imputed datasets
- **MICE**: For directly fitting analysis models to imputed data and combining results

Key Features
------------

- Flexible specification of imputation models using Patsy formulas
- Support for different perturbation methods (gaussian, bootstrap)
- Predictive mean matching for realistic imputation values
- History callback system for monitoring imputation process
- Comprehensive plotting capabilities for diagnostics
- Memory-efficient implementation

Classes
-------

MICEData
~~~~~~~~
Wraps a pandas DataFrame to facilitate multiple imputation. Handles model specification, iteration, and provides methods for exporting imputed datasets.

**Key Methods:**
- ``set_imputer()``: Specify custom imputation models
- ``update_all()``: Perform one complete imputation cycle
- Iterator interface for sequential imputation

MICE
~~~~
Combines MICEData with analysis model specification. Automates the process of imputing data, fitting models, and combining results.

**Key Methods:**
- ``fit()``: Run the MICE procedure
- ``combine()``: Combine results across imputations

Usage Examples
--------------

Basic imputation with default models:

.. code-block:: python

   imp = mice.MICEData(data)
   for j in range(20):
       imp.update_all()
       imp.data.to_csv(f'data{j:02d}.csv')

Custom imputation model specification:

.. code-block:: python

   imp = mice.MICEData(data)
   imp.set_imputer('x1', formula='x2 + np.square(x2) + x3')
   # Continue with imputation...

Complete analysis with model fitting:

.. code-block:: python

   imp = mice.MICEData(data)
   mice_model = MICE(imp, model_formula='y ~ x1 + x2')
   results = mice_model.fit()
   print(results.summary())

References
----------

- Schafer, J.L. (1999). Multiple Imputation: A Primer
- Raghunathan, T.E. et al. (2001). A Multivariate Technique for Multiply Imputing Missing Values
- SAS Institute (2014). Predictive Mean Matching Method for Monotone Missing Data
- Gelman, A. et al. (2009). Multiple Imputation with Diagnostics in R

Note
----
This implementation prioritizes memory efficiency by overwriting intermediate datasets. Use the history callback functionality to preserve specific information across iterations if needed.