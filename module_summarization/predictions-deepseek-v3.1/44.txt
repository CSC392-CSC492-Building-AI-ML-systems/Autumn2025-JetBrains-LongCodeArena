.. _library_azure:

Azure Storage Library Provider
==============================

The ``AzureStorageLibraryProvider`` class is a library provider implementation that reads from a Microsoft Azure Storage container. It is designed to integrate with the ASAB library system to provide access to files and directories stored in Azure Blob Storage.

Configuration
-------------

To configure the Azure Storage library provider, use the following URL format:

``azure+https://ACCOUNT-NAME.blob.core.windows.net/BLOB-CONTAINER``

If the container's Public Access Level is not set to "Public access", you must create an Access Policy with "Read" and "List" permissions and include the Shared Access Signature (SAS) query string in the configuration URL:

``azure+https://ACCOUNT-NAME.blob.core.windows.net/BLOB-CONTAINER?sv=2020-10-02&si=XXXX&sr=c&sig=XXXXXXXXXXXXXX``

Class Details
-------------

.. autoclass:: AzureStorageLibraryProvider
   :members:
   :special-members: __init__
   :undoc-members:

Implementation Notes
--------------------

- The provider supports optional local caching of files to improve performance
- Cache directory can be configured via the ``library.azure_cache`` configuration option
- Uses aiohttp for asynchronous HTTP requests to Azure Blob Storage
- Parses Azure's XML response format to build a directory model
- Supports ETag-based caching to avoid re-downloading unchanged files

Dependencies
------------

- aiohttp
- xml.dom.minidom
- hashlib
- urllib.parse
- tempfile
- os
- logging

The provider integrates with the ASAB framework's configuration system and task service for asynchronous initialization and operation.