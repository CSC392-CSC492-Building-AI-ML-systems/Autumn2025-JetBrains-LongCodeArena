`w_assign`: Assigning Walkers to Bins for WESTPA Analysis
================================================================

Overview
--------
The `w_assign` tool assigns walkers to bins based on their progress coordinate values or other specified datasets, producing an assignment file (`assign.h5` by default) essential for subsequent analysis in WESTPA. This tool ensures consistency across analysis operations by processing the entire dataset, even when only a subset is used, enabling accurate trajectory tracing and macrostate identification.

Usage
-----
Run `w_assign` from the command line with appropriate options to specify input data, binning, and output parameters. The tool supports parallel processing for efficient computation on large datasets.

Input Data Specification
------------------------
Source data can be provided in one of two ways:

1. **Custom Function (--construct-dataset)**: 
   - Specify a Python function in `MODULE.FUNCTION` format.
   - The function is called as `function(n_iter, iter_group)`, where `n_iter` is the iteration number and `iter_group` is the corresponding HDF5 group in `west.h5`.
   - Must return data indexable as `[segment][timepoint][dimension]`.

2. **Dataset Specifications (--dsspecs)**:
   - List one or more datasets in the format `NAME[,file=FILENAME,slice=SLICE]`.
   - `NAME`: Dataset name in the HDF5 file.
   - `file`: HDF5 filename (default: `west.h5`).
   - `slice`: Python slice expression (e.g., `[0:2]`) to select specific data columns.

If neither option is provided, the default progress coordinate dataset `pcoord` is used.

Defining Macrostates
--------------------
Macrostates can be defined for kinetic analysis using one of three methods:

1. **Command Line (--states)**:
   - Specify states as coordinate tuples with optional labels (e.g., `bound:1.0` or `unbound:(2.5,2.5)`).
   - Unlabeled states are automatically named `stateN` (zero-based index).

2. **YAML File (--states-from-file)**:
   - Provide a YAML file listing states with names and coordinate tuples.
   - Example YAML content:
     ```
     ---
     states:
       - label: unbound
         coords:
           - [9.0, 1.0]
           - [9.0, 2.0]
       - label: bound
         coords:
           - [0.1, 0.0]
     ```

3. **Custom Function (--states-from-function)**:
   - Specify a Python function in `MODULE.FUNCTION` format.
   - The function is called with the bin mapper as an argument and must return a list of dictionaries, each containing a "coords" key with coordinate tuples and an optional "label" key.

Output File Structure
---------------------
The output HDF5 file (default: `assign.h5`) includes:

- **Attributes**:
  - `nbins` (Integer): Number of valid bins (assignments range from 0 to `nbins-1`).
  - `nstates` (Integer): Number of valid macrostates (0 if none defined; assignments range from 0 to `nstates-1`).

- **Datasets**:
  - `/assignments` [iteration][segment][timepoint]: Integer bin indices per segment and timepoint.
  - `/npts` [iteration]: Integer number of timepoints per iteration.
  - `/nsegs` [iteration]: Integer number of segments per iteration.
  - `/labeled_populations` [iteration][state][bin]: Floating-point bin populations labeled by the most recently visited macrostate. The last state index (`nstates-1`) corresponds to trajectories outside defined macrostates.
  - `/bin_labels` [bin]: Labels for bins (if applicable).

Notes
-----
- The tool requires processing all iterations to maintain consistency in trajectory tracing.
- Macrostates are optional but necessary for kinetics analysis tools like `w_kintrace` and `w_kinmat`.
- Parallel execution is supported for improved performance on large datasets.

See Also
--------
- `w_kintrace`: For tracing kinetics based on macrostate assignments.
- `w_kinmat`: For generating kinetic matrices from assigned states.