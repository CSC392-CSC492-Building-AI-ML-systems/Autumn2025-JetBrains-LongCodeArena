.. module:: statsmodels.stats.contingency_tables

Contingency Tables
==================

Methods for analyzing two-way contingency tables (i.e. frequency
tables for observations that are cross-classified with respect to two
categorical variables).

The main classes are:

  * :class:`Table` : implements methods that can be applied to any two-way
    contingency table.

  * :class:`SquareTable` : implements methods that can be applied to a square
    two-way contingency table.

  * :class:`Table2x2` : implements methods that can be applied to a 2x2
    contingency table.

  * :class:`StratifiedTable` : implements methods that can be applied to a
    collection of 2x2 contingency tables.

Also contains functions for conducting McNemar's test and Cochran's q
test.

Note that the inference procedures may depend on how the data were
sampled.  In general the observed units are independent and
identically distributed.

Classes
-------

.. class:: Table(table, shift_zeros=True)

   A two-way contingency table.

   Parameters
   ----------
   table : array_like
       A contingency table.
   shift_zeros : boolean
       If True and any cell count is zero, add 0.5 to all values
       in the table.

   Attributes
   ----------
   table_orig : array_like
       The original table is cached as `table_orig`.

   See Also
   --------
   statsmodels.graphics.mosaicplot.mosaic
   scipy.stats.chi2_contingency

   Notes
   -----
   The inference procedures used here are all based on a sampling
   model in which the units are independent and identically
   distributed, with each unit being classified with respect to two
   categorical variables.

   References
   ----------
   Definitions of residuals:
       https://onlinecourses.science.psu.edu/stat504/node/86

   Methods
   -------
   .. method:: test_nominal_association()

      Assess independence for nominal factors.

      Assessment of independence between rows and columns using
      chi^2 testing.  The rows and columns are treated as nominal
      (unordered) categorical variables.

      Returns
      -------
      A bunch containing the following attributes:

      statistic : float
          The chi^2 test statistic.
      df : integer
          The degrees of freedom of the reference distribution
      pvalue : float
          The p-value for the test.

   .. method:: test_ordinal_association(row_scores=None, col_scores=None)

      Assess independence between two ordinal variables.

      This is the 'linear by linear' association test, which uses
      weights or scores to target the test to have more power
      against ordered alternatives.

      Parameters
      ----------
      row_scores : array_like
          An array of numeric row scores
      col_scores : array_like
          An array of numeric column scores

      Returns
      -------
      A bunch with the following attributes:

      statistic : float
          The test statistic.
      null_mean : float
          The expected value of the test statistic under the null
          hypothesis.
      null_sd : float
          The standard deviation of the test statistic under the
          null hypothesis.
      zscore : float
          The Z-score for the test statistic.
      pvalue : float
          The p-value for the test.

      Notes
      -----
      The scores define the trend to which the test is most sensitive.

      Using the default row and column scores gives the
      Cochran-Armitage trend test.

   .. classmethod:: from_data(data, shift_zeros=True)

      Construct a Table object from data.

      Parameters
      ----------
      data : array_like
          The raw data, from which a contingency table is constructed
          using the first two columns.
      shift_zeros : boolean
          If True and any cell count is zero, add 0.5 to all values
          in the table.

      Returns
      -------
      A Table instance.

.. class:: SquareTable(table, shift_zeros=True)

   A square contingency table, in which the rows and columns
   correspond to the same categorical variable.

   Inherits from :class:`Table`.

.. class:: Table2x2(table, shift_zeros=True)

   A 2x2 contingency table.

   Inherits from :class:`Table`.

   Methods
   -------
   .. method:: odds_ratio()

      Returns the odds ratio.

   .. method:: log_odds_ratio()

      Returns the log odds ratio.

   .. method:: risk_ratio()

      Returns the risk ratio.

   .. method:: log_risk_ratio()

      Returns the log risk ratio.

.. class:: StratifiedTable(tables, shift_zeros=False)

   Analyses for a collection of 2x2 contingency tables.

   Parameters
   ----------
   tables : list_like
       A list of 2x2 contingency tables.
   shift_zeros : boolean
       If True and any cell count is zero, add 0.5 to all values
       in the table.

Functions
---------

.. function:: mcnemar(table, exact=False, correction=True)

   McNemar's test for paired nominal data.

   Parameters
   ----------
   table : array_like
       A 2x2 contingency table.
   exact : boolean
       If True, use the exact binomial test. Otherwise, use the
       chi-square approximation.
   correction : boolean
       If True, apply the continuity correction.

   Returns
   -------
   A bunch with the following attributes:

   statistic : float
       The test statistic.
   pvalue : float
       The p-value for the test.

.. function:: cochrans_q(x)

   Cochran's Q test for identical treatment effects.

   Parameters
   ----------
   x : array_like
       A two-dimensional array where each row represents a subject
       and each column represents a treatment.

   Returns
   -------
   A bunch with the following attributes:

   statistic : float
       The test statistic.
   df : integer
       The degrees of freedom.
   pvalue : float
       The p-value for the test.