Publishing for Web Review
=========================

Overview
--------

The ftrack API provides a robust framework for publishing content for web review. This functionality allows users to upload media, manage versions, and share content directly through the ftrack web interface for review and approval workflows.

Authentication
--------------

To publish content for web review, you must first establish a session with the ftrack server. Authentication is handled through an API key and user credentials:

.. code-block:: python

    import ftrack_api

    session = ftrack_api.Session(
        server_url='https://yourcompany.ftrackapp.com',
        api_key='your_api_key',
        api_user='your_username'
    )

The session handles authentication automatically using the provided credentials. You can also set these values through environment variables:

- ``FTRACK_SERVER``: The ftrack server URL
- ``FTRACK_API_KEY``: Your API key
- ``FTRACK_API_USER``: Your ftrack username

Creating a Review Session
-------------------------

To publish content for review, you first need to create a review session:

.. code-block:: python

    # Create a new review session
    review_session = session.create('ReviewSession', {
        'name': 'Dailies Review',
        'description': 'Weekly dailies review session',
        'status': 'open'
    })
    
    session.commit()

Adding Media to Review
----------------------

Once you have a review session, you can add media for review:

.. code-block:: python

    # Create a review session object (the item to be reviewed)
    review_object = session.create('ReviewSessionObject', {
        'name': 'Scene_001_v001',
        'review_session': review_session,
        'description': 'First version of Scene 001'
    })
    
    session.commit()

    # Add media to the review object
    media_component = session.create('ReviewSessionObjectComponent', {
        'review_session_object': review_object,
        'name': 'movie',
        'system_type': 'video',
        'file_path': '/path/to/your/media/file.mp4'
    })
    
    session.commit()

Managing Review Versions
------------------------

You can manage multiple versions of the same asset for review:

.. code-block:: python

    # Create a new version
    version = session.create('AssetVersion', {
        'asset': asset,
        'task': task,
        'comment': 'For review',
        'version': 1
    })
    
    session.commit()

    # Add a sequence of images or a movie file for web review
    component = session.create('FileComponent', {
        'name': 'movie',
        'container': version,
        'file_path': '/path/to/media.mp4'
    })
    
    session.commit()

Publishing Workflow
-------------------

The typical publishing workflow for web review involves several steps:

1. **Establish Session**: Create an authenticated session with the ftrack server
2. **Create Review Context**: Set up the review session and associated objects
3. **Upload Media**: Add media components to the review session
4. **Set Metadata**: Add any additional metadata or notes
5. **Publish**: Commit all changes to make them available for review

.. code-block:: python

    # Complete publishing example
    with ftrack_api.Session() as session:
        # Find or create project
        project = session.query('Project where name is "MyProject"').first()
        
        # Create a review session
        review_session = session.create('ReviewSession', {
            'name': 'Weekly Review',
            'project': project,
            'status': 'open'
        })
        
        # Create review object
        review_object = session.create('ReviewSessionObject', {
            'name': 'shot_001_v001',
            'review_session': review_session
        })
        
        # Add media component
        session.create('ReviewSessionObjectComponent', {
            'review_session_object': review_object,
            'name': 'movie',
            'system_type': 'video',
            'file_path': '/path/to/media.mp4'
        })
        
        # Commit all changes
        session.commit()

Best Practices
--------------

When publishing for web review, consider the following best practices:

1. **Use Context Managers**: Wrap your session in a context manager to ensure proper cleanup
2. **Batch Operations**: Group multiple operations together to reduce server round trips
3. **Error Handling**: Implement proper error handling for network and server issues
4. **Metadata**: Include descriptive metadata to make review items easily identifiable
5. **File Paths**: Ensure media files are accessible to the ftrack server for processing

.. code-block:: python

    try:
        with ftrack_api.Session() as session:
            # Your publishing code here
            session.commit()
    except ftrack_api.exceptions.ApiError as error:
        print(f'API Error: {error}')
    except Exception as error:
        print(f'General Error: {error}')

Access Control
--------------

Review sessions can be configured with different access levels:

.. code-block:: python

    # Create a private review session
    review_session = session.create('ReviewSession', {
        'name': 'Private Review',
        'is_public': False,  # Only invited users can access
        'project': project
    })

    # Invite specific users
    invitee = session.create('ReviewSessionInvitee', {
        'review_session': review_session,
        'user': user,
        'invitation_status': 'pending'
    })

    session.commit()

This ensures that only authorized users can access the review content, maintaining security for sensitive projects.