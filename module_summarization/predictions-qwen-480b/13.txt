Understanding Sessions
======================

A session in the ftrack API represents an isolated interaction with an ftrack server. It encapsulates the connection details, authentication, caching, and other configuration necessary to communicate with the server. Sessions are the primary entry point for working with ftrack data and provide methods for querying, creating, updating, and deleting entities.

Creating a Session
------------------

To create a session, instantiate the ``Session`` class, providing the required connection parameters:

.. code-block:: python

    import ftrack_api

    session = ftrack_api.Session(
        server_url='https://mycompany.ftrackapp.com',
        api_key='your-api-key',
        api_user='your-username'
    )

If the parameters are not provided explicitly, the session will attempt to retrieve them from the following environment variables:

- ``FTRACK_SERVER``: The URL of the ftrack server.
- ``FTRACK_API_KEY``: The API key for authentication.
- ``FTRACK_API_USER``: The username to record operations against.

Authentication
--------------

The session uses API key-based authentication. The ``SessionAuthentication`` class is responsible for attaching the necessary authentication headers to each request made to the ftrack server. These headers include:

- ``ftrack-api-key``: The API key for the session.
- ``ftrack-user``: The username associated with the session.

Caching
-------

Sessions support caching to improve performance by reducing the number of requests made to the server. A cache can be specified when creating a session. If no cache is provided, a default memory cache is used. The cache must implement the ``ftrack_api.cache.Cache`` interface.

.. note::

    The session automatically wraps the provided cache in a layered cache that includes a memory cache at the top level. This ensures that frequently accessed data is stored in memory for quick retrieval.

Plugins
-------

Sessions can load and manage plugins that extend the functionality of the API. Plugin paths can be specified when creating a session. If not specified, the session will look for plugins in the path defined by the ``FTRACK_EVENT_PLUGIN_PATH`` environment variable.

Event Hub
---------

Sessions can automatically connect to the ftrack event hub, enabling the publishing and subscribing to events. This behavior can be controlled by the ``auto_connect_event_hub`` parameter. If set to ``True``, the event hub will connect in a background thread to minimize the impact on session startup time.

Schema Caching
--------------

To improve performance, sessions can cache the ftrack schema. The cache path can be specified using the ``schema_cache_path`` parameter. If not provided, the session will use the path specified by the ``FTRACK_API_SCHEMA_CACHE_PATH`` environment variable. If neither is set, a temporary directory will be used. Schema caching can be disabled by setting ``schema_cache_path`` to ``False``.

Operations
----------

Sessions track operations (such as creating, updating, or deleting entities) in a queue. These operations are recorded and can be committed to the server in a batch. This allows for better performance and ensures data consistency.

Closing a Session
-----------------

When a session is no longer needed, it should be closed to free up resources. Although sessions are automatically closed when they are garbage collected, it is good practice to explicitly close them.

.. code-block:: python

    session.close()