How to generate Pydantic Models from Tortoise Models
====================================================

Tortoise ORM provides a convenient way to automatically generate `Pydantic Models <https://pydantic-docs.helpmanual.io/usage/models/>`_ from your Tortoise ORM models. This is useful for creating data validation layers, serialization, and API schemas based on your database models.

Basic Usage
-----------

To generate a Pydantic model from a Tortoise model, use the ``pydantic_model_creator`` function:

.. code-block:: python3

    from tortoise.contrib.pydantic import pydantic_model_creator
    from tortoise.models import Model
    from tortoise import fields

    class User(Model):
        id = fields.IntField(pk=True)
        username = fields.CharField(max_length=50)
        email = fields.CharField(max_length=100)

    # Generate Pydantic model
    User_Pydantic = pydantic_model_creator(User)

The generated ``User_Pydantic`` class will be a standard Pydantic model with fields matching your Tortoise model.

Customizing Model Generation
----------------------------

You can customize the generated Pydantic model using several parameters:

.. code-block:: python3

    # Custom name
    User_Pydantic = pydantic_model_creator(User, name="CustomUser")

    # Exclude specific fields
    User_Pydantic = pydantic_model_creator(User, exclude=("email",))

    # Include only specific fields
    User_Pydantic = pydantic_model_creator(User, include=("username",))

    # Add computed fields
    User_Pydantic = pydantic_model_creator(User, computed=("full_name",))

PydanticMeta Configuration
--------------------------

For more advanced configuration, you can define a ``PydanticMeta`` class within your Tortoise model:

.. code-block:: python3

    class User(Model):
        id = fields.IntField(pk=True)
        username = fields.CharField(max_length=50)
        email = fields.CharField(max_length=100)
        password_hash = fields.CharField(max_length=128)

        class PydanticMeta:
            # Only include these fields
            include = ("id", "username", "email")
            
            # Exclude these fields
            exclude = ("password_hash",)
            
            # Include computed fields
            computed = ("display_name",)
            
            # Control recursion settings
            max_recursion = 2
            allow_cycles = False
            backward_relations = True
            exclude_raw_fields = True
            sort_alphabetically = False

Configuration Options
---------------------

The ``PydanticMeta`` class supports the following options:

``include``
    If not empty, only fields this property contains will be in the pydantic model.

``exclude``
    Fields listed in this property will be excluded from pydantic model.

``computed``
    Computed fields can be listed here to use in pydantic model.

``backward_relations``
    Use backward relations without annotations - not recommended, it can be huge data without control.

``max_recursion``
    Maximum recursion level allowed (default: 3).

``allow_cycles``
    Allow cycles in recursion - This can result in HUGE data - Be careful! Please use this with ``exclude``/``include`` and sane ``max_recursion``.

``exclude_raw_fields``
    If we should exclude raw fields (the ones have _id suffixes) of relations.

``sort_alphabetically``
    Sort fields alphabetically. If not set (or ``False``) then leave fields in declaration order.

Advanced Features
-----------------

Recursive Models
^^^^^^^^^^^^^^^^

For self-referential models, you can control recursion behavior:

.. code-block:: python3

    class Category(Model):
        id = fields.IntField(pk=True)
        name = fields.CharField(max_length=100)
        parent = fields.ForeignKeyField('models.Category', related_name='children', null=True)

        class PydanticMeta:
            max_recursion = 2
            allow_cycles = True

Handling Relations
^^^^^^^^^^^^^^^^^^

The generator automatically handles foreign keys, reverse relations, and many-to-many relationships, creating nested Pydantic models as needed.

Computed Fields
^^^^^^^^^^^^^^^

You can include computed properties in your Pydantic models:

.. code-block:: python3

    class User(Model):
        first_name = fields.CharField(max_length=50)
        last_name = fields.CharField(max_length=50)

        def full_name(self) -> str:
            return f"{self.first_name} {self.last_name}"

        class PydanticMeta:
            computed = ("full_name",)

The generated Pydantic model will include the computed field as a property.