Filters
=======

The ``filters`` module provides a flexible and extensible framework for creating and managing event filters in Ethereum-based applications. It supports various types of filters including block filters, transaction filters, log filters, and whisper (shh) filters. The module leverages ``gevent`` for asynchronous processing and callback execution.

Core Components
---------------

Filter Parameters Construction
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. py:function:: construct_event_filter_params(event_abi, contract_address=None, argument_filters=None, topics=None, fromBlock=None, toBlock=None, address=None)

   Constructs filter parameters for Ethereum event filtering based on the provided arguments.

   :param event_abi: The ABI (Application Binary Interface) definition of the event
   :param contract_address: The address of the contract emitting the event
   :param argument_filters: Dictionary of argument name to value for filtering events
   :param topics: Predefined topics for the filter
   :param fromBlock: Starting block number for the filter
   :param toBlock: Ending block number for the filter
   :param address: Additional addresses to include in the filter
   :return: Tuple of (data_filters_set, filter_params)
   :rtype: tuple

Data Filter Construction
~~~~~~~~~~~~~~~~~~~~~~~~

.. py:function:: construct_data_filter_regex(data_filter_set)

   Constructs a regular expression pattern for matching log data against filter criteria.

   :param data_filter_set: Set of data filter patterns
   :return: Compiled regular expression object
   :rtype: re.Pattern

Base Filter Class
~~~~~~~~~~~~~~~~~

.. py:class:: Filter(web3, filter_id)

   Base class for all filter types. Implements core functionality for watching and processing filter events.

   .. py:attribute:: callbacks
      List of callback functions to execute when filter events occur

   .. py:attribute:: running
      Boolean indicating if the filter is currently active

   .. py:attribute:: stopped
      Boolean indicating if the filter has been stopped

   .. py:attribute:: poll_interval
      Time interval (in seconds) between polling operations

   .. py:method:: watch(*callbacks)

      Registers callback functions to be executed when filter events occur.

      :param callbacks: Functions to be called when events are detected

   .. py:method:: stop_watching(timeout=0)

      Stops the filter and uninstalls it from the Ethereum node.

      :param timeout: Maximum time to wait for the filter to stop

   .. py:method:: format_entry(entry)

      Hook method for subclasses to customize the format of entries passed to callbacks.

      :param entry: Raw entry data from the filter
      :return: Formatted entry data

   .. py:method:: is_valid_entry(entry)

      Hook method for subclasses to implement additional filtering logic.

      :param entry: Entry to validate
      :return: True if entry is valid, False otherwise

Filter Subclasses
-----------------

Block Filter
~~~~~~~~~~~~

.. py:class:: BlockFilter(web3, filter_id)

   Filter for monitoring new blocks on the Ethereum blockchain. Inherits all functionality from the base Filter class.

Transaction Filter
~~~~~~~~~~~~~~~~~~

.. py:class:: TransactionFilter(web3, filter_id)

   Filter for monitoring new transactions on the Ethereum network. Inherits all functionality from the base Filter class.

Log Filter
~~~~~~~~~~

.. py:class:: LogFilter(web3, filter_id, log_entry_formatter=None, data_filter_set=None)

   Filter for monitoring Ethereum event logs with advanced filtering capabilities.

   .. py:attribute:: data_filter_set
      Set of data filters for matching log entries

   .. py:attribute:: data_filter_set_regex
      Compiled regular expression for data filtering

   .. py:attribute:: log_entry_formatter
      Function for formatting log entries before passing to callbacks

   .. py:method:: get(only_changes=True)

      Retrieves log entries from the filter.

      :param only_changes: If True, returns only new entries since last check
      :return: List of formatted log entries

   .. py:method:: set_data_filters(data_filter_set)

      Sets data filters for the log filter.

      :param data_filter_set: Set of data filter patterns

Past Log Filter
~~~~~~~~~~~~~~~

.. py:class:: PastLogFilter(web3, filter_id, log_entry_formatter=None, data_filter_set=None)

   Filter for retrieving historical log entries. Processes existing logs immediately upon creation.

Shh Filter
~~~~~~~~~~

.. py:class:: ShhFilter(web3, filter_id)

   Filter for monitoring Whisper (shh) messages in Ethereum. Implements custom polling logic for the Whisper protocol.

Constants
---------

.. py:data:: ZERO_32BYTES

   Regular expression pattern matching 64 hexadecimal characters (32 bytes of data)