.. _w_states:

w_states
========

Synopsis
--------

**w_states** [options]

Description
-----------

The ``w_states`` command is used to display or manipulate basis (initial) or target (recycling) states for a WESTPA simulation. By default, the command displays the current basis and target states, or dumps them to files. Alternatively, it can replace or append states for use in the next iteration.

Modes of Operation
------------------

The following mutually exclusive modes are available:

--show
    Display current basis and target states. If ``--bstate-file`` or ``--tstate-file`` is specified, the states are written to the respective files. Otherwise, they are printed to standard output.

--append
    Append the given basis or target states to those currently in use. Note that appending basis states is not permitted directly. See the note below.

--replace
    Replace the current basis and/or target states with those specified via command-line arguments or files.

Basis States
------------

Basis states define the initial conditions of trajectories in a WESTPA simulation. They are specified by a label, probability, and optionally an auxiliary reference.

Appending basis states directly is not allowed. To add new basis states:

1. Use ``w_states --show --bstate-file=bstates.txt`` to dump current basis states to a file.
2. Edit ``bstates.txt`` to include the new basis states.
3. Use ``w_states --replace --bstate-file=bstates.txt`` to update the WESTPA HDF5 file.

Target States
-------------

Target states define the recycling criteria for trajectories. They are specified by a label and representative progress coordinates.

Appending target states is allowed and can be done directly via command-line arguments or a file.

Options
-------

--bstate-file=BSTATE_FILE
    Read (in ``--append`` or ``--replace`` mode) or write (in ``--show`` mode) basis state names, probabilities, and data references from/to the specified file.

--bstate=BSTATE
    Add the specified basis state to the list. Basis states are specified as a string in the format ``label,probability[,auxref]``. This option can be used multiple times.

--tstate-file=TSTATE_FILE
    Read (in ``--append`` or ``--replace`` mode) or write (in ``--show`` mode) target state names and representative progress coordinates from/to the specified file.

--tstate=TSTATE
    Add the specified target state to the list. Target states are specified as a string in the format ``label,pcoord0[,pcoord1[,...]]``. This option can be used multiple times.

Examples
--------

Display current states:

.. code-block:: bash

    w_states --show

Replace basis states from a file:

.. code-block:: bash

    w_states --replace --bstate-file=new_bstates.txt

Append a new target state:

.. code-block:: bash

    w_states --append --tstate="bound,1.0,2.5"

Replace all states:

.. code-block:: bash

    w_states --replace --bstate-file=bstates.txt --tstate-file=tstates.txt

Notes
-----

- When replacing basis states, the sum of probabilities must be 1.0. If not, probabilities will be rescaled automatically with a warning.
- Basis states require progress coordinates to be assigned, which is handled automatically by the command.
- Target states can be appended freely, but basis states must be replaced as a complete set to avoid inconsistencies.