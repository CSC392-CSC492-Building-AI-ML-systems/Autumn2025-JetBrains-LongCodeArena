```
w_direct
========

The ``w_direct`` command calculates state-to-state kinetics by tracing trajectories in a weighted ensemble simulation. It provides tools to compute fluxes, rates, and event durations between macrostates, with statistical analysis including confidence intervals.

Subcommands
-----------

init
~~~~

**Description:**
Calculate state-to-state rates and transition event durations by tracing trajectories.

A bin assignment file (usually "assign.h5") including trajectory labeling is required (see "w_assign --help" for information on generating this file).

This subcommand for w_direct is used as input for all other w_direct subcommands, which will convert the flux data in the output file into average rates/fluxes/populations with confidence intervals.

**Output format:**

The output file (-o/--output, by default "direct.h5") contains the following datasets:

``/conditional_fluxes`` [iteration][state][state]
  *(Floating-point)* Macrostate-to-macrostate fluxes. These are **not** normalized by the population of the initial macrostate.

``/conditional_arrivals`` [iteration][stateA][stateB]
  *(Integer)* Number of trajectories arriving at state *stateB* in a given iteration, given that they departed from *stateA*.

``/total_fluxes`` [iteration][state]
  *(Floating-point)* Total flux into a given macrostate.

``/arrivals`` [iteration][state]
  *(Integer)* Number of trajectories arriving at a given state in a given iteration, regardless of where they originated.

``/duration_count`` [iteration]
  *(Integer)* The number of event durations recorded in each iteration.

``/durations`` [iteration][event duration]
  *(Structured -- see below)*  Event durations for transition events ending during a given iteration. These are stored as follows:

    istate
      *(Integer)* Initial state of transition event.
    fstate
      *(Integer)* Final state of transition event.
    duration
      *(Floating-point)* Duration of transition, in units of tau.
    weight
      *(Floating-point)* Weight of trajectory at end of transition, **not** normalized by initial state population.

Because state-to-state fluxes stored in this file are not normalized by initial macrostate population, they cannot be used as rates without further processing. The ``w_direct kinetics`` command is used to perform this normalization while taking statistical fluctuation and correlation into account.

kinetics
~~~~~~~~

**Description:**
Calculate average rates/fluxes and associated errors from weighted ensemble data. Bin assignments (usually "assign.h5") and kinetics data (usually "direct.h5") data files must have been previously generated.

The evolution of all datasets may be calculated, with or without confidence intervals.

**Output format:**

The output file (-o/--output, usually "direct.h5") contains the following dataset:

``/avg_rates`` [state,state]
  (Structured) State-to-state rates based on entire window of iterations selected.

``/avg_total_fluxes`` [state]
  (Structured) Total fluxes into each state based on entire window of iterations selected.

``/avg_conditional_fluxes`` [state,state]
  (Structured) State-to-state fluxes based on entire window of iterations selected.

If --evolution-mode is specified, then additional datasets are available:

``/rate_evolution`` [window][state][state]
  (Structured) Time evolution of state-to-state rates.
```