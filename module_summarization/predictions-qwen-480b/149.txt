# FleurXMLModifier

The `FleurXMLModifier` class provides a robust way to organize and group modifications to Fleur's `inp.xml` input files. It allows you to collect multiple changes and apply them in a single operation, making it easier to manage complex input file modifications.

## Overview

This class acts as a low-level version of the `FleurinpModifier` found in `aiida_fleur`. Instead of directly modifying input files, it collects all modification tasks and executes them together when needed.

## Basic Usage

```python
from masci_tools.io.fleurxmlmodifier import FleurXMLModifier

fmode = FleurXMLModifier()

# Add changes by calling methods on this class
# Method names correspond to setting methods in xml_setters modules
fmode.set_inpchanges({'Kmax': 4.0})  # Set Kmax to 4.0
fmode.shift_value({'Gmax': 5.0})     # Add 5 to the current value of Gmax

# Set local orbital configuration on all iron atoms
fmode.set_species('all-Fe', {'lo': [{'n':3, 'l': 's', 'type': 'SCLO'},
                                    {'n':3, 'l': 'p', 'type': 'SCLO'}]})

# Apply changes to an input file
new_xmltree, additional_files = fmode.modify_xmlfile('/path/to/input/file/inp.xml')
```

## Key Features

### Task Management
- **Task Collection**: All modifications are stored as tasks and executed together
- **Undo Functionality**: `undo()` method to revert the last change
- **Bulk Revert**: `undo(revert_all=True)` to reset all added tasks
- **Task Lists**: Create modifiers from predefined task lists using `fromList()`

### Modification Methods
The class provides access to various XML modification functions from:
- `masci_tools.util.xml.xml_setters_names`
- `masci_tools.util.xml.xml_setters_basic`

These include methods for:
- Setting attribute values
- Modifying input parameters
- Configuring species-specific settings
- Handling n_mmp_mat files
- And many more XML manipulation operations

## Class Methods

### `fromList(task_list, *args, **kwargs)`
Create a `FleurXMLModifier` instance from a list of tasks.

**Parameters:**
- `task_list`: List of tuples where the first element is the method name and the second is a dictionary of arguments
- `*args, **kwargs`: Additional arguments passed to `__init__`

### `add_task_list(task_list)`
Add a list of tasks to the modifier.

**Parameters:**
- `task_list`: List of tuples with method names and their arguments

## Instance Methods

### `modify_xmlfile(xmlfile, schema_dict=None)`
Apply all collected modifications to an XML file.

**Parameters:**
- `xmlfile`: Path to the input XML file
- `schema_dict`: Optional schema dictionary for validation

**Returns:**
- Modified XML tree and any additional files created

### `undo(revert_all=False)`
Revert modifications.

**Parameters:**
- `revert_all`: If True, reverts all changes; otherwise reverts only the last change

### `get_avail_actions()`
Returns a dictionary of all available modification methods that can be called on the instance.

## Internal Structure

The class uses three main dictionaries to organize its functionality:
- `_xpath_functions`: Direct XPath-based modifications
- `_schema_dict_functions`: Schema-aware modifications
- `_nmmpmat_functions`: n_mmp_mat file specific modifications

These functions are automatically validated and executed when `modify_xmlfile()` is called.

## Validation

The class includes signature validation to ensure that method calls are properly formed before execution. This helps catch errors early in the modification process.