```
w_stateprobs
============

**Calculate state-to-state kinetics by tracing trajectories**

The ``w_stateprobs`` command calculates average populations and associated errors in state populations from weighted ensemble data. Bin assignments, including macrostate definitions, are required (see ``w_assign --help`` for more information).

This command is deprecated. Please use ``w_direct`` instead.

Command-Line Usage
------------------

::

    w_stateprobs [options]

Description
-----------

The ``w_stateprobs`` tool computes state population statistics from weighted ensemble trajectories by tracing paths through macrostates. It produces HDF5 output files containing average state populations and optional population evolution over time.

-----------------------------------------------------------------------------
Output Format
-----------------------------------------------------------------------------

The output file (``-o/--output``, usually ``stateprobs.h5``) contains the following dataset:

``/avg_state_pops [state]``
  Structured dataset containing population of each state across the entire specified range.

If ``--evolution-mode`` is specified, an additional dataset is available:

``/state_pop_evolution [window][state]``
  Structured dataset containing state populations based on windows of iterations. If ``--evolution-mode=cumulative``, windows begin at the iteration specified with ``--start-iter`` and grow in length by ``--step-iter``. If ``--evolution-mode=blocked``, windows are all of width ``--step-iter`` (except possibly the last), beginning at ``--start-iter``.

Dataset Structure
^^^^^^^^^^^^^^^^^

Each entry in the datasets contains the following fields:

- ``iter_start`` (Integer)
    Iteration at which the averaging window begins (inclusive).

- ``iter_stop`` (Integer)
    Iteration at which the averaging window ends (exclusive).

- ``expected`` (Floating-point)
    Expected (mean) value of the population within this window, in units of inverse tau.

- ``ci_lbound`` (Floating-point)
    Lower bound of the confidence interval on the population within this window, in units of inverse tau.

- ``ci_ubound`` (Floating-point)
    Upper bound of the confidence interval on the population within this window, in units of inverse tau.

- ``corr_len`` (Integer)
    Correlation length of the population within this window, in units of tau.

Dataset Attributes
^^^^^^^^^^^^^^^^^^

Each dataset is stamped with the following attributes:

- ``mcbs_alpha`` (Floating-point)
    Alpha value of confidence intervals (e.g., 0.05 for a 95% confidence interval).

- ``mcbs_nsets`` (Integer)
    Number of bootstrap data sets used in generating confidence intervals.

- ``mcbs_acalpha`` (Floating-point)
    Alpha value for determining correlation lengths.

-----------------------------------------------------------------------------
Command-Line Options
-----------------------------------------------------------------------------

``w_stateprobs`` accepts the following command-line options:

.. code-block:: text

    -h, --help            show this help message and exit
    --config CONFIG       Configuration file
    -o OUTPUT, --output OUTPUT
                          Output file (default: stateprobs.h5)
    --kinetics-file KINETICS_FILE
                          Kinetics file (default: assign.h5)
    --start-iter START_ITER
                          Starting iteration (default: 1)
    --stop-iter STOP_ITER
                          Stop iteration (default: last iteration in kinetics file)
    --step-iter STEP_ITER
                          Step iteration (default: 1)
    --evolution-mode {cumulative,blocked}
                          Evolution mode (default: None)
    --mcbs-alpha MCBS_ALPHA
                          Alpha value for confidence intervals (default: 0.05)
    --mcbs-nsets MCBS_NSETS
                          Number of bootstrap sets (default: 1000)
    --mcbs-acalpha MCBS_ACALPHA
                          Alpha value for autocorrelation analysis (default: 0.05)
    --window-size WINDOW_SIZE
                          Window size for block averaging (default: 1)

Examples
--------

Calculate state populations from iteration 1 to 100:

.. code-block:: bash

    w_stateprobs --start-iter 1 --stop-iter 100

Calculate state population evolution in cumulative windows:

.. code-block:: bash

    w_stateprobs --start-iter 1 --stop-iter 100 --step-iter 10 --evolution-mode cumulative

Notes
-----

- This command is a shim for backward compatibility with ``w_direct``.
- Bin assignments and macrostate definitions must be provided via the kinetics file (usually generated by ``w_assign``).
- The output is in HDF5 format and contains structured datasets with statistical analysis of state populations.
```