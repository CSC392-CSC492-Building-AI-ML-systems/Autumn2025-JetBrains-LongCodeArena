The Metadata Routing API
========================

.. currentmodule:: sklearn.utils.metadata_routing

Introduction
------------

The Metadata Routing API is a framework within scikit-learn that allows for the flexible and consistent routing of metadata (such as ``sample_weight``, ``classes``, or any additional parameters) through meta-estimators to their underlying base estimators. This API addresses the challenge of passing metadata through complex estimator chains, such as those involving ensemble methods, multioutput models, or other composite estimators.

The core idea is to enable meta-estimators to declare how they route metadata to their sub-estimators, ensuring that the right parameters reach the right components during fitting, prediction, or other operations.

Key Concepts
------------

- **Metadata**: Any additional information passed to estimator methods beyond the required input data (e.g., ``X``, ``y``). Examples include ``sample_weight``, ``classes``, or custom parameters.
- **Routing**: The process of directing metadata to the appropriate sub-estimators within a meta-estimator.
- **Meta-estimator**: An estimator that takes another estimator as a parameter (e.g., ``Pipeline``, ``GridSearchCV``, ``MultiOutputRegressor``).

Classes and Functions
---------------------

.. autosummary::
   :toctree: generated/
   :template: class.rst

   MetadataRouter
   MethodMapping

.. autosummary::
   :toctree: generated/
   :template: function.rst

   process_routing
   _routing_enabled
   _raise_for_params

Usage
-----

The Metadata Routing API is primarily used internally by scikit-learn's meta-estimators. However, understanding its components can help in developing custom meta-estimators or debugging metadata-related issues.

Enabling Metadata Routing
^^^^^^^^^^^^^^^^^^^^^^^^^

Metadata routing is enabled globally within scikit-learn. The behavior can be checked or controlled using the ``_routing_enabled`` function.

Routing Metadata
^^^^^^^^^^^^^^^^

The ``process_routing`` function is used to process and validate metadata routing for a given estimator and its sub-components. It ensures that metadata is correctly passed according to the routing configuration.

Example
-------

Here is a simplified example of how a meta-estimator might use the Metadata Routing API to route ``sample_weight`` to its base estimator:

.. code-block:: python

 from sklearn.utils.metadata_routing import process_routing

 class MyMetaEstimator:
     def __init__(self, estimator):
         self.estimator = estimator

     def fit(self, X, y, sample_weight=None, **fit_params):
         routed_params = process_routing(self, "fit", sample_weight=sample_weight, **fit_params)
         self.estimator_ = self.estimator.fit(X, y, **routed_params.estimator.fit)

In this example, ``process_routing`` ensures that ``sample_weight`` and any additional parameters are correctly routed to the ``fit`` method of the base estimator.

See Also
--------

- :ref:`Metadata Routing User Guide <metadata_routing>`: For a more detailed explanation and advanced usage.
- :class:`~sklearn.utils.metadata_routing.MetadataRouter`: For details on how routing is configured.
- :func:`~sklearn.utils.metadata_routing.process_routing`: For how metadata is processed and validated.