.. module:: statsmodels.sandbox.regression.gmm

Generalized Method of Moments (GMM) and Instrumental Variables (IV) Estimation
==============================================================================

The :mod:`gmm` module provides tools for estimating models using the Generalized Method of Moments (GMM) and instrumental variables techniques, including Two-Stage Least Squares (2SLS). These methods are particularly useful in situations where traditional regression assumptions—such as exogeneity of explanatory variables—are violated, and valid instruments are available to address endogeneity.

Classes
-------

.. class:: IV2SLS(endog, exog, instrument=None)

   Instrumental variables estimation using Two-Stage Least-Squares (2SLS).

   Parameters
   ----------
   endog : array_like
       Endogenous variable. Can be 1D or 2D with shape (nobs, 1).
   exog : array_like
       Explanatory variables. Can be 1D or 2D with shape (nobs, k_vars).
   instrument : array_like, optional
       Instruments for the explanatory variables. Must include both the exogenous variables that are not being instrumented and the actual instruments.

   Notes
   -----
   All variables in `exog` are treated as endogenous and thus instrumented. If some variables in `exog` are exogenous and should not be instrumented, they must also be included in the `instrument` array.

   Standard errors use degrees of freedom correction based on the number of observations and the number of explanatory variables (`df_resid = nobs - k_vars`), consistent with the `small` option in Stata's `ivreg2`.

   .. method:: fit()

      Estimate model using 2SLS IV regression.

      Returns
      -------
      results : :class:`RegressionResults`
          Instance of regression results with estimated parameters and covariance.

   .. method:: predict(params, exog=None)

      Return linear predicted values from a design matrix.

      Parameters
      ----------
      params : array_like
          Estimated parameters of the model.
      exog : array_like, optional
          Design / exogenous data. If not provided, uses the model's `exog`.

      Returns
      -------
      array
          Fitted values computed as `dot(exog, params)`.

.. class:: IVRegressionResults(model, params, normalized_cov_params=None, **kwargs)

   Results class for instrumental variables regression.

   Inherits from :class:`RegressionResults`. Provides standard regression output such as parameter estimates, standard errors, t-values, and confidence intervals. Additional methods and attributes are inherited from the base regression results class.

GMM Framework
-------------

The GMM framework is a general estimation principle that allows for flexible modeling of moment conditions. It is especially useful in overidentified models where there are more instruments than endogenous variables. The :class:`GMM` class (not shown here) provides the core infrastructure for defining and estimating such models.

Features and Considerations
---------------------------

- Supports one-step and iterated GMM estimation.
- Handles both exactly identified and overidentified systems.
- Includes support for alternative weighting matrices, including identity weighting for cases where optimal weighting is not feasible.
- Provides specification tests such as the J-test for overidentifying restrictions.
- Allows for custom moment conditions through subclassing.

Issues and Limitations
----------------------

- The number of parameters and starting values must be handled carefully; automatic handling is not fully implemented.
- In some cases (e.g., `DistQuantilesGMM`), the optimal weighting matrix cannot be computed numerically due to insufficient variation in moment conditions. A workaround is to use `fitonce` with an identity weighting matrix.
- Degrees of freedom in Hausman tests may differ depending on implementation and rank considerations.
- The normalization in the J-test statistic may require further validation.
- Standard error estimates in some configurations (e.g., `fitonce`) may be inaccurate due to incorrect covariance matrix formulas.

Author: Josef Perktold  
License: BSD (3-clause)