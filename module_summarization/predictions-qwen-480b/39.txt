# Models

Models are Python classes that represent database tables. They are the core component of Tortoise ORM and provide an object-oriented interface for interacting with your database.

## Defining Models

To define a model, inherit from the `Model` class and define fields as class attributes:

```python
from tortoise.models import Model
from tortoise.fields import IntField, CharField

class User(Model):
    id = IntField(pk=True)
    name = CharField(max_length=50)
    email = CharField(max_length=100)
```

## Model Meta Options

Models can define a `Meta` class to configure various options:

```python
class User(Model):
    id = IntField(pk=True)
    name = CharField(max_length=50)
    
    class Meta:
        table = "users"
        unique_together = ("name", "email")
        indexes = ("name",)
        ordering = ["name"]
```

Available Meta options:
- `abstract`: If True, this model will not create a database table
- `table`: Database table name (defaults to model name)
- `unique_together`: Fields that should be unique together
- `indexes`: Fields to create database indexes on
- `ordering`: Default ordering for queries

## Field Types

Models support various field types:

- `IntField`: Integer field
- `CharField`: String field with max_length
- `TextField`: Long text field
- `BooleanField`: Boolean field
- `DatetimeField`: DateTime field
- `ForeignKeyField`: Foreign key relationship
- `ManyToManyField`: Many-to-many relationship

## Basic Operations

### Creating Records

```python
# Create and save
user = User(name="John", email="john@example.com")
await user.save()

# Create directly
user = await User.create(name="John", email="john@example.com")
```

### Retrieving Records

```python
# Get all records
users = await User.all()

# Get single record by ID
user = await User.get(id=1)

# Get or raise exception if not found
user = await User.get_or_404(id=1)

# Filter records
users = await User.filter(name__icontains="john")
```

### Updating Records

```python
# Update instance
user.name = "Jane"
await user.save()

# Bulk update
await User.filter(name="John").update(name="Jane")
```

### Deleting Records

```python
# Delete instance
await user.delete()

# Bulk delete
await User.filter(name="John").delete()
```

## Querying

Models provide a powerful QuerySet API for complex queries:

```python
# Filtering
users = await User.filter(name__startswith="J", age__gte=18)

# Ordering
users = await User.all().order_by("-created_at")

# Limit/Offset
users = await User.all().limit(10).offset(20)

# Select related
users = await User.all().prefetch_related("posts")
```

## Relationships

### Foreign Keys

```python
class User(Model):
    id = IntField(pk=True)
    name = CharField(max_length=50)

class Post(Model):
    id = IntField(pk=True)
    title = CharField(max_length=100)
    author = ForeignKeyField("models.User", related_name="posts")
```

### Many-to-Many

```python
class Category(Model):
    id = IntField(pk=True)
    name = CharField(max_length=50)

class Post(Model):
    id = IntField(pk=True)
    title = CharField(max_length=100)
    categories = ManyToManyField("models.Category", related_name="posts")
```

## Model Methods

Models have several built-in methods:

- `save()`: Save the model instance
- `delete()`: Delete the model instance
- `refresh_from_db()`: Reload instance from database
- `clone()`: Create a copy of the instance

## Validation

Models support field validation through field parameters:

```python
class User(Model):
    name = CharField(max_length=50, null=False)
    email = CharField(max_length=100, unique=True)
    age = IntField(min_value=0, max_value=150)
```

## Transactions

Models work with transactions:

```python
async with in_transaction():
    user = await User.create(name="John")
    await Post.create(title="First Post", author=user)
```

## Signals

Models support signals for hooking into lifecycle events:

```python
from tortoise.signals import post_save

@post_save(User)
async def user_post_save(sender, instance, created, **kwargs):
    if created:
        print(f"New user created: {instance.name}")
```