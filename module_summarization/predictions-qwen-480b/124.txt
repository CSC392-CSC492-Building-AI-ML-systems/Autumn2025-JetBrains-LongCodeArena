Header Interface Transition Guide
=================================

This document provides guidance for transitioning to the new Header interface in ``astropy.io.fits``. The Header class has undergone significant changes to improve usability, consistency, and performance. This guide outlines the key differences and provides recommendations for updating existing code.

Overview
--------

The Header interface in ``astropy.io.fits`` has been redesigned to provide a more intuitive and Pythonic experience. The changes focus on improving the handling of FITS header cards, verification processes, and overall interaction patterns.

Key Changes
-----------

1. **Verification Options**
   The Header verification system now supports multiple options for handling validation issues:
   
   - ``ignore``: Ignore all verification issues
   - ``warn``: Issue warnings for verification problems
   - ``exception``: Raise exceptions for verification problems
   - ``fix``: Automatically fix fixable issues and report others
   - ``silentfix``: Automatically fix fixable issues silently
   - Combined options like ``fix+warn``, ``silentfix+exception``, etc.

2. **Error Handling**
   The verification system now uses structured error reporting with the following classes:
   
   - ``VerifyError``: Exception class for verification failures
   - ``VerifyWarning``: Warning class for verification issues

3. **Enhanced Card Management**
   The Header class now provides better methods for managing FITS cards with improved validation and error reporting.

Transition Recommendations
--------------------------

1. **Update Verification Calls**
   Replace old verification patterns with the new option system:
   
   .. code-block:: python
   
       # Old way (if applicable)
       header.verify()
       
       # New way
       header.verify('fix+warn')  # Automatically fix issues and warn about others

2. **Handle Verification Exceptions**
   Update exception handling to use ``VerifyError``:
   
   .. code-block:: python
   
       try:
           header.verify('exception')
       except VerifyError as e:
           # Handle verification errors
           print(f"Header verification failed: {e}")

3. **Use Appropriate Warning Categories**
   When handling warnings, use ``VerifyWarning``:
   
   .. code-block:: python
   
       import warnings
       from astropy.io.fits.verify import VerifyWarning
       
       with warnings.catch_warnings():
           warnings.simplefilter('ignore', VerifyWarning)
           header.verify('warn')

4. **Leverage New Fix Options**
   Take advantage of the automatic fixing capabilities:
   
   .. code-block:: python
   
       # Automatically fix issues silently
       header.verify('silentfix')
       
       # Fix issues and warn about any remaining problems
       header.verify('fix+warn')

Best Practices
--------------

1. **Choose Appropriate Verification Levels**
   Select verification options based on your use case:
   - Use ``silentfix`` for automated processing where minor issues should be corrected
   - Use ``fix+warn`` for interactive applications where users should be notified
   - Use ``exception`` for strict validation requirements

2. **Handle Unfixable Errors**
   Remember that some errors cannot be automatically fixed. Plan your error handling accordingly.

3. **Test with Various Header Types**
   Ensure your code works with different types of FITS headers, including those with non-standard structures.

4. **Use Zero-Based Indexing**
   Note that ``astropy.io.fits`` uses zero-based indexing for all operations, which differs from some other FITS libraries.

Migration Checklist
-------------------

- [ ] Update all ``verify()`` method calls to use explicit options
- [ ] Replace custom verification error handling with ``VerifyError``
- [ ] Update warning handling to use ``VerifyWarning``
- [ ] Test with the new fix and silentfix options
- [ ] Verify compatibility with existing FITS files
- [ ] Update documentation to reflect new verification options

For detailed information about the verification options and their behavior, refer to the main astropy documentation on the verify system.