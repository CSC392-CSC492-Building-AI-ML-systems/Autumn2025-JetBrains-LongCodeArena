Generating schema
=================

Overview
--------
This module provides two utilities for producing and applying SQL schema based on a database client's schema generator:

- get_schema_sql(client, safe): returns the SQL statements as a string.
- generate_schema_for_client(client, safe): asynchronous helper that executes the generated SQL on the provided client.

Both utilities obtain a generator from the client via ``client.schema_generator(client)`` and use that generator to produce or apply schema SQL. A debug log entry is emitted when applying schema.

API
---

get_schema_sql(client, safe)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
Generates the SQL schema for the given client.

- Parameters:
  - client (BaseDBAsyncClient): the database client whose schema generator will produce the SQL.
  - safe (bool): when True, generated SQL will create tables only if they do not already exist (i.e., use ``IF NOT EXISTS``-style constructs where supported).

- Returns:
  - str: the SQL schema as a single string.

generate_schema_for_client(client, safe)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
Generates and applies the SQL schema directly to the given client.

- Parameters:
  - client (BaseDBAsyncClient): the database client to apply the schema to.
  - safe (bool): same semantics as in :func:`get_schema_sql`.

- Behavior:
  - Obtains the generator via ``client.schema_generator(client)``.
  - Calls :func:`get_schema_sql` to get the SQL string.
  - Logs the SQL at DEBUG level: ``Creating schema: <sql>``.
  - If the SQL string is non-empty, awaits ``generator.generate_from_string(schema)`` to apply it.

Examples
--------

Generate SQL (synchronous)
::

    # Return SQL string only
    sql = get_schema_sql(client, safe=True)
    print(sql)

Apply schema (asynchronous)
::

    # In async context
    await generate_schema_for_client(client, safe=True)

Typical usage in an async function
::

    async def ensure_schema(client):
        # Create tables if they don't exist
        await generate_schema_for_client(client, safe=True)

Notes and caveats
-----------------
- The functions expect a client that implements ``schema_generator(client)`` and that the resulting generator exposes ``get_create_schema_sql(safe)`` and ``generate_from_string(sql)``.
- If the generated schema is an empty string, nothing is executed.
- Logging uses the logger named ``tortoise`` at DEBUG level when applying schema.
- Type hints reference ``BaseDBAsyncClient`` (from ``tortoise.backends.base.client``) under a TYPE_CHECKING guard; no runtime import is required by these helpers.
- Be cautious when running schema generation in production â€” review generated SQL before applying if possible.