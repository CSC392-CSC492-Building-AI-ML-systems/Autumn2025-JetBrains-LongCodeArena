w_states — display and manipulate basis / target states
=====================================================

Synopsis
--------
w_states [--show | --append | --replace] [--bstate-file BFILE] [--bstate LABEL,PROB[,AUXREF]]...
         [--tstate-file TFILE] [--tstate LABEL,PCOORD0[,PCOORD1,...]]... [WORK-MANAGER OPTIONS...]

Description
-----------
w_states displays or updates the basis (initial) and target (recycling) states used by a WESTPA simulation.

By default (the --show mode) the current basis and target states for the simulation iteration are printed to stdout or dumped to files. Two modification modes are provided:

- --replace
  Replace the basis and/or target states with those specified by files and/or command-line arguments.

- --append
  Append target states to the existing list of target states for the next iteration. (Appending basis states is not permitted — see "Basis-state editing" below.)

When replacing/appending, the changes are applied to the current iteration unless the current iteration already contains completed segments; in that case changes are applied to the next iteration.

The command uses the WESTPA runtime configuration (westpa.rc) and the configured work manager; work-manager options may be passed to the command.

Modes of operation
------------------
--show (default)
    Display the basis and target states for the current iteration. If --bstate-file and/or --tstate-file are given, states are written to those files; otherwise states are written to stdout.

--replace
    Replace the current basis and/or target states with the states provided via files and command-line arguments. If replacing basis states, probabilities are checked and rescaled (with a warning) if they do not sum to unity. Basis states are assigned progress-coordinate representatives prior to storing.

--append
    Append the given target states to those currently in use for the next iteration. Appending basis states is not permitted; use the workflow under "Basis-state editing" instead.

Options
-------
--bstate-file BSTATE_FILE
    Read (in --replace/--append) or write (in --show) basis state entries from/to BSTATE_FILE.

--bstate LABEL,PROB[,AUXREF]
    Add a basis state described by LABEL and PROB (a floating-point probability). An optional AUXREF (data reference) may be provided. This argument may be given multiple times; entries are processed in the order given, after any entries read from --bstate-file. Note: use of --bstate is only valid for replacement (appending basis states is not supported).

--tstate-file TSTATE_FILE
    Read (in --replace/--append) or write (in --show) target state entries from/to TSTATE_FILE.

--tstate LABEL,PCOORD0[,PCOORD1,...]
    Add a target state described by LABEL and one or more representative progress-coordinate values. This option may be given multiple times and will be appended (in the given order) to any target states read from --tstate-file.

Work-manager options
--------------------
The command integrates with WESTPA work-manager configuration. Use the work-manager-related options supported by your environment/installation (the command will add and process these arguments automatically).

File formats
------------
Basis-state string (command-line --bstate)
    LABEL,PROBABILITY[,AUXREF]
    - LABEL: textual label for the basis state
    - PROBABILITY: floating-point probability (sum of basis-state probabilities should be 1.0; if not, probabilities are rescaled with a warning)
    - AUXREF (optional): auxiliary data reference string

Target-state string (command-line --tstate)
    LABEL,PCOORD0[,PCOORD1,...]
    - LABEL: textual label for the target state
    - PCOORDn: representative progress-coordinate values (one or more)

Files written in --show mode begin with a comment header identifying the iteration:
    # Basis states for iteration N
or
    # Target states for iteration N
Lines following the header are in the same comma-separated formats as the command-line forms described above.

Behavior notes
--------------
- Basis-state probabilities are checked when replacing basis states. If the total probability differs from 1.0 by more than numerical tolerance, the probabilities are rescaled to sum to unity and a warning is emitted.
- When replacing basis states, the simulation manager is asked to assign representative progress coordinates and the new basis-state group is created in the data manager; the simulation manager is also notified (report_basis_states).
- If the current iteration already contains completed segments, replacement/appending is applied to the next iteration (so that finished work is not altered retroactively).
- Only the master work-manager process performs data-manager updates; the command uses the configured work manager context.

Basis-state editing workflow
----------------------------
Appending basis states directly is disallowed (to avoid subtle renormalization pitfalls). To change basis-state lists:
1. Run w_states --show --bstate-file=bstates.txt to obtain the current basis-state file.
2. Edit bstates.txt to the desired list (LABEL,PROB[,AUXREF] lines); ensure probabilities sum to 1.0 or allow the command to rescale them.
3. Run w_states --replace --bstate-file=bstates.txt to update the basis states in the WESTPA data store.

Examples
--------
Display current states to stdout (default):
    w_states

Write basis and target states to files:
    w_states --show --bstate-file bstates.txt --tstate-file tstates.txt

Replace states from files and add an extra basis state on the command line:
    w_states --replace --bstate-file bstates.txt --bstate "new_state,0.05,auxref"

Append target states for the next iteration:
    w_states --append --tstate "targetA,1.0" --tstate "targetB,0.9,0.1"

Exit status and logging
-----------------------
The command emits warnings (e.g., when basis-state probabilities are rescaled) and uses the WESTPA logging facility. Routine failures are reported via standard error and nonzero exit status as appropriate.

See also
--------
westpa runtime configuration (westpa.rc) and work-manager documentation for options that control execution environment and data-manager access.