Configurations
==============

Overview
--------
This module provides utilities to control import/export behavior for project configurations (variables, setups, optimizations, parametrics, boundaries, mesh operations, coordinate systems, materials, datasets, and object properties) and a helper function to locate dataset references inside nested dictionaries.

The main public API documented here:

- ConfigurationsOptions — an options container exposing toggles and parameters that control what is exported and imported.
- _find_datasets(d, out_list) — helper to recursively search nested mappings for dataset references (PWL references) and append discovered tokens to a provided list.

_find_datasets
--------------
Signature
    _find_datasets(d, out_list)

Description
    Recursively walks a mapping (dict or OrderedDict) and inspects values. When values are lists or strings containing "pwl", the function extracts a substring that usually denotes a dataset/variable reference (from the first '$' to the first ',' after it) and appends it to out_list.

Parameters
    d (dict or OrderedDict)
        Mapping to search recursively.
    out_list (list)
        Mutable list that will be appended with found dataset reference substrings.

Behavior and notes
    - Values that are nested dicts are traversed recursively.
    - List elements are inspected; elements expected to be dict-like with a "free_form_value" key are handled.
    - On unexpected structures or when keys are missing, entries are skipped silently (KeyError/TypeError are ignored).
    - The function mutates out_list and returns None.

ConfigurationsOptions
---------------------
Description
    Lightweight options container used to configure what should be exported/imported when serializing or reconstructing a design. Each flag is a boolean and can be toggled to enable or disable a specific export/import behavior. An object mapping tolerance (float) controls geometric mapping tolerance used by features such as boundary-object mapping.

Instantiation
    opts = ConfigurationsOptions()

Attributes / Properties
    object_mapping_tolerance (float)
        Tolerance value used for object mapping operations (for example when mapping boundaries to geometry). Default: 1e-9

    export_variables (bool)
        Whether variables should be exported to JSON. Default: True

    export_setups (bool)
        Whether analysis setups should be exported to JSON. Default: True

    export_optimizations (bool)
        Whether optimization setups should be exported to JSON. Default: True

    export_parametrics (bool)
        Whether parametric setups should be exported to JSON. Default: True

    export_boundaries (bool)
        Whether boundary conditions should be exported to JSON. Default: True

    export_mesh_operations (bool)
        Whether mesh operations should be exported to JSON. Default: True

    export_coordinate_systems (bool)
        Whether coordinate systems should be exported to JSON. Default: True

    export_materials (bool)
        Whether materials should be exported to JSON. Default: True

    export_object_properties (bool)
        Whether generic object properties should be exported to JSON. Default: True

    export_datasets (bool)
        Whether datasets (for example PWL datasets) should be exported to JSON. Default: True

    import_datasets (bool)
        Whether datasets should be imported from JSON. Default: True

    import_variables (bool)
        Whether variables should be imported from JSON. Default: True

    import_setups (bool)
        Whether setups should be imported from JSON. Default: True

    import_optimizations (bool)
        Whether optimizations should be imported from JSON. Default: True

    import_parametrics (bool)
        Whether parametrics should be imported from JSON. Default: True

    import_boundaries (bool)
        Whether boundaries should be imported from JSON. Default: True

    import_mesh_operations (bool)
        Whether mesh operations should be imported from JSON. Default: True

    import_coordinate_systems (bool)
        Whether coordinate systems should be imported from JSON. Default: True

    import_materials (bool)
        Whether materials should be imported from JSON. Default: True

    import_object_properties (bool)
        Whether object properties should be imported from JSON. Default: True

    skip_import_if_exists (bool)
        When importing, if True existing items will not be overwritten or re-imported. Default: False

Usage examples
--------------
Toggle export/import options:

    from pyaedt import Hfss
    hfss = Hfss()
    # Disable variables export
    hfss.configurations.options.export_variables = False

Create and use ConfigurationsOptions directly:

    opts = ConfigurationsOptions()
    opts.export_setups = False
    opts.object_mapping_tolerance = 1e-6

Find dataset references inside a nested mapping:

    my_map = {...}
    refs = []
    _find_datasets(my_map, refs)
    # refs now contains found dataset/variable tokens (substrings containing "pwl")

Design notes
------------
- The options container is intentionally simple: each configurable feature is exposed as a boolean property for easy toggling.
- _find_datasets is a utility function intended for preparing lists of dataset references to be included in exports or to detect dependencies when importing.

See also
--------
- The surrounding module integrates with higher-level functions that perform JSON generation, import/export orchestration, and mapping of design objects. ConfigurationsOptions acts as the user-facing control panel for those operations.