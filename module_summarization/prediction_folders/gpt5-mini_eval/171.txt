Calculator Interface
====================

Overview
--------
The Calculator Interface provides a lightweight API for inspecting and computing model parameters and for performing numerically robust special-function calculations used by model kernels. It is designed to:

- enumerate models and their kernel parameters,
- filter parameters by semantic kind (volume, orientation, sld, none),
- provide a small command-line utility to list parameters,
- provide numeric routines that operate correctly on scalars and broadcastable arrays (using NumPy and SciPy).

Concepts
--------
- Model: identified by a string name. Model metadata is obtained via load_model_info(name).
- model_info: an object describing a model; its kernel parameters are available at model_info.parameters.kernel_parameters.
- Parameter: an object with at least .name and .type attributes. The .type is used to categorize parameters (see "Parameter kinds").
- Calculator: a conceptual collection of utilities and numeric helpers used by model kernels. The interface focuses on model metadata access and numerical primitives rather than a single monolithic class.

Parameter kinds
---------------
Parameters may be classified by kind. Recognized kinds:

- volume
- orientation
- sld
- none

For convenience the CLI and helpers accept the pseudo-kind "any" (equivalent to no kind filtering).

API: inspection helpers
-----------------------

load_model_info(name)
    Return model_info for the model named name. model_info must expose
    parameters.kernel_parameters: an iterable of Parameter objects.

list_models()
    Return an iterable (usually list) of available model names.

find_pars(kind=None)
    Return a dict mapping parameter name -> list of model names which use that
    parameter. If kind is provided, only parameters of that semantic type are
    included. kind should be one of the recognized kinds or None.

list_pars(names_only=True, kind=None)
    Print parameters to stdout. If names_only is True, only parameter names
    (columnized) are printed. If False, each line is "param: model1, model2, ...".
    The behaviour can be controlled from the CLI (see below).

Command-line utility
--------------------
A small CLI exposes the parameter-listing functionality:

Usage:
    python -m sasmodels.list_pars [-v] [volume|orientation|sld|none|any]

Options:
- -v, --verbose : list the models that use each parameter (names_only=False).
- kind argument : one of "volume", "orientation", "sld", "none", or "any".
  "any" behaves the same as omitting kind. "none" and "any" are treated as
  neutral by the internal parsing logic and are mapped to None.

Notes on parsing:
- The CLI uses choices=['volume','orientation','sld',None,'any'] and a small
  type-mapping so that both "any" and "none" map to None internally.

Numeric primitives and broadcasting
----------------------------------
The numeric helper routines are implemented using NumPy and SciPy special
functions. Key behaviors and contracts:

- Inputs may be scalars or array-like; functions broadcast inputs using
  numpy.broadcast_arrays. Scalar inputs produce scalar outputs where
  appropriate; broadcasted arrays produce correspondingly shaped outputs.

- Complex-valued intermediate and output values are supported. Numeric
  helpers return NumPy arrays with dtype chosen to accommodate complex results
  when required.

ellipticJi(u, v, m)
    Compute the complex Jacobi elliptic functions [sn, cn, dn] at argument
    (u + i v) with parameter m. Behaviour:

    - Accepts scalar or array-like u, v, m. Scalars return scalar-like results.
    - The implementation dispatches special-case real-only and imag-only paths
      for efficiency and uses scipy.special elliptic functions for general
      values.
    - Returns an array shaped to match the broadcasted inputs; for scalar
      inputs a 1-D result of length 3 is returned, or a scalar triplet for
      scalar callers depending on the call site contract.

Example usage
-------------
List all parameter names:
    python -m sasmodels.list_pars

List all parameters plus the models that use each:
    python -m sasmodels.list_pars -v

In Python code:
    # list parameter â†’ models mapping for orientation parameters
    partable = find_pars(kind='orientation')

    # print names only
    list_pars(names_only=True, kind=None)

Numeric example:
    # elliptic functions on arrays (NumPy broadcasting)
    u = np.linspace(0.0, 1.0, 5)
    v = 0.0
    m = 0.5
    sn_cn_dn = ellipticJi(u, v, m)   # handles scalar v, scalar m, array u

Error handling and types
------------------------
- Caller code should treat parameter.kind as possibly None (meaning no semantic
  classification).
- The CLI maps "any" and "none" to None. Functions that accept kind=None treat
  that as "no filtering".
- Numeric helpers may raise standard NumPy or SciPy exceptions (e.g. domain
  errors) for out-of-range inputs.

Dependencies
------------
- NumPy (broadcasting, array handling)
- SciPy (special functions used for elliptic computations)

Implementation notes
--------------------
- The parameter-inspection utilities are intentionally simple and operate on
  the model metadata produced by load_model_info.
- Numeric helpers use optimized special-case code paths for purely real or
  purely imaginary inputs, falling back to general complex routines when
  required to preserve correctness and performance.