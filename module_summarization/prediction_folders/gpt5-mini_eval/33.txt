w_select
========

Select dynamics segments matching a user-supplied predicate function.

Synopsis
--------
w_select [OPTIONS]

Description
-----------
Selects segments from a WESTPA run that match a user-provided predicate function.
Selection is performed per-iteration; by default only matching segments are written
to the output file. The match predicate may be inverted, and ancestors of matched
segments can optionally be included in the output.

Predicate function
------------------
The predicate must be a callable object supplied as MODULE.FUNCTION with
--predicate-function (or -p). It will be loaded at runtime and must accept the
signature:

    predicate(n_iter, iter_group)

where
- n_iter is the iteration number (int),
- iter_group is the HDF5 group for that iteration (the iteration group as found
  in the WESTPA data file).

The predicate must return a collection (e.g., list, set, ndarray) of seg_ids
(for that iteration) that satisfy the condition. If --invert (or -v) is given,
the predicate is logically inverted and segments not returned by the predicate
are selected instead.

Including ancestors
-------------------
If --include-ancestors (or -a) is supplied, ancestors of matched segments are
also included in the output in addition to the directly matching segments.

Output format
-------------
The output is an HDF5 file (default name: select.h5) containing the following
datasets:

- /n_iter  [iteration]
  Integer: iteration numbers corresponding to other per-iteration datasets.

- /n_segs  [iteration]
  Integer: number of matching segment IDs stored for each iteration. For
  iteration index i, only the first n_segs[i] entries in the corresponding
  row of /seg_ids and /weights are valid.

- /seg_ids [iteration][segment]
  Integer: segment IDs selected for each iteration. For iteration n_iter,
  the matching segment IDs are seg_ids[i][:n_segs[i]] where i indexes the
  iteration within the stored range.

- /weights [iteration][segment]
  Floating-point: weights corresponding to each stored segment ID in /seg_ids.

Command-line arguments
----------------------
Selection and behavior options:
- -p, --predicate-function MODULE.FUNCTION
  Specify the predicate function used to select segments. The function must be
  callable as described above.

- -v, --invert
  Invert the match predicate; select segments that do NOT satisfy the predicate.

- -a, --include-ancestors
  Include ancestors of matched segments in the output.

Output options:
- -o, --output OUTPUT
  Write results to OUTPUT (default: select.h5).

Other options:
- Options to locate and read the WESTPA data file are provided via the data
  reader component (see the tool's --help for details).
- Iteration-range selection options are available (see the tool's --help).
- Progress reporting options are available.

Notes
-----
- The predicate is loaded using the runtime object loader; provide a fully
  importable MODULE.FUNCTION pointing to a callable.
- The tool processes the requested iteration range; the output stores data for
  each iteration in that range in order.
- Weights written to /weights correspond element-wise to the segment IDs in
  /seg_ids.

Examples
--------
Select segments matching mypred.match in the default range and write to select.h5:

    w_select -p mypred.match

Select and include ancestors, writing to chosen file:

    w_select -p mypred.match -a -o matched_segments.h5

Invert selection (keep non-matching segments):

    w_select -p mypred.match -v -o nonmatching.h5

See w_select --help for full option details.