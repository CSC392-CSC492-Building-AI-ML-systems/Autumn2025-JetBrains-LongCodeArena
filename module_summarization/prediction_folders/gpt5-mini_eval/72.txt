metrics module
==============

Utilities for pairwise distance input validation and dtype handling.

This module provides helper functions used by pairwise distance and kernel
computations to validate inputs, enforce dtypes, and ensure consistent shapes
for both paired and unpaired (cross) distance computations.

Functions
---------

_return_float_dtype(X, Y)
    Determine an appropriate floating dtype for X and Y and return possibly
    converted arrays plus the dtype.

    Description
    - If both X and Y have dtype ``np.float32``, returns ``np.float32``.
    - Otherwise returns the default Python float dtype (``float`` / ``np.float64``).
    - If Y is None, the dtype is chosen based on X.

    Parameters
    - X : array-like or sparse matrix
    - Y : array-like or sparse matrix or None

    Returns
    - X, Y, dtype : tuple
        - X and Y converted to numpy arrays when appropriate (sparse inputs are
          left as-is).
        - dtype is either ``np.float32`` or Python ``float`` depending on the
          input dtypes.

check_pairwise_arrays(X, Y, *, precomputed=False, dtype=None, accept_sparse='csr',
                      force_all_finite=True, copy=False)
    Validate and prepare arrays for pairwise (cross) distance computations.

    Summary
    - Ensures X and Y are arrays (or allowed sparse formats), at least
      two-dimensional, and contain floating-point values (or the given dtype).
    - If Y is None, it is set as a pointer to X (no copy).
    - If ``precomputed=True``, X is treated as a precomputed distance matrix
      with shape (n_queries, n_indexed) and the function checks compatibility
      with Y accordingly.
    - Otherwise the function verifies that X and Y have the same number of
      features (same second dimension).

    Parameters
    - X : array-like or sparse matrix, shape (n_samples_X, n_features)
    - Y : array-like or sparse matrix or None, shape (n_samples_Y, n_features)
    - precomputed : bool, default=False
        Treat X as a precomputed distance matrix (shape (n_queries, n_indexed)).
    - dtype : dtype or None, default=None
        Required dtype for X and Y. If None, an appropriate float dtype is
        selected by _return_float_dtype.
    - accept_sparse : str, bool or list/tuple of str, default='csr'
        Allowed sparse formats. If input is sparse but not in an allowed format,
        it will be converted to the first listed format. True allows any format,
        False disallows sparse input.
    - force_all_finite : bool or {'allow-nan'}, default=True
        Whether to raise on ``np.inf``/``np.nan``/``pd.NA``. Options:
        - True: force all values finite.
        - False: accept infinities and NaNs.
        - 'allow-nan': accept only NaNs/NA but not infinities.
    - copy : bool, default=False
        Force a copy of the data if True; otherwise conversions may or may not
        produce a copy.

    Returns
    - safe_X, safe_Y : tuple
        Arrays (or sparse matrices) safe to use for pairwise computations. If
        Y was None, safe_Y is a pointer to safe_X.

    Raises
    - ValueError : if feature dimensions are incompatible
        - For precomputed matrices, raises if X.shape[1] != Y.shape[0].
        - Otherwise raises if X.shape[1] != Y.shape[1].

    Notes
    - This function delegates array conversion and checking to the library's
      input validation utilities and selects an appropriate float dtype when
      none is provided.

check_paired_arrays(X, Y)
    Validate and prepare arrays for paired distance computations.

    Summary
    - Intended for paired distance metrics that compute a distance between
      corresponding rows of X and Y (i.e., len(X) == len(Y)).
    - Ensures X and Y are arrays, are at least two-dimensional, and contain
      floating-point values.
    - Verifies that X and Y have compatible shapes for paired computations
      (typically same number of samples and same number of features).

    Parameters
    - X : array-like or sparse matrix, shape (n_samples, n_features)
    - Y : array-like or sparse matrix, shape (n_samples, n_features)

    Returns
    - safe_X, safe_Y : tuple
        Arrays (or sparse matrices) ready for paired distance computation.

    Raises
    - ValueError : if X and Y are not compatible for paired computation,
      e.g., differing numbers of samples or features.

Examples
--------
Typical usage (conceptual)
- Use check_pairwise_arrays when computing a full cross-distance matrix
  between two collections of samples.
- Use check_paired_arrays when computing elementwise distances between two
  collections of the same length (paired observations).

See also
--------
- _return_float_dtype : dtype selection helper used by the check functions.
- The library's array checking utilities used internally (e.g. check_array,
  force_all_finite semantics) for details on conversions and error handling.