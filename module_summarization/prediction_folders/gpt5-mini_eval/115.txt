Configuration
=============

.. module:: asdf.config
   :synopsis: Methods for getting and setting ASDF global configuration options.

Overview
--------
This module provides a global configuration container for ASDF runtime behavior.
Users typically obtain and modify the configuration via the helper functions
``get_config`` and ``config_context`` (exported by the module), rather than
instantiating the configuration class directly.

The configuration is represented by the AsdfConfig class, which is safe for
concurrent access using an internal re-entrant lock.

Constants
---------
DEFAULT_VALIDATE_ON_READ
    Default boolean for whether files are validated on read (True).

DEFAULT_DEFAULT_VERSION
    Default ASDF standard version string (initialised from asdf.versioning.default_version).

DEFAULT_LEGACY_FILL_SCHEMA_DEFAULTS
    Default boolean controlling legacy schema defaults behavior (True).

DEFAULT_IO_BLOCK_SIZE
    Default block size used for IO operations (-1 means auto / filesystem preferred).

DEFAULT_ARRAY_INLINE_THRESHOLD
    Default threshold for inlining arrays (None means default behavior).

Classes
-------

AsdfConfig
~~~~~~~~~~
Container for ASDF configuration options. Users should use ``get_config`` or
``config_context`` rather than constructing this class directly.

Thread safety: internal operations that modify or lazily initialize attributes
are protected by a threading.RLock.

Attributes (internal)
- _resource_mappings: cached list of resource mappings (or None to lazy-load).
- _resource_manager: cached ResourceManager instance (or None).
- _extensions: cached list of extensions (or None to lazy-load).
- _validate_on_read: bool
- _default_version: str
- _legacy_fill_schema_defaults: bool
- _io_block_size: int
- _array_inline_threshold: optional int
- _lock: threading.RLock

Properties and Methods
----------------------

resource_mappings
    Get the list of registered resource mapping instances. If not explicitly
    set, this is populated from entry points.

    Returns
        list of asdf.resource.ResourceMappingProxy

add_resource_mapping(mapping)
    Register a new resource mapping. The new mapping takes precedence over
    previously registered mappings.

    Parameters
        mapping: collections.abc.Mapping
            Mapping of resource URI (str) to bytes content.
    Notes
        The mapping will be wrapped with ResourceMappingProxy.maybe_wrap if needed.

remove_resource_mapping(mapping=None, *, package=None)
    Remove a registered resource mapping.

    Parameters
        mapping: collections.abc.Mapping, optional
            Specific mapping to remove (will be wrapped via ResourceMappingProxy).
        package: str, optional
            Remove mappings provided by this package. If mapping is omitted,
            all mappings from the package are removed.

    Raises
        ValueError: if both mapping and package are omitted.

reset_resources()
    Reset registered resource mappings to the default list provided via entry points.

resource_manager
    Get the asdf.resource.ResourceManager instance. This manager includes
    resources gathered from registered resource mappings and any mappings added
    at runtime.

    Returns
        asdf.resource.ResourceManager

extensions
    Get the list of registered extensions. If not explicitly set, extensions
    are loaded from entry points.

    Returns
        list of asdf.extension.ExtensionProxy

add_extension(extension)
    Register a new extension. The new extension takes precedence over previously
    registered extensions.

    Parameters
        extension: asdf.extension.AsdfExtension or asdf.extension.Extension
            The extension will be wrapped with ExtensionProxy.maybe_wrap if needed.

remove_extension(extension=None, *, package=None)
    Remove a registered extension.

    Parameters
        extension: asdf.extension.AsdfExtension or asdf.extension.Extension or str, optional
            An extension instance, ExtensionProxy, or a URI pattern (str) to remove.
        package: str, optional
            Remove only extensions provided by this package. If extension is omitted,
            all extensions from the package are removed.

    Raises
        ValueError: if both extension and package are omitted.

reset_extensions()
    Reset extensions to the default list registered via entry points.

default_version (property)
    Get/set the default ASDF Standard version used for new files.

    Getter
        Returns: str

    Setter
        value: str
        The value is validated via validate_version before being set.

io_block_size (property)
    Get/set the block size used when reading and writing files.

    Getter
        Returns: int
            Block size, or -1 to use the filesystem's preferred block size.

    Setter
        value: int
            Block size or -1.

Other notes
-----------
- The configuration defers loading of entry-point-provided resource mappings and
  extensions until first access.
- add/remove methods wrap raw mapping/extension objects using the provided proxy
  helpers (ResourceMappingProxy and ExtensionProxy) to ensure a consistent API.
- Changing resource mappings or extensions invalidates cached objects (e.g.
  ResourceManager) so they will be recreated on next access.

Examples
--------
Obtain the global configuration and change the default ASDF version:

.. code-block:: python

    cfg = get_config()
    cfg.default_version = "1.2.0"

Temporarily override configuration within a context:

.. code-block:: python

    with config_context() as cfg:
        cfg.io_block_size = 1024
        # operations use the overridden config

Exports
-------
The module exports:
- AsdfConfig
- get_config
- config_context