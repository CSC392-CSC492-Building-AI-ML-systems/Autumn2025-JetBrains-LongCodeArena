Commands module
===============

Module overview
---------------
This module provides high-level commands for managing Alembic migration script directories and for creating new revision scripts. The main API functions documented here are:

- list_templates(config)
- init(config, directory, template='generic', package=False)
- revision(config, message=None, autogenerate=False, sql=False, head='head', splice=False, branch_label=None, version_path=None, rev_id=None, depends_on=None, process_revision_directives=None)

These functions are intended to be invoked programmatically (they correspond to the CLI commands) and accept an alembic.config.Config object (or compatible) for I/O and configuration.

list_templates(config)
----------------------
Signature:
    list_templates(config)

Description:
    Print the available migration environment templates found in the template
    directory configured on the provided Config object.

Parameters:
    config (alembic.config.Config)
        The configuration object providing get_template_directory() and
        print_stdout() used for output.

Behavior:
    - Calls config.get_template_directory() and lists each template subdirectory.
    - For each template, opens its README and prints a one-line synopsis.
    - Prints a brief hint showing how templates are used with `alembic init`.

init(config, directory, template='generic', package=False)
----------------------------------------------------------
Signature:
    init(config, directory, template='generic', package=False) -> None

Description:
    Initialize a new Alembic scripts directory using a selected template.

Parameters:
    config (alembic.config.Config)
        The configuration object. Its get_template_directory() and
        config_file_name attributes are used during initialization.
    directory (str)
        Path of the target scripts directory to create.
    template (str, optional)
        Name of the template to use (defaults to "generic").
    package (bool, optional)
        If True, write __init__.py files into the environment location and
        the versions/ directory, turning them into Python packages.

Behavior and notes:
    - Raises util.CommandError if the target directory already exists and is not empty.
    - Verifies the requested template exists under the configured template directory.
    - Creates the target directory and a versions/ subdirectory.
    - Copies template files into the new directory; if a template contains
      an alembic.ini.mako file that corresponds to the current Config's
      config_file_name, the template is rendered into that config file location.
    - If package=True, creates empty __init__.py files in the environment and versions paths.
    - After creation, prints a message instructing the user to edit configuration,
      connection and logging settings in the generated config file.

Exceptions:
    util.CommandError
        For missing template or when attempting to initialize into a non-empty
        existing directory, or other command-related errors.

revision(config, message=None, autogenerate=False, sql=False, head='head', splice=False, branch_label=None, version_path=None, rev_id=None, depends_on=None, process_revision_directives=None)
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Signature:
    revision(
        config,
        message: Optional[str]=None,
        autogenerate: bool=False,
        sql: bool=False,
        head: str='head',
        splice: bool=False,
        branch_label: Optional[str]=None,
        version_path: Optional[str]=None,
        rev_id: Optional[str]=None,
        depends_on: Optional[str]=None,
        process_revision_directives: Optional[callable]=None
    ) -> Union[Optional[alembic.script.base.Script], List[Optional[alembic.script.base.Script]]]

Description:
    Create a new revision script file (or files), optionally autogenerating the
    migration from the database state. This is the programmatic equivalent of
    the `alembic revision` CLI command.

Parameters:
    config (alembic.config.Config)
        Configuration object used to locate and load the scripts directory and
        any revision environment.
    message (str, optional)
        Revision message (maps to `-m` CLI option).
    autogenerate (bool, optional)
        If True, attempt to autogenerate migration directives by comparing
        the database state to models (maps to `--autogenerate`).
    sql (bool, optional)
        If True, write the resulting migration as SQL to stdout instead of a file
        (maps to `--sql`).
    head (str, optional)
        The parent revision to base the new revision upon (maps to `--head`).
    splice (bool, optional)
        Allow creating a new head that splices into history (maps to `--splice`).
    branch_label (str, optional)
        Label to apply to the new branch (maps to `--branch-label`).
    version_path (str, optional)
        Version path to write the revision into (maps to `--version-path`).
    rev_id (str, optional)
        Explicit revision id to use instead of generating one (maps to `--rev-id`).
    depends_on (str, optional)
        Comma-separated "depends on" identifiers (maps to `--depends-on`).
    process_revision_directives (callable, optional)
        A callable matching the signature used by EnvironmentContext.configure
        for altering generated revision directives programmatically. This option
        exists for programmatic (API) use only and is not a CLI option.

Behavior and notes:
    - Resolves the ScriptDirectory via ScriptDirectory.from_config(config).
    - Packages the provided arguments into a RevisionContext (autogenerate.RevisionContext)
      which coordinates autogeneration and script output.
    - If autogenerate=True, the revision environment is forced on; combining
      --autogenerate with --sql (autogenerate + sql=True) is invalid and
      results in a util.CommandError.
    - The function may return a single Script instance, a list of Script instances,
      or None depending on configuration and options (for example when SQL output
      is requested or when no file is written).

Exceptions:
    util.CommandError
        - Raised for incompatible option combinations (e.g. --autogenerate with --sql)
        - Other command-level validation errors.

Examples
--------
Programmatic examples (conceptual):
- List templates:
  >>> list_templates(config)

- Initialize a new scripts directory:
  >>> init(config, "migrations", template="generic", package=False)

- Create an empty revision:
  >>> revision(config, message="add users table")

- Create an autogenerate revision:
  >>> revision(config, message="autogen changes", autogenerate=True)

Related objects
---------------
- alembic.config.Config
- alembic.script.ScriptDirectory
- alembic.script.base.Script
- util.CommandError
- autogenerate.RevisionContext
- runtime.environment.EnvironmentContext

See also
--------
The CLI equivalents (alembic init, alembic revision) and the autogeneration
mechanisms documented in the autogenerate/EnvironmentContext APIs.