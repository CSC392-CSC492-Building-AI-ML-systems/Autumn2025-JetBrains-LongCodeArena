Using custom attributes
=======================

Overview
--------
Custom attributes (also called user attributes or custom fields) are user‑defined pieces of data that can be attached to ftrack entity types (for example Task, AssetVersion, or Shot). They extend the built‑in schema to store project‑ or studio‑specific metadata such as review status, external IDs, pipeline flags or numeric estimates.

Custom attributes are defined at the server level (typically by an administrator) and once defined can be read and written by clients and scripts using the ftrack API.

Accessing custom attribute values
---------------------------------
Once a custom attribute has been defined for an entity type you can access its value directly from the entity object using dictionary‑style key lookups:

Example::

    task = session.get('Task', '1234')        # Fetch an entity (example)
    print(task['my_custom_attr'])              # Read value

Setting and saving values
-------------------------
Assign values to a custom attribute the same way you would any other attribute. Changes made to entities are recorded on the session and need to be committed to be persisted on the server:

Example::

    task['my_custom_attr'] = 'In Review'
    # Option A: commit via session
    session.commit()

    # Option B: some scripts use recorded operations and commit later:
    # session.recorded_operations contains operations until session.commit()

Clearing or removing values
---------------------------
To clear a value set it to None (or the empty value appropriate for the attribute type) and commit:

Example::

    task['my_custom_attr'] = None
    session.commit()

Common value types
------------------
Custom attributes support several common value types. The exact set and names depend on your ftrack server configuration, but typically include:

- String (text)
- Integer / Float (numeric)
- Boolean
- Date / DateTime
- Enum / Single choice (selected from a list of options)
- Multi‑choice (multiple selections)
- Lookup (references another entity)
- JSON or structured data (studio custom types)

The ftrack client performs simple conversions between Python types and the attribute value type where appropriate (for example, Python bool, int, float, str and datetime types).

Enumerations and options
------------------------
For enum or option attributes you typically assign one of the available option values (often stored as strings or keys). If an attribute is multi‑valued, assign an iterable of values appropriate for that attribute.

Example (single selection)::

    task['priority'] = 'High'
    session.commit()

Example (multi selection)::

    task['tags'] = ['vfx', 'review']
    session.commit()

Note: option values and keys depend on the custom attribute definition on the server.

Defining and managing custom attribute definitions
-------------------------------------------------
Creating or modifying custom attribute definitions is an administrative action on the ftrack server. In production studios this is commonly done via the server administration UI. Programmatic creation is possible with the API but requires administrative permissions and careful handling (and may require server schema cache refresh).

Typical properties of a custom attribute definition include:

- key (unique identifier)
- name / label (human readable)
- entity type(s) the attribute applies to (for example Task)
- value type (string, integer, boolean, date, enum, lookup, etc.)
- input type (text, textarea, dropdown, checkbox, multi select)
- default value
- allowed options (for enums)
- whether the attribute is multi‑valued
- whether the attribute is visible / editable in the UI

Because server schemas and field names vary between ftrack versions and deployments, refer to your studio administrator or the ftrack server documentation for exact creation APIs.

Querying and filtering with custom attributes
--------------------------------------------
You can filter client‑side by reading attribute values from queried entities:

Example::

    tasks = session.query('Task').all()
    urgent = [t for t in tasks if t.get('priority') == 'High']

Server‑side filtering by custom attributes may be possible with the ftrack query language depending on server version and how custom attributes are exposed. If you need server‑side filtering for performance, consult the ftrack server/query documentation for the correct query syntax for your installation.

Best practices
--------------
- Prefer creating and editing custom attribute definitions through the server admin UI unless you have automated, documented, and tested programmatic management.
- Use consistent naming and keys to avoid confusion across projects and scripts.
- Validate values in client code when expecting a specific type (e.g. ensure dates are datetime objects).
- Be careful when changing the type or allowed options of an attribute that already has data stored — such changes can require data migration.
- Commit at controlled points in scripts to group related changes and avoid partial updates.

Further information
-------------------
For implementation details about the ftrack Python API (session lifecycle, committing operations, entity caching and attribute handling) refer to the ftrack API documentation and the ftrack_api.attribute module documentation provided with your ftrack client package or server installation.