auto_augment module
===================

Overview
--------
The auto_augment module provides utilities to apply AutoAugment-style augmentation
policies to batches of images or video frames. The module exposes a flexible
high-level function that applies one of several predefined policies from the
AutoAugment paper (https://arxiv.org/abs/1805.09501) to DALI DataNodes.

The supported inputs are:
- Images in HWC layout.
- Videos in FHWC layout (frames-first).
- Input dtype must be uint8.

Predefined policies
-------------------
The following named policies are available:
- ``image_net`` — full ImageNet AutoAugment policy (supports translation-based ops).
- ``reduced_image_net`` — reduced ImageNet policy (does not contain translation ops).
- ``svhn`` — SVHN policy.
- ``reduced_cifar10`` — reduced CIFAR-10 policy.

When using a policy that does not include translation operations (currently
``reduced_image_net``), arguments related to image shape or translation magnitude
must not be provided (an exception is raised).

Functions
---------

auto_augment
^^^^^^^^^^^^
Applies one of the predefined AutoAugment policies to a batch of samples.

Signature
    .. function:: auto_augment(data, policy_name='image_net', shape=None, fill_value=128, interp_type=None, max_translate_abs=None, max_translate_rel=None, seed=None)

Parameters
    data (DataNode)
        A DALI DataNode representing a batch of samples. Images must be HWC and videos FHWC.
    policy_name (str, optional)
        Name of the predefined policy to apply. One of:
        ``'image_net'``, ``'reduced_image_net'``, ``'svhn'``, ``'reduced_cifar10'``.
        Defaults to ``'image_net'``.
    shape (DataNode or tuple(int, int), optional)
        If provided, the (height, width) of the image or frames in the video. When
        specified, translation magnitudes (for policies that use translation) are
        interpreted relative to the image shape and are sampled from a range that
        scales with the shape.
    fill_value (int or None, optional)
        Padding value used for warp_affine operations (translation, shear, rotate).
        If ``None`` is given, padding is performed by clamping (repeating border).
        Defaults to ``128``.
    interp_type (types.DALIInterpType or None, optional)
        Interpolation method to use for warp_affine ops. Supported values:
        ``types.INTERP_LINEAR`` (default) and ``types.INTERP_NN``.
    max_translate_abs (int or (int, int), optional)
        Maximum absolute translation (in pixels) when ``shape`` is not provided.
        If a tuple is given, it limits (height_shift, width_shift). Defaults to 250
        if not provided by caller when needed.
    max_translate_rel (float or (float, float), optional)
        Maximum translation as a fraction of the image shape when ``shape`` is provided.
        If a tuple is given, it limits (height_frac, width_frac). Defaults to 1.0 when needed,
        which can move the image fully off-canvas.
    seed (int, optional)
        Random seed used to sample operations and signs of magnitudes.

Returns
    DataNode
        A DALI DataNode with the transformed batch.

Raises
    Exception
        - If ``policy_name`` is not one of the supported policy names.
        - If a shape/translation-related argument is supplied for a policy that does not
          include any shape-dependent or translation augmentations (e.g. ``reduced_image_net``).

Notes
    - The function internally resolves a policy and calls the augmentation application
      pipeline (via internal helper such as :func:`apply_auto_augment`).
    - When ``shape`` is provided as a DataNode, shapes may vary per-sample; otherwise
      a fixed tuple (height, width) applies to every sample.
    - ``max_translate_abs`` is only valid when ``shape`` is not set; conversely,
      ``max_translate_rel`` is only valid when ``shape`` is provided.

auto_augment_image_net
^^^^^^^^^^^^^^^^^^^^^^
Convenience wrapper that applies the ``image_net`` AutoAugment policy.

Signature
    .. function:: auto_augment_image_net(data, shape=None, fill_value=128, interp_type=None, max_translate_abs=None, max_translate_rel=None, seed=None)

Description
    Equivalent to calling :func:`auto_augment` with ``policy_name='image_net'``.
    All other parameters behave exactly as in :func:`auto_augment`.

Examples
--------
Simple usage inside a DALI pipeline (conceptual):

    from nvidia.dali import fn, types
    from nvidia.dali.auto_aug import auto_augment

    # `images` is a DALI DataNode containing a batch of uint8 images in HWC layout
    augmented = auto_augment(images, policy_name='image_net',
                             shape=(224, 224),
                             fill_value=128,
                             interp_type=types.INTERP_LINEAR,
                             seed=42)

Providing no shape (absolute translation):

    augmented = auto_augment(images, policy_name='image_net',
                             max_translate_abs=30, seed=123)

Applying the reduced ImageNet policy (shape/translation args must not be supplied):

    augmented = auto_augment(images, policy_name='reduced_image_net')

Implementation details
----------------------
- The module uses predefined policy constructors (e.g. get_image_net_policy) to build
  a :class:`Policy` instance and then applies it to the provided DataNode.
- Translation parameter semantics:
  - If ``shape`` is provided, translation magnitudes are sampled relative to the
    image/frame size using ``max_translate_rel`` (fractional).
  - If ``shape`` is not provided, translation magnitudes are sampled in pixels up
    to ``max_translate_abs``.
- Interpolation and padding choices are applied to warp-affine operations such as
  translation, shear, and rotate.

See also
--------
- AutoAugment paper: https://arxiv.org/abs/1805.09501
- DALI types: :mod:`nvidia.dali.types`
- DALI functional API: :mod:`nvidia.dali.fn`