Delete view — Implements the preview+confirm+delete workflow
==========================================================

Overview
--------
Provides a small reusable workflow for previewing an object, asking the user to
confirm deletion, performing the delete and showing a success message. The
functionality is split into a generic mixin (DeleteViewMixin) and a concrete
view for cradmin "within role" pages (WithinRoleDeleteView).

Classes
-------

DeleteViewMixin
^^^^^^^^^^^^^^^
A mixin that augments Django's DeleteView with:

- Default page/action labels and translatable strings:
  - get_pagetitle() -> "Confirm delete"
  - get_action_label() -> "Delete"
  - get_delete_button_label() -> defaults to get_action_label()
  - get_cancel_button_label() -> "Cancel"
- Object preview and confirmation message:
  - get_object_preview() -> str(self.get_object()) by default
  - get_confirm_message() -> 'Are you sure you want to delete "%(object_preview)s"?'
- Success handling:
  - get_success_url() -> defaults to the current app index
    (self.request.cradmin_app.reverse_appindexurl())
  - get_success_message(object_preview) -> 'Deleted "%(what)s"' by default
  - add_success_messages(object_preview) -> calls Django messages.success if
    get_success_message returns a value
- Context helpers:
  - add_delete_view_mixin_context_data(context) — adds the common context
    variables used by delete templates
- delete(request, *args, **kwargs) — calls super().delete(...) and then
  add_success_messages(object_preview) so the success message is shown after
  deletion.

Import path (recommended usage):
from django_cradmin import viewhelpers
refer to as: viewhelpers.formview.DeleteViewMixin

WithinRoleDeleteView
^^^^^^^^^^^^^^^^^^^
A view class suitable for cradmin pages that have a role. It composes several
mixins and Django's DeleteView:

Inheritance (high level): QuerysetForRoleMixin, DeleteViewMixin, DjangoDeleteView,
CommonCradminViewMixin, javascriptregistry.viewmixin.WithinRoleViewMixin

- template_name: 'django_cradmin/viewhelpers/formview/within_role_delete_view.django.html'
- get_context_data(...) calls:
  - add_javascriptregistry_component_ids_to_context(context=context)
  - add_common_view_mixin_data_to_context(context=context)
  - add_delete_view_mixin_context_data(context=context)

Import path (recommended usage):
from django_cradmin import viewhelpers
refer to as: viewhelpers.formview.WithinRoleDeleteView

Context variables provided by add_delete_view_mixin_context_data
----------------------------------------------------------------
The following keys are added to the template context:

- model_verbose_name — obj._meta.verbose_name
- success_url — get_success_url()
- object_preview — get_object_preview()
- pagetitle — get_pagetitle()
- confirm_message — get_confirm_message()
- delete_button_label — get_delete_button_label()
- cancel_button_label — get_cancel_button_label()

Template
--------
The default WithinRoleDeleteView template:
django_cradmin/viewhelpers/formview/within_role_delete_view.django.html

This template is expected to use the context keys above to render the preview,
confirmation text and action/cancel buttons.

Behavior / Flow
---------------
1. Render view showing object preview and the confirm message.
2. User confirms deletion (form POST).
3. View deletes object (Django DeleteView behavior).
4. delete(...) in DeleteViewMixin captures an object preview before deletion,
   calls the parent delete and then add_success_messages(object_preview).
5. User is redirected to get_success_url() and (by default) a success message
   is added to Django messages.

Customization examples
----------------------

Override preview text:
::
    class MyDeleteView(DeleteViewMixin, DjangoDeleteView):
        def get_object_preview(self):
            obj = self.get_object()
            return '{} ({})'.format(obj.full_name, obj.pk)

Customize success message:
::
    def get_success_message(self, object_preview):
        return gettext_lazy('Successfully removed %(what)s') % {'what': object_preview}

Change redirect target:
::
    def get_success_url(self):
        return reverse('my-custom-index')

Notes
-----
- All user-visible strings use gettext_lazy for easy translation.
- add_success_messages can be overridden to use another messaging system or to
  add multiple messages.
- DeleteViewMixin.delete ensures the success message is produced with the same
  object preview that was shown to the user prior to deletion.