Data component in an Image HDU
=============================

Overview
--------
The Data component of an Image HDU holds the pixel values for a FITS image.  In Astropy this is exposed as a NumPy ndarray (or an array-like object backed by a memory-mapped file) and provides direct access to the image pixels, their shape, and dtype.  The Data component follows FITS conventions for axis ordering and value scaling; verification machinery is available to report or fix common issues.

Accessing the data
------------------
- The data attribute of an ImageHDU (and PrimaryHDU) is the array of pixel values:
  ``hdu.data``
- Typical usage:
  - Open a FITS file (optionally memory-mapped) and access data:
    ``from astropy.io import fits``
    ``hdul = fits.open('image.fits', memmap=True)``
    ``data = hdul[0].data``
  - ``data`` behaves as a NumPy ndarray for indexing, slicing, arithmetic, etc.

Array shape and indexing
------------------------
- The array shape corresponds to the FITS NAXIS values.  FITS stores axes in increasing order, but the resulting NumPy shape is (NAXIS2, NAXIS1[, NAXIS3, ...]) so that the first array index corresponds to the second FITS axis and the second index to the first FITS axis.  In other words, use ``data[y, x]`` to access the pixel at FITS coordinate (x, y).
- Astropy uses zero-based indexing (i.e., the first element of an array is index 0).
- For multi-dimensional images the same axis-order rule applies (row-major order matching NumPy conventions).

Data types and BITPIX mapping
-----------------------------
- The in-memory dtype of ``hdu.data`` reflects the FITS BITPIX value and any on-disk representation.  Common mappings:
  - BITPIX = 8  → unsigned 8-bit integer
  - BITPIX = 16 → signed 16-bit integer
  - BITPIX = 32 → signed 32-bit integer
  - BITPIX = -32 → 32-bit floating point
  - BITPIX = -64 → 64-bit floating point
- The actual dtype of the loaded array is a NumPy dtype.  When FITS scaling (BSCALE/BZERO) is applied, returned values are the scaled, physical values (see "Scaling" below).

Scaling (BSCALE, BZERO)
-----------------------
- FITS files may store integer values with linear scaling parameters BSCALE and BZERO.  By default Astropy applies scaling so that ``hdu.data`` contains the physical (scaled) values.
- Some APIs allow opening without applying scaling (returning raw stored values); consult the relevant open/read functions for options that control scaling.

Memory mapping and file-backed arrays
------------------------------------
- When a FITS file is opened with memory mapping enabled (e.g., ``fits.open(..., memmap=True)``), the data array may be a NumPy memmap.  Benefits:
  - Large images can be accessed without reading the entire image into memory.
  - Slicing reads only the accessed portions as needed.
- Caution:
  - A memory-mapped array is backed by the on-disk file; modifying the array may modify the underlying file contents.  Close or flush the HDUList appropriately if you rely on changes being written or not written.
  - Closing the FITS file will invalidate the memmap; keep a reference to data only while the file is open or explicitly copy data (e.g., ``data.copy()``) if you need it after closing.

Modifying image data
--------------------
- The data array supports standard NumPy assignment and in-place operations:
  ``hdu.data[10:20, 30:40] = 0``
- When the HDU is part of an open HDUList, changes can be written back to disk with the usual HDUList file-writing utilities (e.g., ``hdul.flush()`` or ``hdul.writeto(...)`` depending on how the file was opened).
- Some internal classes provide notification hooks: changes to the data may trigger update notifications to registered listeners (internal implementation detail).

Verification and error reporting
--------------------------------
- HDUs support verification to check for common FITS issues. Verification can report warnings, raise exceptions, or attempt to fix fixable problems depending on the chosen option. Options include:
  - ``"ignore"``, ``"warn"``, ``"exception"``, ``"fix"``, ``"silentfix"``, and combinations such as ``"fix+warn"``.
- Verification messages are collected and reported as warnings (VerifyWarning) or as a combined VerifyError exception when requested.  Messages include the note that Astropy uses zero-based indexing.

Notes and best practices
------------------------
- Treat ``hdu.data`` as a NumPy ndarray for computations; use NumPy functions for vectorized operations.
- For very large images prefer memory mapping to reduce memory usage, but be mindful of the file-backed semantics.
- When performing destructive edits, ensure you understand whether you are modifying an in-memory copy or a memmap-backed array, and write changes explicitly if persistence is required.
- Use the verification facility to detect and optionally fix FITS-specific inconsistencies before processing image data.