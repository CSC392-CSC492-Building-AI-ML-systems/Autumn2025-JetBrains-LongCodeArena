Generalized Linear Mixed Effects Models
=====================================

Overview
--------
This implementation provides Bayesian inference for generalized linear mixed
models (GLMMs). Supported outcome families are those without additional scale
or shape parameters (currently Binomial and Poisson). Two estimation
approaches are provided:

- Laplace approximation (maximum a posteriori; fit_map)
- Variational Bayes (mean-field approximation to the posterior; fit_vb)

All realized random effects are modeled as mutually independent given the
variance-structure parameters.

Model and parameterization
--------------------------
The joint density of data and parameters factors as:

.. math::

    p(y \mid vc, fep)\; p(vc \mid vcp)\; p(vcp)\; p(fe)

where

- y are the observed responses,
- fep are the fixed-effects parameters,
- vc are the realized random-effect values (one realized value per column
  of the random-effects design matrix),
- vcp are the variance-component parameters (parameterizing the standard
  deviations of the random effects).

The conditional distribution of responses p(y | vc, fep) depends on the
chosen GLM family and link. Random effects conditional on vcp are independent
Gaussian. The priors p(vcp) and p(fe) are taken to be Gaussian on the
parameterization used for estimation (see Priors).

Random effects design and identifiability
----------------------------------------
The matrix exog_vc is the design matrix for random effects. Every column of
exog_vc corresponds to a distinct realized random effect. The standard
deviation (scale) parameters for these realized random effects are constrained
to be equal within subsets of columns. These subsets are specified in two
ways:

- When constructing models without formulas: the ident array (integer labels)
  must have the same length as the number of columns of exog_vc. Two columns
  that share the same ident value are constrained to have the same standard
  deviation.
- When using model formulas: columns derived from the same random-effects
  formula share the same standard deviation; ident is constructed internally.

exog_vc can be sparse (scipy.sparse). If a dense array is passed it will be
internally converted to sparse.

Priors
------
- Variance-component parameters (vcp): the implementation parameterizes vcp as
  the log of standard deviations. These log-standard-deviation parameters
  have Gaussian priors with mean 0 and user-specified standard deviation
  vcp_p. Hence the implied prior on standard deviations is log-normal.
- Fixed effects (fep): Gaussian prior with mean 0 and standard deviation fe_p.
- Random effects (vc | vcp): independent Gaussian with zero mean and standard
  deviations determined by vcp and the ident grouping.

Estimation approaches
---------------------
Laplace approximation (fit_map)
    Finds the posterior mode (MAP) and uses a Laplace approximation to
    approximate the posterior. This is useful when a fast point estimate and
    approximate uncertainty are desired.

Variational Bayes (fit_vb)
    Uses a mean-field variational approximation to approximate the posterior
    distribution. This provides an alternative approximation to the posterior
    that can be computationally efficient for larger models.

Practical notes and recommendations
-----------------------------------
- Supported families: Binomial and Poisson (families without additional scale
  or shape parameters).
- All random-effect realizations are modeled independent given vcp.
- When using sparse exog_vc, computations avoid unnecessary dense copies where
  feasible. However, formula processing may require temporary dense matrices.
- Choosing vcp_p: for some families (e.g., Binomial), finding the posterior
  mode can be numerically challenging if vcp_p is too large. A value of
  vcp_p â‰ˆ 0.5 is often a reasonable default.
- Naming: fep_names, vcp_names, and vc_names may be provided; otherwise
  default names are constructed.

API and constructor parameters
------------------------------
The primary model constructor accepts the following key arguments:

- endog : array_like
    Response vector.
- exog : array_like
    Covariates for the fixed-effects component.
- exog_vc : array_like or scipy.sparse
    Covariates for the random-effects component (columns correspond to
    realized random effects). Dense arrays are converted to sparse.
- ident : array_like
    Integer labels indicating which columns of exog_vc share a common
    variance (length must equal number of columns of exog_vc). When using
    formulas, ident is built automatically.
- vcp_p : float
    Prior standard deviation for vcp (the prior on log-standard-deviations).
- fe_p : float
    Prior standard deviation for fixed-effects parameters.
- family : statsmodels.genmod.families instance
    The GLM family (e.g., Binomial, Poisson).
- fep_names, vcp_names, vc_names : list of strings or None
    Optional names for fixed effects, variance-component parameters, and
    realized random-effect terms.

Examples
--------
Basic usage sketch:

- Construct a model with endog, exog, exog_vc (and optionally ident or
  formulas).
- Call fit_map() for a MAP/Laplace estimate or fit_vb() for a variational
  approximation.
- Use the returned results object to inspect parameter estimates and summaries.

References
----------
- Introduction to generalized linear mixed models:
  https://stats.idre.ucla.edu/other/mult-pkg/introduction-to-generalized-linear-mixed-models
- SAS documentation on mixed models:
  https://support.sas.com/documentation/cdl/en/statug/63033/HTML/default/viewer.htm#statug_intromix_a0000000215.htm
- An assessment of estimation methods for GLMMs with binary outcomes:
  https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3866838/