w_direct — Direct (trajectory-traced) state-to-state kinetics and fluxes
========================================================================

Synopsis
--------
w_direct init [options]
w_direct kinetics [options]

Description
-----------
The w_direct command produces and processes state-to-state flux and transition-duration
data by tracing weighted-ensemble trajectories through user-defined macrostates (labels).
It comprises two primary subcommands:

- init
  - Generate direct, trajectory-traced flux and event-duration data and write them to
    a kinetics file (default: direct.h5).
  - Requires a bin-assignment file (usually assign.h5) containing trajectory labeling.
    The assignment data must span the requested iteration range.

- kinetics
  - Compute averaged rates, fluxes, and associated confidence intervals from an existing
    kinetics file (direct.h5) together with a bin-assignment file. Supports calculation
    of full-window averages and (optionally) an evolution of estimates across windows.
  - Uses bootstrap/MCBS-style confidence-interval estimation and correlation handling
    (parameters such as alpha, n-sets, autocorrel-alpha, and enabling of correlation
    analysis control details of the uncertainty estimation).

Files
-----
Default kinetics/IO filenames:
- default input/output kinetics file: direct.h5
- default assignments file (bin assignments/labels): assign.h5

w_direct init — Trace trajectories and record fluxes/durations
---------------------------------------------------------------
Purpose
:  Walk trajectories using assignment labels and record state-to-state fluxes,
   transition counts, and event durations that end in each iteration.

Primary output datasets written to the kinetics file (by default direct.h5)
--------------------------------------------------------------------------
- /conditional_fluxes [iteration][state][state]
  Floating-point macrostate-to-macrostate fluxes. These are NOT normalized by the
  population of the initial macrostate.

- /conditional_arrivals [iteration][stateA][stateB]
  Integer counts of trajectories that arrived at stateB in the iteration given they
  departed from stateA.

- /total_fluxes [iteration][state]
  Floating-point total flux into each macrostate.

- /arrivals [iteration][state]
  Integer counts of trajectories arriving at each state (regardless of origin).

- /duration_count [iteration]
  Integer number of recorded event durations ending during each iteration.

- /durations [iteration][event_index] (structured)
  Event durations recorded for transitions that end in the given iteration. Records
  are structured with the following fields:
  - istate (integer): initial state of transition event
  - fstate (integer): final state of transition event
  - duration (float): event duration in units of tau
  - weight (float): trajectory weight at end of transition (not normalized by initial-state population)

Notes
- Because /conditional_fluxes entries are not normalized by the population of the initial macrostate,
  they are not directly equivalent to rates. Use w_direct kinetics to normalize and obtain rates
  with appropriate error estimates.

w_direct kinetics — Compute averages, rates, and confidence intervals
--------------------------------------------------------------------
Purpose
:  Convert fluxes recorded by w_direct init into averaged rates and fluxes with
   statistically meaningful confidence intervals, optionally reporting evolution
   across windows of iterations.

Primary output datasets produced/updated in the kinetics file (default direct.h5)
-------------------------------------------------------------------------------
- /avg_rates [state,state]
  Structured state-to-state rate estimates computed over the selected iteration window.
  Rates are obtained by normalizing appropriate fluxes by initial-state populations
  and by accounting for statistical correlations.

- /avg_total_fluxes [state]
  Structured average total flux into each state over the selected window.

- /avg_conditional_fluxes [state,state]
  Structured average conditional (state-to-state) fluxes over the selected window.

Evolution mode (optional)
:  If evolution mode is enabled, time-resolved evolution datasets are produced:
- /rate_evolution [window][state][state]
  Per-window structured rate estimates for each window (and analogous datasets exist
  for flux evolution).

Methodology notes
-----------------
- Rate estimation leverages a sequence-based estimator that requires the total
  population dataset alongside flux traces so that normalizations properly account
  for contributions from all macrostates (i.e., i→j estimates use populations of i and j).
- Uncertainty estimation uses bootstrap/MCBS procedures with optional autocorrelation
  handling. Parameters controlling the CI machinery include alpha, number-of-sets,
  autocorrel-alpha, and enabling/disabling of correlation correction.

Command-line options (high level)
---------------------------------
- -o / --output
  Path to output kinetics file (default: direct.h5).

- --assignments / --assign
  Path to bin-assignment (label) file (usually assign.h5). Required for init and
  kinetics subcommands.

- Iteration-selection options
  Options to select the iteration range or windows for processing (as typical for
  WESTPA tools); the assignments file must cover the selected iteration range.

- Kinetics/CI options
  Options to control averaging and confidence-interval calculations (alpha, number
  of bootstrap sets, autocorrelation alpha, enable/disable correlation correction,
  and evolution-mode).

Examples
--------
- Produce direct flux/duration data:
  w_direct init -o direct.h5 --assignments assign.h5

- Compute average rates and conditional fluxes with confidence intervals:
  w_direct kinetics -o direct.h5 --assignments assign.h5

Implementation details (notes for advanced users)
------------------------------------------------
- The rate-evaluation procedure iterates over all ordered state pairs (i ≠ j) and
  evaluates estimators that require both the i→j flux trace and the full state-population
  trace to achieve proper normalization and to avoid bias from third-state influences.
- The bootstrap/CIs are implemented using MCBS-style sampling with optional correlation
  correction and subsampling (e.g., subsample=np.mean). Parameters controlling these
  procedures are exposed as command options.

See also
--------
- w_assign — generate bin assignments (assign.h5) required by w_direct
- w_direct --help (or subcommand-specific --help) for full command-line option lists and usage details