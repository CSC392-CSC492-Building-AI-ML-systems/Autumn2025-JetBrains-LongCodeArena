contingency_tables — Two-way contingency table analysis
======================================================

Overview
--------
Utilities and inference procedures for analyzing two-way contingency
tables (frequency tables for observations cross-classified with respect
to two categorical variables).

This module provides classes and functions to work with general two-way
tables, square tables, 2x2 tables and collections of 2x2 tables. It
also supplies procedures for common tests such as chi-square tests of
independence, ordinal association (linear-by-linear / Cochran–Armitage
trend), McNemar's test and Cochran's Q test.

Key components
--------------
- Table
  - General two-way contingency table class for inference and
    descriptive computations.
- SquareTable
  - Methods and utilities targeted to square contingency tables.
- Table2x2
  - Methods specialized for 2x2 contingency tables (e.g. odds ratios,
    exact tests).
- StratifiedTable
  - Methods for a collection of 2x2 tables (stratified analyses).
- _make_df_square(table)
  - Helper to reindex a pandas DataFrame so rows and columns contain
    the same ordered labels (fills missing entries with zeros).
- _Bunch
  - Minimal container used to return results with attribute access.
- mcnemar, cochran_q
  - Functions for McNemar's test and Cochran's Q test
    (testing paired nominal data / repeated measures on a binary
    outcome).

Notes on sampling and inference
------------------------------
The inference procedures assume that the observed units are
independent and identically distributed, each unit being classified
according to two categorical variables. Some tests (e.g. exact or
conditional tests) implicitly depend on the sampling scheme; users
should verify that the chosen procedure matches their sampling design.

Detailed API
------------

_make_df_square(table)
    Ensure a pandas.DataFrame contingency table is square: extend the
    row and column indices so they contain the same labels in the same
    order. Non-DataFrame inputs are returned unchanged.

    Parameters
    ----------
    table : pandas.DataFrame or array-like
        If a DataFrame, it is reindexed and returned as square with missing
        cells filled with zeros.

    Returns
    -------
    pandas.DataFrame or original input
        Reindexed square DataFrame or original object if not a DataFrame.

_Bunch
    Tiny container object used for returning multiple named results.
    Attributes are set on instances and can be accessed via dot notation.

Table
-----
A general two-way contingency table class providing routines for
association testing and other table-based calculations.

Constructor
    Table(table, shift_zeros=True)

    Parameters
    ----------
    table : array-like or pandas.DataFrame
        Contingency table of nonnegative counts. Can be a numpy array or
        a pandas DataFrame (row/column labels are preserved).
    shift_zeros : bool, default True
        If True and any cell count equals zero, 0.5 is added to all
        cells (a small-sample continuity adjustment used by some methods).

Attributes
    table_orig : original input table (array-like or DataFrame)
    table : numpy.ndarray
        Internal numeric copy used for computations (dtype float64).

Methods
    from_data(data, shift_zeros=True) -> Table
        Construct a Table from raw data (cross-tabulate the first two
        columns). Accepts numpy arrays or pandas DataFrames. Returns a
        Table instance.

        Parameters
        ----------
        data : array-like or pandas.DataFrame
            Raw observations; the first two columns are used to form the
            contingency table (rows × columns).
        shift_zeros : bool, default True
            See constructor.

    test_nominal_association() -> _Bunch
        Chi-square test of independence for nominal (unordered)
        categorical variables.

        Returns
        -------
        _Bunch with attributes:
        - statistic : float
            The chi-square test statistic (sum of Pearson contributions).
        - df : int
            Degrees of freedom = (n_rows - 1)*(n_cols - 1).
        - pvalue : float
            p-value under the chi-square reference distribution.

    test_ordinal_association(row_scores=None, col_scores=None) -> _Bunch
        Linear-by-linear association (trend) test for ordinal variables.
        Uses numeric scores (weights) for rows and columns to increase
        power against ordered alternatives (default scores are
        sequential integers).

        Parameters
        ----------
        row_scores : array-like, optional
            Numeric scores for rows (length must equal number of rows).
        col_scores : array-like, optional
            Numeric scores for columns (length must equal number of columns).

        Returns
        -------
        _Bunch with attributes (typical):
        - statistic : float
            Observed test statistic (weighted sum over cells).
        - null_mean : float
            Expected value under the null hypothesis.
        - null_sd : float
            Standard deviation under the null hypothesis.
        - zscore : float
            Standardized test statistic.
        - pvalue : float
            p-value (two-sided by default).

    __str__()
        Human-readable summary: prints the table shape and numeric counts.

Notes
-----
- The Table class will coerce a pandas.DataFrame input to a numeric
  numpy array for computation, but preserves the original input in
  table_orig.
- When providing custom scores for ordinal tests, the length of the
  score arrays must match the corresponding table dimension. A ValueError
  is raised otherwise.

Other classes and functions
---------------------------
SquareTable, Table2x2, StratifiedTable
    These provide specialized methods for square tables, 2x2 tables, and
    stratified analyses of multiple 2x2 tables, respectively. See their
    docstrings for detailed APIs (odds ratios, exact tests, Mantel–Haenszel
    summaries, etc.).

mcnemar
    McNemar's test for paired nominal data (2 × 2 table for paired
    comparisons). Use when evaluating change or agreement in matched
    binary responses.

cochran_q
    Cochran's Q test for k related samples with binary outcomes
    (generalization of McNemar for more than two matched treatments/time
    points).

Examples
--------
Creating a table from raw data and running tests:

    >>> import numpy as np
    >>> from contingency_tables import Table
    >>> data = np.array([
    ...     ['A', 'X'],
    ...     ['A', 'Y'],
    ...     ['B', 'X'],
    ...     ['B', 'X'],
    ... ])
    >>> tbl = Table.from_data(data)
    >>> print(tbl)
    A 2x2 contingency table with counts:
    [[2. 1.]
     [0. 1.]]
    >>> res = tbl.test_nominal_association()
    >>> res.statistic, res.df, res.pvalue

For ordinal association with custom scores:

    >>> res = tbl.test_ordinal_association(row_scores=[0, 1],
    ...                                   col_scores=[0, 1])
    >>> res.zscore, res.pvalue

References
----------
- Cochran, W. G. (1954). Some methods for strengthening the common
  chi-squared tests. Biometrics.
- Agresti, A. (2013). Categorical Data Analysis (3rd ed.). Wiley.
- Online notes on residuals and contribution to chi-square:
  https://onlinecourses.science.psu.edu/stat504/node/86

See Also
--------
- scipy.stats.chi2_contingency
- statsmodels.graphics.mosaicplot.mosaic

License and attribution
-----------------------
This module builds on NumPy, SciPy and pandas for core calculations and
indexing. Error handling and decorators follow patterns used in
statsmodels.