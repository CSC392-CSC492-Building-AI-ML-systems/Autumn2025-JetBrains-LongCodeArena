models â€” SimpleFitter and SpectralModel
======================================

SimpleFitter wrapper
--------------------

A minimal base wrapper for fitters and a small utility for obtaining
spectral moments.

Synopsis
^^^^^^^^
This module supplies:

- SimpleFitter: a lightweight base fitter class.
- vheightmodel: a wrapper to add a variable constant background (height)
  to an existing model function.
- SpectralModel: a rich, generic spectral model wrapper that supports
  multi-component models, parameter information, guess-type handling,
  and integrations.

Module authorship
^^^^^^^^^^^^^^^^^
.. moduleauthor:: Adam Ginsburg <adam.g.ginsburg@gmail.com>

Public variables
^^^^^^^^^^^^^^^^
valid_guess_types
    Tuple of allowed guess-type names used when interpreting user
    guesses: ('amplitude', 'center', 'width').

Functions
^^^^^^^^^

vheightmodel(zeroheightmodel)
    Return a model function that adds a variable constant background
    (height) parameter to an existing model function.

    Parameters
    - zeroheightmodel: callable
        A model function that accepts an x-axis and the model parameters
        (no explicit height/background parameter).

    Returns
    - vhm: callable
        A wrapped model function with the following behavior:
        - Signature: vhm(xax, *pars, **kwargs)
        - Parameter ordering expected by vhm: (height, <original model params...>)
          i.e. the first parameter is the additive constant background.
        - If the keyword argument vheight is present and set to False, the
          wrapper will call the original zeroheightmodel without adding
          the height term (useful to disable the background).
        - The wrapper preserves/adds the docstring of the original model.

Classes
^^^^^^^

SimpleFitter
    A very small base class intended for simple fitter wrappers.

    Important members
    - moments(self, *args, **kwargs)
        Proxy to pyspeckit.spectrum.moments.moments to compute spectral
        moments. Docstring: "Get the spectral moments from the moments package."

    Notes
    - __init__ is a no-op placeholder in this module (defined but empty).

SpectralModel(fitter.SimpleFitter)
    A general-purpose spectral model wrapper that provides parameter
    metadata, multi-component construction, guess-type handling, and
    convenience functionality for fitting and annotating spectral profiles.

    Overview
    - Wraps a user-supplied model function (modelfunc) and manages:
      parameter counts, default Parinfo, parameter limits and ties,
      unit conversion for fitting axis, centroid designation, FWHM and
      analytic integrals, and integration with mpfit/lmfit backends.

    Constructor
    Signature:
        SpectralModel(modelfunc, npars,
                      shortvarnames=("A","\\Delta x","\\sigma"),
                      fitunit=None,
                      centroid_par=None,
                      fwhm_func=None,
                      fwhm_pars=None,
                      integral_func=None,
                      use_lmfit=False,
                      guess_types=('amplitude','center','width'),
                      **kwargs)

    Parameters
    - modelfunc : function
        Model function to be fitted. Should accept an X-axis and then
        the parameter list, returning an array matching the X-axis shape.
    - npars : int
        Number of parameters required by the model.
    - shortvarnames : sequence, optional
        TeX-ready short names for parameters used when annotating plots.
    - fitunit : str or unit, optional
        Unit (or name) to which the X-axis is converted prior to model use.
    - centroid_par : int or name, optional
        Index or name of the parameter representing the profile centroid.
    - fwhm_func : callable, optional
        Function used to compute FWHM from parameters when available.
    - fwhm_pars : sequence, optional
        Parameters for the fwhm_func (if required).
    - integral_func : callable, optional
        Analytic integral function for the profile (if available).
    - use_lmfit : bool, optional
        If True, prefer lmfit as the fitting backend instead of mpfit.
    - guess_types : sequence, optional
        Describes interpretation of user guesses. Entries may be the
        strings 'amplitude', 'center', 'width' or numeric (float) values.
        Values are validated against valid_guess_types.
    - **kwargs : passed to internal Parinfo construction
        Additional keyword arguments are handled by the _make_parinfo helper
        to build default Parinfo objects (names, limits, fixed flags, steps,
        etc.). The resulting default_parinfo is copied to self.parinfo.

    Key attributes set at initialization
    - modelfunc : the wrapped model callable
    - npars, default_npars : int
    - shortvarnames : tuple of display names
    - fitunit : unit/str for axis conversion
    - default_parinfo : ParinfoList describing default parameter metadata
    - parinfo : a (copy) ParinfoList used in fitting
    - modelfunc_kwargs : dict of kwargs retained for use when evaluating model
    - use_lmfit : bool (whether to use lmfit)
    - centroid_par : parameter identifying the centroid
    - fwhm_func, fwhm_pars : FWHM-related callables/parameters
    - integral_func : analytic integral callable (if any)
    - guess_types : validated list/tuple of guess descriptors

    Behavior and helpers
    - The constructor appends or merges the docstring of modelfunc
      onto the class docstring when available.
    - Guess types are validated: they must either be float or contain one
      of the valid_guess_types tokens ('amplitude','center','width'), or
      a ValueError is raised.

    Special methods
    - __call__(self, *args, **kwargs)
        The fitter invocation entry point. Supports passing use_lmfit as a
        keyword override to temporarily select the fitting backend. (The
        module's implementation delegates to the configured fitting routines
        and logs debug information on call.)
    - __copy__ and __deepcopy__
        Implement shallow and deep copy semantics so SpectralModel instances
        can be copied safely without unintentionally sharing mutable state.

    Integration notes
    - This class uses Parinfo and ParinfoList objects for parameter metadata,
      integrates with pyspeckit.mpfit/mpfitException, and can emit warnings
      via pyspeckit.specwarnings.warn. It expects OrderedDict availability
      (falls back to ordereddict package for Python < 2.7).

Usage summary
^^^^^^^^^^^^^
- To add a constant background parameter to an existing model function
  use vheightmodel(zeroheightmodel). The returned function expects its
  first parameter to be the background height.
- Instantiate a SpectralModel with a model function and the number of
  parameters the model requires. Configure parameter defaults and limits
  via parinfo-related kwargs (handled internally).
- Use the SpectralModel instance as a callable to perform fits; the
  fitting backend can be controlled with the use_lmfit attribute or a
  per-call use_lmfit keyword.

See also
^^^^^^^^
- pyspeckit.spectrum.parinfo.Parinfo, ParinfoList for parameter metadata
- pyspeckit.mpfit for the primary mpfit fitting backend
- pyspeckit.spectrum.moments.moments for the moments utility used by
  SimpleFitter.moments.