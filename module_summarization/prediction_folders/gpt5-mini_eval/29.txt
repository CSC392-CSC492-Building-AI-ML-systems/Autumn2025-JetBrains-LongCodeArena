w_ntop — select walkers from bins
================================

Synopsis
--------
w_ntop [OPTIONS]

Purpose
-------
Select a fixed number of walkers from each bin at each iteration using an
assignments file that maps walkers (segments) to bins at each timepoint.
By default the highest-weight walkers are selected ("N top-weighted"), but
you may instead select the lowest-weight walkers or a random sample.

Requirements
------------
- An assignments file mapping segments to bins (default: assign.h5). See
  w_assign for creating this file.
- WESTPA trajectory/segment data available for the iterations being
  examined (configured via the usual WESTDataReader options).

Command-line options
--------------------
General:
- Iteration-range and data-reader options are provided through the usual
  WESTDataReader and IterRangeSelection arguments (see w_help for details).

Input:
- -a, --assignments ASSIGNMENTS
  Use assignments from ASSIGNMENTS (default: assign.h5).

Selection:
- -n, --count COUNT
  Select COUNT walkers from each bin in each iteration (default: 1).
- -t, --timepoint TIMEPOINT
  Base the selection on the given TIMEPOINT within each iteration.
  Default (-1) corresponds to the last timepoint.
- --highweight
  Select the COUNT highest-weight walkers from each bin (default).
- --lowweight
  Select the COUNT lowest-weight walkers from each bin.
- --random
  Select COUNT walkers randomly from each bin.

Output:
- -o, --output OUTPUT
  Write the selection results to OUTPUT (default: ntop.h5).

Progress:
- A progress indicator is shown during processing (configurable via the
  tool's progress options).

Behavior and selection details
------------------------------
- For each requested iteration in the iteration range, the tool reads the
  assignment of segments to bins at the requested timepoint and the
  segment weights for that iteration.
- For each bin it selects up to COUNT segments according to the selected
  method:
  - highweight: the COUNT segments with largest weight,
  - lowweight: the COUNT segments with smallest weight,
  - random: COUNT segments chosen uniformly at random.
- If fewer than COUNT segments exist in a bin for an iteration, the
  recorded number of selected segments for that bin is reduced accordingly.

Output file format
------------------
The output is an HDF5 file (default ntop.h5) containing these datasets:

- /n_iter [iteration]
  Integer iteration numbers for each stored entry (range selected).

- /nsegs [iteration][bin]
  Integer: number of segments actually selected for each bin in the
  given iteration. This will be <= requested COUNT.

- /seg_ids [iteration][bin][segment]
  Integer segment IDs of the selected segments. For a given iteration
  index i and bin b, only the first nsegs[i][b] entries are valid.

- /weights [iteration][bin][segment]
  Floating-point weights corresponding to the segment IDs in /seg_ids.

Notes
-----
- The number of bins is read from the assignments file (assignments_file.attrs['nbins'] + 1)
  and is used when shaping the output datasets.
- The tool validates that the requested iteration range exists in the
  assignments dataset before proceeding.
- The output datasets are chunked and compressed in the HDF5 file for
  efficient storage and access.

Examples
--------
Select the single highest-weight walker per bin in iterations 0–99 and
write results to ntop.h5:
  w_ntop --iter-start 0 --iter-stop 100 -n 1 -o ntop.h5

Select three randomly chosen walkers per bin at the last timepoint:
  w_ntop --random -n 3

Select the two lowest-weight walkers per bin using a specific assignments
file:
  w_ntop -a my_assignments.h5 --lowweight -n 2

See also
--------
w_assign (to produce the assignments file), and the WESTDataReader /
iteration-range options for configuring which iterations and data files
are used.