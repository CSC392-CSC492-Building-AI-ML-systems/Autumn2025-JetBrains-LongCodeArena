Piccolo Projects Module
======================

This module provides lightweight utilities and configuration classes used to register Piccolo applications, discover table classes within app modules, and describe migration modules. The key components are: MigrationModule, PiccoloAppModule, table_finder, Command, AppConfig, and AppRegistry.

MigrationModule
---------------

A minimal ModuleType subclass that defines the expected attributes of a migration module.

Attributes
- ID (str): Unique identifier for the migration.
- VERSION (str): Migration version string.
- DESCRIPTION (str): Short description of the migration.

Coroutines
- forwards() -> None
  - Async coroutine stub representing the forward migration operation.

PiccoloAppModule
----------------

A ModuleType subclass representing a Piccolo application module.

Attributes
- APP_CONFIG (AppConfig): The application configuration instance defined by the app (typically in piccolo_app.py).

table_finder
------------

Discover and import Table subclasses from one or more module paths.

Signature
- table_finder(modules: Sequence[str], include_tags: Sequence[str] = None, exclude_tags: Sequence[str] = None, exclude_imported: bool = False) -> List[Type[Table]]

Description
- Imports each provided module path and collects classes that are subclasses of piccolo.table.Table (excluding the base Table class itself).
- Tag filtering:
  - include_tags (default ["__all__"]): If "__all__" is present, all discovered Table subclasses are included. Otherwise, only tables with matching tags are included.
  - exclude_tags: Any table that has any of these tags will be excluded (takes precedence over include_tags).
- exclude_imported:
  - If True, only Table subclasses defined directly in the inspected module are returned. Table classes imported into the module from other modules are ignored.
- Accepts a single string for modules (e.g., "blog.tables") or a sequence of module paths.

Raises
- ImportError: If a module cannot be imported.

Example behavior
- Finds classes declared in provided modules, verifies subclassing of Table, checks tag criteria and module origin (when exclude_imported=True), returns list of table classes.

Command
-------

Dataclass representing a CLI command registration.

Fields
- callable (Callable): Function or coroutine implementing the command.
- aliases (List[str]): Optional list of alias names for the command. Defaults to an empty list.

AppConfig
---------

Dataclass that describes a Piccolo application and metadata used by migrations and the CLI.

Fields
- app_name (str): The short name of the app (for example "article").
- migrations_folder_path (str): Filesystem path to the app's migrations folder (can be a pathlib.Path).
- table_classes (List[Type[Table]]): Registered Table subclasses for the app. Defaults to an empty list.
- migration_dependencies (List[str]): Other Piccolo app module paths whose migrations must run before this app's migrations. Defaults to an empty list.
- commands (List[Union[Callable, Command]]): Functions/coroutines or Command objects to register with the Piccolo CLI. Defaults to an empty list.

Behavior and Methods
- __post_init__():
  - Normalizes commands into Command objects.
  - Converts pathlib.Path migrations_folder_path to a string.
  - Initializes internal cache for resolved migration dependency app configs.
- register_table(table_class: Type[Table]) -> Type[Table]:
  - Registers a Table subclass with this AppConfig and returns it (useful as a class decorator).
- migration_dependency_app_configs -> List[AppConfig]:
  - Lazily imports modules named in migration_dependencies and returns their APP_CONFIG attributes as a list of AppConfig instances.
  - The resolved list is cached on first access to avoid repeated imports.
- get_table_with_name(table_class_name: str) -> Type[Table]:
  - Returns a registered Table subclass whose class name matches table_class_name.
  - Raises ValueError if no matching table class is found.

AppRegistry
-----------

Registry object that records all Piccolo apps in a project (typically referenced from piccolo_conf.py).

Constructor
- AppRegistry(apps: List[str] = None)

Parameters
- apps: Optional list of app module paths (e.g., ['blog.piccolo_app']). If not provided, defaults to an empty list.

Purpose
- Holds the list of app module paths and associated AppConfig instances for use by Piccolo tooling and migrations.

Notes
- This module relies on dynamic imports and introspection to locate Table subclasses and AppConfig instances declared by apps. The AppConfig pattern centralizes app metadata, registered tables and CLI commands, and migration dependency information.