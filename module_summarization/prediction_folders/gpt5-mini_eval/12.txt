A quick dive into using the API
==============================

This short guide shows how to start a Session with the ftrack API and highlights the common options you will use when interacting with an ftrack server.

Creating a Session
------------------

A Session represents an isolated connection to an ftrack server and is the primary entry point for API usage.

Example:

.. code-block:: python

    from ftrack_api import Session

    session = Session(
        server_url='https://ftrack.example.com',
        api_key='YOUR_API_KEY',
        api_user='your_username'
    )

Environment variables may be used instead of passing arguments:

- FTRACK_SERVER — server URL
- FTRACK_API_KEY (or FTRACK_APIKEY) — API key
- FTRACK_API_USER — API username

Important Session arguments
---------------------------

- server_url
  : URL of the ftrack server (including port if required). Required.

- api_key
  : API key used for authentication. Required.

- api_user
  : Username in ftrack to record operations against. Required.

- auto_populate (default True)
  : When True, accessing missing entity attributes will automatically fetch them from the server. You can toggle this on the session at any time.

- plugin_paths
  : List of paths to search for plugins. If not given the environment variable FTRACK_EVENT_PLUGIN_PATH is consulted.

- cache
  : Instance of a cache implementing the ftrack_api.cache.Cache interface, or a callable that receives the session and returns a cache. If not provided a layered cache is configured with an in-memory cache at the top level.

  Note: the session always ensures a memory cache at the top of the cache stack for predictable behavior.

- cache_key_maker
  : Key maker instance implementing ftrack_api.cache.KeyMaker used to generate cache keys. Defaults to ftrack_api.cache.StringKeyMaker.

- auto_connect_event_hub
  : If True the embedded event hub will be automatically connected to the event server. Connection is performed in a background thread to avoid blocking session startup. Subscribing to events does not require the hub to be connected, but publishing non-local events does.

- schema_cache_path
  : Path to store schema cache. If omitted the FTRACK_API_SCHEMA_CACHE_PATH environment variable or a temporary directory will be used. Set to False to disable schema caching.

- plugin_arguments
  : Mapping of keyword arguments to pass to plugin register functions upon discovery. The discovery mechanism will try to adapt provided arguments to plugin signatures and will log a warning if reduction is necessary.

Authentication helper
---------------------

A small helper is provided to attach ftrack session authentication information to requests when needed:

.. code-block:: python

    from ftrack_api import SessionAuthentication
    auth = SessionAuthentication(api_key='YOUR_API_KEY', api_user='your_user')

    # Use with requests directly if necessary:
    import requests
    requests.get('https://ftrack.example.com/api', auth=auth)

Session recording and operations
--------------------------------

- session.recorded_operations
  : Holds currently pending operations (instance of ftrack_api.operation.Operations).

- session.record_operations (bool)
  : Controls whether operations are recorded. Default True.

Event hub and plugins
---------------------

- The event hub can be connected manually (useful if auto_connect_event_hub was False):
  
  .. code-block:: python

      # If available on the session:
      session.event_hub.connect()

- Plugins discovered via plugin_paths or environment are registered at session startup. Use plugin_arguments to influence registration.

Quick example usage
-------------------

.. code-block:: python

    from ftrack_api import Session

    session = Session(
        server_url='https://ftrack.example.com',
        api_key='MYKEY',
        api_user='me',
        auto_connect_event_hub=True
    )

    # Toggle automatic population of attributes:
    session.auto_populate = True

    # Work with the API (querying, creating entities, etc.)
    # e.g. results = session.query("select id, name from Task where project_id is ...")

Further reading
---------------

Consult the API reference for details on querying, entity factories, accessors, and the event subsystem for advanced use (plugin discovery, custom caches, and event publishing/subscribing).