w_pdist
=======

Calculate time-resolved, multi-dimensional probability distributions of WE
datasets.

Synopsis
--------
w_pdist [OPTIONS]

Description
-----------
w_pdist computes time-resolved, multi-dimensional probability distributions
(histograms) from WESTPA datasets. The tool can read data from built-in
datasets (such as the progress coordinate) or from user-specified dataset
specifications or a custom Python function that constructs the per-iteration
data.

Source data
-----------
Source data is provided in one of three ways:

- --construct-dataset MODULE.FUNCTION
  A Python function specified in MODULE.FUNCTION syntax. The function will be
  called as function(n_iter, iter_group) where n_iter is the iteration number
  and iter_group is the corresponding group in the main WEST HDF5 file
  (west.h5). The function must return an array-like object indexable as
  [segment][timepoint][dimension].

- --dsspecs NAME[,file=FILENAME,slice=SLICE] ...
  One or more dataset specifications. Each specification uses the dataset
  NAME in the HDF5 file FILENAME (defaults to the main file west.h5) and may
  include a slice expression to select parts of the dataset (for example,
  selecting one column from a multi-column dataset). Multiple dsspecs may be
  provided (space-separated).

- Default
  If neither --construct-dataset nor --dsspecs is provided, the built-in
  progress coordinate dataset (pcoord) is used.

Histogram binning
-----------------
- Default: 100 bins per dimension.
- Option: -b / --bins accepts several forms:

  1) Single integer N
     Use N uniformly spaced bins in each dimension.

  2) Sequence of integers N1,N2,...
     Use Ni uniformly spaced bins for the i-th dimension.

  3) List-of-lists [[B11,B12,...],[B21,B22,...],...]
     Explicit bin boundaries for each dimension. These boundaries need not be
     uniform. Expressions are evaluated with Python's eval, with numpy available
     as the name np (e.g., np.arange()).

Notes:
- The integer forms (single integer or sequence of integers) cause a scan of
  all data in each dimension to determine min/max values; this can be
  expensive for large datasets. To avoid the scan, provide explicit
  bin-boundary lists (form 3).
- These histogram bins are independent of bins used to drive WE sampling.

Output format
-------------
The output HDF5 file (option -o / --output, default "pdist.h5") contains the
following datasets suitable for plotting (for example with plothist):

- histograms
  Normalized histograms. The first axis corresponds to iteration number; the
  remaining axes correspond to the histogram dimensions.

- /binbounds_0, /binbounds_1, ...
  Bin boundary vectors for each dimension (index 0 is the first dimension).

- /midpoints_0, /midpoints_1, ...
  Bin midpoint vectors for each dimension.

- n_iter
  Vector of iteration numbers corresponding to the stored histograms (i.e.,
  the first axis of the histograms dataset).

Subsequent processing
---------------------
The output (default "pdist.h5") may be plotted by the plothist program or
processed by other tools that consume histogram HDF5 output. See plothist
for plotting options.

Parallelization
---------------
w_pdist supports parallelized binning and parallel reading of input data.
Parallel processing is enabled by default. For simple cases (pre-computed
input data or modest numbers of segments) serial processing (use --serial)
may be more efficient.

Command-line options (common)
-----------------------------
- --construct-dataset MODULE.FUNCTION
  Provide a Python function to construct per-iteration data.

- --dsspecs NAME[,file=FILENAME,slice=SLICE] ...
  Provide one or more dataset specifications.

- -b, --bins BINSPEC
  Specify bins (see "Histogram binning" above). Accepts a single integer,
  a comma-separated sequence of integers, or a Python list-of-lists expression
  (eval'd, with np available).

- -o, --output FILE
  Specify output HDF5 filename (default: pdist.h5).

- --serial
  Run in serial (disable parallel processing).

Examples
--------
1) Produce 2D histograms using the default progress coordinate and 50 bins:
   w_pdist -b 50 -o pdist.h5

2) Provide explicit, nonuniform bin boundaries for a 2D histogram:
   w_pdist -b '[[0,0.1,0.3,1.0],[ -2,-1,0,1,2]]' -o pdist.h5

3) Use a custom data constructor function:
   w_pdist --construct-dataset mymodule.make_pdist_data -o pdist.h5

Data-set specification syntax examples
-------------------------------------
- pcoord
  Use the dataset named "pcoord" in the main west.h5 file.

- mydata,file=mydata.h5
  Use the dataset "mydata" in the file mydata.h5.

- coords,file=west.h5,slice=[0:2]
  Use elements selected by the slice expression (Python slice syntax)
  to pick columns or ranges from a dataset.

Notes and implementation details
-------------------------------
- Histograms are normalized for each iteration before they are stored.
- When integer bin specifications are used, the code scans per-dimension data
  to determine min and max values; provide explicit binboundaries to avoid
  scanning large datasets.
- Output is compatible with plotting tools that accept the produced datasets,
  such as plothist.

See also
--------
plothist -- plot histograms produced by w_pdist.