# General Plotting routines

This module provides small, high-level helpers for creating interactive Bokeh plots using the shared BokehPlotter configuration object. The routines handle common data input shapes (pandas DataFrame, dicts, Bokeh ColumnDataSource, plain arrays), apply shared plotting defaults, add tooltips and common decorations (lines, axis limits, legends), and save the result using the configured output settings.

Common concepts
- plot_params — a shared BokehPlotter instance used to hold defaults and plotting parameters.
- ensure_plotter_consistency — decorator used to ensure the plotter parameters are consistent before plotting.
- process_data_arguments — utility used to convert inputs (data, x, y, etc.) into a uniform representation (entries and ColumnDataSource).
- Many keyword arguments are forwarded to BokehPlotter methods; any unrecognized keys are forwarded to the underlying bokeh plotting functions (e.g., p.scatter).
- The plotting functions return the bokeh Figure object.

Setup / defaults helpers
- set_bokeh_plot_defaults(**kwargs)
  - Set defaults for the Bokeh backend via BokehPlotter.set_defaults.
  - Available default keys and their descriptions are defined in BokehPlotter.

- reset_bokeh_plot_defaults()
  - Reset to the hard-coded BokehPlotter defaults.

- show_bokeh_plot_defaults()
  - Print the currently set defaults (user-overridden and inherited values).

- get_bokeh_help(key)
  - Print the description/help for a specific default key.

- load_bokeh_defaults(filename='plot_bokeh_defaults.json')
  - Load defaults from a JSON file.

- save_bokeh_defaults(filename='plot_bokeh_defaults.json', save_complete=False)
  - Save current defaults to a JSON file. If save_complete is True, also save the unmodified hard-coded defaults.

bokeh_scatter
Create an interactive scatter plot (single dataset) with Bokeh and the shared plot parameters.

Signature
bokeh_scatter(x, y=None, *, xlabel='x', ylabel='y', title='', figure=None, data=None, saveas='scatter', copy_data=False, **kwargs)

Key parameters
- x, y: array-like or column names. Can also pass data (DataFrame/dict/ColumnDataSource) and supply x/y as keys.
  - Deprecated behavior: passing the data source as the first positional argument (instead of using data=...) is supported but will emit a DeprecationWarning. Prefer data=...
- data: data source (pandas.DataFrame, dict, or ColumnDataSource).
- xlabel, ylabel, title: axis labels and title.
- figure: optional existing bokeh Figure object to add the glyph to. If omitted a new Figure is prepared from plot defaults.
- saveas: base filename or identifier used by the plotter's save routine.
- copy_data: if True the provided data is copied before processing.
- kwargs: forwarded to the BokehPlotter and, for unknown keys, to bokeh's scatter call.

Behavior and features
- Input is normalized via process_data_arguments; a ColumnDataSource is created/used.
- Plotter defaults are applied (plot_params.set_parameters) and the figure is prepared with plot_params.prepare_figure.
- The call draws a scatter glyph (p.scatter) using configured plot style (plot_params.plot_kwargs) and attaches tooltips (plot_params.add_tooltips).
- If plot_params['level'] is set, the glyph level is applied to control rendering order.
- plot_params.draw_straight_lines and plot_params.set_limits are called to add reference lines and enforce axis limits if configured.
- The figure is saved via plot_params.save_plot(p, saveas).
- Returns the bokeh Figure object.

Notes
- Unrecognized kwargs will be passed into the bokeh scatter call; recognized keys influence the plotter behavior.
- Tooltips are automatically added for the plotted entry.

bokeh_multi_scatter
Create an interactive scatter plot with multiple datasets.

Signature (summary)
bokeh_multi_scatter(x, y=None, *, data=None, figure=None, xlabel='x', ylabel='y', title='', saveas='scatter', copy_data=False, set_default_legend=True, **kwargs)

Key differences from bokeh_scatter
- Intended for plotting multiple datasets (e.g., multiple columns or multiple x/y pairs) on the same figure.
- set_default_legend: if True, generate legend labels from the data names when no explicit legend is supplied.
- Input normalization handles multiple entries and constructs appropriate ColumnDataSource(s).
- The routine iterates over processed entries, drawing each dataset (with its own style/legend) using the plotter's configured multi-plot behavior.
- Behavior for tooltips, levels, straight lines, limits and saving is analogous to bokeh_scatter.

Data handling notes
- Supported data sources: pandas.DataFrame, dict of arrays, Bokeh ColumnDataSource, plain numpy arrays / lists.
- process_data_arguments ensures x and y have the same length when required (same_length option), and converts/labels data entries for tooltips and legend use.
- copy_data=True can be useful to avoid modifying caller-provided data.

Examples (minimal)
- Single scatter from arrays or DataFrame columns:
  - bokeh_scatter(x=arr_x, y=arr_y, xlabel='k', ylabel='energy', title='Dispersion', saveas='dispersion')
  - bokeh_scatter(x='k', y='energy', data=df, title='Dispersion')

- Multiple datasets (e.g., many columns vs. index):
  - bokeh_multi_scatter(x='k', y=['E1', 'E2', 'E3'], data=df, title='Multiple bands')

Return values
- Both bokeh_scatter and bokeh_multi_scatter return the bokeh.models.figure.Figure instance that was drawn/modified.

Warnings & compatibility
- Passing the data source as the first positional argument (instead of using data=...) is deprecated and will emit a DeprecationWarning. Use data=... and provide x/y keys or arrays explicitly.
- Behavior and available configuration keys are defined by the BokehPlotter class — consult that class to see plotting defaults, valid style keys, and detailed descriptions.

See also
- masci_tools.vis.bokeh_plotter.BokehPlotter — available defaults, detailed parameter descriptions, and saving behavior.
- masci_tools.vis.data.process_data_arguments — input normalization rules and accepted data shapes.