mixed_linear — Linear mixed effects models
=========================================

Summary
-------
This module provides tools to specify, fit and post-process linear mixed effects
models (also known as multilevel or hierarchical linear models).  The primary
interface is the MixedLM class (group-based implementation) which fits models
of the form

    Y = X * beta + Z * gamma + epsilon

for data partitioned into independent groups.  The module supports both
standard random effects (correlated, same dimensionality across groups) and
variance components (uncorrelated, possibly differing counts across groups),
and implements ML and REML estimation.

Model and notation
------------------
For a group i with n_i observations:

- Y : n_i vector of responses (endog)
- X : n_i x k_fe design matrix for fixed effects (exog)
- beta : k_fe vector of fixed-effect coefficients (fe_params)
- Z : n_i x ? design matrix for random effects (exog_re). Number of columns in Z
  can vary by group in the variance-component formulation.
- gamma : random effects vector, mean zero. The first k_re elements of gamma
  share a common covariance (cov_re) across groups; remaining elements are
  variance-component realizations with their own variance parameters (vcomp).
- epsilon : n_i independent errors, N(0, sigma^2)

Marginally, E[Y | X, Z] = X * beta and cov(Y | X, Z) = sigma^2 I + Z cov_re Z'.

Parameterizations
-----------------
Three related parameterizations are used in the implementation:

- User parameterization: cov(endog) = scale * I + Z * cov_re * Z' (visible to user).
- Profile parameterization: cov(endog) = I + Z * cov_re1 * Z' (used for the
  profiled likelihood optimized during fitting; cov_re = scale * cov_re1).
- Square-root parameterization: the Cholesky factor of cov_re1 is used for
  numerical work and optimization.

Variance parameters for variance components are exposed in vcomp. The module
handles packing and unpacking of parameters across these parameterizations,
including working with lower-triangle or Cholesky representations when needed.

Estimation and inference
------------------------
- Estimation: ML and REML are supported. The implementation profiles over the
  fixed effects and the error scale so the optimizer works on a reduced set of
  parameters. GLS is used internally to avoid explicit optimization over the
  fixed effects.
- Optimization: The code supplies likelihood and score calculations. The
  profiled likelihood is optimized; because the Hessian of the profiled
  log-likelihood is not computed (and is not needed for the optimizer used),
  Newton–Raphson style algorithms that require Hessians are not supported.
- Scores: Two score formulations are provided — scores with respect to the
  elements of the random-effects covariance matrix (for inference), and scores
  with respect to parameters of the Cholesky square root (used for
  optimization).
- Post-estimation: The fitted model objects provide estimated fixed effects
  (fe_params), random-effects covariance (cov_re), variance-component
  parameters (vcomp), error scale (scale), and typical result methods such as
  summary and predict (see the MixedLMResults object returned by fit).

Random effects types
--------------------
- Standard random effects: correlated, k_re per group, same joint distribution
  across groups (independent realizations across groups).
- Variance components: uncorrelated, zero-mean, each variance component has a
  single variance parameter shared across realizations; the number of realized
  components per parameter can vary across groups. Variance-component
  structures are specified via exog_vc or using a vc_formula when using
  formulas.

Inputs and common arguments
---------------------------
Typical inputs to construct a mixed model:

- endog: response array or Series (fully observed)
- exog: fixed-effect design matrix or formula (fully observed)
- groups: grouping index that partitions the data into independent groups
- exog_re: random-effect design matrix (or list/dict for group-specific forms)
- exog_vc / vc_formula: variance-component specifications (optional)

All of Y, X and Z must be entirely observed. Missing-data handling should be
done prior to model construction.

Utility functions
-----------------
- _dot(x, y): robust dot-product helper that works for dense ndarray and
  scipy sparse matrices (supports combinations of sparse/dense).
- _multi_dot_three(A, B, C): optimized multiplication for three arrays that
  chooses a good parenthesization and handles sparse/dense inputs (used to
  speed up chained products).

References
----------
- Lindstrom, M. J. and Bates, D. M. (1988). "Newton–Raphson and EM algorithms
  for linear mixed effects models for repeated measures data". Journal of the
  American Statistical Association, 83(404):1014–1022. (Primary reference for
  implementation details.)
- Additional user-level references and notes:
  http://lme4.r-forge.r-project.org/lMMwR/lrgprt.pdf
  http://lme4.r-forge.r-project.org/slides/2009-07-07-Rennes/3Longitudinal-4.pdf
- Supplemental notes:
  http://econ.ucsb.edu/~doug/245a/Papers/Mixed%20Effects%20Implement.pdf

Notes and alternatives
----------------------
- If only marginal mean structure is of interest and group dependence is a
  nuisance, GEE (generalized estimating equations) can be a suitable
  alternative.
- Because the implementation profiles over both fixed effects and scale,
  standard errors for parameters that are profiled should be interpreted with
  the profiling in mind. The module computes scores and quantities appropriate
  for usual inference on covariance parameters and fixed effects after fitting.

Quick example
-------------
Construct and fit a basic grouped random-intercept model::

    model = MixedLM(endog, exog, groups=groups, exog_re=exog_re)
    result = model.fit(reml=True)    # or reml=False for ML
    print(result.summary())
    preds = result.predict(exog_new, exog_re_new, group=group_ids)

See also
--------
- The MixedLM class and its result classes (MixedLMResults, MixedLMParams) for
  details about available attributes and methods after fitting.