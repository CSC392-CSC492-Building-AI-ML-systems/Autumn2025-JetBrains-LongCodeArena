Convolution module — built-in kernels
====================================

Overview
--------
This module provides small helper classes and utilities for building and
using convolution kernels with the Convolution model. Kernels are small
arrays that describe the response used to blur or smooth data (images,
1-D signals, etc.). The module supplies base kernel classes and helpers
for common checks, normalization and optimized FFT padding for fast
convolutions.

Kernel classes
--------------
- Kernel
  - Base container for an N-dimensional kernel array. Can wrap a plain
    NumPy array (or an object exposing .array).
- Kernel1D, Kernel2D
  - Convenience subclasses for the common 1-D and 2-D kernel cases.

These classes hold the kernel array and are intended to be passed to
astropy.modeling.convolution.Convolution (or used directly by
convolution routines).

Kernel creation
---------------
Kernels can be created from existing arrays or from specialized kernel
constructors (if provided elsewhere in the package). A simple example:

  from astropy.convolution import Kernel, Kernel1D, Kernel2D
  import numpy as np

  k = Kernel(np.array([[0, 1, 0],
                       [1, 4, 1],
                       [0, 1, 0]]))
  k1 = Kernel1D(np.array([0.25, 0.5, 0.25]))

Using kernels with the Convolution model:

  from astropy.modeling.convolution import Convolution
  conv = Convolution(k)            # create a convolution model
  smoothed = conv(image)           # apply to an ndarray

Normalization
-------------
Kernels are normally used in a normalized fashion so that the total
response is controlled (e.g., sums to 1). The module exposes a
normalization constant:

- MAX_NORMALIZATION — a module constant used to represent normalization
  constraints internally.

Kernel size and axis parity
---------------------------
Kernels must be of appropriate sizes for the intended convolution. Two
common issues are:

- Very large kernel sizes may be disallowed; KernelSizeError is raised
  for unsupported sizes.
- Even-sized kernels are often problematic for centered convolution
  implementations. Utilities are provided to detect or raise for such
  conditions:
  - has_even_axis(kernel) — returns True if any kernel axis has an even
    length.
  - raise_even_kernel_exception(...) — helper to raise a clear error
    when an even-sized axis is unacceptable.

Boundary handling
-----------------
When applying convolution to finite arrays, boundary behavior affects the
result. Supported boundary option names are:

  None, 'fill', 'wrap', 'extend'

These are collected in BOUNDARY_OPTIONS and are accepted by convolution
routines to control how the array is extended at edges.

FFT padding and performance
---------------------------
FFT-based convolution implementations often perform better if input
arrays are padded to so-called "fast" lengths. This module exposes a
helper that computes good FFT lengths:

- _next_fast_lengths(shape) — returns an array of lengths to pad each
  axis to for efficient FFTs. If scipy.fft is available then its
  next_fast_len is used; otherwise a built-in list of favorable sizes
  (and powers of ten scaling) is used.

Input handling and copies
-------------------------
Convolution routines must handle masked arrays, quantities with units
and NaNs in a robust manner. A utility in the module performs the
required conversions and makes copies when necessary:

- _copy_input_if_needed(input, dtype=float, order='C',
                        nan_treatment=None, mask=None, fill_value=None)

  - If the input is a Kernel object it unwraps the underlying array.
  - If the input has a .unit attribute (an astropy Quantity) the unit
    is stripped and the raw values are used.
  - Masked arrays are filled (using fill_value) and copied as needed.
  - The function ensures the returned array has the requested dtype
    and memory order and prevents in-place side-effects when operations
    require a copy.

Exceptions and doctests
-----------------------
- KernelSizeError — raised for invalid kernel sizes.
- AstropyUserWarning may be used within the convolution utilities for
  non-fatal user-level warnings.
- __doctest_requires__ is defined to disable doctests when optional
  dependencies (e.g., scipy.fft) are not available.

Examples
--------
Basic 2-D smoothing:

  from astropy.convolution import Kernel2D
  from astropy.modeling.convolution import Convolution
  import numpy as np

  kernel = Kernel2D(np.ones((3, 3)))  # small 3x3 box kernel
  conv = Convolution(kernel)
  smoothed = conv(image)

Detecting even-sized kernel axes:

  from astropy.convolution import has_even_axis
  has_even_axis(kernel)  # True if any axis length is even

Notes
-----
- When using FFT-based convolution, padding to fast lengths via
  _next_fast_lengths can improve performance and reduce memory churn.
- Be mindful of boundary behavior and normalization when interpreting
  convolved results.