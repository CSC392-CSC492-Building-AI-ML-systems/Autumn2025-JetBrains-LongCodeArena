w_run â€” start or continue a WEST simulation
==========================================

Synopsis
--------
w_run [OPTIONS]

Description
-----------
w_run is the main command used to start or continue a WEST simulation. It configures and launches the simulation manager and its associated drivers (system, data manager, WEST driver, and propagator) and runs the simulation using a work manager to distribute work.

Options
-------
- --oneseg
  : Propagate only one segment. Useful for debugging propagators.

- Standard WEST runtime configuration options
  : w_run accepts the usual WESTPA runtime/configuration options provided by westpa.rc. These are added to the command-line parser by westpa.rc.add_args().

- Work-manager specific options
  : Work-manager-specific command-line arguments are also accepted and added by the work manager environment (work_managers.environment.add_wm_args()). These control how the work manager operates (local/remote execution, resource settings, etc.).

Operation details
-----------------
1. Parse arguments and process configuration
   - Command-line arguments are parsed.
   - westpa.rc.process_args() applies runtime configuration options.
   - work manager environment processes its options.

2. Create and enter the work manager context
   - A work manager is created with make_work_manager() and assigned to westpa.rc.work_manager.
   - The work manager is used as a context manager (with work_manager:), which handles setup and teardown.

3. Master vs worker behavior
   - If the current process is the master (work_manager.is_master):
     - A SIGINT handler is installed via work_manager.install_sigint_handler() so user interrupts are handled cleanly.
     - Simulation plugins are loaded (sim_manager.load_plugins()).
     - The simulation manager prepares the run (sim_manager.prepare_run()).
     - The simulation manager executes the simulation loop (sim_manager.run()).
     - After the run completes normally, the simulation manager finalizes the run (sim_manager.finalize_run()).
   - If the current process is a worker:
     - The work manager runs its worker loop (work_manager.run()) to receive and process tasks from the master.

Integration of drivers
----------------------
Before running, w_run retrieves the drivers from westpa.rc:
- sim_manager = westpa.rc.get_sim_manager()
- system = westpa.rc.get_system_driver()
- data_manager = westpa.rc.get_data_manager()
- we_driver = westpa.rc.get_we_driver()
- propagator = westpa.rc.get_propagator()

It wires these together:
- propagator.system, data_manager.system, and we_driver.system are set to the system driver.
- sim_manager.data_manager, sim_manager.system, sim_manager.propagator, and sim_manager.we_driver are set appropriately so the simulation manager has access to all drivers.

Signal handling and shutdown
----------------------------
- KeyboardInterrupt: if the user interrupts with Ctrl-C during the run, the command prints a status message ("interrupted; shutting down") and attempts a clean shutdown.
- Exceptions: uncaught exceptions during the master run cause a status message ("exception caught; shutting down") and the exception message and traceback are logged. The logger used is named 'w_run'.

Logging
-------
- The command uses the logger 'w_run' for debug and error messages.
- Error messages and full tracebacks are logged on exception.

Examples
--------
- Normal run (uses runtime configuration and work-manager defaults):
  w_run

- Debugging a propagator by running a single segment:
  w_run --oneseg

See also
--------
- WESTPA runtime configuration options (westpa.rc)
- Work manager documentation for available work-manager-specific command-line arguments and environment configuration