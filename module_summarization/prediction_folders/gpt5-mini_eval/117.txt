Resources
=========

Support for plugins that provide access to resources such as schemas.

This module exposes resource mapping implementations and a small manager that
wraps multiple mappings into a single lookup interface.

Classes
-------

DirectoryResourceMapping
~~~~~~~~~~~~~~~~~~~~~~~~
A resource mapping that reads resource content from a directory or directory
tree.

This class is a thin subclass of asdf_standard.resource.DirectoryResourceMapping
and inherits its behavior and configuration. See the upstream
`asdf_standard` implementation for details.

ResourceMappingProxy
~~~~~~~~~~~~~~~~~~~~
Wrapper around a resource mapping that carries additional information on the
package that provided the mapping.

Signature
  ResourceMappingProxy(delegate, package_name=None, package_version=None)

Parameters
  delegate (collections.abc.Mapping)
    The underlying mapping instance to wrap. Must implement the Mapping
    interface.
  package_name (str or None)
    Optional name of the Python package that provided the mapping.
  package_version (str or None)
    Optional version string of the providing package.

Class methods
  maybe_wrap(delegate)
    Return the delegate wrapped in a ResourceMappingProxy if it is not
    already one; otherwise return the existing proxy.

Mapping interface
  The proxy implements the Mapping interface by delegating to the wrapped
  mapping:
    __getitem__(uri)
    __len__()
    __iter__()

Properties
  delegate
    The wrapped mapping instance (collections.abc.Mapping).
  package_name
    The package name that provided the mapping, or ``None`` if added at
    runtime.
  package_version
    The package version that provided the mapping, or ``None`` if added at
    runtime.
  class_name
    Fully qualified class name of the wrapped mapping.

Behavioral details
  Equality: two ResourceMappingProxy instances compare equal only if they
  wrap the same delegate object.
  Hashing: based on the identity of the delegate.
  __repr__: includes the wrapped class name, package description
  (``{name}=={version}`` or ``(none)``) and mapping length.

ResourceManager
~~~~~~~~~~~~~~~
Wraps multiple resource mappings into a single interface with friendlier error
handling.

Signature
  ResourceManager(resource_mappings)

Parameters
  resource_mappings (iterable of collections.abc.Mapping)
    Underlying resource mappings. In the case of a duplicate URI, the first
    mapping containing that URI takes precedence.

Behavior
  - Builds an internal mapping from resource URI to the first mapping that
    provides that URI.
  - Implements the Mapping protocol:
      __getitem__(uri)
        Returns the resource content as bytes. If the underlying mapping
        returns a str, it is encoded as UTF-8. Raises KeyError if the URI
        is not available.
      __len__()
        Number of unique URIs available across all wrapped mappings.
      __iter__()
        Iterates over available URIs.
      __contains__(uri)
        Efficient membership test implemented.
      __repr__()
        Short representation including the number of available resources.

JsonschemaResourceMapping
~~~~~~~~~~~~~~~~~~~~~~~~~
Resource mapping that fetches metaschemas from the installed `jsonschema`
package.

Behavior
  - Maintains an internal mapping of known json-schema URIs to filenames:
    Example mapping:
      http://json-schema.org/draft-04/schema -> draft4.json
  - Fetches data using pkgutil.get_data("jsonschema", "schemas/{filename}").
  - Implements the Mapping interface:
      __getitem__(uri)
        Returns the raw data bytes for the given URI.
      __len__()
        Number of known URIs provided.
      __iter__()
        Iterates over the known URIs.
      __repr__()
        Returns "JsonschemaResourceMapping()".

Functions
---------

get_json_schema_resource_mappings()
  Return a list of resource mapping instances that expose JSON Schema
  metaschemas via the jsonschema package.

  Returns
    list
      A list containing a JsonschemaResourceMapping() instance.

Module constants
----------------
_JSONSCHEMA_URI_TO_FILENAME
  Internal dict mapping a json-schema URI to the corresponding filename in
  the jsonschema package. Example entry:
    "http://json-schema.org/draft-04/schema": "draft4.json"

Usage notes
-----------
- ResourceMappingProxy is intended to carry metadata (package name/version and
  the wrapped class name) alongside an existing Mapping instance.
- ResourceManager provides a simple unified lookup over multiple mappings and
  converts text content to bytes for consistency.