Features Documentation
======================

Overview
--------
This module provides utilities for searching and manipulating ASDF (Advanced Scientific Data Format) trees. It includes the `AsdfSearchResult` class, which encapsulates search results and offers methods for further filtering, formatting, and modifying the matched nodes within an ASDF tree.

Classes
-------

AsdfSearchResult
----------------
Represents the result of a search operation within an ASDF tree. It allows for further refinement of search results, formatting of the output, and in-place modification of matched nodes.

Constructor
-----------
`__init__(self, identifiers, node, filters=[], parent_node=None, max_rows=DEFAULT_MAX_ROWS, max_cols=DEFAULT_MAX_COLS, show_values=DEFAULT_SHOW_VALUES)`

Initializes an `AsdfSearchResult` object with search identifiers, the node, optional filters, and display parameters.

Methods
-------

format
------
`format(self, max_rows=NotSet, max_cols=NotSet, show_values=NotSet) -> AsdfSearchResult`

Adjusts the formatting parameters of the rendered tree, such as maximum rows, columns, and whether to show primitive values. Returns a new `AsdfSearchResult` with updated display settings.

search
------
`search(self, key=NotSet, type=NotSet, value=NotSet, filter=None) -> AsdfSearchResult`

Performs a refined search within the current search results based on key, type, value, and custom filter criteria. Supports regular expressions and type matching. Returns a new `AsdfSearchResult` with the filtered results.

replace
-------
`replace(self, value) -> None`

Replaces all leaf nodes in the current search results with the specified value. Modifies the tree in place.

node (property)
---------------
`node(self) -> object`

Retrieves the leaf node from a search result when exactly one match is found.

Internal Methods
----------------
_maybe_compile_pattern
-----------------------
Converts a string query into a compiled regular expression pattern if applicable.

_safe_equals
------------
Safely compares two objects for equality, handling exceptions gracefully.

_get_fully_qualified_type
--------------------------
Returns the fully qualified type name of a given value, including module information if not a built-in type.

Usage
-----
The `AsdfSearchResult` class is typically obtained as the result of a search operation within an ASDF file. Users can chain search filters, format the output for readability, and modify the tree directly through the provided methods.

Example
-------
```python
result = asdf_file.search(key="data").format(max_rows=10).replace(new_value)
```

This example searches for nodes with keys matching "data", formats the output to show up to 10 rows, and replaces the matched nodes with `new_value`.

Note
----
This module relies on other internal utilities and display functions to perform tree rendering, filtering, and schema collection, which are assumed to be part of the larger codebase.