File Objects
============

Overview
--------
File objects in h5py provide an interface to HDF5 files, allowing users to open, manipulate, and close HDF5 files within Python. These objects manage the underlying HDF5 identifiers and ensure proper resource management and thread safety.

ObjectID Class
--------------
The `ObjectID` class represents an HDF5 identifier, which is a handle to various HDF5 objects such as files, groups, and datasets. It encapsulates the low-level HDF5 identifier (`id`) and provides mechanisms for validation, locking, and lifecycle management.

Attributes
----------
- `id` (readonly): The HDF5 identifier associated with the object.
- `locked`: An integer flag indicating whether the object is locked from being closed.
- `fileno`: A property that retrieves the file number associated with the object, providing information about the file handle.
- `valid`: A property that checks whether the HDF5 object is still valid.

Methods
-------
- `__cinit__(self, id_)`: Constructor that initializes the ObjectID with a given HDF5 identifier, registers it in the registry, and sets initial attributes.
- `__dealloc__(self)`: Destructor that unregisters the object and manages reference counting, ensuring proper cleanup.
- `with_phil(func)`: A decorator for thread-safe locking around functions that interact with the HDF5 identifiers.

Registry and Thread Safety
--------------------------
The implementation maintains a registry of all live `ObjectID` instances using weak references, enabling the detection and invalidation of stale or dead objects. Thread safety is managed through locking mechanisms (`FastRLock` or `BogoLock`) to serialize access to the low-level HDF5 API, preventing race conditions and ensuring consistency across threads.

Identifier Validation and Management
--------------------------------------
The code includes functions such as `nonlocal_close()` to identify and invalidate stale or invalid identifiers, setting their `id` to zero to prevent dangling references. This helps maintain the integrity of the object registry and avoid issues related to reusing identifiers after they are closed or invalidated.

Locking and Concurrency
-----------------------
The code employs locking strategies to ensure that only one thread interacts with the low-level HDF5 API at a time. The `with_phil` decorator wraps critical functions to acquire the lock during execution, maintaining thread safety in multi-threaded environments.

Summary
-------
The `ObjectID` class and associated registry mechanisms form the core of resource management in h5py, providing safe, efficient, and thread-aware handling of HDF5 identifiers. Proper management of these objects is crucial for avoiding resource leaks, ensuring data integrity, and supporting concurrent operations on HDF5 files.