# Alchemical Transformations

Alchemical transformations are a powerful computational technique used in molecular simulations to calculate free energy differences between different states of a system. These transformations involve gradually changing the system's Hamiltonian from an initial state to a final state through a parameter called lambda (λ), which varies typically from 0 to 1. This process allows for the efficient estimation of free energy differences, such as binding affinities or solvation energies, by simulating intermediate states rather than directly transitioning between the two end states.

## Hybrid Topology Approach

The core of alchemical transformations in this framework is the construction of a **hybrid topology** that seamlessly interpolates between the initial and final states. The `HybridTopologyFactory` class facilitates this process by generating a hybrid system that contains atoms from both the old and new systems, categorized into four classes:

- **Unique Old Atoms**: Present only in the initial system; interactions are active at λ=0 and turned off at λ=1.
- **Unique New Atoms**: Present only in the final system; interactions are off at λ=0 and active at λ=1.
- **Core Atoms**: Mapped atoms involved in the changing residue; their interactions are scaled according to λ, transitioning from the old to the new system.
- **Environment Atoms**: Mapped atoms outside the changing residue; their interactions remain constant throughout the transformation.

This categorization allows for precise control over how different parts of the system are transformed during the simulation.

## Softcore Potentials

To avoid singularities and numerical instabilities during the transformation, **softcore potentials** are employed. These modify the standard Lennard-Jones and electrostatic interactions to smoothly interpolate between states, especially when atoms are being created or annihilated. The `HybridTopologyFactory` supports advanced softcore schemes, including the **softcore LJ v2** potential, which is based on recent research to improve stability and accuracy.

Key parameters influencing softcore potentials include:

- `softcore_alpha`: The alpha parameter controlling the softness of the potential.
- `softcore_sigma_Q`: The sigma parameter for electrostatics.
- `softcore_electrostatics`: Whether to include softcore electrostatics.

## Scaling and Interpolation

The transformation process involves scaling various force components:

- **Bonds, angles, torsions**: These may be softened or scaled to facilitate smooth transitions.
- **Nonbonded interactions**: Managed through custom scaling functions, which can be specified via the `functions` argument, allowing for flexible control over how interactions are turned on or off.
- **Exceptions**: Specific nonbonded exceptions can be omitted or included gradually, controlled via parameters like `interpolate_old_and_new_14s`.

## Restraints and Constraints

Optional restraints, such as RMSD restraints between core heavy atoms and specific residues (e.g., protein CA atoms), can be applied to maintain structural integrity during the transformation.

## Implementation Details

The `HybridTopologyFactory` class provides a comprehensive API to set up and manage alchemical transformations, including:

- Defining the topology proposal and initial positions.
- Configuring softcore parameters and scaling functions.
- Managing omitted terms and exceptions.
- Handling endstates and lambda protocols.

This setup enables efficient and stable free energy calculations by carefully interpolating between the initial and final states, ensuring smooth potential energy surfaces and minimizing numerical issues during the alchemical process.

---

This documentation provides an overview of how alchemical transformations are implemented within this framework, emphasizing the construction of hybrid topologies, the use of softcore potentials, and the control over interaction scaling necessary for accurate free energy calculations.