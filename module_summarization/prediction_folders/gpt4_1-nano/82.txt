baseuser.rst

Generate Documentation for the BaseUser Module
==============================================

Overview
--------
The `BaseUser` module provides a comprehensive user model designed for authentication and user management within applications. It leverages the Piccolo ORM to define a user table with essential fields and methods to handle user creation, password management, and login processes securely.

Class: BaseUser
---------------
The `BaseUser` class extends `piccolo.table.Table` and represents a user entity with the following features:

Attributes:
-----------
- `id`: Auto-incrementing primary key.
- `username`: Unique username for user identification.
- `password`: Hashed password stored securely.
- `first_name`: Optional first name.
- `last_name`: Optional last name.
- `email`: Unique email address.
- `active`: Boolean indicating if the user is active.
- `admin`: Boolean indicating admin privileges (can access Piccolo admin GUI).
- `superuser`: Boolean indicating superuser privileges (manage other users' passwords).
- `last_login`: Timestamp of the last login.

Constants:
----------
- `_min_password_length`: Minimum allowed password length.
- `_max_password_length`: Maximum allowed password length.
- `_pbkdf2_iteration_count`: Number of iterations for password hashing, following OWASP recommendations.

Methods:
--------
- `__init__(**kwargs)`: Initializes a user instance, hashing the password if provided.
- `get_salt()`: Generates a cryptographically secure salt.
- `get_readable()`: Returns a human-readable representation of the user (typically username).
- `_validate_password(password)`: Validates password strength and criteria.
- `update_password_sync(user, password)`: Synchronously updates a user's password.
- `update_password(user, password)`: Asynchronously updates a user's password.
- `hash_password(password, salt='', iterations=None)`: Hashes a password using PBKDF2 with SHA-256.
- `split_stored_password(password)`: Splits a stored hashed password into its components.
- `login_sync(username, password)`: Synchronously authenticates a user.
- `login(username, password)`: Asynchronously authenticates a user.

Usage
-----
The `BaseUser` class provides methods for creating users, validating passwords, and authenticating login attempts. Passwords are securely hashed using PBKDF2 with SHA-256, with configurable iteration counts for enhanced security. The class also supports updating passwords and tracking user login activity.

Security
--------
Passwords are hashed with a configurable number of iterations and include salts for security. The class enforces password length constraints and prevents the use of pre-hashed passwords during user creation or password updates.

Notes
-----
- The class uses asynchronous methods for database operations, with synchronous wrappers available.
- Ensure that password validation rules are enforced before creating or updating user passwords.
- The `last_login` timestamp is updated upon successful login to track user activity.

This documentation provides an overview of the `BaseUser` module, outlining its core components and usage for secure user management in applications.