Configuration and Usage Documentation
======================================

Overview
--------
This documentation provides an overview of the configuration classes, functions, and command-line interface for managing FV3 model runs. It covers how to define, instantiate, and convert configurations, as well as how to utilize initial conditions and high-level settings.

Configuration Classes
---------------------
FV3Config
~~~~~~~~~~
Represents the core FV3 configuration parameters excluding high-level overrides.
- Attributes:
  - namelist: Model namelist settings, default includes coupler timing.
  - experiment_name: Name of the experiment.
  - data_table: Data table configuration.
  - field_table: Optional field table.
  - forcing: Forcing configurations.
  - orographic_forcing: Orographic forcing settings.
  - gfs_analysis_data: GFS analysis data source.
- Methods:
  - asdict(): Returns a dictionary excluding None values.

InitialCondition
~~~~~~~~~~~~~~~~
Defines the initial condition setup for model runs.
- Attributes:
  - base_url: URL or path to initial condition data.
  - timestep: Timestamp in YYYYMMDD.HHMMSS format.
  - restart_categories: Optional restart categories configuration.
- Properties:
  - overlay: Generates an overlay configuration for initial conditions.

HighLevelConfig
~~~~~~~~~~~~~~~
Extends UserConfig and FV3Config to provide a comprehensive configuration for prognostic runs.
- Attributes:
  - base_version: Default physics configuration version.
  - initial_conditions: Initial condition specification.
  - duration: Duration of each run segment (e.g., "3h").
  - zhao_carr_emulation: Emulation configuration for Zhao-Carr physics.
- Methods:
  - _initial_condition_overlay(): Retrieves overlay for initial conditions.
  - _to_fv3config_specific(): Converts to FV3Config.
  - to_runtime_config(): Extracts runtime-specific configuration.
  - _physics_timestep(): Calculates physics timestep as timedelta.
  - _duration: Returns duration as timedelta if specified.
  - to_fv3config(): Generates a complete FV3 configuration dictionary, merging overlays and applying duration if set.

Functions
---------
instantiate_dataclass_from(cls, instance)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Creates an instance of a dataclass `cls` with attributes copied from `instance`. Useful for instantiating parent classes from subclasses.

_create_arg_parser()
~~~~~~~~~~~~~~~~~~~~
Creates an argument parser for command-line interface, accepting:
- `user_config`: Path to YAML file with configuration updates.
- `--model_url`: Optional list of URLs to trained ML models for model updating.

Usage
-----
To generate a configuration for a FV3 model run:
1. Prepare a YAML file with configuration updates.
2. Use the command-line interface:
   
   ```bash
   python your_script.py user_config.yaml --model_url http://model1 URL --model_url http://model2 URL
   ```

This will parse the provided configuration, merge overlays, and produce a complete FV3 configuration dictionary suitable for execution.

Note:
- The configuration system supports overlays for diagnostics, initial conditions, and physics emulation.
- Duration settings override default timing parameters.
- The system is designed to facilitate flexible and reproducible model experiments.

Additional Information
----------------------
- The configuration classes utilize Python dataclasses for structured data management.
- The system integrates with fv3kube for configuration overlays and merging.
- Emulation settings can be customized via `zhao_carr_emulation`.
- The code includes logging for debugging and traceability.

For further customization and advanced usage, refer to the source code and associated modules such as `fv3config`, `fv3kube`, and `runtime`.