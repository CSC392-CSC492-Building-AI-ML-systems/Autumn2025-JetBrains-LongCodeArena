.. _events.rst: 

Generate Documentation for SQLAlchemy ORM Instrumentation Module
===============================================================

Overview
--------
The `orm.instrumentation` module defines SQLAlchemy's system of class instrumentation, which is integral to the ORM's internal interactivity and state management. This module is primarily used internally and is not typically accessed directly by end-user applications. It manages registration and tracking of ORM-mapped classes, enabling features such as attribute change tracking, lazy loading, and event handling.

Key Components
--------------
- `ClassManager`: The central class responsible for managing state information at the class level. It tracks class-specific attributes, manages initialization routines, and interfaces with the ORM's event system.
- Protocols: Defines interfaces such as `_ExpiredAttributeLoaderProto` and `_ManagerFactory` to facilitate flexible and customizable behavior in class instrumentation.
- Utility Functions and Types: Includes various helper functions, type variables, and type hints to support the internal mechanisms of class instrumentation.

ClassManager
------------
The `ClassManager` class is a generic, event-aware component that maintains state information for ORM-mapped classes. It interacts closely with the ORM's event system, registry, and attribute instrumentation mechanisms.

Features:
- Tracks class attributes and their state.
- Manages class initialization routines.
- Supports customization through factory functions and loader protocols.
- Maintains references to class hierarchies and declarative configurations.
- Provides deprecated attributes for backward compatibility, such as `deferred_scalar_loader`.

Usage
-----
While the `ClassManager` is primarily used internally within SQLAlchemy's ORM machinery, understanding its role can be beneficial for advanced customization or debugging. It is instantiated per ORM-mapped class and manages the class's instrumentation lifecycle, including setup, updates, and finalization.

Notes
-----
- The module interacts with other internal components such as `state`, `attributes`, and `collections`.
- It supports extensibility via external modules like `sqlalchemy.ext.instrumentation`.
- Proper management of class instrumentation is crucial for ORM features like lazy loading, attribute change tracking, and event dispatching.

See Also
--------
- `sqlalchemy.ext.instrumentation`: External extension system for customizing class instrumentation.
- `sqlalchemy.orm.state`: Manages instance state tracking.
- `sqlalchemy.orm.attributes`: Handles attribute instrumentation and management.
- `sqlalchemy.event`: Provides event dispatching capabilities for ORM events.

This documentation provides an overview of the internal mechanisms for class instrumentation within SQLAlchemy's ORM, focusing on the `ClassManager` class and its role in managing ORM-mapped class state and behavior.