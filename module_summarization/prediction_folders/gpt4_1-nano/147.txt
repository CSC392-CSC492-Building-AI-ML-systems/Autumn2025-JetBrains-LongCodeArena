# Fleur Input/Output Parsers Documentation

This documentation provides an overview of the Fleur input and output parsers, which are designed to facilitate the extraction and interpretation of data from Fleur XML files. These parsers enable users to efficiently access key information about the calculation setup and results, supporting version compatibility and complex XML structures.

## Overview

The Fleur parsers are part of the masci-tools package and are tailored to handle Fleur's XML input and output files. They include functions to determine calculation modes, extract k-point information, and parse various calculation parameters. The parsers are built to work seamlessly with different schema versions and XML structures, ensuring robustness and flexibility.

## Key Functions

### get_fleur_modes

**Purpose:**  
Determine the calculation modes of Fleur for a given XML file. Calculation modes influence the generated files and output data in Fleur's `out.xml`.

**Parameters:**  
- `xmltree`: An XML-like object representing the Fleur XML file.  
- `schema_dict`: A dictionary describing the schema version of the XML file, supporting different input/output schema versions.  
- `logger`: Optional logger for logging warnings and errors.

**Returns:**  
A dictionary containing the extracted calculation modes, such as:
- `jspin`: Number of spins considered.
- `noco`: Non-collinear calculation indicator.
- `soc`: Spin-orbit coupling inclusion.
- `relax`: Structure relaxation mode.
- `spex`: GW/Spex calculation mode.
- `force_theorem`: Force theorem calculation indicator.
- `film`: Film system indicator.
- `ldau`: LDA+U inclusion.
- `dos`: Density of states calculation.
- `band`: Bandstructure calculation.
- `bz_integration`: Brillouin zone integration method.
- `greensf`: Green's function calculation presence.
- `ldahia`: LDA HIA calculation presence.

This function inspects specific XML tags and attributes, considering schema version differences to accurately determine each mode.

### get_nkpts

**Purpose:**  
Retrieve the number of k-points used in the calculation from the Fleur XML file.

**Parameters:**  
- `xmltree`: An XML-like object representing the Fleur XML file.  
- `schema_dict`: A dictionary describing the schema version, ensuring compatibility across versions.  
- `logger`: Optional logger for warnings and errors.

**Returns:**  
An integer indicating the number of k-points.

**Notes:**  
- For versions prior to Max5, only `kPointList` or `kPointCount` tags are supported.  
- A warning is issued if `kPointCount` does not reliably match the actual number of k-points.

## XML Context Handling

The parsers utilize the `FleurXMLContext` class to manage XML parsing context, ensuring proper handling of XML structures, attributes, and nested tags. This context management simplifies access to XML data and maintains consistency across different schema versions.

## Usage Considerations

- The parsers are designed to be schema-aware, adapting to different Fleur XML schema versions.
- They provide detailed extraction of calculation parameters, supporting complex workflows and automation.
- Proper logging is recommended to track warnings and potential issues during parsing.

## Summary

The Fleur input/output parsers are essential tools for researchers working with Fleur simulations, enabling automated extraction of calculation modes, k-point data, and other critical parameters. Their schema-aware design ensures compatibility and robustness, facilitating efficient data analysis and workflow integration.