Using SQLite with Asyncio
==========================

This module provides an effective way to integrate SQLite database operations with Python's asyncio for asynchronous programming. It includes custom type conversions, an asynchronous batch processing class, and transaction management to facilitate non-blocking database interactions.

Type Conversions
----------------

To ensure data consistency between SQLite and Python, the module registers several custom adapters and converters:

- **Input Converters**: Transform Python types into SQLite-compatible formats before insertion.
  - `convert_numeric_in`: Converts `Decimal` to `float`.
  - `convert_uuid_in`: Converts `uuid.UUID` to `str`.
  - `convert_time_in`: Converts `datetime.time` to ISO format string.
  - `convert_date_in`: Converts `datetime.date` to ISO format string.
  - `convert_datetime_in`: Converts timezone-aware `datetime.datetime` to UTC ISO string.
  - `convert_timedelta_in`: Converts `datetime.timedelta` to total seconds.
  - `convert_array_in`: Serializes list of `str`, `int`, or `float` to JSON string.

- **Output Converters**: Parse SQLite byte data back into Python types.
  - `convert_numeric_out`: Converts numeric bytes to `Decimal`.
  - `convert_int_out`: Ensures integer bytes are returned as `int`.
  - `convert_uuid_out`: Converts UUID bytes to `uuid.UUID`.
  - `convert_date_out`: Converts date bytes to `datetime.date`.
  - `convert_time_out`: Converts time bytes to `datetime.time`.
  - `convert_seconds_out`: Converts seconds bytes to `datetime.timedelta`.
  - `convert_boolean_out`: Converts boolean bytes to `bool`.
  - `convert_timestamp_out`: Converts timestamp bytes to `datetime.datetime`.
  - `convert_timestamptz_out`: Converts timezone-aware timestamp bytes to UTC `datetime.datetime`.
  - `convert_array_out`: Deserializes JSON string bytes back into a list.
  - `convert_M2M_out`: Splits comma-separated string bytes into a list.

These converters are registered with the `sqlite3` module to automatically handle data serialization and deserialization during database operations.

Asynchronous Batch Processing
-----------------------------

The `AsyncBatch` class enables efficient asynchronous batch operations:

- **Attributes**:
  - `connection`: The active SQLite connection.
  - `query`: The query to execute.
  - `batch_size`: Number of records to fetch per batch.
  - `_cursor`: Internal cursor for executing queries.

- **Methods**:
  - `next()`: Fetches the next batch of records asynchronously.
  - `__aiter__()`: Returns the async iterator.
  - `__anext__()`: Retrieves the next batch or stops iteration.
  - `__aenter__()`: Initializes the cursor within an async context.
  - `__aexit__()`: Closes the cursor and connection upon exiting the context.

This class allows for non-blocking retrieval of large datasets in manageable chunks, suitable for high-performance applications.

Transaction Management
----------------------

The module defines a `TransactionType` enum to specify transaction behaviors, aligning with SQLite's transaction capabilities. This facilitates explicit control over transaction boundaries, ensuring data integrity during concurrent operations.

Usage Example
-------------

```python
async with connection.transaction() as transaction:
    batch = AsyncBatch(connection, query, batch_size=100)
    async for records in batch:
        process(records)
```

This pattern ensures that database resources are properly managed and that operations are performed asynchronously, maximizing efficiency and responsiveness.

Summary
-------

By leveraging custom type conversions, asynchronous batch processing, and transaction control, this module provides a robust foundation for integrating SQLite with asyncio in Python applications. It enables scalable, non-blocking database interactions suitable for modern asynchronous workflows.