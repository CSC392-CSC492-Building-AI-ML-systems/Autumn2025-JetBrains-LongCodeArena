w_fork Command
==============

Overview
--------
The `w_fork` command is a utility for preparing a new weighted ensemble simulation from an existing one at a specified point. It generates a new HDF5 file containing the initial states and segments for the forked simulation, facilitating the continuation or modification of the simulation workflow.

Functionality
-------------
- Reads an existing simulation HDF5 file and extracts data from a specified iteration (or the last complete iteration by default).
- Creates a new HDF5 file for the forked simulation, copying target and basis states.
- Transforms existing segments into initial states suitable for the new simulation.
- Generates corresponding segments for the new initial states.
- Produces a mapping file that links old segments to new initial states, aiding in tracking and analysis.

Usage
-----
```bash
w_fork [options]
```

Options
-------
- `-i`, `--input` : *str*  
  Path to the input HDF5 file of the existing simulation. If not specified, it is read from the configuration file.

- `-I`, `--iteration` : *int*  
  The iteration number from which to start the new simulation. Defaults to the last complete iteration if not provided.

- `-o`, `--output` : *str*  
  Filename for the output HDF5 file of the forked simulation. Defaults to `forked.h5`.

- `--istate-map` : *str*  
  Path to the text file that will contain the mapping of old segments to new initial states. Defaults to `istate_map.txt`.

- `--no-headers` : *bool*  
  If specified, suppresses writing header comments in the mapping file.

Operation
---------
1. Opens the specified input HDF5 file and retrieves data from the designated iteration.
2. Creates a new HDF5 file for the forked simulation.
3. Copies target and basis states from the old to the new file.
4. Converts existing segments into initial states and creates new segments accordingly.
5. Writes a mapping file that details the correspondence between old segments and new initial states.
6. Closes both HDF5 files, completing the fork process.

Notes
-----
- It is the user's responsibility to ensure that the new simulation directory is properly prepared, especially regarding restart data.
- The mapping file generated by `w_fork` aids in tracking segment lineage and initial state assignments across simulations.
- The command is designed to work with the WESTPA framework and requires its environment for proper execution.