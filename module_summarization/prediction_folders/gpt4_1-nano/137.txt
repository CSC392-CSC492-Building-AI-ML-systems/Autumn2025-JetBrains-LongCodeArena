ImPACT (Impact Parameter and Shower Maximum Reconstruction Technique)
======================================================================

Overview
--------
The ImPACT reconstruction method is a template-based image fitting technique designed for Atmospheric Cherenkov Telescopes (ACTs). It is based on the approach described by Parsons & Hinton (2014) in *Astroparticle Physics*, which utilizes a library of precomputed image templates to perform a maximum likelihood fit of the shower parameters, including the impact parameter, energy, and height of maximum development.

Key Features
------------
- Utilizes a Monte Carlo generated template library for each telescope type.
- Performs pixel-wise likelihood fitting to determine shower parameters.
- Incorporates atmospheric profile functions to convert between height and atmospheric depth.
- Supports multiple telescope types with customizable template files.
- Can include time gradient information for improved reconstruction accuracy.

Implementation Details
----------------------
The core of the ImPACT method is implemented within the `ImPACTReconstructor` class, which extends the `Component` class from `ctapipe`. The class manages template interpolation, likelihood calculations, and parameter fitting.

Template Management
-------------------
- Templates are stored as interpolators (`TemplateNetworkInterpolator`) for each telescope type.
- Time gradient templates (`TimeGradientInterpolator`) are optionally used if `use_time_gradient` is enabled.
- Templates are initialized via the `initialise_templates()` method, which loads the relevant files based on telescope types.

Likelihood Calculation
----------------------
- The pixel-wise likelihood is computed using the `neg_log_likelihood` or `mean_poisson_likelihood_gaussian` functions from `ctapipe.image`.
- Pedestal widths for each camera are hard-coded in the `ped_table`.
- The single photoelectron width (`spe`) is fixed at 0.5.

Parameter Estimation
--------------------
- The reconstruction estimates the shower impact parameter, energy, and maximum height by maximizing the likelihood.
- Priors on energy and Xmax are implemented via `energy_prior()` and `xmax_prior()` functions, incorporating physical expectations and atmospheric models.
- The `guess_shower_depth()` function provides an initial estimate of the shower maximum depth based on the energy.

Atmospheric Profile
-------------------
- Atmospheric profiles are obtained using `get_atmosphere_profile_functions()` from `ctapipe.instrument`, providing functions to convert between altitude and atmospheric depth.
- These profiles are essential for accurate modeling of the shower development and image templates.

Usage
-----
The `ImPACTReconstructor` class is configured with parameters such as the root directory of template files, minimizer choice, priors, and options for including time gradient information. Once initialized and templates are loaded, it can be used to perform event reconstruction by fitting the observed images to the template library, yielding estimates of the shower impact parameter, energy, and maximum development height.

References
----------
- Parsons & Hinton, *Astroparticle Physics*, 56 (2014), pp. 26-34.  
  "A Monte Carlo template-based analysis for the Cherenkov Telescope Array"  

This documentation provides an overview of the pixel-wise image fitting approach used in the ImPACT method for atmospheric Cherenkov telescope data analysis.