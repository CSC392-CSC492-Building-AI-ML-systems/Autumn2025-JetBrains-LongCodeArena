dask.delayed Interface
========================

Overview
--------
The `dask.delayed` interface provides a way to build task graphs dynamically by wrapping Python functions and objects. It allows for lazy evaluation of computations, enabling parallel and distributed execution of complex workflows.

Main Components
---------------
- `delayed`: A function decorator or constructor that converts a Python function or object into a Delayed object.
- `Delayed`: The class representing a delayed computation, encapsulating a task and its associated dask graph.

Functions
---------
### delayed(obj=None, name=None, pure=True)
Creates a Delayed object from a function or value. When called, it wraps the function or value into a delayed task, which can be computed later.

Parameters:
- `obj`: The function or object to be delayed. If `None`, returns a Delayed constructor.
- `name`: Optional name for the delayed task.
- `pure`: Boolean indicating whether the function is pure (has no side effects). Defaults to `True`.

Returns:
- A `Delayed` object representing the lazy computation.

Usage:
```python
from dask import delayed

@delayed
def add(x, y):
    return x + y

result = add(1, 2)
```

### finalize(collection)
Converts a dask collection into a Delayed object that represents the final computation. It creates a high-level graph with a finalize layer.

Parameters:
- `collection`: A dask collection (e.g., Array, DataFrame, Bag).

Returns:
- A `Delayed` object that, when computed, produces the final result of the collection.

### unpack_collections(expr)
Normalizes a Python object, replacing `Delayed` objects with their keys, converting literals, and extracting embedded dask graphs.

Parameters:
- `expr`: The object to be normalized, which can include `Delayed` objects, collections, or Python primitives.

Returns:
- A tuple containing the normalized task and a tuple of involved collections.

Examples:
```python
a = delayed(1, 'a')
b = delayed(2, 'b')
task, collections = unpack_collections([a, b, 3])
# task: ['a', 'b', 3]
# collections: (Delayed('a'), Delayed('b'))
```

### to_task_dask(expr)
Normalizes a Python object into a task and a merged dask graph, extracting all embedded graphs and replacing `Delayed` objects with their keys.

Parameters:
- `expr`: The object to be converted into a task and graph.

Returns:
- A tuple `(task, dask)` where:
  - `task`: The normalized task ready for execution.
  - `dask`: The merged dask graph representing the dependencies.

Notes
-----
- The `delayed` interface supports lazy evaluation, enabling efficient parallel computation.
- It integrates seamlessly with dask collections and custom functions.
- The functions `unpack_collections` and `to_task_dask` assist in converting complex nested structures into executable task graphs.

See Also
--------
- `dask.base.DaskMethodsMixin`
- `dask.highlevelgraph.HighLevelGraph`
- `dask.utils` for utility functions related to task graph manipulation.

This interface is essential for constructing custom workflows and integrating non-dask code into dask's parallel execution model.