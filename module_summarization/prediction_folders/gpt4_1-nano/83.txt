cockroach_engine.rst

CockroachEngine
================

The `CockroachEngine` class is an extension of the `PostgresEngine` designed to facilitate integration with CockroachDB, a distributed SQL database compatible with PostgreSQL. This engine provides specialized setup and configuration to work effectively with CockroachDB environments.

Overview
--------

`CockroachEngine` inherits from `PostgresEngine` and overrides certain behaviors to accommodate the unique requirements of CockroachDB. It supports setting specific cluster settings during initialization to optimize database operations.

Features
--------

- Extends the `PostgresEngine` to support CockroachDB.
- Configurable with connection settings, extensions, and logging options.
- Attempts to enable experimental features in CockroachDB upon setup.
- Handles permission issues gracefully with warnings.

Initialization
--------------

The constructor accepts the following parameters:

- `config` (dict): Connection configuration for the database.
- `extensions` (list of str): Optional list of extensions to load.
- `log_queries` (bool): Whether to log executed queries.
- `log_responses` (bool): Whether to log responses from the database.
- `extra_nodes` (dict): Additional nodes for distributed setups.

Usage
-----

Create an instance of `CockroachEngine` with the desired configuration:

```python
engine = CockroachEngine(
    config={
        "database": "mydb",
        "user": "admin",
        "password": "password",
        "host": "localhost",
        "port": 26257,
    },
    extensions=["extension1", "extension2"],
    log_queries=True,
    log_responses=True,
)
```

Database Preparation
--------------------

The `prep_database` method attempts to set a CockroachDB cluster setting to enable experimental alter column type features:

```python
await engine.prep_database()
```

If the database user lacks sufficient privileges, a warning is issued indicating that some functionality may not behave as expected.

Notes
-----

- The engine type is identified as `"cockroach"`.
- Versioning support is minimal, with `min_version_number` set to 0.
- Designed to work seamlessly with asynchronous operations using `asyncpg`.

This engine provides a robust foundation for integrating CockroachDB into applications that utilize the Piccolo ORM framework, ensuring compatibility and ease of setup.