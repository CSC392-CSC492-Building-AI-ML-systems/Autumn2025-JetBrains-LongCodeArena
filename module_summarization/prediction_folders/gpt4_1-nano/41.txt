How to Use QuerySet to Build Your Queries
===========================================

The QuerySet class provides a powerful and flexible way to construct database queries in an asynchronous environment. It allows you to filter, join, annotate, order, and retrieve data from your models with a clear and expressive API.

1. Creating a QuerySet
----------------------
To start building a query, instantiate a QuerySet with your model class:

```python
from your_app.models import YourModel

queryset = YourModel.all()
```

2. Filtering Data
-----------------
Use the `filter()` method with Q objects or keyword arguments to narrow down your results:

```python
from tortoise.expressions import Q

# Filter by a specific field value
results = await queryset.filter(field_name='value')

# Using Q objects for complex lookups
results = await queryset.filter(Q(field1='value1') & Q(field2='value2'))
```

3. Prefetch Related Data
------------------------
To optimize related data retrieval, use `prefetch_related()`:

```python
results = await queryset.prefetch_related('related_field')
```

4. Annotating Results
---------------------
Add computed fields or aggregations with `annotate()`:

```python
from tortoise.functions import Count

results = await queryset.annotate(total=Count('related_field'))
```

5. Selecting Specific Fields
---------------------------
Use `only()` to fetch only certain fields, reducing data transfer:

```python
results = await queryset.only('field1', 'field2')
```

6. Retrieving Values
--------------------
Use `values()` or `values_list()` to get dictionaries or tuples of field values:

```python
# As dictionaries
results = await queryset.values('field1', 'field2')

# As list of tuples
results = await queryset.values_list('field1', 'field2', flat=False)
```

7. Ordering Results
-------------------
Apply ordering with `resolve_ordering()`, specifying fields and direction:

```python
results = await queryset.order_by('field_name')  # Ascending
results = await queryset.order_by('-field_name')  # Descending
```

8. Joining Related Tables
-------------------------
Join related tables using `resolve_filters()` and `_join_table_by_field()`:

```python
# Internally handled when filtering or ordering on related fields
```

9. Executing the Query
----------------------
Finally, execute the query asynchronously:

```python
results = await queryset
```

This will return a list of model instances or the specified values, depending on the method used.

10. Combining Queries
---------------------
Chain multiple methods for complex queries:

```python
results = await (
    YourModel.all()
    .filter(field_name='value')
    .prefetch_related('related_field')
    .annotate(total=Count('related_field'))
    .order_by('-created_at')
)
```

By leveraging these methods, you can build efficient and readable database queries tailored to your application's needs.