Operations Module Documentation
===============================

Overview
--------
The operations module provides a set of classes and functions to define, manage, and execute database schema migration operations. These operations include adding and dropping constraints, among other schema modifications. The module is designed to be extensible, allowing custom operations and integration with migration workflows.

Classes
-------
MigrateOperation
~~~~~~~~~~~~~~~~
Base class for migration command and organization objects. It serves as the foundation for all specific migration operations.

- Attributes:
  - info (dict): A dictionary for storing arbitrary metadata related to the operation.
  - _mutations (FrozenSet[Rewriter]): Set of rewriters associated with the operation.

- Methods:
  - reverse() -> MigrateOperation: Returns the reverse of the current operation.
  - to_diff_tuple() -> Tuple[Any, ...]: Converts the operation into a tuple suitable for diffing.

AddConstraintOp
~~~~~~~~~~~~~
Represents an operation to add a database constraint.

- Attributes:
  - constraint_type: The type of constraint being added (e.g., foreign key, unique).

- Methods:
  - to_constraint() -> Constraint: Converts the operation into a SQLAlchemy Constraint object.
  - reverse() -> DropConstraintOp: Returns the operation to drop the constraint.
  - to_diff_tuple() -> Tuple[str, Constraint]: Returns a tuple describing the add constraint operation.
  - register_add_constraint: Decorator to register specific constraint types.

DropConstraintOp
~~~~~~~~~~~~~~~~
Represents an operation to drop a database constraint.

- Attributes:
  - constraint_name: Name of the constraint to drop.
  - table_name: Name of the table containing the constraint.
  - constraint_type: Type of the constraint (e.g., foreign key, primary key).
  - schema: Optional schema name.
  - _reverse: Optional reference to the corresponding AddConstraintOp for reversal.

- Methods:
  - reverse() -> AddConstraintOp: Returns the operation to add the constraint back.
  - to_diff_tuple() -> Tuple[str, SchemaItem]: Describes the drop constraint operation.
  - from_constraint(constraint: Constraint) -> DropConstraintOp: Creates an instance from a SQLAlchemy constraint.
  - to_constraint() -> Constraint: Reconstructs the SQLAlchemy constraint object.
  - drop_constraint: Class method to create and invoke a drop constraint operation.
  - batch_drop_constraint: Class method to issue a batch drop constraint operation.

Usage
-----
The module is used within migration scripts to define schema changes programmatically. Operations such as adding or dropping constraints are encapsulated in objects that can be reversed, serialized, and executed within a migration context.

Extensibility
-------------
The system supports registration of custom constraint types via decorators, enabling extension for various database dialects and custom schema objects. The design promotes modularity and integration with broader migration workflows.

See Also
--------
- :ref:`operation_objects`
- :ref:`operation_plugins`
- :ref:`customizing_revision`

This documentation provides an overview of the core classes and their roles in managing schema migration operations within the system.