```rst
w_fork
======

Prepare a new weighted ensemble simulation from an existing one at a particular point. A new HDF5 file is generated. In the case of executable propagation, it is the user's responsibility to prepare the new simulation directory appropriately, particularly making the old simulation's restart data from the appropriate iteration available as the new simulation's initial state data; a mapping of old simulation segments to new simulation initial states is created, both in the new HDF5 file and as a flat text file, to aid in this. Target states and basis states for the new simulation are taken from those in the original simulation.

Options
-------

- ``-i``, ``--input``:
  Create simulation from the given INPUT_H5FILE (default: read from configuration file).

- ``-I``, ``--iteration``:
  Take initial distribution for new simulation from iteration N_ITER (default: last complete iteration).

- ``-o``, ``--output``:
  Save new simulation HDF5 file as OUTPUT (default: forked.h5).

- ``--istate-map``:
  Write a text file describing the mapping of existing segments to new initial states in ISTATE_MAP (default: istate_map.txt).

- ``--no-headers``:
  Do not write a header to ISTATE_MAP.

Usage
-----

The ``w_fork`` command prepares a new weighted ensemble simulation based on an existing one. It allows for the creation of a new HDF5 file with target states and basis states copied from the original simulation. The command also transforms old segments into initial states and new segments, creating a mapping between old segment IDs and new initial state IDs.

The user is responsible for ensuring that the new simulation directory is set up correctly, especially in terms of providing the necessary restart data from the old simulation. The command provides flexibility for further adjustments using ``w_binning``.

The state map generated by ``w_fork`` provides a clear mapping from previous segment IDs to new initial states, aiding in the setup of the new simulation.

```