# Generate documentation for the code

The provided code contains utilities for searching ASDF trees and manipulating search results. Here is a summary of the features and functionalities documented from the code:

## AsdfSearchResult Class
- Represents the result of a call to `AsdfFile.search`.
- Contains methods for formatting the search result and further narrowing the search.
- Provides a method to replace leaf nodes in the search results with a new value.

### Methods:
1. `format(max_rows=NotSet, max_cols=NotSet, show_values=NotSet)`
   - Change formatting parameters of the rendered tree.
   - Parameters:
     - `max_rows`: Maximum number of lines to print.
     - `max_cols`: Maximum length of line to print.
     - `show_values`: Set to False to disable display of primitive values.
   - Returns: `AsdfSearchResult` - the reformatted search result.

2. `search(key=NotSet, type=NotSet, value=NotSet, filter=None)`
   - Further narrow the search based on key, type, value, and custom filter.
   - Parameters:
     - `key`: Search query that selects nodes by dict key or list index.
     - `type`: Search query that selects nodes by type.
     - `value`: Search query that selects nodes by value.
     - `filter`: Callable that filters nodes by arbitrary criteria.
   - Returns: `AsdfSearchResult` - the subsequent search result.

3. `replace(value)`
   - Assign a new value in place of all leaf nodes in the search results.
   - Parameters:
     - `value`: New value to assign.

4. `node`
   - Retrieve the leaf node of a tree with one search result.

## Other Functions:
- `_maybe_compile_pattern(query)`: Helper function to compile a regular expression pattern if the query is a string.
- `_safe_equals(a, b)`: Safely compare two values and handle exceptions.
- `_get_fully_qualified_type(value)`: Get the fully qualified type name of a value.
- `_wrap_filter(filter)`: Helper function to wrap the filter callable.

The code provides a comprehensive set of functionalities for searching and manipulating ASDF trees efficiently.