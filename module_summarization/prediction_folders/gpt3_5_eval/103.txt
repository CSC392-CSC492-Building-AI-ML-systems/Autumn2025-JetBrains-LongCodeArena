# Code Generation Documentation

The `diofant.utilities.codegen` module provides functionality for generating C, C++, Fortran77, Fortran90, and Octave/Matlab routines that evaluate Diofant expressions. This module is a work in progress, with only certain milestones completed.

## Differences from `diofant.printing.ccode`

The `diofant.utilities.codegen` module differs from `diofant.printing.ccode` in the following ways:

- While `ccode` generates a single string, the code generator in `diofant.utilities.codegen` can produce both code and header files for C, and can be extended to support `.pyf` files for `f2py`.
- `diofant.utilities.codegen` addresses programming-technical issues such as input/output arguments, array types, and library headers, which are not handled by Diofant functions.
- It allows for evaluating multiple Diofant functions in a single C routine, potentially sharing intermediate results using the `cse` routine.
- Constants are isolated and evaluated beforehand in double precision, which is different from the printing routines.

## Basic Assumptions

- A generic `Routine` data structure describes the routine to be translated into code, covering all features of the supported languages.
- Derived classes from `CodeGen` transform multiple `Routine` instances into compilable code for specific languages.
- The module provides friendly functions for a simpler workflow on top of the `Routine/CodeGen` classes, offering ease of use but with less power.

## Milestones

The following milestones have been completed:

- First working version with scalar input arguments, generating C code, and tests.
- Friendly functions that are easier to use than the rigorous `Routine/CodeGen` workflow.
- Support for integer and real numbers as input and output.
- Handling of output and input-output arguments.
- Proper sorting of input/output arguments.
- Support for contiguous array arguments (numpy matrices).
- Generation of `.pyf` code for `f2py` in the `autowrap` module.
- Isolation and evaluation of constants in double precision.
- Support for Fortran 90 and Octave/Matlab.

The following milestones are yet to be completed:

- Common Subexpression Elimination
- User-defined comments in the generated code
- Optional extra include lines for libraries/objects that can evaluate special functions
- Testing with other C compilers and libraries
- Support for Diofant matrices as contiguous and non-contiguous array arguments
- Error handling for unsupported translations in C code
- Support for complex numbers as input and output
- Default complex datatype
- Inclusion of extra information in the header such as date, user, hostname, sha1 hash, etc.
- Support for Fortran 77, C++, Python, and more.

## Classes and Functions

The module provides the following classes and functions for generating code:

- `Routine`: A generic description of an evaluation routine for a set of expressions.
- `DataType`, `default_datatypes`, `get_default_datatype`: Data structures for specifying data types.
- `Argument`, `InputArgument`, `OutputArgument`, `Result`: Classes for defining routine arguments and results.
- `CodeGen`, `CCodeGen`, `FCodeGen`, `OctaveCodeGen`: Classes for translating `Routine` instances into code for specific languages.
- `codegen`, `make_routine`: Friendly functions for a simpler workflow.

For detailed usage and examples, refer to the module's documentation and examples provided.