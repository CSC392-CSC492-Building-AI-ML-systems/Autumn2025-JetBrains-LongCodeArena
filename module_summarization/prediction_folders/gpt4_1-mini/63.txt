Commands Module Documentation
=============================

This module provides command functions for managing Alembic database migration environments and revisions. The commands include listing available templates, initializing a new migration environment, and creating new revision files.

Functions
---------

list_templates(config: Config)  
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~  
List available migration environment templates.

- **Parameters**:  
  - `config` (:class:`.Config`): The Alembic configuration object.

- **Description**:  
  Prints the list of available templates found in the template directory, along with a brief synopsis extracted from each template's README file. Also provides an example of how to use a template with the `init` command.

init(config: Config, directory: str, template: str = "generic", package: bool = False) -> None  
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~  
Initialize a new Alembic scripts directory.

- **Parameters**:  
  - `config` (:class:`.Config`): The Alembic configuration object.  
  - `directory` (str): The path to the target directory where the migration environment will be created.  
  - `template` (str, optional): The name of the migration environment template to use. Defaults to `"generic"`.  
  - `package` (bool, optional): If True, writes `__init__.py` files into the environment directory and the versions directory, making them Python packages.

- **Description**:  
  Creates a new migration environment directory structure based on the specified template. It ensures the target directory is empty or does not exist, creates necessary subdirectories, copies template files, and optionally adds `__init__.py` files. It also prompts the user to edit configuration, connection, and logging settings before proceeding.

- **Raises**:  
  - `util.CommandError` if the target directory exists and is not empty, or if the specified template does not exist.

revision(  
    config: Config,  
    message: Optional[str] = None,  
    autogenerate: bool = False,  
    sql: bool = False,  
    head: str = "head",  
    splice: bool = False,  
    branch_label: Optional[str] = None,  
    version_path: Optional[str] = None,  
    rev_id: Optional[str] = None,  
    depends_on: Optional[str] = None,  
    process_revision_directives: Optional[ProcessRevisionDirectiveFn] = None  
) -> Union[Optional[Script], List[Optional[Script]]]  
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~  
Create a new database revision file.

- **Parameters**:  
  - `config` (:class:`.Config`): The Alembic configuration object.  
  - `message` (Optional[str]): The message string to apply to the revision (corresponds to the `-m` option).  
  - `autogenerate` (bool): Whether to autogenerate the revision script from the database schema (corresponds to the `--autogenerate` option).  
  - `sql` (bool): Whether to output the revision as a SQL string to stdout instead of a Python script (corresponds to the `--sql` option).  
  - `head` (str): The head revision to build the new revision upon (corresponds to the `--head` option). Defaults to `"head"`.  
  - `splice` (bool): Whether to create a new head revision even if the specified head is not a head (corresponds to the `--splice` option).  
  - `branch_label` (Optional[str]): A label to apply to the branch (corresponds to the `--branch-label` option).  
  - `version_path` (Optional[str]): A specific version path from the configuration (corresponds to the `--version-path` option).  
  - `rev_id` (Optional[str]): A specific revision identifier to use instead of generating one (corresponds to the `--rev-id` option).  
  - `depends_on` (Optional[str]): A list of revision identifiers that this revision depends on (corresponds to the `--depends-on` option).  
  - `process_revision_directives` (Optional[ProcessRevisionDirectiveFn]): A callable to programmatically alter the revision directives during the revision process. This is only available via programmatic use.

- **Returns**:  
  - A single :class:`.Script` object or a list of such objects representing the created revision(s).

- **Description**:  
  Creates a new revision file in the migration environment. Supports autogeneration of migration scripts based on database schema changes, outputting SQL scripts, branching, and other advanced revision options. The function sets up the revision context and processes the revision directives accordingly.

Notes
-----

- The `list_templates` function helps users discover available migration environment templates.
- The `init` function is used to bootstrap a new Alembic environment in a specified directory.
- The `revision` function is the primary method for creating new migration scripts, supporting both manual and autogeneration workflows.
- Error handling is provided to ensure directories and templates exist and are used correctly.
- The module relies on internal utilities and classes such as `ScriptDirectory`, `util`, and `autogenerate.RevisionContext` to perform its operations.

Usage Examples
--------------

- Listing templates:

  ```bash
  alembic list_templates
  ```

- Initializing a new environment with a specific template:

  ```bash
  alembic init --template generic ./migrations
  ```

- Creating a new revision with a message:

  ```bash
  alembic revision -m "Add new table"
  ```

- Creating a new autogenerate revision:

  ```bash
  alembic revision --autogenerate -m "Autogenerate migration"
  ```

This documentation covers the primary commands provided by this module for managing Alembic migration environments and revisions.