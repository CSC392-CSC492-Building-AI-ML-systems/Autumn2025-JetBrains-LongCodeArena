w_stateprobs command
====================

Calculate average populations and associated errors in state populations from weighted ensemble data. Bin assignments, including macrostate definitions, are required. (See "w_assign --help" for more information).

Overview
--------

The `w_stateprobs` command calculates state-to-state kinetics by tracing trajectories in weighted ensemble simulations. It produces average state populations and confidence intervals (CIs) based on the input data.

Output Format
-------------

The output file (specified with `-o` or `--output`, usually named `stateprobs.h5`) contains the following datasets:

- **/avg_state_pops [state]**  
  A structured dataset representing the population of each state averaged across the entire specified range.

If the `--evolution-mode` option is specified, an additional dataset is included:

- **/state_pop_evolution [window][state]**  
  A structured dataset representing state populations based on windows of iterations of varying width.  
  - If `--evolution-mode=cumulative`, these windows all begin at the iteration specified with `--start-iter` and grow in length by `--step-iter` for each successive element.  
  - If `--evolution-mode=blocked`, these windows are all of width `--step-iter` (except possibly the last, which may be shorter), with the first window beginning at `--start-iter`.

Dataset Structure
-----------------

Each dataset contains the following fields:

- **iter_start**  
  Integer. Iteration at which the averaging window begins (inclusive).

- **iter_stop**  
  Integer. Iteration at which the averaging window ends (exclusive).

- **expected**  
  Floating-point. Expected (mean) value of the rate as evaluated within this window, in units of inverse tau.

- **ci_lbound**  
  Floating-point. Lower bound of the confidence interval on the rate within this window, in units of inverse tau.

- **ci_ubound**  
  Floating-point. Upper bound of the confidence interval on the rate within this window, in units of inverse tau.

- **corr_len**  
  Integer. Correlation length of the rate within this window, in units of tau.

Each dataset is also annotated with the following attributes:

- **mcbs_alpha**  
  Floating-point. Alpha value of confidence intervals (e.g., `alpha=0.05` corresponds to a 95% confidence interval).

- **mcbs_nsets**  
  Integer. Number of bootstrap data sets used in generating confidence intervals.

- **mcbs_acalpha**  
  Floating-point. Alpha value used for determining correlation lengths.

Command-line Options
--------------------

Use `w_stateprobs --help` to see all available command-line options. Key options include:

- `-o`, `--output`  
  Specify the output file name (default: `stateprobs.h5`).

- `--evolution-mode`  
  Enable calculation of state population evolution over iteration windows. Options: `cumulative`, `blocked`.

- `--start-iter`  
  Specify the starting iteration for windowed analysis.

- `--step-iter`  
  Specify the step size (window width or increment) for iteration windows.

Notes
-----

- Bin assignments and macrostate definitions are required inputs for this analysis. Use the `w_assign` command to generate these assignments.

- This command is a wrapper around the `w_direct trace` subcommand and is maintained for backward compatibility.

Deprecation Notice
------------------

The `w_stateprobs` command is deprecated. Users are encouraged to use the `w_direct` command instead for state-to-state kinetics analysis.