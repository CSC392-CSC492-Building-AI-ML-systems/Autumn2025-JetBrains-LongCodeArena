w_kinavg command
================

Description
-----------

The `w_kinavg` command calculates average rates and associated confidence intervals (CIs) from weighted ensemble data for path-tracing kinetics analysis. It requires previously generated bin assignments (usually stored in `assignments.h5`) and kinetics data files (such as `kintrace.h5` or `kinmat.h5`). For information on generating these prerequisite files, see the documentation for `w_assign` and `w_kinetics`.

This command supports direct kinetics analysis schemes and provides detailed statistical analysis of state-to-state rates and fluxes over specified iteration windows.

Output Format
-------------

The output file (specified with `-o` or `--output`, defaulting to `kinavg.h5`) contains the following datasets:

- **/avg_rates** `[state,state]`  
  Structured dataset containing state-to-state rates averaged over the entire selected iteration window.

In trace mode, additional datasets are generated:

- **/avg_total_fluxes** `[state]`  
  Structured dataset of total fluxes into each state averaged over the selected iteration window.

- **/avg_conditional_fluxes** `[state,state]`  
  Structured dataset of state-to-state fluxes averaged over the selected iteration window.

If the `--evolution-mode` option is specified, the following dataset is also available:

- **/rate_evolution** `[window][state][state]`  
  Structured dataset showing state-to-state rates calculated over windows of iterations of varying width.  
  - If `--evolution-mode=cumulative`, windows start at the iteration specified by `--start-iter` and grow in length by `--step-iter` for each successive element.  
  - If `--evolution-mode=blocked`, windows have a fixed width of `--step-iter` (except possibly the last), starting at `--start-iter`.

In trace mode with `--evolution-mode` specified, these additional datasets are generated:

- **/target_flux_evolution** `[window,state]`  
  Structured dataset of total flux into each macro state over windows of varying width, as described above.

- **/conditional_flux_evolution** `[window,state,state]`  
  Structured dataset of state-to-state fluxes over windows of varying width, as described above.

Dataset Structure
-----------------

Each dataset is structured with the following fields:

- **iter_start**  
  Integer indicating the iteration at which the averaging window begins (inclusive).

- **iter_stop**  
  Integer indicating the iteration at which the averaging window ends (exclusive).

- **expected**  
  Floating-point value representing the expected (mean) rate within the window, in units of inverse tau.

- **ci_lbound**  
  Floating-point value for the lower bound of the confidence interval on the rate, in units of inverse tau.

- **ci_ubound**  
  Floating-point value for the upper bound of the confidence interval on the rate, in units of inverse tau.

- **corr_len**  
  Integer representing the correlation length of the rate within the window, in units of tau.

Each dataset also includes the following attributes:

- **mcbs_alpha**  
  Floating-point alpha value used for confidence intervals (e.g., `0.05` corresponds to a 95% confidence interval).

- **mcbs_nsets**  
  Integer number of bootstrap data sets used to generate confidence intervals.

- **mcbs_acalpha**  
  Floating-point alpha value used for determining correlation lengths.

Command-line Options
--------------------

For detailed command-line options and usage, run:

```
w_kinavg --help
```

or consult the help for the underlying `w_direct` command and its `trace` subcommand.

Deprecation Notice
------------------

The `w_kinavg` command is deprecated. Users are encouraged to use the `w_direct` command instead for direct kinetics analysis. The `w_kinavg` command remains available for backward compatibility but may be removed in future releases.