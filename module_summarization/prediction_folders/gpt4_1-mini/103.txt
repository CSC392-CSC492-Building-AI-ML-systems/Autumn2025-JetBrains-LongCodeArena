Generate Documentation for diofant.utilities.codegen
======================================================

Overview
--------

The `diofant.utilities.codegen` module provides tools for generating source code in multiple programming languages such as C, C++, Fortran77, Fortran90, and Octave/Matlab. It is designed to translate Diofant expressions into compilable routines, supporting a variety of programming constructs and language-specific features.

This module is a work in progress, with several milestones already achieved and others planned for future development.

Key Differences from diofant.printing.ccode
--------------------------------------------

While `diofant.printing.ccode` focuses on printing C code snippets for expressions, `diofant.utilities.codegen` aims to generate complete, compilable routines with additional programming context. The main distinctions include:

- **Multiple Files and Headers:** Code generation often requires both source and header files (e.g., in C), whereas printing routines produce a single string.
- **Programming Constructs:** The code generator handles input, output, and input-output arguments, array contiguity, and integration with external libraries, which are beyond the scope of simple printing.
- **Multiple Functions and Optimization:** It supports generating routines that evaluate multiple Diofant functions simultaneously, potentially sharing intermediate results using common subexpression elimination (CSE).
- **Constant Evaluation:** Constants in expressions are evaluated at code generation time to optimize the output code.

Basic Assumptions and Architecture
----------------------------------

- **Routine Data Structure:** The core abstraction is the `Routine` class, which generically describes an evaluation routine for a set of expressions. It encapsulates all features needed to represent routines across supported languages.
- **CodeGen Classes:** Derived classes from the abstract `CodeGen` base class translate `Routine` instances into compilable code for specific target languages (e.g., `CCodeGen`, `FCodeGen`, `OctaveCodeGen`).
- **Friendly API:** For ease of use, the module provides higher-level functions such as `codegen` and `make_routine` that simplify the workflow compared to directly manipulating `Routine` and `CodeGen` objects.

Milestones Achieved
-------------------

The following features have been implemented and tested:

- Generation of C code for routines with scalar input arguments.
- Friendly functions providing a simplified API.
- Support for integer and real number input and output.
- Handling of output and input-output arguments.
- Proper sorting of input/output arguments.
- Support for contiguous array arguments (e.g., NumPy matrices).
- Generation of `.pyf` files for `f2py` integration (in the autowrap module).
- Pre-evaluation and isolation of constants in double precision.
- Support for Fortran 90 and Octave/Matlab code generation.

Planned Features
----------------

Future enhancements include:

- Common subexpression elimination (CSE).
- User-defined comments in generated code.
- Inclusion of extra library headers for special functions.
- Testing with various C compilers and libraries (gcc, tcc, libtcc, gcc+gsl, etc.).
- Support for contiguous and non-contiguous Diofant matrix arguments.
- Error handling for unsupported expressions in C code generation.
- Support for complex numbers as input and output.
- Default complex data types.
- Inclusion of metadata in headers (date, user, hostname, SHA1 hash).
- Support for Fortran 77, C++, Python, and more.

Core Classes and Concepts
-------------------------

### Routine

The `Routine` class represents a generic evaluation routine for a set of expressions. It includes:

- **Name:** The routine's identifier.
- **Arguments:** A list of `Argument` instances representing inputs, outputs, or input-output parameters.
- **Results:** A list of `Result` instances representing return values.
- **Local Variables:** Variables defined within the routine.
- **Global Variables:** Variables not passed as arguments but used within the routine.

The class ensures that all symbols required by the routine's expressions are properly covered by the input, local, or global variables.

### Arguments and Results

- **Argument:** Base class for routine arguments.
- **InputArgument:** Represents input parameters.
- **OutputArgument:** Represents output parameters.
- **InOutArgument:** Represents parameters used for both input and output.
- **Result:** Represents return values or local variables holding intermediate results.

### CodeGen and Derived Classes

- **CodeGen:** Abstract base class defining the interface for code generators.
- **CCodeGen:** Generates C source and header files.
- **FCodeGen:** Generates Fortran code.
- **OctaveCodeGen:** Generates Octave/Matlab code.

These classes take one or more `Routine` instances and produce compilable source code in the target language.

Friendly Functions
------------------

- **codegen:** A high-level function that generates code for given expressions and writes the output files.
- **make_routine:** Constructs a `Routine` instance from given expressions and parameters, simplifying the creation of routines.

Usage Example
-------------

```python
from diofant.utilities.codegen import codegen

[(c_name, c_code), (h_name, c_header)] = codegen(
    ("myfunc", expr),
    language="C",
    project="myproject"
)
```

This example generates C source and header files for the expression `expr` wrapped in a function named `myfunc`.

Summary
-------

The `diofant.utilities.codegen` module provides a structured and extensible framework for generating efficient, compilable code from symbolic expressions in multiple programming languages. It bridges the gap between symbolic computation and practical numerical code implementation, supporting advanced features such as argument handling, constant pre-evaluation, and multi-language output.

For detailed usage, refer to the API documentation of the core classes and functions within the module.