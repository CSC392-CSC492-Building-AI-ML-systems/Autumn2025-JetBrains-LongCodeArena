Less Frequently Used FITS Data Structures
=========================================

This section provides an overview of some of the less commonly used data structures and classes encountered in FITS (Flexible Image Transport System) files, particularly as implemented in the Astropy FITS module. These structures are typically used internally or for advanced FITS file verification and manipulation.

Verification Framework
----------------------

Astropy's FITS module includes a robust verification framework designed to check the integrity and correctness of FITS files. This framework is built around several key classes and concepts:

### VerifyError and VerifyWarning

- **VerifyError**: An exception class raised when verification encounters an error that cannot be ignored or fixed.
- **VerifyWarning**: A warning class used to notify users of verification issues that do not necessarily halt processing.

### Verification Options

Verification behavior can be controlled using various options, allowing users to specify how errors should be handled:

- `"ignore"`: Do not report errors.
- `"warn"`: Issue warnings for errors.
- `"exception"`: Raise exceptions on errors.
- `"fix"`: Attempt to fix errors and report them.
- `"silentfix"`: Attempt to fix errors silently without reporting.
- Combinations such as `"fix+warn"`, `"silentfix+exception"`, etc., allow fine-grained control.

### The `_Verify` Class

This class provides shared methods for running verification checks on FITS data structures. It supports executing verification with the selected option, handling fixable and unfixable errors appropriately, and reporting messages via warnings or exceptions.

Key methods include:

- `run_option(option, err_text, fix_text, fix, fixable)`: Executes verification logic based on the option and whether the error is fixable.
- `verify(option)`: Runs the verification process with the specified option, managing error reporting and fixing.

### The `_ErrList` Class

Verification errors are collected in an `_ErrList`, a specialized list that can hold nested error messages corresponding to different levels of the FITS data hierarchy. It supports:

- Nested error message storage.
- Iteration over error messages with indentation reflecting the structure.
- Filtering of messages based on fixability or other criteria.

Notifier Mixin
--------------

The `NotifierMixin` class is a utility mixin that provides a mechanism for objects to register listeners and notify them of changes. This is useful in complex FITS data structures where changes in one part of the data may need to propagate updates elsewhere.

Features include:

- Registering listeners with weak references to avoid memory leaks.
- Notifying listeners of specific change types by calling corresponding update methods.
- Ignoring listeners that do not implement the required update methods.

Example usage:

```python
class Widget(NotifierMixin):
    state = 1
    def __init__(self, name):
        self.name = name
    def update_state(self):
        self.state += 1
```

This mixin is primarily intended for internal use within the FITS module to facilitate communication between components.

Additional Notes
----------------

- The verification system uses zero-based indexing when reporting errors, consistent with Python conventions.
- The verification framework is designed to be extensible and customizable, allowing developers to implement additional checks and fixes as needed.
- The use of warnings and exceptions allows users to integrate FITS verification into larger workflows with appropriate error handling strategies.

Summary
-------

While most users interact with standard FITS data structures such as HDUs (Header/Data Units), headers, and data arrays, the classes and mechanisms described here provide the foundation for ensuring FITS file integrity and supporting advanced manipulation. Understanding these less frequently used components can be valuable for developers working on FITS file validation, repair, or complex data processing pipelines.