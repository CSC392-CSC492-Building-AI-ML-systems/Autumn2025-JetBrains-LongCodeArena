Understanding Sessions
======================

A **Session** represents an isolated context for interacting with an ftrack server. It encapsulates the connection details, authentication, caching, event handling, and plugin management necessary to communicate with the server and perform operations.

Session Initialization
----------------------

To create a session, you need to specify the server URL, API key, and API user. These can be provided directly as arguments or through environment variables:

- **server_url**: The URL of the ftrack server, including any port number. If not provided, the session will attempt to read it from the `FTRACK_SERVER` environment variable.
- **api_key**: The API key used for authentication. If not provided, it will be read from the `FTRACK_API_KEY` environment variable.
- **api_user**: The username of the ftrack user to record operations against. If not provided, it will be read from the `FTRACK_API_USER` environment variable or derived from the current system user.

Example:

```python
session = ftrack_api.Session(
    server_url='https://ftrack.example.com',
    api_key='your_api_key',
    api_user='username'
)
```

Session Features
----------------

- **Auto-populate**: By default, the session automatically fetches entity attributes from the server when they are accessed but not yet loaded. This behavior can be toggled via the `auto_populate` flag.

- **Caching**: Sessions support caching to improve performance and reduce server load. You can provide a custom cache instance or a callable that returns a cache. The session uses a layered cache system with a memory cache at the top level by default.

- **Cache Key Maker**: A key maker is used to generate keys for cached objects. If not specified, a default string-based key maker is used.

- **Event Hub**: The session includes an embedded event hub for publishing and subscribing to events. If `auto_connect_event_hub` is enabled, the event hub connects automatically in a background thread, allowing interaction with non-local events. Otherwise, only local events are available until the event hub is manually connected.

- **Schema Caching**: To improve performance, schema caching can be enabled by specifying a path via `schema_cache_path` or the `FTRACK_API_SCHEMA_CACHE_PATH` environment variable. If not set, a temporary directory is used. Setting this to `False` disables schema caching.

- **Plugin Support**: The session can load plugins from specified paths (`plugin_paths`) and pass optional arguments (`plugin_arguments`) to plugin registration functions. The system attempts to match plugin signatures with provided arguments, logging warnings if there are mismatches.

Session Authentication
----------------------

Authentication for requests is handled by the `SessionAuthentication` class, which attaches the API key and user information to HTTP request headers. This ensures that all communication with the ftrack server is properly authenticated.

Usage:

```python
auth = SessionAuthentication(api_key='your_api_key', api_user='username')
response = requests.get('https://ftrack.example.com/api', auth=auth)
```

Operations and Recording
------------------------

The session maintains a collection of pending operations (`recorded_operations`) that can be recorded and sent to the server. By default, operation recording is enabled (`record_operations = True`), allowing changes made through the session to be tracked and committed.

Summary
-------

The `Session` class is the primary interface for interacting with an ftrack server. It manages connection details, authentication, caching, event handling, and plugin integration, providing a robust and flexible environment for working with ftrack data and services. Proper configuration of the session ensures efficient and secure communication with the server, enabling powerful automation and integration workflows.