Isotonic Regression
====================

Isotonic regression is a non-parametric regression technique that fits a free-form line to a set of points while preserving a specified order constraint. It is particularly useful when the relationship between the independent variable and the dependent variable is assumed to be monotonic (either non-decreasing or non-increasing), but the exact functional form is unknown.

Overview
--------

The isotonic regression model fits a monotonic function to the data by minimizing the sum of squared errors subject to the monotonicity constraint. This method is widely used in statistics and machine learning for calibration, smoothing, and shape-constrained regression problems.

Key Features
------------

- Fits a monotonic (increasing or decreasing) function to data.
- Supports weighted samples.
- Allows bounding the predicted values within specified minimum and maximum limits.
- Can automatically determine the direction of monotonicity based on the data.
- Handles out-of-bounds inputs during prediction with configurable strategies.

Functions and Classes
---------------------

check_increasing(x, y)
~~~~~~~~~~~~~~~~~~~~~~

Determines whether the target values `y` are monotonically correlated with the input `x`. This is done using the Spearman correlation coefficient.

**Parameters**

- `x` : array-like of shape (n_samples,)
  Input data.

- `y` : array-like of shape (n_samples,)
  Target values.

**Returns**

- `increasing_bool` : bool
  Returns `True` if `y` is increasing with respect to `x`, `False` otherwise.

**Notes**

- The function computes the Spearman correlation coefficient and uses its sign to determine monotonicity.
- A warning is issued if the 95% confidence interval of the correlation coefficient spans zero, indicating uncertainty in the monotonicity direction.

isotonic_regression(y, *, sample_weight=None, y_min=None, y_max=None, increasing=True)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Solves the isotonic regression problem for the given data.

**Parameters**

- `y` : array-like of shape (n_samples,)
  The data to fit.

- `sample_weight` : array-like of shape (n_samples,), default=None
  Weights for each data point. If `None`, equal weights are assumed.

- `y_min` : float, default=None
  Lower bound on the predicted values. If not set, no lower bound is applied.

- `y_max` : float, default=None
  Upper bound on the predicted values. If not set, no upper bound is applied.

- `increasing` : bool, default=True
  If `True`, fits an increasing function; if `False`, fits a decreasing function.

**Returns**

- `y_` : ndarray of shape (n_samples,)
  The isotonic fit of the input data.

**References**

- Best, M. J., & Chakravarti, N. (1990). Active set algorithms for isotonic regression; A unifying framework.

IsotonicRegression Class
------------------------

The `IsotonicRegression` class provides a scikit-learn compatible estimator for isotonic regression. It can be used both as a regressor and as a transformer.

**Parameters**

- `y_min` : float, default=None
  Lower bound on the lowest predicted value. If not set, defaults to negative infinity.

- `y_max` : float, default=None
  Upper bound on the highest predicted value. If not set, defaults to positive infinity.

- `increasing` : bool or 'auto', default=True
  Specifies whether the predictions should be increasing or decreasing with respect to the input `X`. If set to `'auto'`, the direction is inferred from the data using the Spearman correlation.

- `out_of_bounds` : {'nan', 'clip', 'raise'}, default='nan'
  Defines how to handle input values outside the training data range during prediction:
  
  - `'nan'`: returns NaN for out-of-bounds inputs.
  - `'clip'`: clips inputs to the nearest boundary value.
  - `'raise'`: raises a `ValueError`.

**Attributes**

- `X_min_` : float
  Minimum value of the training input data.

- `X_max_` : float
  Maximum value of the training input data.

- `X_thresholds_` : ndarray of shape (n_thresholds,)
  Unique sorted input values used for interpolation.

- `y_thresholds_` : ndarray
  Corresponding output values at the thresholds.

Usage Example
-------------

```python
from sklearn.isotonic import IsotonicRegression

# Sample data
X = [0, 1, 2, 3, 4, 5]
y = [0, 0.5, 0.7, 0.9, 1.2, 1.5]

# Fit isotonic regression model
iso_reg = IsotonicRegression(increasing=True)
iso_reg.fit(X, y)

# Predict new values
y_pred = iso_reg.predict([1.5, 2.5, 3.5])
```

References
----------

- Best, M. J., & Chakravarti, N. (1990). Active set algorithms for isotonic regression; A unifying framework.
- Spearman, C. (1904). The proof and measurement of association between two things. *American Journal of Psychology*, 15(1), 72-101.
- Fisher transformation. Wikipedia. https://en.wikipedia.org/wiki/Fisher_transformation

See Also
--------

- :ref:`User Guide <isotonic>` for detailed explanations and examples.

---

This documentation provides an overview of isotonic regression as implemented in scikit-learn, including its API, usage, and theoretical background.