SANS to SESANS Conversion
=========================

This document describes the theoretical background and practical implementation details for converting Small-Angle Neutron Scattering (SANS) data into Spin-Echo Small-Angle Neutron Scattering (SESANS) data.

Overview
--------

SANS and SESANS are complementary neutron scattering techniques used to probe the structure of materials at the nanoscale. While SANS measures the scattering intensity as a function of the scattering vector \( q \), SESANS measures the real-space correlation function \( G(z) \) as a function of the spin-echo length \( z \).

The conversion from SANS to SESANS involves transforming the scattering intensity \( I(q) \) into the SESANS correlation function \( G(z) \). This transformation is mathematically expressed as an integral transform involving Bessel functions and elliptic integrals.

Mathematical Background
-----------------------

The SESANS correlation function \( G(z) \) is related to the SANS intensity \( I(q) \) by the following integral:

\[
G(z) = \int_0^\infty q \, I(q) \, J_0(q z) \, dq
\]

where

- \( q \) is the scattering vector magnitude,
- \( I(q) \) is the scattering intensity measured by SANS,
- \( J_0 \) is the zeroth-order Bessel function of the first kind,
- \( z \) is the spin-echo length in SESANS.

This integral transform converts reciprocal space data into real-space correlation data.

Elliptic Functions in the Conversion
------------------------------------

The conversion process involves elliptic integrals and Jacobi elliptic functions, which arise naturally in the mathematical description of the SESANS technique.

Key functions used include:

- **Elliptic integrals of the first kind** \( F(\phi | m) \),
- **Jacobi elliptic functions** \( \mathrm{sn}(u|m), \mathrm{cn}(u|m), \mathrm{dn}(u|m) \).

These functions are used to map between coordinate systems and to evaluate the integral transforms efficiently.

Implementation Details
----------------------

The conversion algorithm uses numerical methods to evaluate the integral transform from \( I(q) \) to \( G(z) \). The implementation leverages the following:

- **Numerical integration** over the scattering vector \( q \),
- **Special functions** from the SciPy library, such as `scipy.special.ellipj` and `scipy.special.ellipkinc`, to compute elliptic functions and integrals,
- **Broadcasting and vectorization** with NumPy for efficient computation over arrays of \( q \) and \( z \) values.

The elliptic functions are computed using the `ellipj` function, which returns the values of the Jacobi elliptic functions \( \mathrm{sn}, \mathrm{cn}, \mathrm{dn} \) for given arguments.

Example Usage
-------------

To perform the conversion, one typically follows these steps:

1. Obtain or calculate the SANS intensity \( I(q) \) over a range of \( q \) values.
2. Define the desired spin-echo lengths \( z \) for SESANS.
3. Compute the integral transform numerically using the Bessel function \( J_0 \) and the elliptic functions as needed.
4. Analyze the resulting SESANS correlation function \( G(z) \).

The codebase includes functions to facilitate these calculations, handling the special functions and numerical integration internally.

References
----------

- Paul Kienzle, "Conversion between latitude-longitude and Guyou map coordinates," 2017-11-01.
- SciPy Special Functions Documentation: https://docs.scipy.org/doc/scipy/reference/special.html
- SESANS Theory and Applications, relevant neutron scattering literature.

License
-------

The code and algorithms described here are provided under the BSD 3-Clause License. See the source code for full license details.

---

This documentation provides a concise overview of the SANS to SESANS conversion process, highlighting the mathematical foundations and computational methods employed. For detailed usage and code examples, please refer to the source code and associated modules.