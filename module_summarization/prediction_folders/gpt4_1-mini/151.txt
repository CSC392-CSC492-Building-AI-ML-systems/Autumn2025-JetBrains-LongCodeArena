# General Plotting Routines

This document provides an overview of the general plotting routines available in the Masci-tools package for creating interactive plots using the Bokeh backend. These routines facilitate the creation of scatter plots and multi-scatter plots with customizable parameters and default settings.

---

## Overview

The plotting routines leverage the `BokehPlotter` class to generate interactive visualizations. Users can configure default plotting parameters, reset them to hardcoded defaults, and save or load these settings from JSON files. The plotting functions accept data in various formats, including arrays, pandas DataFrames, and Bokeh `ColumnDataSource` objects.

---

## Managing Bokeh Plot Defaults

### `set_bokeh_plot_defaults(**kwargs)`

Set default parameters for the Bokeh plotting backend. The available defaults correspond to those defined in the `BokehPlotter` class.

**Parameters:**

- `**kwargs`: Keyword arguments specifying the default parameters to set.

---

### `reset_bokeh_plot_defaults()`

Reset the Bokeh plotting defaults to the original hardcoded values as defined in the `BokehPlotter` class.

---

### `show_bokeh_plot_defaults()`

Display the currently set default parameters for the Bokeh plotting backend.

---

### `get_bokeh_help(key)`

Print the description of a specific default parameter key used in the Bokeh backend.

**Parameters:**

- `key` (str): The key for which the description is requested.

---

### `load_bokeh_defaults(filename='plot_bokeh_defaults.json')`

Load Bokeh plotting defaults from a JSON file.

**Parameters:**

- `filename` (str): Path to the JSON file containing the defaults to load. Defaults to `'plot_bokeh_defaults.json'`.

---

### `save_bokeh_defaults(filename='plot_bokeh_defaults.json', save_complete=False)`

Save the current Bokeh plotting defaults to a JSON file.

**Parameters:**

- `filename` (str): Path to the JSON file where defaults will be saved. Defaults to `'plot_bokeh_defaults.json'`.
- `save_complete` (bool): If `True`, saves both user-overwritten and unmodified hardcoded defaults. Defaults to `False`.

---

## Plotting Functions

### `bokeh_scatter(x, y=None, *, xlabel='x', ylabel='y', title='', figure=None, data=None, saveas='scatter', copy_data=False, **kwargs)`

Create an interactive scatter plot using Bokeh.

**Parameters:**

- `x` (array-like or str): Data or key for the x-axis.
- `y` (array-like or str, optional): Data or key for the y-axis.
- `data` (optional): Data source for the plot, e.g., a pandas DataFrame.
- `xlabel` (str): Label for the x-axis. Default is `'x'`.
- `ylabel` (str): Label for the y-axis. Default is `'y'`.
- `title` (str): Title of the figure.
- `figure` (Bokeh figure, optional): If provided, the plot will be added to this figure.
- `saveas` (str): Filename prefix for saving the plot. Default is `'scatter'`.
- `copy_data` (bool): If `True`, the data argument will be copied before plotting.
- `**kwargs`: Additional keyword arguments passed to `BokehPlotter` or Bokeh's `scatter` function.

**Notes:**

- If the first argument `x` is a dictionary, pandas DataFrame, or Bokeh `ColumnDataSource`, it is treated as the data source, and `x` and `y` keys should be specified via `xdata` and `ydata` in `kwargs`.
- The function automatically processes the data, prepares the figure, applies default and user-specified parameters, and adds interactive tooltips.
- Straight lines and axis limits can be drawn/set based on the current defaults.
- The plot is saved automatically if `saveas` is specified.

**Returns:**

- A Bokeh figure object containing the scatter plot.

---

### `bokeh_multi_scatter(x, y=None, *, data=None, figure=None, xlabel='x', ylabel='y', title='', saveas='scatter', copy_data=False, set_default_legend=True, **kwargs)`

Create an interactive scatter plot with support for multiple datasets using Bokeh.

**Parameters:**

- `x` (array-like or str): Data or key for the x-axis.
- `y` (array-like or str): Data or key for the y-axis.
- `data` (optional): Data source for the plot, e.g., a pandas DataFrame.
- `figure` (Bokeh figure, optional): If provided, the plot will be added to this figure.
- `xlabel` (str): Label for the x-axis. Default is `'x'`.
- `ylabel` (str): Label for the y-axis. Default is `'y'`.
- `title` (str): Title of the figure.
- `saveas` (str): Filename prefix for saving the plot. Default is `'scatter'`.
- `copy_data` (bool): If `True`, the data argument will be copied before plotting.
- `set_default_legend` (bool): If `True`, uses data names to generate default legend labels.
- `**kwargs`: Additional keyword arguments passed to `BokehPlotter` or Bokeh's `scatter` function.

**Notes:**

- Supports plotting multiple datasets on the same figure.
- Automatically manages legends and colors for different datasets.
- Processes data similarly to `bokeh_scatter`.
- Adds interactive tooltips and applies default plotting parameters.
- Saves the plot automatically if `saveas` is specified.

**Returns:**

- A Bokeh figure object containing the multi-scatter plot.

---

## Data Handling

The plotting functions internally use the `process_data_arguments` helper to handle various data input formats, ensuring consistent and correct data extraction for plotting. This includes support for:

- Pandas DataFrames
- Dictionaries
- Bokeh `ColumnDataSource` objects
- Array-like data structures

---

## Additional Features

- **Tooltips:** Interactive tooltips are added to plots to display data values on hover.
- **Straight Lines:** Optional straight lines can be drawn on plots based on default settings.
- **Axis Limits:** Axis limits can be set automatically or manually.
- **Saving Plots:** Plots can be saved to files with customizable filenames.

---

## Example Usage

```python
from masci_tools.vis.general_plots import bokeh_scatter, set_bokeh_plot_defaults

# Set some default plotting parameters
set_bokeh_plot_defaults(color='red', size=10)

# Create a scatter plot
p = bokeh_scatter(x=[1, 2, 3], y=[4, 5, 6], xlabel='Time', ylabel='Value', title='Sample Scatter Plot')

# Show the plot (in a Jupyter notebook or Bokeh server)
from bokeh.io import show
show(p)
```

---

For more detailed information on available parameters and customization options, refer to the `BokehPlotter` class documentation within the Masci-tools package.