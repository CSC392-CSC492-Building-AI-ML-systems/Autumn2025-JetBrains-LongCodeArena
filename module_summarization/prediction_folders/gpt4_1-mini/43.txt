Config Usage
============

The `ConfigParser` class extends Python's built-in `configparser.ConfigParser` with additional features tailored for enhanced configuration management in applications. It provides default configuration values, supports environment variable expansion, includes configuration files recursively, and integrates with external systems such as Zookeeper.

Key Features
------------

- **Default Configuration Values**  
  The class comes with a comprehensive set of default configuration values organized into sections such as `general`, `asab:metrics`, `logging`, `library`, and more. These defaults cover common application settings like logging, metrics, housekeeping, and daemonization.

- **Environment Variable Support**  
  Configuration values can include environment variables, which are automatically expanded when the configuration is loaded. For example, the `config_file` path in the `general` section can be set via the `ASAB_CONFIG` environment variable.

- **Include Support with Recursive Loading**  
  The configuration supports including other configuration files using glob patterns or special prefixes like `zookeeper`. Included files are loaded recursively, with safeguards to prevent infinite loops by tracking already included files.

- **Zookeeper Integration**  
  If the environment variable `ASAB_ZOOKEEPER_SERVERS` is set, the configuration automatically includes a `zookeeper` section with the specified servers. Additionally, configuration files can be included directly from Zookeeper by using the `zookeeper` prefix in include directives.

- **Platform-Specific Defaults**  
  Some defaults, such as syslog socket paths and formats, are set based on the detected platform (e.g., Darwin/macOS).

Usage
-----

### Creating a ConfigParser Instance

```python
from your_module import ConfigParser

config = ConfigParser()
```

### Adding Default Values

You can add or override default configuration values programmatically using the `add_defaults()` method:

```python
defaults = {
    'my_section': {
        'my_key': 'my_value',
    }
}
config.add_defaults(defaults)
```

This method adds the specified keys and values only if they do not already exist in the configuration.

### Loading Configuration Files

The configuration can be loaded from files specified in the `general:config_file` setting or by manually reading files:

```python
config.read('path/to/config.ini')
```

Included files specified in the `include` key of the `general` section are automatically processed, supporting nested includes.

### Accessing Configuration Values

Configuration values can be accessed using standard `configparser` methods:

```python
tick_period = config.getint('general', 'tick_period')
log_level = config.get('logging', 'level')
```

### Passwords Section

The configuration supports a special `[passwords]` section intended for securely storing passwords. Passwords stored here can be referenced in other sections using the syntax `${passwords:<password_key>}`. This allows sensitive information to be kept separate and not exposed in the main configuration API.

Example:

```ini
[connection:KafkaConnection]
password=${passwords:kafka_password}

[passwords]
kafka_password=MY_SECRET_PASSWORD
```

### Logging Configuration

The `logging` section and its subsections (`logging:console`, `logging:syslog`, `logging:file`) provide detailed control over application logging, including formats, levels, and output destinations.

### Housekeeping

The `housekeeping` section allows scheduling of maintenance tasks with keys such as `at`, `limit`, and `run_at_startup`.

Notes
-----

- The `ConfigParser` class is designed to be loaded once; multiple loads may lead to undefined behavior.
- The special value `'!'` for the `pidfile` key in the `general` section is interpreted as a platform-specific default location for the PID file.
- The class uses internal mechanisms to prevent infinite loops when including configuration files.
- Logging warnings are issued if a configuration file is included more than once.

Logging
-------

The class uses Python's standard `logging` module to report warnings and other messages during configuration loading and processing.

Summary
-------

The enhanced `ConfigParser` class provides a robust and flexible configuration management system suitable for complex applications requiring default values, environment variable expansion, recursive includes, and integration with external services like Zookeeper. It simplifies configuration handling while maintaining compatibility with standard `configparser` usage patterns.