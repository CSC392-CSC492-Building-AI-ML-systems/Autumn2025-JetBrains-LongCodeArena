MapPlot Module Documentation
============================

Overview
--------

The `MapPlot` module provides interactive plotting capabilities for data cubes, allowing users to visualize maps and connect them interactively to spectrum plotting. It is designed primarily as an interactive analysis tool rather than for producing publication-quality plots. However, it leverages the `APLpy` package, enabling the creation of high-quality plots if desired.

Key Features
------------

- Interactive map plotting from data cubes.
- Click on map pixels to plot corresponding spectra in separate windows.
- Support for overplotting multiple spectra.
- Interactive region averaging by click-and-drag or keyboard commands.
- Integration with `APLpy` for FITS-based plotting and colorbars.
- Flexible plotting options including color maps, value ranges, and projection conventions.

Dependencies
------------

- `matplotlib` for plotting.
- `numpy` for numerical operations.
- `astropy.wcs` and `astropy.io.fits` (or legacy `pywcs` and `pyfits`) for WCS and FITS handling.
- `aplpy` (optional) for advanced FITS plotting capabilities.

Classes
-------

### MapPlotter

A class to create and manage interactive map plots from data cubes.

#### Initialization

```python
MapPlotter(Cube=None, figure=None, doplot=False, **kwargs)
```

- `Cube` : The data cube object containing the data and header.
- `figure` : A `matplotlib.figure.Figure` instance, an integer figure number, or `None`.
- `doplot` : If `True`, immediately generate the map plot.
- `**kwargs` : Additional keyword arguments passed to the plotting methods.

#### Methods

- `__call__(**kwargs)`

  Alias for `mapplot()`. Allows the object to be called directly to generate plots.

- `mapplot(convention='calabretta', colorbar=True, useaplpy=True, vmin=None, vmax=None, cmap=None, plotkwargs={}, **kwargs)`

  Generate an interactive map plot from the data cube.

  Parameters:

  - `convention` : Projection convention for Galactic data (`'calabretta'` or `'griesen'`).
  - `colorbar` : Whether to display a colorbar alongside the map.
  - `useaplpy` : Use `APLpy` for plotting if available and a FITS header is present.
  - `vmin`, `vmax` : Minimum and maximum values for the color scale. Automatically determined if `None`.
  - `cmap` : Colormap to use for the plot.
  - `plotkwargs` : Additional keyword arguments passed to the plotting functions.
  - `**kwargs` : Additional parameters, including those for selecting the map plane and estimator.

  Interactive Controls:

  - **Button 1 or '1' key**: Plot the spectrum at the clicked pixel in a separate window and mark the pixel.
  - **Button 2 or 'o' key**: Overplot additional spectra in the external plot window.
  - **Button 3**: Disconnect the interactive viewer.
  - **Click-and-drag with Button 1**: Average over a circular region.
  - **'c' key**: Set the center of a circular region.
  - **'r' key**: Set the radius of the circular region.

Internal Methods
----------------

- `_connect()`

  Connects mouse click, release, and key press events to their respective handlers for interactive functionality.

- `_disconnect()`

  Disconnects the interactive event handlers.

Usage Notes
-----------

- The module attempts to import `astropy.wcs` and `astropy.io.fits` for WCS and FITS support, falling back to legacy `pywcs` and `pyfits` if necessary.
- If `APLpy` is installed and enabled, it is used to render the map with FITS header information, providing enhanced plotting features.
- The plotting interface is designed to be flexible and extensible, allowing users to customize the appearance and behavior of the plots.

Author and Date
---------------

- Author: Adam Ginsburg
- Date: March 17, 2011

License and Disclaimer
----------------------

This module is intended for interactive data analysis and exploration. While it can produce publication-quality plots via `APLpy`, its primary focus is on user interaction rather than final figure aesthetics.