Best Effort Callback
====================

The `BestEffortCallback` class provides a flexible and user-friendly callback for live data visualization and tabular display during data acquisition runs. It is designed to work with streaming data, offering real-time plotting, tabular summaries, and baseline data handling with minimal configuration.

Overview
--------

`BestEffortCallback` inherits from `QtAwareCallback` and integrates multiple features to present live data updates effectively:

- Live plotting of hinted fields from data streams.
- Tabular display of primary stream data.
- Baseline data printing.
- Automatic handling of scan metadata and stream descriptors.
- Configurable options to enable or disable specific features.

This callback is particularly useful for interactive data acquisition environments where immediate feedback on data quality and trends is essential.

Usage
-----

Instantiate the callback and attach it to a data acquisition plan or run engine. The callback automatically manages the display of headings, tables, and plots based on the incoming data documents.

Example:

```python
from your_module import BestEffortCallback

bec = BestEffortCallback()
run_engine.subscribe(bec)
```

Features and Configuration
--------------------------

### Heading Display

The callback can print a heading at the start of a run, including the scan ID, timestamp, and unique scan identifier.

- `enable_heading()`: Enable printing the heading.
- `disable_heading()`: Disable printing the heading.

### Table Display

A live table of hinted readings from the primary data stream can be shown.

- `enable_table()`: Enable the live table display.
- `disable_table()`: Disable the live table display.

### Baseline Display

Fields from the 'baseline' stream can be printed for reference.

- `enable_baseline()`: Enable baseline data printing.
- `disable_baseline()`: Disable baseline data printing.

### Plotting

The callback supports live plotting of hinted fields from all streams except those explicitly excluded.

- `enable_plots()`: Enable live plotting.
- `disable_plots()`: Disable all plotting.

### Public Attributes

- `overplot` (bool): If `True`, new data points are overplotted on existing plots.
- `noplot_streams` (list): List of stream names to exclude from plotting (default includes `'baseline'`).
- `omit_single_point_plot` (bool): If `True`, plots are omitted for streams with only a single data point.

Internal Behavior
-----------------

- The callback processes the start document to extract metadata such as motors and dimensions.
- It manages descriptors for each data stream, tracking fields and hints.
- It intelligently decides whether to plot data based on stream name, number of points, and user settings.
- It supports legacy document formats by cleaning up and interpreting hints and dimensions.
- The callback maintains internal state for live plots, grids, scatters, and peak statistics.

Additional Information
----------------------

- The callback uses `PeakResults` to store peak-related data extracted during the run.
- It prints new stream notifications when encountering previously unseen streams.
- The callback is decorated with `make_class_safe` to ensure robust error handling and logging.

Testing
-------

For instructions on testing the `BestEffortCallback` in a simulated environment, please refer to:

```
tests/interactive/best_effort_cb.py
```

This test suite provides examples and validation for the callback's behavior in controlled scenarios.

Dependencies
------------

The callback relies on several external libraries and modules:

- `matplotlib` for plotting.
- `numpy` for numerical operations.
- `cycler` for color cycling in plots.
- Internal modules such as `.core`, `.mpl_plotting`, and `.fitting` for live table, plotting, and peak statistics functionality.

Logging
-------

The callback uses Python's standard `logging` module to report internal events and warnings. It is configured with a logger named after the module's namespace.

Summary
-------

`BestEffortCallback` is a comprehensive and adaptable callback designed to provide immediate visual and tabular feedback during data acquisition. Its configurability and automatic handling of data streams make it a valuable tool for experimental workflows requiring live data monitoring.