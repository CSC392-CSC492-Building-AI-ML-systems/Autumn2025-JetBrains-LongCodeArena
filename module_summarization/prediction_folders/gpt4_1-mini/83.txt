CockroachEngine
===============

The `CockroachEngine` class is an extension of the `PostgresEngine` tailored specifically for use with CockroachDB.

Overview
--------

`CockroachEngine` inherits from `piccolo.engine.postgres.PostgresEngine` and provides additional functionality and configuration suited to CockroachDB's unique behavior and requirements.

Attributes
----------

- **engine_type** (`str`):  
  A string identifier for the engine type. For this class, it is set to `"cockroach"`.

- **min_version_number** (`int`):  
  The minimum supported version number for the engine. This is set to `0` as CockroachDB versioning does not align with this check.

Constructor
-----------

```python
def __init__(
    self,
    config: Dict[str, Any],
    extensions: Sequence[str] = (),
    log_queries: bool = False,
    log_responses: bool = False,
    extra_nodes: Dict[str, CockroachEngine] = None,
) -> None
```

Initializes a new instance of `CockroachEngine`.

Parameters:

- `config` (`Dict[str, Any]`):  
  Configuration dictionary for the database connection.

- `extensions` (`Sequence[str]`, optional):  
  A sequence of extension names to load. Defaults to an empty tuple.

- `log_queries` (`bool`, optional):  
  Whether to log SQL queries executed by the engine. Defaults to `False`.

- `log_responses` (`bool`, optional):  
  Whether to log responses from the database. Defaults to `False`.

- `extra_nodes` (`Dict[str, CockroachEngine]`, optional):  
  A dictionary of additional CockroachEngine instances representing extra nodes in a cluster. Defaults to `None`.

Methods
-------

### `prep_database`

```python
async def prep_database(self) -> None
```

Prepares the CockroachDB database for use by enabling experimental features required by the engine.

This method attempts to execute the following SQL command on a new connection:

```sql
SET CLUSTER SETTING sql.defaults.experimental_alter_column_type.enabled = true;
```

If the database user does not have sufficient privileges to set cluster options, a warning is issued indicating that some CockroachDB functionality may not behave as expected.

Warnings
--------

- If the user lacks permission to set cluster options, a colored warning is displayed:

  ```
  => Unable to set up Cockroach DB functionality may not behave as expected. Make sure your database user has permission to set cluster options.
  ```

Dependencies
------------

- Relies on `asyncpg` for asynchronous PostgreSQL database interactions, loaded lazily.
- Inherits from `PostgresEngine` in the `piccolo.engine.postgres` module.
- Uses utilities from `piccolo.utils.lazy_loader` and `piccolo.utils.warnings` for lazy loading and warning display.

Usage
-----

`CockroachEngine` can be used as a drop-in replacement for `PostgresEngine` when working with CockroachDB, providing additional setup and compatibility features specific to CockroachDB clusters.

Example:

```python
from piccolo.engine.cockroach_engine import CockroachEngine

config = {
    "user": "username",
    "password": "password",
    "database": "mydb",
    "host": "localhost",
    "port": 26257,
}

engine = CockroachEngine(config=config)
await engine.prep_database()
```

This will initialize the engine and prepare the database by enabling necessary cluster settings.