A Quick Dive into Using the ftrack API
======================================

This tutorial provides a brief introduction to using the ftrack API to interact with an ftrack server. The API allows you to create an isolated session, authenticate, and perform operations on the server.

Creating a Session
------------------

To start working with the ftrack API, you first need to create a `Session` object. A session represents an isolated connection to an ftrack server and manages authentication, caching, plugins, and event handling.

Here is a basic example of creating a session:

```python
import ftrack_api

# Create a session by specifying the server URL, API key, and API user.
session = ftrack_api.Session(
    server_url='https://your.ftrack.server',
    api_key='your_api_key',
    api_user='your_username'
)
```

If you do not specify the `server_url`, `api_key`, or `api_user` parameters, the session will attempt to read these values from the environment variables:

- `FTRACK_SERVER` for the server URL
- `FTRACK_API_KEY` for the API key
- `FTRACK_API_USER` for the API user

If these are not set, the session creation will raise an error.

Session Parameters
------------------

- **server_url**: The URL of the ftrack server, including the port if necessary.
- **api_key**: The API key used for authentication.
- **api_user**: The username of the ftrack user.
- **auto_populate**: If `True` (default), entity attributes will be automatically fetched from the server when accessed.
- **plugin_paths**: List of paths to search for plugins. Defaults to the environment variable `FTRACK_EVENT_PLUGIN_PATH`.
- **cache**: A cache instance or callable to manage caching of entities.
- **cache_key_maker**: An object responsible for generating cache keys. Defaults to `StringKeyMaker`.
- **auto_connect_event_hub**: If `True`, the embedded event hub will automatically connect to the event server.
- **schema_cache_path**: Path to cache the schema for faster startup.
- **plugin_arguments**: Optional dictionary of keyword arguments to pass to plugins during registration.

Authentication
--------------

The session uses an internal authentication mechanism that attaches the API key and user information to each request. This is handled by the `SessionAuthentication` class, which adds the necessary headers:

- `ftrack-api-key`
- `ftrack-user`

This ensures that all requests to the server are properly authenticated.

Working with Entities
---------------------

Once a session is established, you can query and manipulate entities on the ftrack server. Entities represent projects, tasks, assets, and other objects managed by ftrack.

Example of querying entities:

```python
# Query all projects
projects = session.query('Project').all()

for project in projects:
    print(project['name'])
```

The `auto_populate` feature ensures that when you access attributes of an entity, they are fetched from the server if not already loaded.

Operations and Recording
------------------------

The session keeps track of operations performed during its lifetime through the `recorded_operations` attribute. By default, operation recording is enabled (`record_operations = True`), allowing you to review or replay actions if needed.

Event Hub
---------

The ftrack API includes an event hub for publishing and subscribing to events. If `auto_connect_event_hub` is enabled, the event hub connects automatically in a background thread, allowing you to handle non-local events.

You can also manually connect or disconnect the event hub:

```python
session.event_hub.connect()
```

Caching
-------

The API supports caching to improve performance and reduce server load. By default, a layered cache is used with a memory cache at the top level. You can provide your own cache implementation or configure caching behavior through the session parameters.

Schema caching can be enabled by specifying a `schema_cache_path`, which stores the schema locally for faster session startup.

Summary
-------

- Create a `Session` to connect and authenticate with an ftrack server.
- Use environment variables or explicit parameters for configuration.
- Query and manipulate entities using the session.
- Take advantage of automatic attribute population and caching.
- Use the event hub to handle events.
- Manage operations and plugins through the session.

This quick dive should help you get started with the ftrack API and begin integrating it into your workflows. For more detailed information, refer to the full API documentation and examples.