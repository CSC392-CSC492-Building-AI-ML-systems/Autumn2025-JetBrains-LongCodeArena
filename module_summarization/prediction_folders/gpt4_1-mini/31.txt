w_red Command
=============

Overview
--------
The `w_red` command provides tools for calculating rate constants from WESTPA simulation data, including raw and RED (Rate from Event Durations) corrected rates. The RED correction accounts for the distribution of event durations to improve the accuracy of rate estimates.

Key Features
------------
- Calculation of raw rate constants from simulation data.
- Application of RED correction factors based on event duration histograms.
- Support for confidence interval estimation.
- Efficient computation of rate constants over multiple iterations.

Usage
-----
The `w_red` command operates on WESTPA kinetics data stored in HDF5 files and requires specification of initial and final states for rate calculation.

Main Components
---------------

DurationCorrector Class
~~~~~~~~~~~~~~~~~~~~~~~
The `DurationCorrector` class computes correction factors for rate constants based on the distribution of event durations between specified states.

- **Initialization**: Can be created from a kinetics HDF5 file, initial state (`istate`), final state (`fstate`), and timestep `dtau`.
- **Correction Calculation**: Computes a correction factor that adjusts raw rate constants by integrating over the event duration histogram.
- **Properties**:
  - `event_duration_histogram`: Histogram of event durations weighted by walker weights.
  - `cumulative_event_duration_histogram`: Cumulative integral of the event duration histogram.

Methods:
- `from_kinetics_file(directh5, istate, fstate, dtau, n_iters=None)`: Creates a `DurationCorrector` instance from a kinetics file.
- `correction(iters, freqs=None)`: Returns the RED correction factor for the specified iterations and optional frequency weights.

Functions
~~~~~~~~~

- `calc_avg_rate(directh5_path, istate, fstate, **kwargs)`

  Calculates the average rate constant between `istate` and `fstate` from the kinetics data file.

  Arguments:
  - `directh5_path`: Path to the kinetics HDF5 file.
  - `istate`: Initial state index.
  - `fstate`: Final state index.
  - `dt`: Timestep in picoseconds (ps).
  - `nstiter`: Duration of each iteration (number of steps).
  - `ntpr`: Report interval (number of steps).
  - `n_iters`: Number of iterations to consider (optional).
  - `red`: Boolean flag to apply RED correction (default: False).
  - `callback`: Optional callback function to receive intermediate results.

  Returns:
  - The rate constant corrected by RED if requested, otherwise the raw rate.

- `calc_rates(directh5_path, istate, fstate, **kwargs)`

  Computes raw and RED-corrected rate constants as a function of iteration number. This function is optimized for performance compared to repeated calls to `calc_avg_rate`.

Additional Details
------------------
The RED correction factor is computed by integrating a normalized event duration distribution weighted by walker weights and adjusted for the maximum observed duration. This approach accounts for the finite observation window and improves rate constant estimates, especially in systems with broad event duration distributions.

References
----------
For more information on the RED method and its implementation, please refer to the WESTPA documentation and relevant literature on rate estimation from event durations.

---

This documentation provides an overview of the `w_red` command and its associated classes and functions for rate constant calculation and RED correction in WESTPA simulations.