w_run Command
=============

Overview
--------
The `w_run` command is used to start or continue a WEST simulation. It manages the execution of the simulation by coordinating the various components such as the system driver, data manager, propagator, and work manager. This command is essential for running WESTPA simulations, handling the setup, execution, and finalization phases.

Usage
-----
```
w_run [OPTIONS]
```

Options
-------
- `--oneseg`  
  Run only one segment of the simulation. This option is primarily useful for debugging propagators by limiting the simulation to a single segment.

- Additional options are available through WESTPA's runtime configuration and the work manager environment, which can be viewed by running `w_run --help`.

Functionality
-------------
When executed, `w_run` performs the following steps:

1. **Argument Parsing and Configuration**  
   Parses command-line arguments, including WESTPA runtime configuration options and work manager-specific arguments. These configurations are processed to set up the simulation environment.

2. **Work Manager Initialization**  
   Creates and initializes a work manager instance responsible for managing parallel execution and task distribution.

3. **Component Setup**  
   Loads and configures key simulation components:
   - **Simulation Manager**: Orchestrates the simulation workflow.
   - **System Driver**: Represents the physical system being simulated.
   - **Data Manager**: Handles data storage and retrieval.
   - **WE Driver**: Manages weighted ensemble simulation specifics.
   - **Propagator**: Advances the system state during simulation.

   These components are interconnected, with the propagator, data manager, and WE driver linked to the system driver, and the simulation manager coordinating all components.

4. **Simulation Execution**  
   Within the context of the work manager:
   - If running as the master process:
     - Installs signal handlers for graceful interruption.
     - Loads any simulation plugins.
     - Prepares the simulation run.
     - Executes the simulation run.
     - Finalizes the simulation after completion.
     - Handles interruptions (e.g., keyboard interrupts) and exceptions by logging appropriate messages and shutting down cleanly.
   - If running as a worker process:
     - Executes assigned tasks as directed by the work manager.

Logging and Error Handling
--------------------------
The `w_run` command uses Python's logging module to provide debug-level information about the simulation's progress, including preparation, execution, and finalization stages. Errors and exceptions are logged with detailed traceback information to aid in troubleshooting.

Interruptions such as keyboard interrupts are caught to allow for a clean shutdown of the simulation.

Summary
-------
`w_run` is the primary command for running WESTPA simulations, providing a robust and flexible interface to manage simulation execution. It integrates configuration management, parallel work distribution, and component coordination to facilitate efficient and controlled simulation workflows.