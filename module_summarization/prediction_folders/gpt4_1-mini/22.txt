w_fluxanl — Flux Analysis Tool for WEST Simulations
====================================================

Description
-----------

`w_fluxanl` is a command-line tool designed to extract fluxes into pre-defined target states from WEST simulation data. It computes averages and constructs confidence intervals for these fluxes using Monte Carlo bootstrapping. This approach accounts for correlated and potentially non-Gaussian statistical errors in flux measurements, providing robust uncertainty quantification.

The tool supports data from different versions of the WEST HDF5 file format, adapting its extraction method accordingly. For older file versions (prior to version 7), fluxes are extracted from recycling tables within iteration groups. For version 7 and later, fluxes are obtained from the "new_weights" group of the iteration following recycling events.

Key Features
------------

- Extraction of flux values from WEST HDF5 data files over specified iteration ranges.
- Support for multiple file format versions, ensuring compatibility with legacy and current data.
- Monte Carlo bootstrapping to estimate confidence intervals, accounting for statistical correlations and non-Gaussian distributions.
- Output includes average fluxes, confidence interval bounds, and correlation lengths.
- Handles multiple target states, identified by name or index.
- Outputs results in HDF5 format and to the terminal.
- Assumes the propagation/resampling period (τ) equals unity for non-graphical outputs; users should scale fluxes and correlation lengths by the true τ value to obtain physical units.

Usage
-----

The `w_fluxanl` tool is invoked from the command line with various options to specify input data, iteration ranges, and output preferences.

Basic command structure:

```
w_fluxanl [OPTIONS]
```

Options include:

- Data input specification (e.g., WEST HDF5 file location).
- Iteration range selection for analysis.
- Output file and group naming.
- Parameters controlling the bootstrap confidence interval calculation.
- Options to control the evolution analysis over iterations.

Flux Extraction Methodology
---------------------------

The tool extracts flux data differently depending on the WEST HDF5 file version:

- **File versions < 7**: Fluxes are extracted from the 'recycling' table within iteration groups. The flux field name depends on the file version (`weight` for versions < 5, `flux` otherwise).

- **File version ≥ 7**: Fluxes are extracted from the "new_weights" group of the iteration following recycling events. The tool identifies recycled weights by checking the source type and target state ID, summing weights to compute fluxes per target state.

Data Structures
---------------

- **fluxentry_dtype**: A NumPy structured dtype representing flux entries with fields:
  - `n_iter`: iteration number
  - `flux`: flux value (weight)
  - `count`: number of recycling events or samples

- **target_index_dtype**: Structured dtype for target state flux statistics, including:
  - `target_label`: target state name
  - `mean_flux`: average flux
  - `mean_flux_ci_lb`: lower bound of confidence interval
  - `mean_flux_ci_ub`: upper bound of confidence interval
  - `mean_flux_correl_len`: correlation length of flux measurements

Output
------

The tool produces:

- Terminal output summarizing flux averages and confidence intervals.
- HDF5 files containing detailed flux data and statistics organized by target states.
- Data suitable for further analysis or visualization.

Notes
-----

- All non-graphical outputs assume the propagation/resampling period τ = 1. To convert fluxes and correlation lengths to physical units, multiply fluxes by τ and correlation lengths by τ accordingly.
- The tool uses Monte Carlo bootstrapping to handle statistical uncertainties, which is particularly important for correlated and non-Gaussian data typical in WEST simulations.

For detailed usage instructions and options, run:

```
w_fluxanl --help
```

or consult the WESTPA documentation.