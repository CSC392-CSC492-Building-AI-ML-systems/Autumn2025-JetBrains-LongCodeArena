Executing notebooks
===================

The `ExecutePreprocessor` class allows you to execute all the code cells in a Jupyter notebook programmatically. It is a preprocessor that runs each code cell, captures the outputs, and updates the notebook accordingly.

Class: `ExecutePreprocessor`
----------------------------

`ExecutePreprocessor` inherits from both `Preprocessor` and `NotebookClient` to provide seamless execution capabilities integrated with nbconvert's preprocessing framework.

### Initialization

```python
ExecutePreprocessor(**kwargs)
```

- `nb` (optional): A `NotebookNode` object representing the notebook to be executed. If not provided, an empty notebook node is created.
- Additional keyword arguments are passed to both `Preprocessor` and `NotebookClient`.

### Methods

#### preprocess(nb, resources=None, km=None)

Executes all the code cells in the notebook.

- **Parameters:**
  - `nb` (`NotebookNode`): The notebook to execute. This notebook is modified in-place.
  - `resources` (dict, optional): Additional resources used in the conversion process. For example, passing `{'metadata': {'path': run_path}}` sets the execution path to `run_path`.
  - `km` (`KernelManager`, optional): An optional kernel manager. If none is provided, a new kernel manager will be created.

- **Returns:**
  - `nb` (`NotebookNode`): The executed notebook with updated outputs.
  - `resources` (dict): Additional resources used in the conversion process.

- **Description:**
  This method initializes the kernel client, executes each code cell in order, updates the notebook metadata with kernel language information, and sets widget metadata if applicable. It resets execution state before running and ensures proper kernel setup and teardown.

#### preprocess_cell(cell, resources, index)

Executes a single code cell.

- **Parameters:**
  - `cell` (`NotebookNode`): The notebook cell to execute.
  - `resources` (dict): Additional resources used in the conversion process.
  - `index` (int): The index of the cell in the notebook.

- **Returns:**
  - `cell` (`NotebookNode`): The executed cell with updated outputs.
  - `resources` (dict): Additional resources used in the conversion process.

- **Description:**
  This method executes the given cell and returns the updated cell and resources. It can be overridden to customize cell-level preprocessing.

### Usage Example

```python
from nbformat import read, write, NO_CONVERT
from nbconvert.preprocessors import ExecutePreprocessor

with open("notebook.ipynb") as f:
    nb = read(f, as_version=NO_CONVERT)

ep = ExecutePreprocessor(timeout=600, kernel_name='python3')
nb, resources = ep.preprocess(nb, resources={'metadata': {'path': './'}})

with open("executed_notebook.ipynb", "w") as f:
    write(nb, f)
```

Deprecated Function
-------------------

The module also provides a deprecated function `executenb` which was moved to `nbclient.execute`. It is recommended to import and use `nbclient.execute` directly for executing notebooks.

```python
from nbclient import execute

# Instead of using executenb from nbconvert.preprocessors.execute
execute(nb, **kwargs)
```

Notes
-----

- The `ExecutePreprocessor` modifies the notebook in-place.
- Kernel management is handled internally, but you can provide a custom `KernelManager` if needed.
- Execution errors raise `CellExecutionError` exceptions.
- The preprocessor updates the notebook metadata with kernel language information after execution.
- Widget metadata is set if widgets are present in the notebook.

This preprocessor is useful for running notebooks programmatically, for example, during automated testing, batch processing, or converting notebooks to other formats with executed outputs.