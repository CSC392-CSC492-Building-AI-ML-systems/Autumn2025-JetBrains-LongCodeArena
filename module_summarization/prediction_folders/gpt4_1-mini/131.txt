Verification of FITS Data
=========================

This document describes the verification scheme implemented in the `astropy.io.fits` package to ensure the integrity and correctness of FITS (Flexible Image Transport System) data. Verification is a critical step in validating FITS files, checking for compliance with the FITS standard, and optionally fixing detected issues.

Overview
--------

The verification framework is built around a set of classes and methods designed to identify errors and warnings in FITS data. It supports multiple levels of response to verification results, including ignoring issues, issuing warnings, raising exceptions, and automatically fixing fixable problems.

Key Components
--------------

### Exceptions and Warnings

- **VerifyError**: Exception class raised when verification encounters errors that cannot be ignored or fixed.
- **VerifyWarning**: Warning class used to issue warnings during verification without interrupting execution.

### Verification Options

Verification behavior is controlled by the `option` parameter, which can take the following values:

- `"ignore"`: Do not report or fix any issues.
- `"warn"`: Issue warnings for detected problems.
- `"exception"`: Raise exceptions for detected problems.
- `"fix"`: Attempt to fix fixable problems and raise exceptions for unfixable ones.
- `"silentfix"`: Attempt to fix fixable problems silently without reporting; raise exceptions for unfixable ones.
- Combinations such as `"fix+warn"`, `"fix+ignore"`, `"silentfix+warn"`, etc., allow fine-grained control over fixing and reporting behavior.

Verification Process
--------------------

The verification process is initiated by calling the `verify` method on a FITS object or component, passing the desired verification option. The method performs the following steps:

1. **Option Validation**: Ensures the provided option is recognized.
2. **Verification Execution**: Calls internal verification routines to collect errors and warnings.
3. **Error Handling**: Depending on the option, errors are either ignored, warned about, raised as exceptions, or fixed.
4. **Fixing Issues**: If the option includes fixing, fixable errors are corrected automatically.
5. **Reporting**: Issues are reported according to the specified option, with support for silent fixing.

Error Reporting Structure
-------------------------

Verification errors are managed using a nested list structure (`_ErrList`) that organizes messages hierarchically according to the FITS data structure levels. This allows clear and indented reporting of errors at different levels, such as HDUs, headers, and data units.

The error list supports filtering and indentation to produce readable output, facilitating debugging and correction of FITS files.

Usage Example
-------------

```python
from astropy.io import fits

hdulist = fits.open('example.fits')
try:
    hdulist.verify('fix+warn')
except fits.VerifyError as e:
    print("Verification failed:", e)
```

In this example, the FITS file is opened and verified with the option to fix fixable errors and warn about others. If unfixable errors are found, an exception is raised.

Notes
-----

- Verification uses zero-based indexing when reporting locations within FITS files.
- The verification scheme is designed to be extensible and is used internally by various FITS classes.
- Users can customize verification behavior to suit their needs by selecting appropriate options.

See Also
--------

- `astropy.io.fits` — FITS file handling in Astropy
- `astropy.io.fits.verify` — Verification options and usage

License
-------

This verification scheme is licensed under a 3-clause BSD style license. See the `PYFITS.rst` file for details.