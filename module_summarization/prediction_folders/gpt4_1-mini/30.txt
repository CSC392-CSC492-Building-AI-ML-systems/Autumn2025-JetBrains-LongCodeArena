w_pdist â€” Calculate time-resolved, multi-dimensional probability distributions of WE datasets
===============================================================================================

Description
-----------

The `w_pdist` command calculates time-resolved, multi-dimensional probability distributions of weighted ensemble (WE) datasets.

Source data
-----------

Source data can be provided in one of the following ways:

- **User-specified function** (`--construct-dataset`):  
  Specify a Python function in `MODULE.FUNCTION` syntax. This function will be called as `function(n_iter, iter_group)`, where `n_iter` is the iteration number and `iter_group` is the corresponding group in the main WEST HDF5 file (`west.h5`). The function must return data indexable as `[segment][timepoint][dimension]`.

- **List of data set specifications** (`--dsspecs`):  
  Provide a list of dataset specifications formatted as `NAME[,file=FILENAME,slice=SLICE]`. This will use the dataset called `NAME` in the HDF5 file `FILENAME` (defaulting to the main WEST HDF5 file `west.h5`), optionally sliced with the Python slice expression `SLICE` (e.g., `[0:2]` to select the first two elements of the first axis). This is useful for selecting specific columns from multi-column datasets, such as multi-dimensional progress coordinates.

- **Default dataset**:  
  If neither a custom function nor dataset specifications are provided, the progress coordinate dataset `pcoord` is used by default.

Histogram binning
-----------------

By default, histograms are constructed with 100 bins in each dimension. This can be customized using the `-b` or `--bins` option, which accepts several argument formats:

- **Single integer N**:  
  Use `N` uniformly spaced bins in each dimension.

- **Sequence of integers N1,N2,...**:  
  Use `N1` bins for the first dimension, `N2` for the second, and so on.

- **List of lists of bin boundaries**:  
  Provide explicit bin boundaries as `[[B11, B12, B13, ...], [B21, B22, B23, ...], ...]` for each dimension. These boundaries need not be uniformly spaced and are evaluated using Python's `eval` with `np` (NumPy) available, allowing expressions like `np.arange()`.

Note that the first two forms (integer or list of integers) trigger a scan of all data to determine minimum and maximum values in each dimension, which may be computationally expensive for large datasets. Providing explicit bin boundaries avoids this scan.

**Important:** These bins are unrelated to the bins used to drive WE sampling.

Output format
-------------

The output file (specified by `-o` or `--output`, default `"pdist.h5"`) contains the following datasets:

- **`histograms`**:  
  Normalized histograms with the first axis corresponding to iteration number, and subsequent axes corresponding to the dimensions of the input dataset.

- **`/binbounds_0`, `/binbounds_1`, ...**:  
  Vectors of bin boundaries for each dimension.

- **`/midpoints_0`, `/midpoints_1`, ...**:  
  Vectors of bin midpoints for each dimension.

- **`n_iter`**:  
  Vector of iteration numbers corresponding to the stored histograms.

Subsequent processing
---------------------

The output file can be used with the `plothist` program to generate plots or other processed outputs. See `plothist --help` for more information.

Parallelization
---------------

`w_pdist` supports parallelized binning and input data reading. Parallel processing is enabled by default. For simple cases with pre-computed input data and modest segment counts, serial processing (`--serial`) may be more efficient.

Command-line options
--------------------

Run `w_pdist --help` to see all available command-line options and their descriptions.