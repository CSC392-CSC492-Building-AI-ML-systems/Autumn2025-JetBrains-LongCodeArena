Generalized Linear Mixed Models (MixedGLM) Module
==================================================

Overview
--------

This module provides tools for Bayesian inference in generalized linear mixed models (GLMMs). It currently supports families without additional scale or shape parameters, specifically binomial and Poisson families.

Two primary estimation approaches are implemented:

- **Laplace Approximation**: Also known as maximum a posteriori (MAP) estimation.
- **Variational Bayes**: A mean field approximation to the posterior distribution.

The module assumes that all realizations of random effects are mutually independent.

Random Effects Design
---------------------

The design matrix for the random effects is represented by `exog_vc`. Each column of `exog_vc` corresponds to an independent realization of a random effect, which is assumed to have mean zero and an unknown standard deviation. The standard deviation parameters are constrained to be equal within subsets of columns. These subsets are specified by the `ident` parameter when formulas are not used. The `ident` array must have the same length as the number of columns in `exog_vc`, and columns sharing the same `ident` value share the same standard deviation.

When using formulas, the columns of `exog_vc` derived from a common formula are constrained to have the same standard deviation.

In many applications, `exog_vc` is sparse. The module accepts sparse matrices for `exog_vc` and will convert dense matrices to sparse internally. However, when using formulas, a temporary dense version of `exog_vc` is created internally.

Model and Parameterization
--------------------------

The joint density of the data and parameters factors as:

.. math::

    p(y | vc, fep) \, p(vc | vcp) \, p(vcp) \, p(fe)

where:

- :math:`y` is the observed data,
- :math:`vc` are the random effects realizations,
- :math:`fep` are the fixed effects parameters,
- :math:`vcp` are the variance component parameters (log standard deviations),
- :math:`fe` are the fixed effects parameters.

The prior distributions :math:`p(vcp)` and :math:`p(fe)` are Gaussian. The variance component parameters are modeled on the log scale, so their standard deviations have log-normal distributions. The random effects distribution :math:`p(vc | vcp)` is an independent Gaussian distribution, with independence assumed both within and between groups defined by `ident`. The model likelihood :math:`p(y | vc, fep)` depends on the specific GLM family being fit.

Fitting Methods
---------------

The module provides two fitting methods:

- **fit_map**: Fits the model using the Laplace approximation to the posterior distribution (maximum a posteriori estimation).
- **fit_vb**: Fits the model using a variational Bayes approximation to the posterior distribution.

Both methods estimate the fixed effects, random effects realizations, and variance component parameters.

Parameters
----------

- **endog** : array_like  
  Vector of response values.

- **exog** : array_like  
  Covariates for the fixed effects part of the model.

- **exog_vc** : array_like or sparse matrix  
  Covariates for the random effects part of the model. Sparse matrices are supported and preferred.

- **ident** : array_like  
  Integer labels indicating which random effect columns share a common variance.

- **vcp_p** : float  
  Prior standard deviation for variance component parameters (log standard deviations).

- **fe_p** : float  
  Prior standard deviation for fixed effects parameters.

- **family** : statsmodels.genmod.families instance  
  The GLM family (e.g., Binomial, Poisson).

- **fep_names** : list of strings, optional  
  Names of fixed effects parameters.

- **vcp_names** : list of strings, optional  
  Names of variance component parameters.

- **vc_names** : list of strings, optional  
  Names of random effect realizations.

Notes
-----

- The posterior distribution includes three types of parameters: fixed effects parameters (fep), random effects realizations (vc), and variance component parameters (vcp).
- Random effects are modeled as independent Gaussian variables with zero mean and variance determined by the variance components.
- The variance components are shared among random effects according to the `ident` labels.
- The prior for variance components is log-normal with mean zero and standard deviation `vcp_p`.
- The prior for fixed effects is Gaussian with mean zero and standard deviation `fe_p`.
- For some families, such as Binomial, the posterior mode may be difficult to find if `vcp_p` is set too large; a value around 0.5 is recommended.
- Sparse matrices are supported for random effects design matrices to improve computational efficiency.

References
----------

- Introduction to generalized linear mixed models:  
  https://stats.idre.ucla.edu/other/mult-pkg/introduction-to-generalized-linear-mixed-models

- SAS documentation on mixed models:  
  https://support.sas.com/documentation/cdl/en/statug/63033/HTML/default/viewer.htm#statug_intromix_a0000000215.htm

- An assessment of estimation methods for generalized linear mixed models with binary outcomes:  
  https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3866838/