Getting Started with Mitogen
=============================

Introduction
------------

Mitogen is a Python library designed to simplify the creation and management of remote and local processes, enabling efficient and scalable distributed computing. It provides a framework for spawning child contexts, managing inter-process communication, and handling system-level operations such as PTY allocation and signal management.

This tutorial will guide you through the basics of using Mitogen, focusing on its core features and how to get started with creating and managing child processes.

Key Concepts
------------

- **Context**: A Mitogen context represents an execution environment, which can be local or remote. Child contexts can be spawned from a master or parent context.
- **Broker**: The central component that manages communication between contexts.
- **PTY (Pseudo Terminal)**: Used for terminal emulation, Mitogen handles PTY allocation and management, including error handling when system limits are reached.
- **Pre-exec Hook**: A hook function that can be set to run just before a child process is executed, useful for setting process affinity or other pre-execution configurations.

Installation
------------

Mitogen requires Python 2.7 or later (including Python 3.x). Ensure you have Python installed on your system. Mitogen handles compatibility across Python versions internally.

Basic Usage
-----------

1. **Importing Mitogen Core**

   Begin by importing the core Mitogen module:

   ```python
   import mitogen.core
   ```

2. **Spawning a Child Context**

   Mitogen allows you to spawn child contexts which can execute code independently. This is useful for parallel execution or remote command execution.

3. **Handling PTYs**

   Mitogen manages PTYs for child processes. If the system limit for PTYs is reached, Mitogen will raise an error with a message suggesting how to increase the limit on your operating system.

4. **Logging and Debugging**

   Mitogen uses Pythonâ€™s standard logging module. You can configure the logging level to control the verbosity of output:

   ```python
   import logging
   logging.basicConfig(level=logging.INFO)
   ```

5. **System Executable Detection**

   Mitogen attempts to detect the Python executable path (`sys.executable`). If it cannot determine this, it defaults to `/usr/bin/python` and logs a warning.

Advanced Features
-----------------

- **Signal Handling**

  Mitogen maps signal numbers to their names for easier debugging and management of signals in child processes.

- **Thread Safety**

  Mitogen uses threading locks to ensure thread-safe operations when accessing shared resources such as source code caching.

- **Source Code Minification**

  For performance, Mitogen can minify its core source code before sending it to child contexts, reducing overhead during recursive connections.

Error Handling
--------------

- **PTY Allocation Failure**

  If Mitogen fails to allocate a PTY, it will provide a detailed error message indicating the likely cause and suggestions for resolution, such as increasing system limits.

- **Broker Shutdown**

  When the broker begins to shut down, Mitogen cancels connections gracefully, providing a clear shutdown message.

Customization
-------------

- **Pre-exec Hook**

  You can define a function to be called just before a child process is executed. This is useful for setting CPU affinity or other process-specific settings.

  ```python
  def my_preexec_hook():
      # Custom setup before exec
      pass

  mitogen.core._preexec_hook = my_preexec_hook
  ```

Conclusion
----------

Mitogen provides a powerful and flexible framework for managing processes and communication in Python applications. By understanding its core concepts and features, you can leverage Mitogen to build scalable and efficient distributed systems.

For more detailed examples and advanced usage, refer to the official Mitogen documentation and source code.