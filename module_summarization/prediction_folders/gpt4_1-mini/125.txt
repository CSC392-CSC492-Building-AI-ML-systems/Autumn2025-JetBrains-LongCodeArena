FITS Headers Documentation
==========================

Overview
--------

This module provides classes and utilities for handling and verifying FITS (Flexible Image Transport System) headers. FITS headers contain metadata describing the contents and structure of FITS files, which are widely used in astronomy for storing image and tabular data.

Verification Framework
----------------------

The verification framework ensures that FITS headers conform to expected standards and formats. It provides mechanisms to check header values, report issues, and optionally fix problems automatically.

### Verification Options

Verification behavior can be controlled using various options:

- **ignore**: Do not report or fix any issues.
- **warn**: Report issues as warnings.
- **exception**: Raise exceptions on verification failures.
- **fix**: Attempt to fix fixable issues and report unfixable ones as exceptions.
- **silentfix**: Attempt to fix fixable issues silently without reporting.
- Combinations such as **fix+warn**, **silentfix+exception**, etc., allow fine-grained control over fixing and reporting.

### Key Classes

#### VerifyError

An exception class raised when verification fails and the chosen option is to raise exceptions.

#### VerifyWarning

A warning class used to issue warnings during verification.

#### _Verify

A mixin class providing shared verification methods. It includes:

- `verify(option="warn")`: Runs verification on the instance with the specified option.
- `run_option(option, err_text, fix_text, fix, fixable)`: Executes verification logic based on the option, optionally fixing issues.

The `verify` method processes verification results, handles fix attempts, and reports or raises errors according to the selected option.

#### _ErrList

A specialized list class for collecting verification errors. It supports nested error messages with hierarchical indentation to represent errors at different levels of the header structure.

- `iter_lines(filter=None, shift=0)`: Iterates over error messages with indentation.
- Errors can be filtered and formatted for display or logging.

NotifierMixin
-------------

The `NotifierMixin` class provides an internal mechanism for objects to notify registered listeners about changes. This is useful for keeping different parts of the FITS header handling system synchronized.

- Listeners are registered with weak references to avoid memory leaks.
- Notifications are sent by calling `_notify(change_type, *args, **kwargs)`, which invokes corresponding update methods on listeners.
- This mixin is intended for internal use and is not part of the public API.

Usage Example
-------------

```python
class Header(_Verify, NotifierMixin):
    def __init__(self):
        # Initialize header data
        pass

    def _verify(self, option):
        # Implement verification logic specific to the header
        errors = _ErrList(unit="Card")
        # Add errors or fix issues here
        return errors

header = Header()
header.verify(option="fix+warn")
```

This example demonstrates how a FITS header class might inherit from `_Verify` and use the verification framework to check and fix header issues, reporting warnings as appropriate.

Notes
-----

- Verification messages use zero-based indexing for elements.
- The verification system is designed to be extensible and customizable for different FITS header implementations.
- The module is licensed under a 3-clause BSD style license.

For more detailed information on verification options and usage, see the Astropy documentation on verification: :ref:`astropy:verify`.