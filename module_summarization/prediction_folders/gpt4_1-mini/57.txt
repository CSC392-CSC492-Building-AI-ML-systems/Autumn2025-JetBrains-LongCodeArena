Mixed Linear Models (:mod:`statsmodels.regression.mixed_linear`)
==================================================================

Linear mixed effects models are regression models designed for dependent data, allowing estimation of regression relationships involving both means and variances. These models are also known as multilevel linear models or hierarchical linear models.

Overview
--------

The core class in this module, `MixedLM`, fits linear mixed effects models to data and supports common post-estimation tasks. This implementation is group-based and is most efficient when the data can be partitioned into independent groups. Some models with crossed effects can be handled by specifying a model with a single group.

Model Specification
-------------------

The data are partitioned into disjoint groups indexed by \(i\). For group \(i\), the model is specified as:

\[
Y = X \beta + Z \gamma + \epsilon
\]

where:

- \(n_i\) is the number of observations in group \(i\).
- \(Y\) is an \(n_i\)-dimensional response vector (called `endog` in `MixedLM`).
- \(X\) is an \(n_i \times k_{fe}\) design matrix for the fixed effects (called `exog`).
- \(\beta\) is a \(k_{fe}\)-dimensional vector of fixed effects parameters (called `fe_params`).
- \(Z\) is the design matrix for the random effects with \(n_i\) rows (called `exog_re`). The number of columns in \(Z\) can vary by group.
- \(\gamma\) is a random vector with mean zero. The covariance matrix for the first \(k_{re}\) elements of \(\gamma\) (called `cov_re`) is common to all groups. The remaining elements correspond to variance components. Each group has its own independent realization of \(\gamma\).
- \(\epsilon\) is an \(n_i\)-dimensional vector of independent and identically distributed normal errors with mean zero and variance \(\sigma^2\). The \(\epsilon\) values are independent both within and between groups.

All of \(Y\), \(X\), and \(Z\) must be fully observed. The parameters \(\beta\), \(\Psi\) (covariance of random effects), and \(\sigma^2\) are estimated using maximum likelihood (ML) or restricted maximum likelihood (REML). The vectors \(\gamma\) and \(\epsilon\) are random and define the probability model.

The marginal mean structure is given by:

\[
E[Y \mid X, Z] = X \beta
\]

If only the mean structure is of interest, generalized estimating equations (GEE) may be an alternative.

Random Effects
--------------

Two types of random effects are supported:

1. **Standard random effects:** These are correlated with each other arbitrarily. Every group has the same number \(k_{re}\) of standard random effects, sharing the same joint distribution but with independent realizations across groups.

2. **Variance components:** These are uncorrelated with each other and with the standard random effects. Each variance component has mean zero, and all realizations of a given variance component share the same variance parameter. The number of realized variance components per variance parameter can differ across groups.

Parameterizations
-----------------

Three parameterizations are used in different contexts:

- **User parameterization:** The covariance of the response is \(\text{scale} \times I + Z \, \text{cov_re} \, Z'\). This is the main parameterization visible to users.

- **Profile parameterization:** The covariance is \(I + Z \, \text{cov_re1} \, Z'\). This parameterization is used in the profile likelihood maximization for parameter estimation. The user parameterization relates to this by \(\text{cov_re} = \text{cov_re1} \times \text{scale}\).

- **Square root parameterization:** The Cholesky factor of \(\text{cov_re1}\) is used instead of \(\text{cov_re}\) directly. This is hidden from the user.

The parameters can be packed into a vector by concatenating the fixed effects parameters (`fe_params`), the lower triangle or Cholesky square root of the dependence structure, and the variance parameters for the variance components. When unpacking, care must be taken to square or reflect the dependence structure depending on the parameterization.

Estimation and Optimization
---------------------------

The likelihood, gradient, and Hessian calculations closely follow Lindstrom and Bates (1988), adapted to support variance components. The numerical optimization uses generalized least squares (GLS) to avoid explicitly optimizing over the fixed effects parameters. The likelihood optimized is profiled over both the scale parameter and the fixed effects parameters.

Because of this profiling, the Hessian of the profiled log-likelihood is not calculated, and optimization methods requiring the Hessian (e.g., Newton-Raphson) cannot be used for model fitting.

Scores are computed in two ways:

- With respect to the elements of the random effects covariance matrix (used for inference after MLE convergence).
- With respect to the parameters of the Cholesky square root of the random effects covariance matrix (used during optimization).

References
----------

- Lindstrom, M. J., & Bates, D. M. (1988). Newton-Raphson and EM algorithms for linear mixed-effects models for repeated-measures data. *Journal of the American Statistical Association*, 83(404), 1014â€“1022.

- [Mixed Effects Models Implementation Details](http://econ.ucsb.edu/~doug/245a/Papers/Mixed%20Effects%20Implement.pdf)

User-Oriented Documentation
---------------------------

- [Linear Mixed-Effects Models using lme4](http://lme4.r-forge.r-project.org/lMMwR/lrgprt.pdf)

- [Longitudinal Data Analysis Slides](http://lme4.r-forge.r-project.org/slides/2009-07-07-Rennes/3Longitudinal-4.pdf)

Notes
-----

- `cov_re` is the random effects covariance matrix (denoted \(\Psi\)).

- `scale` is the scalar error variance \(\sigma^2\).

- For a single group, the marginal covariance matrix of the response given the design matrices is:

\[
\text{scale} \times I + Z \, \text{cov_re} \, Z'
\]

- `vcomp` is a vector of variance parameters, whose length depends on the number of variance components specified via the `exog_vc` or `vc_formula` arguments in `MixedLM`.

- The module supports both dense and sparse matrix operations for efficiency.

Summary
-------

This module provides tools for fitting and analyzing linear mixed effects models, supporting complex variance structures and efficient estimation methods. It is suitable for hierarchical or grouped data where both fixed and random effects are present.