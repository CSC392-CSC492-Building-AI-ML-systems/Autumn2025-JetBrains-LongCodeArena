PyTables File Format
====================

Overview
--------

PyTables is a package for managing hierarchical datasets and designed to efficiently and easily cope with extremely large amounts of data. It is built on top of the HDF5 library and NumPy package, providing a high-level interface to store and retrieve large datasets.

The PyTables file format is based on the HDF5 format, which organizes data in a filesystem-like hierarchy of groups and datasets. PyTables extends this with additional metadata and indexing structures to optimize data access and manipulation.

File Structure
--------------

A PyTables file consists of a hierarchy of nodes, which can be groups or leaves:

- **Groups**: Containers that can hold other groups or leaves, similar to directories.
- **Leaves**: Data containers such as tables, arrays, or columns.

Each node has a pathname that uniquely identifies it within the file hierarchy.

Indexing in PyTables
--------------------

PyTables supports indexing of table columns to speed up data retrieval. The indexing information is stored in special nodes called **Index** nodes, which are descendants of the Group class with added functionality.

### Index Nodes

An Index node represents the index of a column in a table. It is always associated with exactly one column in a table and maintains the indexing information for that column.

#### Key Attributes

- **kind**: Specifies the kind of index, which determines the granularity and size of the index data. Possible kinds are:
  - `ultralight` (8-bit)
  - `light` (16-bit)
  - `medium` (32-bit)
  - `full` (64-bit)

- **filters**: Defines the compression and other I/O filters applied to the index data. By default, indexes use compression filters such as zlib with level 1 compression and shuffle enabled.

- **dirty**: A boolean flag indicating whether the index is out of sync with the column data. Dirty indexes exist but are not usable until they are updated.

- **column**: The Column object associated with this index.

- **table**: The Table object to which the indexed column belongs.

#### Index Data Organization

Indexes are organized in compound blocks with several hierarchical levels:

- **Superblocks**: The largest blocks, each containing multiple blocks.
- **Blocks**: Contain multiple slices.
- **Slices**: Contain multiple chunks.
- **Chunks**: The smallest units of data in the index.

The sizes of these blocks and slices are parameters that affect the performance and storage of the index.

Index Versioning and Optimization
---------------------------------

PyTables maintains versioning for index objects to ensure compatibility and performance improvements. The current version of indexes is 2.1, which includes enhancements over previous versions.

Indexes support different optimization levels (`optlevel`) that control the trade-off between index size and search speed.

Supported Data Types for Optimized Search
-----------------------------------------

PyTables implements optimized search algorithms in C and Cython for the following data types:

- Signed integers: int8, int16, int32, int64
- Unsigned integers: uint8, uint16, uint32, uint64
- Floating point numbers: float32, float64

These optimizations improve the performance of queries on indexed columns.

Default Settings
----------------

- **Default Sorting Method**: `mergesort` is used as the default sorting algorithm for indexes to ensure stability and performance.

- **Automatic Index Updates**: By default, indexes are automatically updated after table append operations or reindexed after operations that invalidate the index.

- **Default Index Filters**: Compression filters applied to indexes by default include zlib compression at level 1 with shuffle enabled.

Temporary Files
---------------

PyTables may use temporary files during index creation or updates. The directory for these temporary files can be specified to control their location.

Summary
-------

The PyTables file format extends the HDF5 format with powerful indexing capabilities to efficiently manage and query large tabular datasets. Index nodes store metadata and data structures that enable fast searches and data retrieval, supporting various optimization levels and data types. The format is designed to balance performance, storage efficiency, and ease of use, making PyTables a robust solution for handling large scientific datasets.