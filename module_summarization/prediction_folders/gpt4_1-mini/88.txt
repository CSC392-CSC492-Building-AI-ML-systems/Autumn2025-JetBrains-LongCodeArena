===============================
Using SQLite and asyncio Effectively
===============================

Overview
--------

This module provides utilities and adapters to facilitate effective use of SQLite with asynchronous programming in Python, particularly when using the `asyncio` library. It includes type conversion adapters for SQLite to handle Python native types more consistently, especially when working with asynchronous database operations.

Type Conversion Adapters
------------------------

SQLite's default type handling can be inconsistent, especially when compared to other database engines like PostgreSQL. This module registers custom adapters and converters to ensure that Python types are correctly serialized when stored in SQLite, and deserialized when retrieved.

### Input Converters (Python to SQLite)

- **Decimal to float**: Converts `Decimal` instances to `float` for storage.
- **UUID to string**: Converts `uuid.UUID` instances to their string representation.
- **datetime.time to ISO string**: Converts `datetime.time` objects to ISO 8601 formatted strings.
- **datetime.date to ISO string**: Converts `datetime.date` objects to ISO 8601 formatted strings.
- **datetime.datetime to string**: Converts `datetime.datetime` objects to strings, converting timezone-aware datetimes to UTC.
- **datetime.timedelta to total seconds**: Converts `datetime.timedelta` objects to total seconds as a float.
- **List to JSON string**: Converts lists containing strings, integers, or floats into JSON strings for storage.

### Output Converters (SQLite to Python)

- **Numeric to Decimal**: Converts numeric SQLite values back to `Decimal`.
- **Integer to int**: Ensures integer values are returned as Python `int`.
- **UUID string to UUID**: Converts stored UUID strings back to `uuid.UUID` instances.
- **Date string to datetime.date**: Parses ISO 8601 date strings into `datetime.date`.
- **Time string to datetime.time**: Parses ISO 8601 time strings into `datetime.time`.
- **Seconds to datetime.timedelta**: Converts stored seconds back to `datetime.timedelta`.
- **Boolean string to bool**: Converts "1" or "0" strings to Python `bool`.
- **Timestamp string to datetime.datetime**: Parses ISO 8601 timestamp strings into `datetime.datetime`.
- **Timestamptz string to datetime.datetime with UTC timezone**: Parses ISO 8601 timestamp strings and attaches UTC timezone.
- **Array string to list**: Deserializes JSON strings back into Python lists.
- **M2M string to list**: Converts comma-separated strings into Python lists.

These adapters and converters are registered with the `sqlite3` module to automatically handle conversions during database operations.

AsyncBatch Class
----------------

The `AsyncBatch` class extends the `Batch` base class to support asynchronous batch processing of query results using `aiosqlite`. It provides an asynchronous iterator interface to fetch query results in batches.

### Attributes

- `connection`: The active `aiosqlite.Connection` used for executing queries.
- `query`: The `Query` object representing the SQL query to execute.
- `batch_size`: The number of rows to fetch per batch.
- `_cursor`: Internal attribute holding the `aiosqlite.Cursor` instance.

### Properties

- `cursor`: Returns the current cursor; raises an error if not set.

### Methods

- `next()`: Asynchronously fetches the next batch of results and processes them.
- `__aiter__()`: Returns the asynchronous iterator (self).
- `__anext__()`: Retrieves the next batch of results asynchronously; raises `StopAsyncIteration` when no more data is available.
- `__aenter__()`: Asynchronous context manager entry; compiles the query and executes it, initializing the cursor.
- `__aexit__()`: Asynchronous context manager exit; closes the cursor and connection.

Usage example:

```python
async with AsyncBatch(connection, query, batch_size=100) as batch:
    async for rows in batch:
        # Process rows
```

This class enables efficient, asynchronous iteration over large query result sets without loading all data into memory at once.

TransactionType Enum
--------------------

The module defines a `TransactionType` enumeration (incomplete in the provided code) intended to represent different types of SQLite transactions. This can be used to manage transaction behavior explicitly when working with SQLite asynchronously.

Summary
-------

This module enhances SQLite's compatibility with Python's native types and asynchronous programming paradigms by:

- Registering custom adapters and converters for seamless type serialization/deserialization.
- Providing an asynchronous batch processing class for efficient query result handling.
- Laying groundwork for transaction management with enumerated transaction types.

These tools help developers write clean, efficient, and type-safe asynchronous database code using SQLite.