Utilities for Developers
========================

This module provides a collection of compatibility fixes and utility functions to support various versions of Python, NumPy, SciPy, and other dependencies. These utilities are primarily intended to facilitate smooth operation and backward compatibility within the scikit-learn library.

Compatibility Fixes
------------------

- **Sparse Matrix Containers**  
  Defines lists of sparse matrix container types (`CSR_CONTAINERS`, `CSC_CONTAINERS`, `COO_CONTAINERS`, `LIL_CONTAINERS`, `DOK_CONTAINERS`, `BSR_CONTAINERS`) that include both sparse matrix classes and, for SciPy versions 1.8 and above, sparse array classes. This ensures compatibility with different sparse data structures across SciPy versions.

- **SciPy Line Search Functions**  
  Imports `line_search_wolfe1` and `line_search_wolfe2` from the appropriate SciPy submodules depending on the installed SciPy version, handling the relocation of these functions in SciPy 1.8.

- **NumPy Percentile Function**  
  Provides a wrapper for `numpy.percentile` to handle the renaming of the `interpolation` keyword argument to `method` introduced in NumPy 1.22. For NumPy versions prior to 1.22, the wrapper translates the `method` argument to `interpolation` to maintain compatibility.

- **Threadpool Control Utilities**  
  Implements `threadpool_limits` and `threadpool_info` functions that manage threadpool settings using the `threadpoolctl` package. These functions use a global threadpool controller when available (threadpoolctl >= 3.0.0) to optimize performance and avoid redundant scanning of shared libraries.

Deprecated Utilities
--------------------

- **`delayed` Function**  
  The `delayed` function has been moved from `sklearn.utils.fixes` to `sklearn.utils.parallel`. The old import path is deprecated and will be removed in version 1.5. This function is provided here with a deprecation warning to ease the transition.

Backported and Compatibility Functions
--------------------------------------

- **Mode Calculation**  
  A compatibility wrapper `_mode` around `scipy.stats.mode` that handles changes in the function's behavior and signature across SciPy versions, ensuring consistent results.

- **Conjugate Gradient Solver**  
  A wrapper `_sparse_linalg_cg` around `scipy.sparse.linalg.cg` that adapts keyword arguments for SciPy versions prior to 1.12 to maintain legacy behavior.

- **Python 3.9 `importlib.resources` Backports**  
  Functions `_open_text`, `_open_binary`, `_read_text`, and `_path` provide access to package resources using the new `importlib.resources` API introduced in Python 3.9. For earlier Python versions, these functions fall back to the older API, ensuring compatibility.

Helper Functions
----------------

- **`_object_dtype_isnan(X)`**  
  Checks for NaN values in arrays with object dtype by comparing elements to themselves (since NaN != NaN).

Usage Notes
-----------

These utilities are primarily intended for internal use within scikit-learn to handle differences in dependency versions and Python environments. They help maintain consistent behavior and performance across a wide range of setups, easing development and user experience.

If you add new compatibility fixes or utilities, please document the minimum version of the package or Python interpreter at which the fix is no longer needed. This practice helps keep the codebase clean and up to date.