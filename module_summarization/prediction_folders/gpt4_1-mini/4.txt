Sync Users with LDAP
====================

This module provides functionality to synchronize users from an LDAP directory into the ftrack system. It enables automated user management by importing and updating user information based on LDAP data, ensuring that the ftrack user database remains consistent with the organization's directory service.

Overview
--------

The synchronization process connects to an LDAP server, queries user entries, and updates the ftrack user records accordingly. This allows for centralized user management and reduces manual user administration within ftrack.

Key Features
------------

- Connect to an LDAP server using configurable connection parameters.
- Query and filter LDAP user entries based on specified criteria.
- Create new ftrack users for LDAP entries that do not yet exist.
- Update existing ftrack users with information from LDAP.
- Optionally deactivate or remove ftrack users that no longer exist in LDAP.
- Support for mapping LDAP attributes to ftrack user fields.
- Logging and error handling to track synchronization status and issues.

Usage
-----

To perform a synchronization of users from LDAP, the following steps are typically involved:

1. **Configure LDAP Connection**  
   Provide the LDAP server URL, bind DN, and credentials to establish a connection.

2. **Define User Query and Attribute Mapping**  
   Specify the LDAP search base, filter, and attributes to retrieve. Map these attributes to the corresponding ftrack user fields.

3. **Run Synchronization**  
   Execute the synchronization process which will:
   - Fetch users from LDAP.
   - Compare with existing ftrack users.
   - Create or update users as necessary.
   - Optionally handle users no longer present in LDAP.

4. **Review Logs and Reports**  
   Check the synchronization logs for any errors or warnings and verify the changes applied.

Configuration Options
---------------------

- **LDAP Server URL**: The address of the LDAP server to connect to.
- **Bind DN and Password**: Credentials used to authenticate to the LDAP server.
- **Search Base**: The LDAP directory subtree to search for user entries.
- **Search Filter**: LDAP filter expression to select user entries.
- **Attribute Mapping**: Dictionary mapping LDAP attributes to ftrack user fields (e.g., username, email, full name).
- **User Deactivation Policy**: Option to deactivate or delete ftrack users not found in LDAP.
- **Logging Level**: Control verbosity of synchronization logs.

Example
-------

```python
from sync_ldap_users import LdapUserSync

# Configure synchronization
sync = LdapUserSync(
    ldap_url='ldap://ldap.example.com',
    bind_dn='cn=admin,dc=example,dc=com',
    bind_password='secret',
    search_base='ou=users,dc=example,dc=com',
    search_filter='(objectClass=person)',
    attribute_mapping={
        'uid': 'username',
        'mail': 'email',
        'cn': 'full_name'
    },
    deactivate_missing=True
)

# Run synchronization
sync.run()
```

Logging
-------

The synchronization process logs detailed information about each step, including:

- Connection status to the LDAP server.
- Number of users retrieved from LDAP.
- Users created, updated, or deactivated in ftrack.
- Any errors encountered during the process.

Logs can be reviewed to audit synchronization runs and troubleshoot issues.

Error Handling
--------------

Common errors during synchronization include:

- LDAP connection failures due to incorrect URL or credentials.
- LDAP query errors from invalid filters or search bases.
- Data mapping issues when LDAP attributes are missing or malformed.
- API errors when creating or updating ftrack users.

The module handles these errors gracefully, logging appropriate messages and continuing where possible.

Extensibility
-------------

The synchronization logic can be extended or customized by:

- Modifying attribute mappings to suit different LDAP schemas.
- Implementing custom user filtering or transformation logic.
- Integrating with other user management workflows or systems.

This flexibility allows the synchronization to adapt to various organizational requirements.

License and Copyright
---------------------

This module is provided under the terms of the ftrack license. Copyright (c) 2014 ftrack.

For more information, refer to the ftrack API documentation and LDAP server administration guides.