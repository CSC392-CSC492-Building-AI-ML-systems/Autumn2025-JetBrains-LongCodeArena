Visitor and Traversal Interface
===============================

The `visitors` module provides the foundational visitor and traversal interfaces and utility functions used throughout SQLAlchemy. It defines the core abstractions and mechanisms for traversing and processing SQL expression trees and other internal structures in a consistent and extensible manner.

Overview
--------

This module introduces the concept of a **Visitable** object, which forms the basis for implementing the SQL compiler dispatch system. The visitor pattern implemented here allows different operations to be performed on SQL expression elements by dispatching calls to visitor methods named according to the type of the element being visited.

Key Components
--------------

### Visitable

The `Visitable` class is the base class for all objects that can be visited by a visitor. It provides the mechanism for compiler dispatch by looking up and invoking visitor methods named `visit_<visit_name>`, where `<visit_name>` is a string identifier defined on each subclass via the `__visit_name__` attribute.

- The class automatically generates a `_compiler_dispatch` method that performs this dynamic dispatch.
- This design allows visitors to implement custom behavior for different SQL expression types by defining appropriately named visit methods.
- The `Visitable` class was formerly named `Traversible` in SQLAlchemy 1.4 but was renamed back to `Visitable` in version 2.0.

### InternalTraversal

`InternalTraversal` is an enumeration that defines symbols used for internal traversal of SQL expression objects. These symbols represent different types of internal attributes or collections that can be traversed, such as:

- `dp_has_cache_key`: Visit a `HasCacheKey` object.
- `dp_has_cache_key_list`: Visit a list of `HasCacheKey` objects.
- `dp_clauseelement`: Visit a `ClauseElement` object.
- `dp_fromclause_canonical_column_collection`: Visit a `FromClause` object in the context of its canonical column collection.
- `dp_clauseelement_tuples`: Visit a list of tuples containing `ClauseElement` objects.

These traversal symbols are used in the `_traverse_internals` attribute of SQL expression classes to define how their internal state should be traversed. This enables automatic implementation of methods such as:

- `get_children()`
- `_copy_internals()`
- `_gen_cache_key()`

which are essential for SQL compilation, caching, and cloning operations.

Utility Functions and Aliases
-----------------------------

The module also exposes utility functions and aliases to facilitate traversal operations:

- `iterate`
- `traverse_using`
- `traverse`
- `cloned_traverse`
- `replacement_traverse`

These functions provide various ways to iterate over or traverse SQL expression trees, optionally cloning or replacing elements as needed.

Additional Details
------------------

- The module supports both pure Python and C-accelerated implementations of certain utilities, selecting the appropriate version based on availability.
- It uses Python typing and protocols to define expected interfaces and enhance type checking.
- The visitor pattern implemented here is central to SQLAlchemy's extensibility, allowing new SQL constructs and behaviors to be integrated cleanly.

Summary
-------

The `visitors` module is a critical part of SQLAlchemy's internal architecture, providing a robust and flexible visitor pattern implementation for traversing and processing SQL expression trees. By defining the `Visitable` base class and the `InternalTraversal` enumeration, it standardizes how SQL elements expose their internal structure for traversal, compilation, and caching purposes. This module underpins many of SQLAlchemy's advanced features, including SQL compilation, query caching, and expression cloning.