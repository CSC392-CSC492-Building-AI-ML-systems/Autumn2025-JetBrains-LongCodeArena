Module: sklearn.metrics.pairwise

Overview
--------
This module provides low-level utilities used to validate and prepare inputs for pairwise distance computations. It contains helpers that convert inputs to appropriate numpy arrays, determine the required floating dtype for computations, and verify shapes and finiteness constraints before distance calculations are performed.

Public utilities

- _return_float_dtype(X, Y)
  - Purpose: Determine the appropriate floating dtype to use for pairwise computations based on input types.
  - Behavior (summary):
    - If X and Y are not sparse matrices or ndarray objects, they are converted to numpy arrays.
    - If Y is None, the dtype is derived from X. If Y is provided, its dtype is considered.
    - If both inputs are float32, the result dtype is float32; otherwise the result dtype is a floating type (float).
  - Returns: (X, Y, dtype)

- check_pairwise_arrays(
    X,
    Y,
    *,
    precomputed=False,
    dtype=None,
    accept_sparse="csr",
    force_all_finite=True,
    copy=False,
  )
  - Purpose: Set X and Y appropriately and validate inputs for pairwise distance calculations.
  - Behavior (summary):
    - Ensures X and Y are 2D, numeric arrays suitable for distance computations.
    - If Y is None or is X, Y is treated as a reference to X (no copy); otherwise X and Y are validated separately.
    - If precomputed is True, validates that X.shape[0] matches Y.shape[0] and X.shape[1] matches Y.shape[1] as appropriate for precomputed distances.
    - Otherwise, validates that X.shape[1] == Y.shape[1].
  - Parameters:
    - precomputed: whether inputs represent precomputed distances
    - dtype: desired numeric dtype (None lets the function choose)
    - accept_sparse: allowed sparse formats (string, bool, or list/tuple)
    - force_all_finite: whether to enforce finiteness (True, False, or 'allow-nan')
    - copy: whether to copy inputs if needed
  - Returns: safe_X, safe_Y (validated and converted to numpy arrays; if Y is None, safe_Y is a pointer to X)

- check_paired_arrays(X, Y)
  - Purpose: Prepare and validate inputs for paired distance metrics.
  - Behavior (summary): Ensures X and Y are array-like, and suitable for paired distance computations. The detailed behavior is derived from the function's docstring, which indicates it validates and prepares inputs for paired distances (conversion to arrays, dimensional checks, etc.).
  - Returns: (X, Y) prepared for subsequent computations

Notes
-----
- This module also imports internal helpers used elsewhere in the pairwise distance implementation, such as ArgKmin and low-level kernels. These are intended for internal use and are not part of the public API.
- The functions are designed to be used by higher-level pairwise distance implementations to ensure consistent input validation and dtype handling.

See Also
--------
- ArgKmin
- _chi2_kernel_fast
- _sparse_manhattan

Examples
--------
.. code-block:: python

   import numpy as np
   from sklearn.metrics.pairwise import check_pairwise_arrays

   X = np.random.rand(5, 3)
   Y = np.random.rand(4, 3)

   X2, Y2, dtype = _return_float_dtype(X, Y)
   X3, Y3 = check_pairwise_arrays(X2, Y2, dtype=dtype)

   # For precomputed distances
   D = np.random.rand(5, 5)
   Q, R = check_pairwise_arrays(D, D, precomputed=True)