Pairwise metrics, affinities and kernels
=========================================

Overview
--------

The pairwise module provides utilities for computing distances and similarities between samples. It supports dense NumPy arrays and sparse matrices, and includes helpers for input validation, dtype handling, and precomputed distance matrices. In addition to pairwise distances, the module exposes kernel-based similarities (affinities) used in kernel methods and graph-based learning. Fast paths are available for certain kernels on sparse data to improve performance.

Input validation and dtype handling
-----------------------------------

- _return_float_dtype(X, Y)
  - Ensures stable and efficient dtypes for pairwise computations.
  - If both inputs are float32, returns float32; otherwise returns a floating dtype (default float).
  - Converts inputs to NumPy arrays as needed for consistent processing.

- check_pairwise_arrays(
    X, Y, *,
    precomputed=False,
    dtype=None,
    accept_sparse="csr",
    force_all_finite=True,
    copy=False
  )
  - Validates and prepares X and Y for pairwise computations.
  - If Y is None or identical to X, Y points to X (no copy) and both are validated with the same dtype.
  - If Y is provided, X and Y are validated separately.
  - If precomputed is True, X is treated as a distance matrix and checked for shape compatibility with Y.
  - Otherwise, the second dimension of X and Y must match (n_features consistency).
  - Accepts sparse inputs according to accept_sparse (default 'csr'); converts sparse inputs to the first allowed format if needed.
  - force_all_finite controls whether to reject NaN/Inf values (or allow NaN with 'allow-nan' semantics).
  - Returns safe_X and safe_Y as numpy arrays suitable for downstream computations.

- check_paired_arrays(X, Y)
  - Validates inputs for paired-distance metrics.
  - Ensures X and Y are appropriate array-like inputs for pairwise computations and that their dimensions are compatible for pairing.

Affinities and kernels
----------------------

- Pairwise affinities
  - Similarities (affinities) between samples can be constructed using kernel functions that map inputs into a similarity space.
  - Affinities are used in various learning tasks, including spectral methods and graph-based algorithms, where kernel matrices K with K_ij = k(x_i, x_j) encode pairwise relations.

- Kernels and fast path implementations
  - The module includes kernel-based pairwise computations, transforming data into kernel (similarity) matrices.
  - Fast kernel implementations are provided for certain kernels to improve performance on large or sparse datasets, such as:
    - chi2_kernel_fast: fast chi-squared kernel between histogram-like vectors.
    - sparse_manhattan: efficient computation related to Manhattan-distance-based representations on sparse data.
  - These fast paths enable efficient kernel computations without materializing intermediate representations.

Usage notes
-----------

- Data formats
  - By default, sparse inputs are expected in CSR format (accept_sparse='csr'), but other formats may be accepted or converted as needed.

- Precomputed distances
  - When using precomputed distance matrices, X is interpreted as the distance matrix and must have compatible shape with Y (or with the indexed samples, depending on the context).

- Finite values
  - force_all_finite controls whether inputs must be finite.
  - Options include True (all values finite), False (allow NaN and Inf), or 'allow-nan' (accepts NaN/NA values but not Inf).

- API relationship
  - These utilities underpin higher-level functions such as pairwise_distances, pairwise_kernels, and related convenience routines available in the pairwise module.
  - They ensure inputs are valid, safely typed, and ready for efficient computation, including support for sparse data and precomputed matrices.