augmentations
===============

Overview
--------
This module contains a standard suite of augmentations used by AutoAugment policy
for ImageNet, RandAugment and TrivialAugmentWide. The augmentations are implemented
in terms of DALI operators.

The @augmentation decorator
----------------------------
The decorator handles computation of the decorated transformation's parameter. When called, the augmentation expects:

- a single positional argument: batch of samples
- magnitude parameters supplied via mag_range, randomly_negate, and mag_to_param, using magnitude_bin and num_magnitude_bins

The parameter is computed as:
mag_to_param(magnitudes[magnitude_bin] * ((-1) ** random_sign)),
where magnitudes = linspace(mag_range[0], mag_range[1], num_magnitude_bins).

Augmentations in this module may be defined with preset setups passed to @augmentation. The presets can be easily adjusted, for example by creating
my_shear_x = shear_x.augmentation(mag_range=(0, 0.5)).

How magnitudes map to parameters
-------------------------------
- mag_range: inclusive minimum and maximum magnitudes.
- num_magnitude_bins: number of discrete magnitude steps.
- randomly_negate: if True, magnitude may be negated randomly.
- mag_to_param: a function that maps the computed magnitude to the operator parameters.

Notes
- The module uses numpy for some constant values (e.g., color weights).
- The decorator and the underlying ops produce parameters suitable for consumption by DALI operators.

Augmentations
-------------
- shear_x
  - Decorated with mag_range=(0, 0.3), randomly_negate=True, mag_to_param=warp_x_param
  - Applies a horizontal shear. Uses fn.transforms.shear and fn.warp_affine.

- shear_y
  - Decorated with mag_range=(0, 0.3), randomly_negate=True, mag_to_param=warp_y_param
  - Applies a vertical shear. Uses fn.transforms.shear and fn.warp_affine.

- translate_x
  - Decorated with mag_range=(0, 1.0), randomly_negate=True, mag_to_param=warp_x_param
  - Applies horizontal translation based on a relative offset times the width (shape[1]).
  - Uses fn.transforms.translation and fn.warp_affine.

- translate_x_no_shape
  - Decorated with mag_range=(0, 250), randomly_negate=True, mag_to_param=warp_x_param, name="translate_x"
  - Same operation as translate_x but does not require shape to compute offset; offset is passed directly.

- translate_y
  - Decorated with mag_range=(0, 1.0), randomly_negate=True, mag_to_param=warp_y_param
  - Applies vertical translation based on a relative offset times the height (shape[0]).

- translate_y_no_shape
  - Decorated with mag_range=(0, 250), randomly_negate=True, mag_to_param=warp_y_param, name="translate_y"
  - Same as translate_y but offset is passed directly when shape is not available.

- rotate
  - Decorated with mag_range=(0, 30), randomly_negate=True
  - Applies rotation. Parameters: angle; uses fn.rotate with keep_size controlled by rotate_keep_size (default True).

- brightness
  - Decorated with mag_range=(0, 0.9), randomly_negate=True, mag_to_param=shift_enhance_range
  - Brightness adjustment. Uses fn.brightness.

- contrast
  - Decorated with mag_range=(0, 0.9), randomly_negate=True, mag_to_param=shift_enhance_range
  - Contrast adjustment. Uses a mean-centered approach:
    - Computes mean over HW
    - Uses a channel weighting for RGB
    - Adjusts data with center and parameter without passing a direct center to the operator

- The following helper functions are used by the augmentations:
  - warp_x_param(magnitude) -> [magnitude, 0]
  - warp_y_param(magnitude) -> [0, magnitude]
  - shift_enhance_range(magnitude) -> 1 + magnitude
  These define how magnitudes map to the actual per-augmentation parameters.

Notes on layout and implementation
-----------------------------------
- The module operates with FHWC or HWC layouts where applicable.
- For contrast, the center is computed on the input rather than passed as a direct parameter to the operator, to manage GPU memory locality.

Examples
--------
- Customizing magnitude ranges:
  my_shear_x = shear_x.augmentation(mag_range=(0, 0.5))
  my_brightness = brightness.augmentation(mag_range=(0, 1.0))

- Using translate with shape-free parameters:
  my_translate_y = translate_y_no_shape.augmentation(mag_range=(0, 200))

Dependencies
------------
Requires numpy (for certain constants and numerical operations).

See Also
--------
- nvidia.dali.auto_aug.core.augmentation decorator
- DALI transforms: fn.transforms.shear, fn.warp_affine, fn.rotate, fn.brightness, fn.contrast
- DALI reductions for mean calculations and center computations in contrast

End of documentation.