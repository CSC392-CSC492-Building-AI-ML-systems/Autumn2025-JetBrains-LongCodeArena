Generate documentation for this module
======================================

Overview
--------
This module provides utilities to undo migrations (backwards) in Piccolo's migrations
framework. It includes:
- BackwardsMigrationManager: manages reversing migrations for a single app.
- run_backwards: convenience function to reverse migrations with various options.
- backwards: high-level entry point that delegates to run_backwards and handles exit behavior.
- CheckMigrationManager and MigrationStatus: utilities for inspecting migration status (incomplete portion shown).

API Reference
-------------

BackwardsMigrationManager
~~~~~~~~~~~~~~~~~~~~~~~~~
Class that handles reversing migrations for a specific app.

Attributes
- app_name: str
- migration_id: str
- auto_agree: bool
- clean: bool
- preview: bool

Methods
- __init__(self, app_name: str, migration_id: str, auto_agree: bool = False, clean: bool = False, preview: bool = False)
- run(self) -> MigrationResult
  - Async entry point to perform backwards migrations for the configured app.
- run_migrations_backwards(self, app_config: AppConfig) -> MigrationResult
  - Core logic to determine which migrations to reverse, in what order, and how to apply them.

Notes
- Uses Migration.get_migrations_which_ran to determine the migration history.
- Accepts a “preview” mode to print SQL queries without executing.
- If clean is True, deletes migrated files from disk after reversal.
- Supports reversing a single app or all apps via run_backwards.

run_backwards
~~~~~~~~~~~~
Function to reverse migrations.

Signature
- run_backwards(app_name: str, migration_id: str = "1", auto_agree: bool = False, clean: bool = False, preview: bool = False) -> MigrationResult

Behavior
- If app_name == "all", reverses migrations for all apps in sorted order, with optional confirmation.
- Otherwise, creates a BackwardsMigrationManager and runs it.
- Returns a MigrationResult indicating success or failure.

backwards
~~~~~~~~~
High-level entry point for undoing migrations.

Signature
- backwards(app_name: str, migration_id: str = "1", auto_agree: bool = False, clean: bool = False, preview: bool = False)

Docstring
- Describes undoing migrations up to a specific migration.
- Raises a non-zero exit code if the operation fails.

Notes
- This function delegates to run_backwards and exits with code 1 on failure.

MigrationStatus
~~~~~~~~~~~~~~
Dataclass representing the status of a migration for an app.

Fields
- app_name: str
- migration_id: str
- description: str
- has_ran: bool

CheckMigrationManager
~~~~~~~~~~~~~~~~~~~~~
Manager for checking migration statuses (partial implementation shown).

Initialization
- __init__(self, app_name: str)

API
- async def get_migration_statuses(self) -> List[MigrationStatus]
  - Intended to return a list of MigrationStatus entries for the given app.
  - Placeholder: ensures the migration table exists (implementation not shown in snippet).

Usage Examples
--------------

Basic backwards reversal for a single app:
.. code-block:: python

    import asyncio
    from your_module import backwards

    async def main():
        result = await backwards(app_name="myapp", migration_id="1", auto_agree=True)
        print(result)

    asyncio.run(main())

Undo all migrations across all apps with confirmation:
.. code-block:: python

    import asyncio
    from your_module import run_backwards

    async def main():
        result = await run_backwards(app_name="all", auto_agree=False)
        print(result)

    asyncio.run(main())

Notes
- The module depends on Piccolo's migrations framework and the project’s AppConfig setup.
- The public API focuses on reversing migrations and reporting results; status inspection support exists but is not fully shown in the provided snippet.