Generalized Method of Moments, GMM, and Two-Stage Least Squares for instrumental variables IV2SLS
===============================================================================================

Overview
--------
This module implements an Instrumental Variables estimator using Two-Stage Least Squares (2SLS) within the StatsModels framework. It defines:

- IV2SLS: a LikelihoodModel subclass that performs 2SLS estimation using endogenous, exogenous, and instrumental variables.
- IVRegressionResults: a RegressionResults subclass used to report estimation results for IV2SLS.

The implementation follows a textbook 2SLS approach:
- First stage: regress exog on instruments to obtain predicted exog.
- Second stage: regress endogenous on the predicted exog to obtain parameter estimates.
- Covariance and related statistics are computed in a manner consistent with linear models, returning results compatible with existing StatsModels result classes.

Author, License
---------------
Author: josef-pktd
License: BSD (3-clause)

API and Public Members
----------------------
IV2SLS(endog, exog, instrument=None)
- endog: endogenous variable (nobs x 1)
- exog: explanatory variables (nobs x k)
- instrument: instruments for exog (nobs x m); must include both exog variables that are not instrumented and instruments

IV2SLS.initialize()
- Prepares working data; sets wendog and wexog

IV2SLS.whiten(X)
- Placeholder for whitening; not implemented

IV2SLS.fit()
- Estimates the 2SLS model
- Returns a RegressionResultsWrapper containing an IVRegressionResults instance
- Also stores intermediate quantities:
  - xhatparams: coefficients from the projection of X on Z (Z: instruments)
  - xhat: fitted values of the exog from the first stage (F)
  - FtF, xhatprod: used internally for computations
  - Ftx, Fty: cross-products used to compute parameter estimates
  - normalized_cov_params: covariance matrix of the estimated parameters

IV2SLS.predict(params, exog=None)
- Predicts linear values given params; uses provided exog (or self.exog if None)

IVRegressionResults(RegressionResults)
- Results class for the IV/2SLS model
- Inherits standard RegressionResults functionality and is used to report IV2SLS results

Notes and Implementation Details
-------------------------------
- The 2SLS estimation is performed using a standard “textbook” approach:
  - zt z, zt x, etc., to obtain the projection of exog on instruments, and then compute the second-stage estimates.
- The df_resid and df_model follow conventional linear-model definitions for degrees of freedom in this context.
- The predict method conforms to the pattern used by linear models in StatsModels.

Known Issues and Unclear Aspects
-------------------------------
Issues
- Parameter sizing and starting values (nparams) handling requires careful placement of starts; currently sources of confusion exist.
- When the optimal weighting matrix cannot be calculated numerically, special handling is needed (e.g., identity weighting or analytical weighting). See development notes in the module docstring.

Unclear
- Degrees of freedom (Hausman tests) differ between IV2SLS usage in this module and other GMM/iv implementations.
- Normalization and scaling in jtest/jval tests require case-specific validation.
- Large standard errors observed in certain cases (e.g., fitonce) may indicate incorrect covariance estimation without an optimal weighting matrix.

Licence
-------
BSD (3-clause)

Usage Example
-------------
- Basic usage:
  - model = IV2SLS(endog, exog, instrument)
  - results = model.fit()
  - print(results.summary())

This module integrates with the StatsModels machinery, returning result objects that are compatible with existing regression result handling and diagnostics.