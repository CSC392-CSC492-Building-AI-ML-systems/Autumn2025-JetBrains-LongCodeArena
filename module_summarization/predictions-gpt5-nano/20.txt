w_direct
========

Overview
--------

w_direct computes and summarizes state-to-state kinetics from WESTPA weighted-ensemble trajectories. It generates a direct.h5 file containing flux, arrivals, and duration data, which can then be processed to obtain average rates/fluxes with confidence intervals.

Subcommands
-----------

init
~~~~

Description
~~~~~~~~~~~

Calculate state-to-state kinetics by tracing trajectories. This subcommand requires an assignments file (typically assign.h5) and produces an output file (by default direct.h5) containing datasets describing macrostate fluxes, arrivals, durations, and related statistics. This is the primary step whose results are consumed by other w_direct subcommands to compute normalized rates and averaged quantities.

Notes
~~~~~

- The initialization stores data in the output file and checks that the requested iteration range spans the available assignments data.

- A custom evaluation block is used for rate estimation to account for the specifics of the kinetic estimator.

Input files
~~~~~~~~~~~

- Assignments file (commonly assign.h5) containing trajectory labeling information.

- Output file (default: direct.h5) where results are written.

Output format
~~~~~~~~~~~~~

The output file (-o/--output, by default "direct.h5") contains the following datasets:

- ``/conditional_fluxes`` [iteration][state][state]
  Floating-point macrostate-to-macrostate fluxes. These are not normalized by the population of the initial macrostate.

- ``/conditional_arrivals`` [iteration][stateA][stateB]
  Integer: Number of trajectories arriving at stateB in a given iteration, given that they departed from stateA.

- ``/total_fluxes`` [iteration][state]
  Floating-point: Total flux into a given macrostate.

- ``/arrivals`` [iteration][state]
  Integer: Number of trajectories arriving at a given state in a given iteration, regardless of origin.

- ``/duration_count`` [iteration]
  Integer: The number of event durations recorded in each iteration.

- ``/durations`` [iteration][event duration]
  Structured: istate, fstate, duration, weight
  - istate: Initial state of the transition event (Integer)
  - fstate: Final state of the transition event (Integer)
  - duration: Duration of the transition (Floating-point, in tau)
  - weight: Weight of the trajectory at the end of the transition (Floating-point)

Notes
~~~~~

- Because the state-to-state fluxes are not normalized by the initial macrostate population, they cannot be used as rates without further processing. Use the w_direct kinetics subcommand (or equivalent normalization routines) to obtain rates with confidence intervals.

- Target fluxes (total flux into a given state) do not require normalization.

kinetics
--------

Description
~~~~~~~~~~~

Generate average rates/fluxes and associated errors from WESTPA data via tracing. This subcommand reads the data produced by w_direct init (direct.h5) and computes ensemble-averaged quantities, including confidence intervals. The evolution-mode option (if specified) yields datasets describing rate evolution over the selected window.

Output format
~~~~~~~~~~~~~

When invoked, this subcommand writes the following datasets into the output file (by default the same direct.h5 or an explicitly specified output):

- ``/avg_rates`` [state, state]
  State-to-state rates aggregated over the chosen window.

- ``/avg_total_fluxes`` [state]
  Total fluxes into each state aggregated over the chosen window.

- ``/avg_conditional_fluxes`` [state, state]
  State-to-state fluxes aggregated over the chosen window.

- If evolution mode is requested, additional datasets such as rate evolution over the window may be produced (e.g., ``/rate_evolution`` [window][state][state]).

Notes
~~~~~

- The kinetics subcommand is intended to be run after an initial w_direct init run to produce the necessary datasets.

- Confidence intervals and statistical uncertainties are handled according to the bootstrap/CI framework configured in the analysis.

Usage
-----

- w_direct init --assignments assign.h5 --output direct.h5
- w_direct kinetics --input direct.h5 --output direct_avg.h5

See also
--------

- w_assign for generating the assignments file (assign.h5)
- w_direct init for producing the kinetic datasets used by subsequent analysis
- The provided datasets are designed to be post-processed to obtain normalized rates and fluxes with uncertainties.