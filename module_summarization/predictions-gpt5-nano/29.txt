w_ntop.rst

w_ntop
======

Select walkers from bins. An assignment file mapping walkers to bins at each timepoint is required (see ``w_assign --help`` for further information on generating this file). By default, high-weight walkers are selected (hence the name ``w_ntop``: select the N top-weighted walkers from each bin); however, minimum weight walkers and randomly-selected walkers may be selected instead.

Output format
-------------
The output file (-o/--output, by default "ntop.h5") contains the following datasets:

- ``/n_iter`` [iteration]
  - (Integer) Iteration numbers for each entry in other datasets.

- ``/n_segs`` [iteration][bin]
  - (Integer) Number of segments in each bin/state in the given iteration. This will generally be the same as the requested with ``--n/--count`` but may be smaller if the requested number of walkers does not exist.

- ``/seg_ids`` [iteration][bin][segment]
  - (Integer) Matching segments in each iteration for each bin. For an iteration ``n_iter``, only the first ``n_segs[n_iter]`` entries are valid. For example, the full list of matching seg_ids in bin 0 in the first stored iteration is ``seg_ids[0][0][:n_segs[0]]``.

- ``/weights`` [iteration][bin][segment]
  - (Floating-point) Weights for each matching segment in ``/seg_ids``.

Command-line arguments
----------------------

Input options
-------------
- ``-a``, ``--assignments``

  default: ``assign.h5``

  Use assignments from the given ASSIGNMENTS file (default: %(default)s).

Selection options
-----------------
- ``-n``, ``--count``

  type: int, default: 1

  Select COUNT walkers from each iteration for each bin (default: %(default)s).

- ``-t``, ``--timepoint``

  type: int, default: -1

  Base selection on the given TIMEPOINT within each iteration. Default (-1) corresponds to the last timepoint.

- Mutually exclusive group (selection mode)
  - ``--highweight``

    dest: ``select_what``, const: ``highweight``

    Select COUNT highest-weight walkers from each bin.

  - ``--lowweight``

    dest: ``select_what``, const: ``lowweight``

    Select COUNT lowest-weight walkers from each bin.

  - ``--random``

    dest: ``select_what``, const: ``random``

    Select COUNT walkers randomly from each bin.

Note: The default selection mode is highweight.

Output options
--------------
- ``-o``, ``--output``

  default: ``ntop.h5``

  Write output to OUTPUT (default: %(default)s).

Progress options
----------------
The tool provides a progress indicator during execution.

Usage examples
--------------
- Basic usage selecting the top-weighted walkers:
  w_ntop -a assign.h5 -n 2 -t -1 --highweight -o ntop.h5

- Random selection with a custom assignment file:
  w_ntop -a my_assignments.h5 -n 4 --random -o my_ntop.h5

See also
--------
w_assign