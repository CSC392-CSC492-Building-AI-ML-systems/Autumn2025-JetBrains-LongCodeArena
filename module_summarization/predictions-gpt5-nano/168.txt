Feature extraction for model inspection
=======================================

Overview
--------
This module provides utilities to extract intermediate features by tracing a PyTorch model’s graph and assigning stable, human-readable names to each node. It is designed to support model inspection, debugging, and qualitative analysis by exposing selected internal activations.

Key concepts
------------
- Node naming: Each node is assigned a dot-separated path from the top-level module to a leaf operation or module. The top-level module name is not included. Duplicate node names are suffixed with _1, _2, etc.
- Node to qualname mapping: For every traced node, a corresponding qualified name is stored to enable stable feature extraction across runs.
- Leaf modules: You can mark certain modules as leaves so the tracer stops tracing through them, producing a single node for the leaf’s forward call.
- Train vs eval graphs: The tracer can warn if the training graph and evaluation graph differ in their node names, suggesting separate output node specifications for train and eval modes if needed.

Public API (high level)
-----------------------
- get_graph_node_names(model): Retrieve the list of available node names that can be used for feature extraction.
- create_feature_extractor(model, return_nodes, ...): Wrap a model to return the outputs of the specified nodes during a forward pass. The result is a mapping from node names to feature tensors.

Naming and tracing behavior
---------------------------
- Node names reflect the operation/module path within the traced graph.
- If a node name is encountered more than once, a numeric suffix is added to keep names unique.
- The naming is designed to be stable for inspection purposes across runs, aiding in model understanding and debugging.

Leaf modules and tracing control
--------------------------------
- By supplying leaf_modules, users can control which parts of the model are traced. Leaf modules are not expanded; instead, their forward calls are represented as single nodes in the trace.

Handling train vs eval differences
----------------------------------
- Tracing may produce different node sets for train and eval modes. If differences are detected, a warning is issued and you may need to specify separate output node sets for train and eval.

Example usage (conceptual)
-----------------------------
- node_names = get_graph_node_names(model)
- feature_extractor = create_feature_extractor(model, return_nodes=["layer1.relu", "layer3.fc"])
- features = feature_extractor(input_tensor)

Notes
-----
- The exact node names depend on the model’s structure and which modules are traced as leaves.
- Use the provided utilities to discover valid node names before selecting them for feature extraction.