MapPlot
-------

Make plots of the cube and interactively connect them to spectrum plotting. This is an interactive component of the package; not intended for publication-quality plots, but useful for user-driven analysis.

The plotting makes use of APLpy when available, so publication-quality plots can be produced when dependencies are present.

Author: Adam Ginsburg
Date: 03/17/2011

Overview
--------

This module provides the MapPlotter class, an interactive viewer for visualizing
a spectral cube as a 2D map and for connecting that map to spectrum plotting.

Key features

- Optional use of APLpy for high-quality plots; falls back to matplotlib when APLpy is not available.
- Supports FITS headers and WCS via astropy.wcs or pyfits, with a compatibility flag (pywcsOK).
- Interactive controls to inspect spectra, overplot additional spectra, and disconnect the viewer.
- Handles figure creation and management, color maps, colorbars, and plotting conventions.

Public API
----------

Class: MapPlotter
~~~~~~~~~~~~~~~~~

Constructor
- __init__(self, Cube=None, figure=None, doplot=False, **kwargs)

  Create a map figure for future plotting.

  Parameters
  - Cube: input data cube (expected to provide a header attribute and data plane).
  - figure: matplotlib.figure.Figure instance, an integer figure number, or None.
  - doplot: if True, immediately create the map plot by calling mapplot.
  - kwargs: forwarded to mapplot.

  Notes:
  - If Cube is provided, the header is flattened (via cubes.flatten_header) for WCS use.
  - If available, a WCS object is created from the header.

__call__(self, **kwargs)
- see mapplot

  Alias to mapplot; allows the object to be used as a callable for plotting.

mapplot
-------

Plot a map based on an input data cube.

Parameters
- convention: 'calabretta' or 'griesen' (default 'calabretta')
  Projection convention to use for Galactic data when plotting.
- colorbar: bool
  Whether to show a colorbar.
- useaplpy: bool
  Use APLpy if a FITS header is available.
- vmin, vmax: float or None
  Value clipping for the color scale; determined automatically if None.
- cmap: colormap
  Colormap to use for the map.
- plotkwargs: dict
  Additional keyword arguments passed to aplpy.show_colorscale or matplotlib.imshow.
- kwargs: forwarded to the plotting engine.

  The map is created from an internal method makeplane (not shown here). If a
  FITS header is available and aplpy is enabled, a FITSFigure is used; otherwise a
  standard matplotlib axis is created.

  Interactive plotting is enabled after plotting, with event connections established.

_Additional notes:_
- If a colorbar already exists and a new plot is created, it may be removed to avoid duplicates.
- The origin is tracked (FITS convention for FITS-based plots; normal convention otherwise).

_connect / _disconnect
----------------------

Internal helpers to manage interactive events.

- _connect(self)
  Connect button press, button release, and key press events to the corresponding handlers
  (e.g., click, plot_spectrum).

- _disconnect(self)
  Disconnect the interactive event handlers to stop interactivity.

Dependencies
------------

- numpy, matplotlib
- astropy (for WCS and FITS handling)
- Optional: APLpy (for publication-quality figures)

Example
-------

from . import cubes

# Create a MapPlotter for a cube and plot immediately
mp = cubes.MapPlotter(Cube=mycube, figure=1, doplot=True)