Mixed Linear Models (mixed_linear)
==================================

Overview
--------

Linear mixed effects models are regression models for dependent data that can estimate both mean structure and variance components. They are also known as multilevel linear models or hierarchical linear models. The MixedLM class fits linear mixed effects models to data and provides support for common post-estimation tasks. This implementation favors a group-based approach and is most efficient when data can be partitioned into independent groups. Some models with crossed effects can be handled by specifying a model with a single group.

Model and notation
------------------

Data are partitioned into disjoint groups. For group i, the probability model is

Y = X * beta + Z * gamma + epsilon

where

- n_i is the number of observations in group i
- Y is the n_i-dimensional response vector (endog in MixedLM)
- X is the n_i Ã— k_fe design matrix for the fixed effects (exog in MixedLM)
- beta is the k_fe-dimensional vector of fixed effects parameters (fe_params in MixedLM)
- Z is the design matrix for the random effects with n_i rows (exog_re in MixedLM); the number of columns in Z can vary by group
- gamma is a random vector with mean 0. The covariance matrix for the first k_re elements of gamma (cov_re in MixedLM) is common to all groups. The remaining elements of gamma are variance components. Each group receives its own independent realization of gamma.
- epsilon is an n_i-dimensional vector of iid normal errors with mean 0 and variance sigma^2; the epsilon values are independent within and between groups

Y, X, and Z must be observed. beta, Psi (cov_re), and sigma^2 are estimated using ML or REML. Gamma and epsilon are random and define the probability model.

The marginal mean structure is E[Y | X, Z] = X * beta. If only the mean structure is of interest, generalized estimating equations (GEE) provide an alternative.

Parameterizations
-----------------

There are three parameterizations used in different parts of the implementation. The regression slopes (fe_params) are identical across parameterizations, but the variance parameters differ. The parameterizations are:

- User parameterization: cov(endog) = scale * I + Z * cov_re * Z'
  This is the main parameterization visible to the user.

- Profile parameterization: cov(endog) = I + Z * cov_re1 * Z'
  This parameterization is used for the profile likelihood maximization. The user cov_re equals the profile cov_re1 scaled by the variance parameter scale.

- Square root parameterization: operates with the Cholesky factor of cov_re1 instead of cov_re directly. This is hidden from the user.

Parameter vectors can be packed by concatenating fe_params, the lower triangle (or the Cholesky square root) of the dependence structure, and the variance components. When unpacking, one should either square (or reflect) the dependence structure depending on the chosen parameterization.

Score methods
-------------

Two score methods are implemented:

- Score with respect to the random effects covariance matrix (cov_re) elements, used for inference after the maximum likelihood is reached.
- Score with respect to the parameters of the Cholesky square root of the random effects covariance matrix (for optimization).

Estimation and optimization
---------------------------

The numerical optimization uses generalized least squares (GLS) to avoid explicitly optimizing over the fixed effects parameters. The likelihood (or restricted likelihood, depending on the estimation option) is profiled over both the scale (a scalar) and the fixed effects parameters. As a result, the Hessian of the profiled log-likelihood is difficult and unnecessary to compute, and Hessian-based methods such as Newton-Raphson cannot be used for model fitting in this context.

References and notes
--------------------

Primary reference for the implementation details:

- Lindstrom, MJ & Bates, DM (1988). "Newton-Raphson and EM algorithms for linear mixed effects models for repeated measures data." Journal of the American Statistical Association, 83(404), 1014-1022.

Additional resources and notes:

- A more recent document: http://econ.ucsb.edu/~doug/245a/Papers/Mixed%20Effects%20Implement.pdf

- Users-oriented documents:
  - http://lme4.r-forge.r-project.org/lMMwR/lrgprt.pdf
  - http://lme4.r-forge.r-project.org/slides/2009-07-07-Rennes/3Longitudinal-4.pdf

Notation
--------

- cov_re: the random effects covariance matrix (also referred to as Psi)
- scale: the scalar error variance
- For a single group, the marginal covariance of endog given exog is scale * I + Z * cov_re * Z'
- vcomp: a vector of variance parameters. Its length is determined by the number of keys in the exog_vc argument (to MixedLM) or the vc_formula argument when using formulas.

Implementation notes
--------------------

- The model supports both standard random effects (with a fixed number of random effects per group) and variance components (uncorrelated random effects with group-specific variances).
- Random effects are assumed to have mean zero and group-independent realizations.
- The MixedLM class implements common post-estimation tasks and focuses on efficiency for data partitioned into independent groups.

References to related work and tools
------------------------------------

- Profile likelihood approaches and related estimation techniques are discussed in the references above.
- Notation and parameterization details align with classical linear mixed models literature.

See also
--------

- Mixed models in related software and documentation (e.g., lme4 and related literature).
- General references on linear mixed effects models and multilevel modeling.

Example usage (brief)
---------------------

- Instantiate a MixedLM model with endog, exog, exog_re, groups, and optional variance components formula or structure.
- Fit the model using ML or REML estimation.
- Access fixed effects (fe_params), random effects structure (cov_re / scale), and variance components, along with standard errors and convergence diagnostics.

Notes
-----

- The documentation above reflects the theoretical foundation, parameterizations, and implementation choices used in this module.