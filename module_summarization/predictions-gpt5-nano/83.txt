CockroachEngine
===============

Overview
--------
CockroachEngine is an extension of PostgresEngine tailored for CockroachDB. It provides CockroachDB compatibility by reusing the Postgres engine functionality and adding a Cockroach-specific preparation step to enable certain experimental features.

Key characteristics
- engine_type: "cockroach"
- min_version_number: 0 (CockroachDB versioning is not currently supported)

Inheritance
-----------
- Inherits from: :class:`piccolo.engine.postgres.PostgresEngine`

Class Reference
--------------
class CockroachEngine(PostgresEngine)

Attributes
- engine_type: str = "cockroach"
- min_version_number: int = 0

Constructor
-----------
__init__(self, config: dict[str, Any], extensions: Sequence[str] = (), log_queries: bool = False, log_responses: bool = False, extra_nodes: dict[str, CockroachEngine] = None) -> None

Parameters
- config: Dict[str, Any]
  Configuration dictionary for the engine.
- extensions: Sequence[str] = ()
  Optional list of extensions to load.
- log_queries: bool = False
  Whether to log SQL queries.
- log_responses: bool = False
  Whether to log responses from the database.
- extra_nodes: Dict[str, CockroachEngine] = None
  Optional extra engine nodes for distributed setups.

Behavior
- Calls super().__init__ with the provided arguments.

Methods
-------
prep_database(self) -> None
- Attempt to enable CockroachDB-specific behavior by running in a new connection:
  - SET CLUSTER SETTING sql.defaults.experimental_alter_column_type.enabled = true;
- If an asyncpg.exceptions.InsufficientPrivilegeError is raised, emit a warning:
  - Message: "=> Unable to set up Cockroach DB functionality may not behave as expected. Make sure your database user has permission to set cluster options."
  - Level: Level.medium

Notes
- The module uses a LazyLoader to defer importing asyncpg until needed.
- The prep_database step is a best-effort setup; lack of privileges will log a warning instead of failing.

Usage example
-------------
.. code-block:: python

   from piccolo.engine.cockroach_engine import CockroachEngine

   engine = CockroachEngine(config={"database": "mydb"})
   await engine.prep_database()  # may warn if privileges are insufficient

See Also
--------
- :class:`piccolo.engine.postgres.PostgresEngine` for the base Postgres functionality.
- :func:`piccolo.utils.warnings.colored_warning` for warning output.