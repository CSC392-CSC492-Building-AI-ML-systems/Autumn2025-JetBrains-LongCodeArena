Async
=====

This module provides generator-based plans intended for asynchronous-style usage with Bluesky. It defines three public plans: count, list_scan, and rel_list_scan (the latter is a placeholder for future implementation). The plans compose existing building blocks (detectors, motors, plan patterns, and preprocessors) to build higher-level asynchronous scan and acquisition routines.

Public API
----------

count(detectors, num=1, delay=None, *, per_shot=None, md=None)
- Description: Take one or more readings from detectors with optional per-shot customization.
- Parameters:
  - detectors (list): A list of readable objects. Each detector contributes to the measurement.
  - num (int, optional): Number of readings to take. Default is 1. If None, capture data until canceled.
  - delay (iterable or scalar, optional): Time delay in seconds between successive readings. Default is 0. If an iterable is provided, it must have at least num - 1 entries; otherwise a ValueError may be raised during iteration.
  - per_shot (callable, optional): Hook for customizing the action of the inner loop (messages per step). Expected signature:
    def f(detectors: Iterable[OphydObj]) -> Generator[Msg]:
      ...
  - md (dict, optional): Metadata to attach to the plan.
- Returns: A generator (plan) that yields from the inner_count plan.
- Notes:
  - If per_shot is None, it defaults to bps.one_shot.
  - Metadata includes detectors, num_points, num_intervals, plan_args, plan_name, and hints. The default hints include a primary time dimension when appropriate.

Example (usage sketch)
- count([det1, det2], num=5, delay=0.1)
- count([det], num=None)  # stream until canceled

list_scan(detectors, *args, per_step=None, md=None)
- Description: Scan over one or more variables in steps simultaneously (inner product).
- Parameters:
  - detectors (list): A list of readable objects.
  - *args: Pairs of (motor, [points...]). For N motors, provide N pairs. Motors can be settable objects (motors, temperature controllers, etc.). Each points list defines the positions to visit for the corresponding motor.
  - per_step (callable, optional): Hook for customizing the action of the inner loop (messages per step). Expected signature:
    f(detectors, motor, step) -> plan (generator)
  - md (dict, optional): Metadata to attach to the plan.
- Returns: A generator (plan) produced by calling scan_nd with a full cycler derived from the motors and position lists.
- Implementation details:
  - Validates that the number of args is even (motor, points) for each motor.
  - Ensures all position lists have the same length; raises ValueError if not.
  - Builds metadata (_md) including detectors, motors, number of points, and plan pattern information.
  - Derives default hints from motor hints (fields) to set dimensions if available.
  - Uses plan_patterns.inner_list_product to create the full cycler and delegates to scan_nd.
- See Also:
  - bluesky.plans.rel_list_scan
  - bluesky.plans.list_grid_scan
  - bluesky.plans.rel_list_grid_scan
  - plan_patterns and related utilities

Notes:
- The function relies on the internal plan framework (preprocessors, plan stubs, and plan patterns) to compose a multi-motor inner product scan.
- The default hints attempt to reflect motor-provided fields for dimensional metadata.

rel_list_scan(detectors, *args, per_step=None, md=None)
- Description: Scan over one variable in steps relative to the current position.
- Parameters:
  - detectors (list): A list of readable objects.
  - *args: A motor and a list of relative steps, repeated per motor as in list_scan.
  - per_step (callable, optional): Hook for customizing action of inner loop (messages per step). Expected signature:
    f(detectors, motor, step) -> plan (generator)
  - md (dict, optional): Metadata to attach to the plan.
- Returns: Not yet implemented in this version; a placeholder for future development.
- Notes:
  - The function is intended to mirror list_scan but with step specifications relative to the current position.
  - As of this version, the implementation is a placeholder (TODO).

Dependencies and context
------------------------
- This module relies on Bluesky constructs (detectors, motors, and plan decorators) and a plan-pattern system (plan_patterns) to describe and structure plans.
- It uses:
  - preprocessors (bpp) for stage/run decorators
  - plan_stubs (bps) for inner plan building blocks
  - plan_patterns for inner_list_product
  - metadata conventions (plan_args, plan_name, hints)

Usage guidance
--------------
- Use count when you need a simple, multi-reading acquisition from detectors with optional per-shot customization.
- Use list_scan for multi-motor scans where you want the Cartesian product of motor positions (inner product) across motors.
- Use rel_list_scan when you need to explore relative moves from the current position (future implementation).

Notes for maintainers
---------------------
- rel_list_scan is currently a placeholder; implement according to the intended behavior described above.
- The documentation reflects the codeâ€™s structure, including metadata keys and default hints behavior.