MixedGLM
========

Bayesian inference for generalized linear mixed models.

Currently only families without additional scale or shape parameters are supported
(binomial and Poisson).

Two estimation approaches are supported: the Laplace approximation (maximum a
posteriori) and variational Bayes (mean-field approximation to the posterior
distribution).

All realizations of random effects are modeled to be mutually independent in
this implementation.

The exog_vc matrix is the design matrix for the random effects. Every column of
exog_vc corresponds to an independent realization of a random effect. These
random effects have mean zero and an unknown standard deviation. The standard
deviation parameters are constrained to be equal within subsets of the columns.
When not using formulas, these subsets are specified through the parameter ident.
ident must have the same length as the number of columns of exog_vc, and two
columns whose ident values are equal have the same standard deviation. When
formulas are used, the columns of exog_vc derived from a common formula are
constrained to have the same standard deviation.

In many applications, exog_vc will be sparse. A sparse matrix may be passed when
constructing a model class. If a dense matrix is passed, it will be converted
internally to a sparse matrix. There currently is no way to avoid creating a
temporary dense version of exog_vc when using formulas.

Model and parameterization
--------------------------

The joint density of data and parameters factors as:

.. math::

    p(y | vc, fep) p(vc | vcp) p(vcp) p(fe)

The terms p(vcp) and p(fe) are prior distributions that are taken to be Gaussian
(the vcp parameters are log standard deviations so the standard deviations have
log-normal distributions). The random effects distribution p(vc | vcp) is
independent Gaussian (random effect realizations are independent within and
between values of the ident array). The model p(y | vc, fep) depends on the
specific GLM being fit.

Priors
------

- vcp_p: prior standard deviation for variance component parameters (the prior
  standard deviation of log(s) is vcp_p, where s is the standard deviation of a
  random effect).

- fe_p: prior standard deviation for fixed effects parameters.

- The priors for vcp and fe are Gaussian; the vcp parameters themselves are
  transformed to a log-normal distribution.

- For some families (e.g., Binomial), setting vcp_p too large can make the
  posterior mode difficult to locate numerically. A value around 0.5 often works
  well.

API and return value
--------------------

- endog: array_like
  Vector of response values.

- exog: array_like
  Covariates for the fixed effects part of the mean structure.

- exog_vc: array_like
  Covariates for the random part of the model. May be a scipy.sparse array; if
  not, the passed array will be converted to sparse internally.

- ident: array_like
  Array of integer labels showing which random terms (columns of exog_vc) have a
  common variance.

- vcp_p: float
  Prior standard deviation for variance component parameters.

- fe_p: float
  Prior standard deviation for fixed effects parameters.

- family: statsmodels.genmod.families instance
  The GLM family (e.g., Binomial, Poisson).

- fep_names: list of strings
  Names of the fixed effects parameters (corresponding to columns of exog).
  If None, default names are constructed.

- vcp_names: list of strings
  Names of the variance component parameters (corresponding to distinct labels
  in ident). If None, default names are constructed.

- vc_names: list of strings
  Names of the random effect realizations.

Returns
-------

- MixedGLMResults object

Methods
-------

- fit_map()
  Laplace approximation to the posterior (maximum a posteriori estimate).

- fit_vb()
  Variational Bayes approximation to the posterior (mean-field).

Notes
-----

- All random effects are modeled as independent Gaussian values (given the
  variance structure parameters). Every column of exog_vc has a distinct realized
  random effect used to form the linear predictors. The elements of ident determine
  the distinct variance structure parameters. Two random effect realizations with
  the same ident value share the same variance. When fitting with formulas, ident
  is constructed internally (each element of vc_formulas yields a distinct label in ident).

- The random effect standard deviation parameters (vcp) have log-normal priors
  with mean 0 and standard deviation vcp_p.

- The prior for the fixed effects parameters is Gaussian with mean 0 and standard
  deviation fe_p.

Examples
--------

{example}

References
----------

- Introduction to generalized linear mixed models:
  https://stats.idre.ucla.edu/other/mult-pkg/introduction-to-generalized-linear-mixed-models

- SAS documentation:
  https://support.sas.com/documentation/cdl/en/statug/63033/HTML/default/viewer.htm#statug_intromix_a0000000215.htm

- An assessment of estimation methods for generalized linear mixed models with binary outcomes
  https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3866838/