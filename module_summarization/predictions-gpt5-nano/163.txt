Tensor Attributes
=================

Overview
--------

Tensor Attributes describe metadata associated with tensors in the OneFlow MLIR dialect. They provide static information about a tensor’s shape, data type, layout, and related properties. This metadata is carried alongside tensor-producing operations to enable optimizations, shape propagation, and correct codegen across dialect transformations.

Structure
---------

Tensor Attributes are represented as a dictionary-style attribute (DictionaryAttr) attached to an operation or a tensor value. The dictionary contains key–value pairs describing the tensor properties. Typical keys include shape, dtype, layout, and device, among others. Values use standard MLIR attribute types (IntegerAttr, ArrayAttr, StringAttr, etc.).

Common Keys and Meanings
-------------------------

- shape: A list of integers describing the tensor’s dimensions. A dynamic or unknown dimension can be represented by a sentinel (e.g., -1 or an explicit dynamic marker, depending on the dialect conventions).
- dtype: The element data type of the tensor (e.g., f32, f16, i64). This can be expressed as a type reference or a string, depending on the attribute encoding used by the dialect.
- layout: A string describing the memory/layout convention (for example, "NCHW", "NHWC", or other vendor-specific layouts).
- device: The target device for the tensor (e.g., "CPU", "GPU", or a device string like "/device/cpu:0"). This guides where the tensor is allocated or executed.
- strides: A list of integers describing the tensor’s strides, if provided separately from shape.
- memory_order: Optional hint about memory order (e.g., "ROW_MAJOR", "COL_MAJOR") if the dialect supports it.
- additional: Any other dialect-specific keys used by OneFlow to carry extra tensor metadata required by transforms, optimizers, or runtimes.

Examples
--------

- Static, fully-specified tensor
  - shape = [1, 3, 224, 224]
  - dtype = f32
  - layout = "NCHW"
  - device = "CPU"

- Dynamic batch size with layout
  - shape = [-1, 3, 224, 224]
  - dtype = f16
  - layout = "NHWC"
  - device = "GPU"

Usage notes
-----------

- Tensor Attributes are attached to tensor-producing operations and are propagated through dialect transformations when possible.
- Validation of tensor attributes should ensure consistency with the associated tensor type (e.g., shape matches the rank and any dynamic dimensions are supported by the consumer).
- Tools in the build may read these attributes to customize code generation, optimization passes, and runtime behavior.

See also
---------

- MLIR: ShapedType and RankedTensorType
- MLIR: Attribute system (IntegerAttr, ArrayAttr, DictionaryAttr)
- OneFlow dialect documentation for tensor-related operators and their attribute requirements