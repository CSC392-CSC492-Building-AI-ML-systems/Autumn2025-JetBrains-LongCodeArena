Utilities for searching ASDF trees
==================================

Overview
--------
This module provides utilities for searching ASDF trees and the result type
AsdfSearchResult, which represents the outcome of an ASDF search operation.

Public API
----------
AsdfSearchResult
----------------

Description
    Result of a call to AsdfFile.search.

Constructor
    AsdfSearchResult(
        identifiers,
        node,
        filters=[],
        parent_node=None,
        max_rows=DEFAULT_MAX_ROWS,
        max_cols=DEFAULT_MAX_COLS,
        show_values=DEFAULT_SHOW_VALUES,
    )

Parameters
    - identifiers: path-like identifiers to the matched node(s)
    - node: the root node of the tree to search within
    - filters: a list of callable filters applied to nodes
    - parent_node: the parent node of the matched node(s)
    - max_rows: maximum number of lines to render (default from _display)
    - max_cols: maximum width of rendered lines (default from _display)
    - show_values: whether primitive values are shown (default from _display)

Notes
    - The class aggregates search filters and can render results with
      configurable display settings.

Methods
-------
format(self, max_rows=NotSet, max_cols=NotSet, show_values=NotSet)
    Change formatting parameters of the rendered tree.

    Parameters
        - max_rows: maximum number of lines to print. Use NotSet to keep the
          current value.
        - max_cols: maximum line length. Use NotSet to keep the current value.
        - show_values: whether to display primitive values. Use NotSet to keep
          the current value.

    Returns
        AsdfSearchResult: a new result instance with updated formatting.

_maybe_compile_pattern(self, query)
    If query is a string, compile it to a regular expression; otherwise return
    the query unchanged. Used to support both strings and precompiled patterns.

_safe_equals(self, a, b)
    Safely compare two values, returning a boolean or False if comparison
    raises an exception.

_get_fully_qualified_type(self, value)
    Return the fully qualified type name for a value. Builtin types return
    their simple name; non-builtin types return module.name.

search(self, key=NotSet, type=NotSet, value=NotSet, filter=None)
    Further narrow the search.

    Parameters
        - key: NotSet, str, or any other object. Supports exact match or pattern
          matching for keys/indices. If str, interpreted as a regular expression.
        - type: NotSet, str, or builtins.type. Supports pattern matching on fully
          qualified type names or exact isinstance checks.
        - value: NotSet, str, or any other object. Pattern match for strings; or
          exact equality for other objects.
        - filter: optional callable taking (node, identifier) and returning True to
          retain the node.

Returns
    AsdfSearchResult: a new result with the additional filter applied.

replace(self, value)
    Assign a new value in place of all leaf nodes in the search results that pass
    all filters.

    Parameters
        - value: object to assign to matching leaf nodes.

node (property)
    Retrieve the leaf node of a tree with one search result.

Examples
--------
.. code-block:: python

    # Assuming you have an open AsdfFile instance `f`
    result = f.search(key="path.to.node")
    # Narrow by type and value, then hide primitive values in the display
    narrowed = result.search(type="int", value=NotSet).format(show_values=False)

    # Replace all matching leaf nodes with a new value
    narrowed.replace(42)

Notes
-----
- NotSet is used to indicate that a constraint should be left unchanged.
- The search API supports both exact matches and regular-expression patterns
  for flexible querying of ASDF trees.