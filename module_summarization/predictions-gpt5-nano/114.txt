Simulation Utilities
====================

Overview
--------
This module provides utilities for visualizing and validating Bluesky plans. It includes:

- plot_raster_path: visualize the raster path produced by a plan.
- summarize_plan (and alias print_summary): print a compact summary of a plan.
- check_limits: verify that a plan does not move devices outside their limits.

API
---

plot_raster_path(plan, x_motor, y_motor, ax=None, probe_size=None, lw=2)
    Plot the raster path for this plan.

    Parameters
    ----------
    plan : iterable
        Must yield `Msg` objects and not be a co-routine
    x_motor, y_motor : str
        Names of the x and y motors
    ax : matplotlib.axes.Axes, optional
        The axes to plot to; if None, a new figure and axes are created
    probe_size : float, optional
        If not None, use as radius of probe (in the same units as motor positions)
    lw : float, optional
        Width of lines drawn between points

    Returns
    -------
    dict
        {'path': path, 'events': read_points}

    Notes
    -----
    - The function iterates over the plan and tracks the current x/y positions by responding to
      'set' messages for the specified motor names.
    - 'save' messages record a point in the trajectory.
    - If probe_size is provided, a collection of circles is drawn at trajectory points;
      otherwise the trajectory is plotted with markers.

summarize_plan(plan)
    Print summary of plan.

    Parameters
    ----------
    plan : iterable
        Must yield `Msg` objects

    Returns
    -------
    None

    Notes
    -----
    Prints a minimal version of the plan, showing only moves and where events are created
    using Bluesky's print_summary_wrapper.

print_summary = summarize_plan  # back-compat
    Alias for backward compatibility with older code.

check_limits(plan)
    Check that a plan will not move devices outside of their limits.

    Parameters
    ----------
    plan : iterable
        Must yield `Msg` objects

    Returns
    -------
    None

    Notes
    -----
    - For each 'set' message, if the object has a check_value method, it is called with the new value.
    - If an object lacks check_value, a warning is emitted and the object is ignored for subsequent checks.

Dependencies
------------
- matplotlib
- bluesky (print_summary_wrapper)

Example usage
-------------
Plot the raster path for a plan and motor names 'x' and 'y':

.. code-block:: python

    from simulation import plot_raster_path, summarize_plan, check_limits

    plan = ...  # an iterable yielding Msg objects
    fig_path = plot_raster_path(plan, x_motor='x', y_motor='y', probe_size=0.5, lw=2)

Print a compact summary of a plan:

.. code-block:: python

    summarize_plan(plan)

Check that a plan respects device limits:

.. code-block:: python

    check_limits(plan)

Notes
-----
- The module expects Bluesky Msg objects with attributes such as command, obj, and args.
- The plot_raster_path function creates a plot using matplotlib; if ax is not provided, a new figure is created.
- The check_limits function uses a object's check_value method if available; otherwise it issues a warning.