sans_to_sesans.rst

SANS to SESANS conversion
========================

Overview
--------

This document describes the conceptual approach to converting Small-Angle Neutron Scattering (SANS) data to a SESANS representation. The SESANS signal G(z) can be related to the SANS scattering intensity I(q) through a kernel that encodes the spin-echo geometry and the scattering physics.

Conceptual basis
--------------

- SANS measures I(q) as a function of momentum transfer q.
- SESANS yields a real-space correlation signal G(z) as a function of spin-echo length z.
- A kernel W(q, z) connects the two representations via an integral over q:
  G(z) = âˆ« I(q) W(q, z) dq
- A common form for the kernel is W(q, z) = [sin(q z / 2) / (q z / 2)]^2, up to normalization factors.
- The transformation is performed on a suitable q-grid, with careful handling of the q-range, resolution, and background.

Data model and workflow
-----------------------

- Inputs:
  - I(q): SANS intensity as a function of q, with optional uncertainties.
  - q-grid: Discretized momentum-transfer values over which I(q) is defined.
  - z-grid: Desired spin-echo lengths for the SESANS representation.
- Outputs:
  - G(z): SESANS correlation function corresponding to the input I(q) and chosen kernel.
- Typical workflow:
  1. Prepare I(q) and errors on a common q-grid.
  2. Choose an appropriate z-grid for SESANS analysis.
  3. Compute G(z) by numerical integration of I(q) with W(q, z).
  4. Propagate uncertainties from I(q) to G(z).
  5. Validate against baseline measurements or simulated data.

Practical considerations
------------------------

- Normalization and units: Ensure consistent units for I(q) and the kernel; apply any required normalization to match SESANS conventions.
- q-range and resolution: The finite q-range and sampling affect the resolution and accuracy of G(z); extend or interpolate as needed with caution.
- Instrument effects: Instrumental broadening, background subtraction, and polarization leakage should be accounted for to obtain a meaningful G(z).
- Validation: Compare with synthetic data where the exact G(z) is known, or with direct SESANS measurements for benchmark samples.

Implementation notes (high level)
---------------------------------

- Represent I(q) on a numpy-aligned grid and evaluate the kernel W(q, z) for each z.
- Use numerical integration (e.g., trapezoidal rule) to compute G(z) from I(q) across the z-grid.
- Propagate uncertainties through the integration, e.g., via standard error propagation or Monte Carlo sampling.
- Provide test cases with known transforms to verify correctness.

Relationship to repository components
-------------------------------------

- The codebase includes utilities for parameter discovery and model information (useful for documenting model-dependent aspects of a SANS-to-SESANS workflow).
- It also contains a coordinate transformation utility (latitude-longitude to Guyou projection) that is unrelated to SANS/SESANS and serves as a reference for handling general numerical transformations.

Example workflow (high level)
-----------------------------

- Load I(q) and its uncertainties.
- Define a q-grid and a z-grid.
- Compute G(z) using the integral with kernel W(q, z).
- Compare the resulting G(z) with SESANS measurements or use it to interpret structural features in real space.

Notes
-----

- This document outlines a conceptual approach. Implementations will require careful numerical treatment and validation against experimental SESANS data.