Using review sessions
=====================


Overview
--------

A review session is a client-side context for interacting with an ftrack server during reviews. It is implemented via the ftrack_api.Session class and manages credentials, connection behavior, caching, and optional event hub integration. Authentication is performed by attaching the API key and user to each HTTP request through SessionAuthentication.

Getting started
---------------

Create a session to begin a review workflow. Typical parameters include the server address, credentials, and optional behavior flags.

.. code-block:: python

    from ftrack_api import Session

    session = Session(
        server_url='https://ftrack.example.com',
        api_key='your_api_key',
        api_user='your_user',
        auto_populate=True,
        auto_connect_event_hub=True,
        schema_cache_path='/path/to/schema_cache',
        plugin_arguments={}
    )

Key options
-----------

- server_url
  - URL of the ftrack server (including port if required).

- api_key
  - API key used for authentication.

- api_user
  - Username associated with the API key.

- auto_populate
  - When accessing entity attributes, they are fetched from the server on demand if not already loaded.

- plugin_paths
  - List of paths to search for plugins (used during plugin discovery).

- cache
  - Instance implementing ftrack_api.cache.Cache to be used as the session cache. May also be a callable returning a cache or None to skip.

- cache_key_maker
  - Instance implementing ftrack_api.cache.KeyMaker to generate cache keys. Defaults to a StringKeyMaker.

- auto_connect_event_hub
  - If True, an embedded event hub will be automatically connected to the event server to allow publishing and subscribing to non-local events.

- schema_cache_path
  - Path to a folder for schema caching. Set to False to disable schema caching entirely.

- plugin_arguments
  - Optional mapping of keyword arguments passed to plugin registration upon discovery. If a plugin signature does not accept the provided arguments, only compatible arguments are passed and a warning may be logged.

Authentication details
----------------------

Requests made through the session are authenticated by injecting headers as follows:

- ftrack-api-key: the API key
- ftrack-user: the API user

This behavior is implemented by the SessionAuthentication class, which is used automatically by the requests framework.

Event hub behavior
------------------

- When auto_connect_event_hub is True, the event hub connection runs in a background thread to improve startup time.
- Subscribing to events does not require an active hub, but certain plugins may require a connected hub for non-local events.

Caching and performance
-----------------------

- The session ensures a top-level MemoryCache is present, providing a layered caching strategy.
- A user-supplied cache can be provided via the cache parameter, along with a custom key maker for cache keys.

Environment and troubleshooting
-------------------------------

Environment variables that influence session creation and behavior:

- FTRACK_SERVER
  - Default server URL if server_url is not provided.

- FTRACK_API_KEY
  - Default API key if api_key is not provided.

- FTRACK_API_USER
  - Default API user if api_user is not provided.

- FTRACK_API_SCHEMA_CACHE_PATH
  - Default path for the schema cache if schema_cache_path is not specified.

Notes
-----

- Accessing entities with auto_populate enabled will fetch data on demand.
- If auto_connect_event_hub is disabled, you may connect the hub manually when needed.
- The Session object also maintains a record of pending operations via recorded_operations and related flags.

See also
--------

- ftrack_api.Session for details on initialization and use.
- ftrack_api.SessionAuthentication for understanding how authentication headers are applied to requests.