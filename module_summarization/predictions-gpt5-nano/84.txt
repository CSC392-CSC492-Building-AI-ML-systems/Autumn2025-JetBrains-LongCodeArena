Piccolo Apps
============

Overview
--------
This module provides infrastructure to declare, configure, and discover Piccolo apps within a project. It defines helpers and data structures used by the project’s app configuration system, including:
- MigrationModule and PiccoloAppModule for module typing and app configuration
- table_finder for discovering Table subclasses across modules
- Command and AppConfig as the core building blocks for per-app settings
- AppRegistry to collect and manage app configurations

API reference
-------------

MigrationModule
- A ModuleType subclass used for migration modules.
- Expected attributes:
  - ID: str
  - VERSION: str
  - DESCRIPTION: str
- forwards(): an asynchronous method returning None (stub in this base class).

PiccoloAppModule
- A ModuleType subclass used for app modules.
- Expected attributes:
  - APP_CONFIG: AppConfig

table_finder(modules, include_tags=None, exclude_tags=None, exclude_imported=False)
- Purpose: Discover Table subclasses in the given modules without importing every class manually.
- Parameters:
  - modules: a sequence of module paths to inspect (e.g., ['blog.tables']).
  - include_tags: tags that a Table subclass must have to be included. If None, defaults to including all via '__all__'.
  - exclude_tags: tags that, if present on a Table subclass, will exclude it. Takes precedence over include_tags.
  - exclude_imported: if True, only Tables defined in the specified module path(s) are considered.
- Returns: a list of Table subclasses found in the provided modules.

Command
- A dataclass describing a command that can be registered with an app.
- Fields:
  - callable: the function or coroutine to execute
  - aliases: optional list of alternative command names

AppConfig
- Dataclass representing the configuration for a single Piccolo app.
- Fields:
  - app_name: str — the logical name of the app (e.g., 'article')
  - migrations_folder_path: str — path to the app’s migrations
  - table_classes: List[Type[Table]] — registered table classes (default: empty list)
  - migration_dependencies: List[str] — module paths of apps that this app depends on (default: empty)
  - commands: List[Union[Callable, Command]] — commands exposed by this app (default: empty)
- __post_init__():
  - Normalizes commands to a list of Command instances
  - Converts migrations_folder_path to str if provided as a pathlib.Path
  - Initializes a private cache for migration_dependency_app_configs
- register_table(table_class: Type[Table]) -> Type[Table]
  - Registers a table class with the app and returns the class
- migration_dependency_app_configs (property)
  - Resolves and returns AppConfig instances for all apps listed in migration_dependencies
  - Caches the result for efficiency and ease of testing
- get_table_with_name(table_class_name: str) -> Type[Table]
  - Returns the registered Table subclass with the given class name
  - Raises ValueError if no such table exists

AppRegistry
- A registry that records all Piccolo apps in the project (typically kept in piccolo_conf.py).
- Purpose: central collection point for app configurations.
- Initialization:
  - __init__(apps: List[str] = None) — accepts an optional list of app paths
  - Stores the provided apps and prepares to manage AppConfig instances
- Notes:
  - The implementation in the source shows initialization of an apps list and a container for app configurations, intended to map app paths to AppConfig instances.

Usage notes
- Use AppConfig to declare per-app settings, including its name, migrations location, and any table classes and commands it contributes.
- Use table_finder to dynamically locate necessary Table subclasses across modules, with optional tag-based filtering.
- Use AppRegistry to collect and access all app configurations from your project’s configuration module.

Example (conceptual)
- Define an app configuration with a registered table and a command
  - app_name: "blog"
  - migrations_folder_path: "migrations/blog"
  - register a Table subclass via app_config.register_table(BlogPost)
  - add a function or Command to app_config.commands

See also
- piccolo.table.Table for table definitions used with AppConfig
- piccolo.engine.base.Engine for runtime execution context of migrations and commands
- piccolo.utils.graphlib.TopologicalSorter for dependency-aware ordering of migrations

Notes
- This module’s AppRegistry implementation is shown fragmentarily in the source; the documentation reflects the intended role and typical usage of the classes and functions defined here.