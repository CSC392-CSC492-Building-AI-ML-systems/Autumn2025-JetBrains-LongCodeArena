BaseUser
========

A Piccolo ORM Table that provides a basic user model with authentication support.

Overview
--------

- Inherits from piccolo.table.Table with table name "piccolo_user".
- Fields:
  - id: Serial (primary key)
  - username: Varchar(100), unique
  - password: Secret(255)
  - first_name: Varchar (nullable)
  - last_name: Varchar (nullable)
  - email: Varchar(255), unique
  - active: Boolean (default False)
  - admin: Boolean (default False) with helper text: "An admin can log into the Piccolo admin GUI."
  - superuser: Boolean (default False) with help text describing password management rights in the admin GUI.
  - last_login: Timestamp (nullable, default None, required False) with help text: "When this user last logged in."

Internal constants and password policy
-------------------------------------

- _min_password_length = 6
- _max_password_length = 128
- _pbkdf2_iteration_count = 600_000
  - The default number of PBKDF2-HMAC-SHA256 iterations (per OWASP guidance in this code).

Key behaviors
-------------

Password handling
- When constructing a BaseUser, if a raw password is provided, it is hashed unless it already starts with "pbkdf2_sha256".
- __setattr__ ensures that assigning a password hashes the value if needed.
- get_salt() returns a new random 16-byte hex salt.
- hash_password(password, salt="", iterations=None) hashes the password using PBKDF2-HMAC-SHA256 and returns a string in the form:
  pbkdf2_sha256$<iterations>$<salt>$<hash>
- Exceedingly long passwords raise a ValueError.

Validation
- _validate_password(password) enforces:
  - A password must be provided.
  - Length must be between _min_password_length and _max_password_length.
  - A password starting with "pbkdf2_sha256" is rejected (avoid passing already-hashed passwords).

Password updates
- update_password(user, password) updates the password for a user identified by username (str) or id (int).
- update_password_sync is a synchronous wrapper around update_password.
- The raw password is validated and then hashed before saving.

Authentication
- login(username, password) verifies credentials.
  - Accepts either a username (str) or a user id (via the username field).
  - Validates input lengths.
  - Checks the stored hashed password against the provided password.
  - If valid, the last_login value is updated in the database.
  - Returns the user id on success, or None on failure.
- login_sync is the synchronous wrapper around login.

Utility helpers
- split_stored_password(password) splits a stored hashed password into [algorithm, iterations, salt, hash] and validates the format.

Readability
- get_readable() returns a Readable representation using the username for display.

Usage notes
- The password policy is enforced to improve security, with a default iteration count of 600,000 for PBKDF2-HMAC-SHA256.
- Passwords are stored in hashed form; the system hashes plain passwords on assignment or initialization.
- The class supports both credential creation and authentication workflows suitable for a basic user model in applications using Piccolo.

See also
- Readable: representation helper used by get_readable().
- The module relies on Piccolo ORM components (Table, Serial, Varchar, Secret, Boolean, Timestamp) and utility run_sync for synchronous operations.