w_states
========

Display or manipulate basis (initial) or target (recycling) states for a WEST simulation.

Synopsis
--------
w_states [options]

Description
-----------
The w_states command lets you inspect or modify the basis (initial) states or target (recycling) states used by a WEST simulation. By default, states are displayed (and can be dumped to files). You can replace the current states for the next iteration or append new target states to the existing list.

Important notes
- Basis state appending is not permitted. Appending basis states would require renormalizing basis state probabilities in ways that may be error-prone. To add basis states, use:
  - w_states --show --bstate-file=bstates.txt
  - edit bstates.txt
  - then use w_states --replace --bstate-file=bstates.txt to update the WEST HDF5 file appropriately.
- Target states may be appended or replaced, depending on the chosen mode.

Modes of operation
------------------
- --show
  Display current basis/target states (or dump to files). This is the default mode.
  - If --bstate-file is given, basis states for the current iteration are written to that file.
  - If --tstate-file is given, target states for the current iteration are written to that file.
  - Output includes a header line indicating the iteration number, followed by the states written by BasisState.states_to_file / TargetState.states_to_file.

- --replace
  Replace current basis/target states with those specified.
  - If the current iteration has completed segments, the new states are applied to the next iteration.
  - Basis states can be supplied from:
    - --bstate-file (read basis states from file)
    - --bstate (explicit basis state strings in the form label,probability[,auxref])
  - After collecting basis states, their probabilities are checked to sum to unity. If they do not, they are rescaled to unity.
  - Basis states are assigned progress coordinates, written to the ibstate group, and reported to the simulation manager.
  - Target states are handled similarly when provided.

- --append
  Append the given target state(s) to those currently in use.
  - Append is supported for target states; basis states should not be appended (see above note).
  - Target states can be supplied from:
    - --tstate-file (read target states from file)
    - --tstate (explicit target state strings in the form label,pcoord0[,pcoord1[,...]])
  - The appended target states are added to the existing list for the next iteration.

State files and formats
-----------------------
- Basis states file (--bstate-file) and target states file (--tstate-file) are used for reading or writing state information.
- Basis state strings (--bstate) use the format: label,probability[,auxref]
- Target state strings (--tstate) use the format: label,pcoord0[,pcoord1[,...]]
- When displaying (--show) basis/target states, the corresponding states are written by BasisState.states_to_file / TargetState.states_to_file.

Implementation notes
--------------------
- The command interacts with the WEST data manager and simulation manager to retrieve, create, or update state data for the current or next iteration.
- For basis states, after parsing input, probabilities are validated and normalized if necessary, progress coordinates are assigned, and the new states are written to the appropriate WEST HDF5 structures.
- A small EPS tolerance is used to detect non-unity total probability and trigger rescaling when necessary.

Examples
--------
- Show current states to stdout:
  w_states

- Show basis states to a file:
  w_states --show --bstate-file=bstates.txt

- Replace current basis states from a file:
  w_states --replace --bstate-file=bstates.txt

- Replace current target states by appending new ones from the command line:
  w_states --replace --tstate "stateA,0.1,0.0" --tstate "stateB,0.2,1.0"

- Append target states from a file:
  w_states --append --tstate-file=more_tstate.txt

Notes
-----
- Basis state appending is not permitted; use the recommended workflow with a file and --replace to update basis states.
- Default mode is show.