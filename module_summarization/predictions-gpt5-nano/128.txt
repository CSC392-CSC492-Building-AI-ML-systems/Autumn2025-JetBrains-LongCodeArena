Miscellaneous features
=======================

This section highlights several small but useful features used internally by astropy.io.fits, including verification control, hierarchical error collection, and a notifier mixin for simple event plumbing.

Verification and error reporting
--------------------------------

- _Verify class
  - Provides common helpers for performing value verification.
  - Key methods:
    - run_option(option="warn", err_text="", fix_text="Fixed.", fix=None, fixable=True)
      - Executes verification with a selected option, returning a tuple (fixable, message).
      - Behavior depends on the option:
        - "warn" or "exception": fixable is False.
        - Other options: may apply a fix if provided and append a fix message.
  - verify(option="warn")
    - Runs verification across all values in an instance.
    - Accepts a variety of option strings, including combinations like "fix+warn" or "silentfix+ignore".
    - Raises ValueError if the option is not recognized.
    - Returns normally for "ignore".
    - Produces a sequence of messages that can be reported as warnings or raised as errors, and supports a silent mode.
    - When reporting, a header and a note are prepended to the collected messages:
      - "Verification reported errors:"
      - "Note: astropy.io.fits uses zero-based indexing."
- VERIFY_OPTIONS
  - A list of all recognized option strings, including:
    - "ignore", "warn", "exception", "fix", "silentfix"
    - Combinations such as "fix+ignore", "fix+warn", "fix+exception",
      "silentfix+ignore", "silentfix+warn", "silentfix+exception"
  - These options control both reporting and fixing behavior of verification.

Error list structure (_ErrList)
------------------------------

- _ErrList class
  - A specialized list used to accumulate verification errors in a nested structure.
  - Each element can be a tuple containing (fixable, message) or another _ErrList representing a nested level.
  - unit attribute
    - Serves as a header when displaying nested levels (e.g., "Element 0:", etc.).
  - __str__ method
    - Returns the concatenated error messages, one per line.
  - iter_lines(filter=None, shift=0)
    - Iterates over the nested error structure and yields (header, message) pairs with appropriate indentation.
    - The two-pass iteration prints top-level messages first, then descends into nested levels with increased indentation.
  - This structure supports nicely formatted, hierarchical presentation of multiple verification issues.

Notifer mixin utilities (NotifierMixin)
---------------------------------------

- NotifierMixin
  - A mixin providing a lightweight publish/subscribe mechanism for changes on an object.
  - Intended for internal use; most methods are underscored to discourage external use.
  - Core ideas:
    - Register listeners via _add_listener (listeners are stored with weak references).
    - Notify listeners via _notify(change_type, *args, **kwargs); this calls listener._update_change_type(*args, **kwargs) on all registered listeners.
    - If a listener lacks the appropriate update method, it is ignored.
  - Typical usage pattern:
    - Create a notifier object, register a listener implementing the expected update methods, and call _notify when the notifier’s state changes.

Notes and conventions
---------------------

- The verification framework is designed to separate reporting behavior from fixing behavior.
- The default behavior “warn” reports issues; “exception” raises an exception for errors.
- For fixable errors, you can supply a fix callable to automatically correct values; otherwise, errors may be treated as unfixable.
- The verification output is structured to assist users in understanding which issues were fixed and which remain, and to provide clear guidance via warnings or errors as appropriate.