w_red
=====

A WestPA tool to compute raw and RED-corrected rate constants from rate-evolution data, with optional duration-based RED correction.

Usage
-----

w_red [options] DIRECTH5 ISTATE FSTATE

- DIRECTH5: Path to the kinetics HDF5 file containing rate_evolution and related datasets.
- ISTATE: Initial state index.
- FSTATE: Final state index.

Options
-------

- --n-iters N
  Number of iterations to include (n_iters). If omitted, all iterations are used.

- --report-interval N
  dtau is computed as dtau = report_interval / n_steps_iter. Default: 20.

- --n-steps-iter N
  Number of steps per iteration (n_steps_iter). Default: 1000.

- --callback NAME
  Optional callback to receive information (e.g., the RED correction object).

- --red
  Apply RED correction to the rate. If omitted, the raw rate is returned.

What it does
------------

- get_raw_rates(directh5, istate, fstate, n_iters=None)
  Returns the raw (uncorrected) rate constant from the rate_evolution dataset.

- DurationCorrector (class)
  Builds a RED correction model from a kinetics file and durations data.

  - from_kinetics_file(directh5, istate, fstate, dtau, n_iters=None)
    Creates a DurationCorrector using observed durations for the given state pair.

  - correction(iters, freqs=None)
    Returns the RED correction factor for the specified iterations, optionally weighted by freqs.

  - event_duration_histogram
    Histogram of observed event durations.

  - cumulative_event_duration_histogram
    Cumulative histogram of observed event durations.

- calc_avg_rate(directh5_path, istate, fstate, **kwargs)
  Returns a single rate constant (raw or RED-corrected) along with optional handling:
  - n_iters
  - report_interval
  - n_steps_iter
  - callback
  - red
  The function computes dtau, optionally constructs a DurationCorrector when red is True, derives the correction factor, applies it to the rate, and returns the result.

- calc_rates(directh5_path, istate, fstate, **kwargs)
  Returns raw and RED-corrected rates as a function of iterations (based on the rate_evolution dataset). Supports the same kwargs as calc_avg_rate.

Notes
-----

- Rate data are read from the rate_evolution dataset: rate_evolution[iterations, istate, fstate]['expected'].
- RED correction uses a histogram over the durations dataset (durations['duration'], durations['weight']), masked to relevant istate/fstate, with weights > 0.
- The RED correction factor is computed from the normalized f_tilde and its integrals, and applied to the rate when red is requested.

Example
-------

- Get the raw rate for state pair (0 -> 1):

  w_red /path/to/kinetics.h5 0 1

- Get the RED-corrected rate for state pair (0 -> 1):

  w_red --red /path/to/kinetics.h5 0 1