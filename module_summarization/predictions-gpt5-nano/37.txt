w_trace
=======

Trace a trajectory back to its origin and inspect the data that comprise its history.

Overview
--------
The w_trace command reconstructs and exposes the trace of a trajectory starting from a specified last segment
identified by an iteration number and a segment identifier. It uses the WESTPA data manager to walk backward
through the trajectory, collecting per-segment information such as iteration, segment id, weight, walltime,
CPU time, and the final progressive coordinate. It also provides access to the initial state and basis state
information for the trajectory.

Key concepts
- Trace objects are constructed with Trace.from_data_manager(n_iter, seg_id, data_manager=None).
- The trace summary is a structured array with fields:
  - n_iter: iteration number
  - seg_id: segment identifier
  - weight: trajectory weight
  - walltime: wallclock time
  - cputime: CPU time
  - final_pcoord: final pcoord of the segment (shape depends on the pcoord data type)
- endpoint_type records how the trajectory ends (as provided by the data).
- initial_state and basis_state provide the origin state information for the trace.
- The Trace class enables retrieval of additional segment data via get_segment_data_slice and trace_timepoint_dataset.

Usage
-----
- Reconstruct a trace from a given last segment:
  Trace.from_data_manager(n_iter, seg_id)

- Inspect basic trace information:
  t = Trace.from_data_manager(10, 42)
  print(t.endpoint_type)
  print(t.initial_state)
  print(t.basis_state)

- Iterate over the per-segment summary in the trace:
  for row in t:
      print(row)

- Access the initial and basis states directly:
  print(t.initial_state)
  print(t.basis_state)

- Retrieve a data slice from a dataset for a specific iteration/segment:
  data_slice = t.get_segment_data_slice(datafile, dsname, n_iter, seg_id, slice_=(slice(None),))

- Obtain a time-resolved trace for a dataset laid out as [seg_id][timepoint][...]:
  data_trace, weight = t.trace_timepoint_dataset('pcoord', slice_=None)

Data model
----------
The trace summary is a NumPy structured array with the following dtype fields:
- n_iter: n_iter_dtype
- seg_id: seg_id_dtype
- weight: weight_dtype
- walltime: utime_dtype
- cputime: utime_dtype
- final_pcoord: pcoord_dtype with shape pcoord_pt_shape

Notes
-----
- The data manager is optional; if not provided, the default WESTPA data manager is used.
- The implementation supports older HDF5 versions (fallbacks when certain fields are missing).
- The Trace object is designed to efficiently reuse opened auxiliary HDF5 files to minimize I/O overhead.

API references (high level)
- Trace.from_data_manager(n_iter, seg_id, data_manager=None)
- Trace.__len__(), Trace.__iter__(), Trace.__getitem__(sl)
- Trace.get_segment_data_slice(datafile, dsname, n_iter, seg_id, slice_=None, index_data=None, iter_prec=None)
- Trace.trace_timepoint_dataset(dsname, slice_=None, auxfile=None, index_ds=None)

Examples
--------
- Python example:
  .. code-block:: python

     from westpa.core.segment import Segment
     t = Trace.from_data_manager(n_iter=10, seg_id=42)
     print("Endpoint type:", t.endpoint_type)
     print("Initial state:", t.initial_state)
     for row in t:
         print(row)

- Data extraction example:
  .. code-block:: python

     with h5py.File('west.h5', 'r') as datafile:
         slice_data = t.get_segment_data_slice(datafile, dsname='pcoord', n_iter=10, seg_id=42, slice_=(slice(None),))

- Time-series extraction example:
  .. code-block:: python

     data_trace, w = t.trace_timepoint_dataset('pcoord', slice_=None)

See Also
--------
- westpa.tools.WESTTool
- westpa.tools.WESTDataReader
- westpa.core.h5io
- westpa.core.segment.Segment
- westpa.core.states.InitialState

This documentation describes the capabilities and usage of the w_trace command, including how to reconstruct a trajectory trace from the data manager, inspect the traceâ€™s per-segment summary, and retrieve segment data or timepoint traces.