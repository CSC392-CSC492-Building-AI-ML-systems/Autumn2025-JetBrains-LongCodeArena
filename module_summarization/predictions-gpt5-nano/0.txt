Working with assignments and allocations
=======================================

Overview
--------

In the context of the ftrack API, assignments represent the linkage between a user and a task or item to be worked on, while allocations describe the distribution of work capacity (time/effort) among users. The core session helper provided in this codebase enables authenticated communication with an ftrack server, as well as management of pending operations when creating or updating assignments and allocations.

Prerequisites
-------------

- Access to an ftrack server (server_url)
- API credentials (api_key and api_user) or corresponding environment variables
  - FTRACK_SERVER, FTRACK_API_KEY, FTRACK_API_USER
- A running session object to interact with the server
- Optional: a cache for performance, and a key maker for cache keys

Working with assignments
------------------------

- Purpose: Use assignments to associate a user with a specific item (for example, a task or narrative artifact) so work can be tracked and managed.
- Typical workflow:
  - Retrieve the target item and the user to be assigned.
  - Create or update the assignment linking the user to the item.
  - Manage assignment attributes such as role, status, start/end dates, and scope as required by your workflow.
- Operation recording:
  - The session maintains an internal record of operations to be sent to the server.
  - You can inspect or control this behavior via:
    - session.recorded_operations: a collection of pending operations
    - session.record_operations: a flag to enable/disable recording
- Considerations:
  - Assignments are typically created or modified through the server-side API exposed by ftrack.
  - Ensure the target item and user exist and that you have the necessary permissions to modify assignments.

Working with allocations
------------------------

- Purpose: Use allocations to model how much work capacity (time, effort) is allocated to a user for a given item or period.
- Typical workflow:
  - Define the allocation scope (which item, which time window, which user).
  - Create or update the allocation to reflect current planning (and adjust as needed).
  - Monitor allocations alongside assignments to ensure work is properly distributed and tracked.
- Operation recording:
  - Allocations performed through the session follow the same operation recording mechanism as assignments.
  - Pending allocations can be reviewed via session.recorded_operations before being committed to the server.
- Considerations:
  - Allocations should align with project planning, capacity planning, and user availability.
  - Be mindful of concurrent updates; use the operation recorder to batch changes when appropriate.

Session-related notes
---------------------

- Authentication
  - Sessions authenticate requests using API key and user, either supplied directly or via environment variables.
  - This ensures that subsequent interactions with the server (including creating/updating assignments and allocations) are performed under the correct user context.
- Operation management
  - The Session class initializes an Operations tracker (session.recorded_operations) to collect changes before they are sent to the server.
  - The flag session.record_operations controls whether changes are recorded automatically.
- Caching and schema
  - Schema caching can be enabled to speed up repeated interactions by persisting server schema (schema_cache_path).
  - A memory-backed top-level cache is used to improve performance for common operations.
- Event hub
  - If enabled, the embedded event hub allows publishing and subscribing to non-local events. Subscribing to events does not require an active hub connection.

Example workflow (high-level)
-----------------------------

- Create a session with proper credentials.
- Retrieve the target item and user for an assignment.
- Create or update the assignment to link the user to the item.
- Create or update allocations to reflect the userâ€™s capacity for the item.
- Commit or review the recorded operations as needed.

Notes
-----

- This documentation focuses on concepts and the integration surface provided by the session and operation recording mechanism. The exact API calls for creating and manipulating assignments and allocations are provided by the ftrack API layers (e.g., entities, operations) and are accessible through the session object and related modules.
- Consult the specific ftrack API documentation for concrete function and class names, as they may vary across releases.

See also
--------

- ftrack_api
- ftrack_api.operation
- ftrack_api.entity
- ftrack_api.cache
- ftrack_api.logging