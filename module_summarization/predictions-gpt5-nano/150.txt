Plot_data.md

Supporting data to plotting functions in multiple ways

Overview
- This module provides flexible data handling to support plotting functions with various data sources.
- PlotData enables plotting code to work with dictionaries, pandas dataframes, or Bokeh ColumnDataSource objects (when Bokeh is installed), and to combine multiple sources seamlessly.
- It supports single or multiple plot sets, automatic extraction of requested keys, and optional data validation.

Supported data sources
- Allowed data holders:
  - dict
  - pandas.DataFrame
  - Bokeh ColumnDataSource (only if Bokeh is installed)
- If Bokeh is not installed, ColumnDataSource is not allowed.

Initialization and core concepts
- PlotData(data, use_column_source=False, same_length=False, strict_data_keys=False, copy_data=False, **kwargs)
  - data: a single data holder or a list of data holders. Each element must be an allowed data holder.
  - use_column_source: (flag for internal use) relates to how data sources are accessed.
  - same_length: if True and data are dict-like, entries are normalized to the same length across all keys.
  - strict_data_keys: if True, no new data keys may be added after initialization.
  - copy_data: if True, data sources are shallow-copied (or copied for Bokeh ColumnDataSource) to avoid mutating the originals.
  - kwargs: mapping of data keys to column names or lists of column names. Keys you pass here define what data you intend to plot (e.g., x, y, z, color, size).

Multiple plot sets via key lists
- If any value in kwargs is a list, PlotData expands into multiple plot sets.
- The number of sets (num_sets) is the maximum length of any list provided.
- For each set, a namedtuple Columns is created with the appropriate key-value mapping.
- If the data argument is a list, its length must match num_sets.
- Each set yields a separate entry when iterating PlotData, allowing per-set plotting parameters.

Data keys and data access
- data_keys property returns the registered data keys for the instance.
- The keys correspond to the fields of the internal Columns namedtuple created from kwargs.
- Typical keys you might define include:
  - x, y: coordinates to plot
  - z, color, size: optional attributes for enhanced plotting
- Iteration over a PlotData instance yields per-set data with the specified keys accessible as attributes (e.g., entry.x, entry.y).

Copying and data integrity
- When copy_data is enabled, sources are copied to avoid altering the original data.
  - For dicts and pandas DataFrames, a shallow copy is performed.
  - For Bokeh ColumnDataSource, a dedicated copy routine is used.
- This improves safety when multiple plotting routines share the same data sources.

Same-length data handling
- When same_length is True and data are dict-like, all keys are normalized to have consistent lengths.
- This helps ensure that plotting axes and paired data align correctly across keys.

Adding data keys after initialization
- add_data_key(data_key, keys=None) allows introducing new keys post-initialization.
- If strict_data_keys is True, adding new keys is disallowed.
- If a key already exists, an error is raised.
- You can initialize the new key with a provided set of values (via keys) to align with existing sets.

Usage patterns
- Simple single-set plotting:
  - data = {'x': x_data, 'y': y_data}
  - p = PlotData(data, x='x', y='y')
  - for entry in p:
      plot using entry.x and entry.y
- Multi-set plotting:
  - data = [ds1, ds2]  # two data sources
  - p = PlotData(data, x=['x1', 'x2'], y=['y1', 'y2'])
  - iterate p to obtain per-set values for each (x_i, y_i)
- Mixed data sources:
  - data can be a mixture of dictionaries and pandas DataFrames (or ColumnDataSource when available)

Notes
- The module is designed to be plotting-backend agnostic, enabling plotting functions to operate on various data structures with minimal boilerplate.
- The internal utilities _is_bokeh_cds and _copy_bokeh_cds provide optional support for Bokeh sources, ensuring compatibility and safe copying when available.