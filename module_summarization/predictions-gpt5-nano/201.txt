Partial Dependence and Individual Conditional Expectation Plots
===============================================================

Overview
--------
Partial Dependence Plots (PDP) and Individual Conditional Expectation (ICE) plots are model-agnostic tools for visualizing how a feature influences the predicted outcome of a fitted model.

- PDP averages the model's predictions over the distribution of all other features while sweeping one feature along a grid of values.
- ICE plots display the modelâ€™s prediction for each individual observation as the target feature is varied, revealing heterogeneity and potential interactions.

What they show
---------------
- PDP:
  - Shows the average effect of a feature on the predicted outcome.
  - Helpful for understanding the marginal relationship between a feature and the target.
- ICE:
  - Shows, for each sample, how the prediction changes as the feature changes.
  - Reveals heterogeneity across instances and potential interactions with other features.
- PDP with ICE:
  - Both can be plotted together to compare the average effect with individual trajectories.

Usage and interpretation
------------------------
- Choose a feature (by index or name) and generate a grid of values over which to evaluate the model.
- For each grid value, replace the feature in the input data with that grid value while keeping other features fixed (or marginalized as appropriate) and compute predictions.
- PDP is the average of these predictions across samples; ICE plots show the per-sample predictions.
- Be cautious about features that are strongly correlated with others: marginalizing over correlated features can produce misleading interpretations.
- Centered ICE (where ICE curves are centered around a common reference) helps compare shapes independently of absolute levels.

Plot options
------------
- You can plot PDP, ICE, or both:
  - kind='average' plots only the PDP.
  - kind='both' plots both PDP and ICE trajectories.
- grid_resolution or a custom grid controls how many points are used for the feature grid.
- For multiple features, PDP/ICE can be plotted for each selected feature or in a grid of plots.

Internal helpers (validation and indexing)
------------------------------------------
- _check_feature_names(X, feature_names=None):
  - Validates and returns a list of feature names.
  - If feature_names is None, derives names from X (pandas columns or generic ["x0", "x1", ...] for NumPy arrays).
  - Raises an error if duplicates are found.
- _get_feature_index(fx, feature_names=None):
  - Accepts an int index or a string feature name.
  - If a name is provided and feature_names is not supplied, raises a clear error.
  - Returns the corresponding feature index.

Example (quick start)
---------------------
- Using a fitted estimator and a dataset X with optional feature names:

.. code-block:: python

    from sklearn.inspection import PartialDependenceDisplay

    # features can be indices or names if X has named columns
    features = [0, "feature_name"]
    display = PartialDependenceDisplay.from_estimator(
        estimator, X, features=features, grid_resolution=20, kind='both'
    )
    display.plot()
    display.figure_.tight_layout()
    display.figure_.show()

Notes
-----
- PDP/ICE are approximation tools; their reliability depends on the data distribution and feature correlations.
- When features are categorical, ensure the grid and replacement strategy respect category semantics.
- For complex models or high-dimensional inputs, consider focusing on a small, interpretable subset of features.