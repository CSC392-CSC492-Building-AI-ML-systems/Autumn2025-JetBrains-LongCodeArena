w_fluxanl
===========

A WestPA tool to extract fluxes into pre-defined target states, combine them across iterations, and construct Monte Carlo bootstrapped confidence intervals.

Synopsis
--------

w_fluxanl [OPTIONS]

Description
-----------

- Reads flux information from the WEST HDF5 data file for a user-specified range of iterations and, for each target state, computes:

  - mean_flux
  - mean_flux_ci_lb (lower bound of the confidence interval)
  - mean_flux_ci_ub (upper bound of the confidence interval)
  - mean_flux_correl_len (estimated correlation length)

- Uses Monte Carlo bootstrapping to account for possible correlations and non-Gaussian statistics in flux measurements.

- Non-graphical output (terminal and HDF5) assumes a propagation/resampling period tau = 1. To express results in physical units, divide all fluxes and multiply all correlation lengths by the true value of tau.

Flux data and output data structures
------------------------------------

- Flux data are stored per target as fluxentry_dtype with fields:
  - n_iter: iteration index
  - flux: flux value
  - count: number of recycling events contributing to the flux

- Per-target summary data are stored in target_index_dtype with fields:
  - target_label
  - mean_flux
  - mean_flux_ci_lb
  - mean_flux_ci_ub
  - mean_flux_correl_len

- extract_fluxes(iter_start=None, iter_stop=None, data_manager=None) returns a dictionary mapping target names (or target index) to a 1-D array of fluxentry_dtype (n_iter, flux, count).

How fluxes are extracted
------------------------

- The tool delegates to one of two internal routines depending on the HDF5 file version:

  - For file version < 7: _extract_fluxes_fileversion_lt_7(iter_start, iter_stop, data_manager)
    - Reads recycling data from old format tables.

  - For file version >= 7: _extract_fluxes_fileversion_7(iter_start, iter_stop, data_manager)
    - Reads new_weights information from the iteration following recycling
    - Aggregates flux by target state and trims to the last contiguous run for which the target exists

- The decision which routine to use is based on data_manager.we_h5file_version.

Output and groups
------------------

- Results are organized per target and can be written to an HDF5 output group (output_h5file and output_group) as configured by the tool.

- Target-specific results are accessible in the internal target_groups and fluxdata structures during processing.

CLI and options
---------------

- The tool wires in standard WestPA CLI options for:
  - Data input (via the WESTDataReader)
  - Iteration range selection (via IterRangeSelection)
  - Output configuration (via an output options group, including an -o option)

- The exact option names and semantics for -o and other output controls are determined by the integrated WestPA option framework.

Bootstrap, autocorrelation, and evolution
------------------------------------------

- alpha and autocorrel_alpha configure statistical bootstrapping and autocorrelation handling.

- n_sets specifies the number of bootstrap sets.

- do_evol and evol_step enable and configure optional evolution analysis over iteration windows.

Implementation notes
--------------------

- The tool uses WESTDataReader to parse inputs and IterRangeSelection to determine the iteration window.

- Iteration range defaults: iter_start = 1, iter_stop = current_iteration (when not explicitly provided).

- Output can be directed to terminal or HDF5, with unit conventions documented above (tau = 1).

Examples
--------

- Run with default settings:
  w_fluxanl

- Run with a specific output group:
  w_fluxanl -o <group>

See also
--------

- Other flux-analysis related tools in WestPA for comparison and compatibility (e.g., tools dealing with flux extraction and target-state statistics).