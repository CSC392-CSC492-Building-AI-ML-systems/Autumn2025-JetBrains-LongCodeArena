Working with Entities
=====================

Overview
--------
This section documents how to work with entities in the ftrack API. The primary entry point for interacting with entities is a Session. A Session provides access to remote entities, handles lazy loading of data, caching, and the management of pending operations. Entities themselves are represented by classes in the ftrack_api.entity package (for example base classes, factories and specific entity types such as locations).

Key concepts
- Session: Central object for interacting with an ftrack server. It holds configuration for how data is retrieved, cached and persisted.
- Lazy loading / auto-population: When auto_populate is enabled, accessing an entity attribute will trigger a fetch from the server if the attribute is not already loaded.
- Caching: Sessions use a layered caching strategy with a top-level memory cache. Custom caches can be supplied and are integrated into this layered approach.
- Cache key generation: A cache_key_maker is used to generate stable keys for objects stored in the cache. If not supplied, a default StringKeyMaker is used.
- Pending operations: The session tracks operations that have not yet been persisted to the server via an Operations container. You can control whether operations are recorded.
- Event hub integration: If auto_connect_event_hub is enabled, an embedded event hub will connect to the event server in the background, enabling publishing and (non-local) event subscriptions.
- Schema caching: Schema information can be cached on disk by setting a schema_cache_path. This can improve startup time and reduce server calls.
- Plugins: Found plugins may be discovered and registered at session startup, with optional plugin_arguments controlling plugin behaviour.

The Session: entry point for working with entities
---------------------------------------------------
- Establish a connection to an ftrack server by creating a Session with server_url, api_key and api_user. If any of these are omitted, environment variables may be used or a TypeError may be raised to indicate the required information is missing.
- Configure caching options via cache and cache_key_maker. The session will place your cache within a pre-configured layered cache hierarchy, ensuring a MemoryCache is available at the top.
- Control attribute loading behaviour with auto_populate. When true (the default), attribute access on entities will fetch missing data from the server on demand.
- Optionally enable an embedded event hub by setting auto_connect_event_hub to True. The hub runs in a background thread, and plugins may rely on a connected hub for event publishing and subscription.
- Use schema caching to improve performance for repeated sessions by setting schema_cache_path. You can disable schema caching by setting this path to False.

Entity model and access
-----------------------
- Entities are defined in modules such as ftrack_api.entity.base and ftrack_api.entity.factory. The factory module is used to create entity instances, while the base module provides the common building blocks for all entities.
- Attributes on an entity are exposed in a way that supports lazy loading. If auto_populate is enabled, missing attribute data will be retrieved from the server when the attribute is accessed.
- Collections and query results are represented with ftrack_api.collection and ftrack_api.query, providing convenient iteration and filtering capabilities over sets of entities.

Pending operations and persistence
-----------------------------------
- The session tracks operations that have not yet been committed to the server via recorded_operations (an Operations instance). You can inspect and control the recording of operations through the session.
- When operations are executed (via the APIâ€™s operation mechanisms), changes to entities can be persisted back to the server.

Authentication for HTTP requests
------------------------------
The SessionAuthentication helper attaches the required authentication headers to outgoing HTTP requests:
- ftrack-api-key: your API key
- ftrack-user: your API user

Usage notes
- If server_url is not provided, FTRACK_SERVER environment variable will be consulted. If still missing, a TypeError is raised.
- If api_key or api_user are not provided, the corresponding environment variables (FTRACK_API_KEY, FTRACK_API_USER) or safe fallbacks are consulted.
- The auto-populate and caching features are designed to optimize interaction with the server, reducing latency and the number of remote calls.
- The embedded event hub can be useful for real-time integrations but may introduce background threading considerations.

See also
--------
- ftrack_api.entity.base: Base class for ftrack entities
- ftrack_api.entity.factory: Entity factory for creating entity instances
- ftrack_api.collection: Collection utilities for grouping entities
- ftrack_api.query: Query builder and execution
- ftrack_api.attribute: Entity attributes and loading behavior
- ftrack_api.cache: Cache interfaces and implementations
- ftrack_api.event.hub: Event hub integration
- ftrack_api.structure.origin and ftrack_api.structure.entity_id: Internal identity and origin tracking
- ftrack_api.plugin: Plugin discovery and registration
- ftrack_api.logging: Logging utilities (including LazyLogMessage)

Example workflow (conceptual)
- Create a Session with server URL and credentials.
- Access entities; enabling auto_populate allows on-demand loading of missing attributes.
- Use queries and collections to locate desired entities.
- Inspect and modify entities; changes are recorded in recorded_operations until persisted.
- Optionally connect to the event hub for real-time event handling.