Using metadata
==============

This section describes how metadata is used within the session and how to configure it for optimal interaction with the ftrack server.

Overview
--------

Metadata in the client covers aspects such as authentication information, caching strategies, schema caching, and session lifecycle behavior. The Session class centralises this metadata, allowing you to customise how the client caches data, how keys are generated for stored objects, and how and when the schema cache is populated.

Key configuration points
------------------------

- Server and authentication
  - server_url: URL of the ftrack server (including port if needed).
  - api_key and api_user: credentials used for authentication. If not provided, the client will look for FTRACK_API_KEY (or FTRACK_APIKEY for backward compatibility) and FTRACK_API_USER in the environment, or fall back to the current user for api_user.
  - SessionAuthentication: attaches authentication headers to each request (ftrack-api-key and ftrack-user).

- Caching
  - cache: an instance implementing ftrack_api.cache.Cache, or a callable(session) that returns a cache or None if unavailable. The Session will integrate this cache into a layered top-level MemoryCache.
  - cache_key_maker: determines how keys for cached objects are generated. If not provided, a StringKeyMaker is used.

- Schema caching
  - schema_cache_path: directory path to store schema cache data. If not set, FTRACK_API_SCHEMA_CACHE_PATH environment variable is consulted; if that is also not set, a temporary directory is used. Set to False to disable schema caching entirely.

- Session behavior
  - auto_populate: if True (default), accessing attributes may trigger automatic fetching from the server if not already loaded.
  - auto_connect_event_hub: if True, an embedded event hub will automatically connect to the event server to publish/subscribe non-local events. If False, hub connection must be performed manually via EventHub.connect.
  - plugin_paths and plugin_arguments: control plugin discovery and argument passing to discovered plugins.

Environment variables affecting metadata
---------------------------------------

- FTRACK_SERVER: default server URL if server_url is not explicitly provided.
- FTRACK_API_KEY or FTRACK_APIKEY: API key for authentication.
- FTRACK_API_USER: API user name for authentication.
- FTRACK_API_SCHEMA_CACHE_PATH: path to store schema cache data.
- Potential other environment variables may influence plugin discovery and other session configuration aspects.

Notes
-----

- The top-level cache is always a MemoryCache to ensure consistent caching behaviour unless explicitly overridden.
- The session is designed to perform certain operations in the background (e.g., event hub connection) to improve startup time; plugins should check hub status if necessary.

Examples (conceptual)
-----------------------

- Create a session with explicit credentials and default caching behavior:
  - Session(server_url="https://ftrack.example.com", api_key="KEY", api_user="user")

- Enable schema caching via a directory:
  - Session(server_url="https://ftrack.example.com", api_key="KEY", api_user="user", schema_cache_path="/var/cache/ftrack/schema")

- Use a custom cache and key maker:
  - custom_cache = MyCacheImplementation()
  - Session(server_url="https://ftrack.example.com", api_key="KEY", api_user="user",
            cache=custom_cache, cache_key_maker=MyKeyMaker())